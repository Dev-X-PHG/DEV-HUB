
local b64 = 'aWYgbm90IGdhbWU6SXNMb2FkZWQoKSB0aGVuCiAgICBnYW1lLkxvYWRlZDpXYWl0KCkKZW5kCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBWaXJ0dWFsVXNlciA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKbG9jYWwgUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBSZW1vdGVzID0gUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJSZW1vdGVzIiwgNSkKbG9jYWwgQ29tbUYgPSBSZW1vdGVzOldhaXRGb3JDaGlsZCgiQ29tbUZfIiwgNSkgCmxvY2FsIFBsYXllckd1aSA9IFBsYXllcjpXYWl0Rm9yQ2hpbGQoIlBsYXllckd1aSIsIDUpCmxvY2FsIE1haW5HdWkgPSBQbGF5ZXJHdWk6V2FpdEZvckNoaWxkKCJNYWluIiwgNSkKbG9jYWwgbGFzdE5vdGlmaWNhdGlvblRpbWUgPSAwCmxvY2FsIG5vdGlmaWNhdGlvbkNvb2xkb3duID0gMTAKbG9jYWwgY3VycmVudFRpbWUgPSB0aWNrKCkKaWYgY3VycmVudFRpbWUgLSBsYXN0Tm90aWZpY2F0aW9uVGltZSA+PSBub3RpZmljYXRpb25Db29sZG93biB0aGVuCiAgICBnYW1lLlN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICBUaXRsZSA9ICJIaXJ1IEh1YiIsCiAgICAgICAgVGV4dCA9ICJMb2FkaW5nIiwKICAgICAgICBEdXJhdGlvbiA9IDUKICAgIH0pCiAgICBsYXN0Tm90aWZpY2F0aW9uVGltZSA9IGN1cnJlbnRUaW1lCmVuZApsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBFZmZlY3RDb250YWluZXIgPSBSZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCgiRWZmZWN0IikgYW5kIFJlcGxpY2F0ZWRTdG9yYWdlLkVmZmVjdDpGaW5kRmlyc3RDaGlsZCgiQ29udGFpbmVyIikKaWYgRWZmZWN0Q29udGFpbmVyIHRoZW4KICAgIGxvY2FsIERlYXRoID0gRWZmZWN0Q29udGFpbmVyOkZpbmRGaXJzdENoaWxkKCJEZWF0aCIpCiAgICBpZiBEZWF0aCB0aGVuCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwocmVxdWlyZSwgRGVhdGgpCiAgICAgICAgaWYgc3VjY2VzcyBhbmQgdHlwZShyZXN1bHQpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICBob29rZnVuY3Rpb24ocmVzdWx0LCBmdW5jdGlvbigpIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAogICAgbG9jYWwgUmVzcGF3biA9IEVmZmVjdENvbnRhaW5lcjpGaW5kRmlyc3RDaGlsZCgiUmVzcGF3biIpCiAgICBpZiBSZXNwYXduIHRoZW4KICAgICAgICBsb2NhbCBzdWNjZXNzLCByZXN1bHQgPSBwY2FsbChyZXF1aXJlLCBSZXNwYXduKQogICAgICAgIGlmIHN1Y2Nlc3MgYW5kIHR5cGUocmVzdWx0KSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgaG9va2Z1bmN0aW9uKHJlc3VsdCwgZnVuY3Rpb24oKSBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCmxvY2FsIEd1aWRlTW9kdWxlID0gUmVwbGljYXRlZFN0b3JhZ2U6RmluZEZpcnN0Q2hpbGQoIkd1aWRlTW9kdWxlIikKaWYgR3VpZGVNb2R1bGUgdGhlbgogICAgbG9jYWwgc3VjY2VzcywgbW9kdWxlID0gcGNhbGwocmVxdWlyZSwgR3VpZGVNb2R1bGUpCiAgICBpZiBzdWNjZXNzIGFuZCBtb2R1bGUgYW5kIHR5cGUobW9kdWxlLkNoYW5nZURpc3BsYXllZE5QQykgPT0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgaG9va2Z1bmN0aW9uKG1vZHVsZS5DaGFuZ2VEaXNwbGF5ZWROUEMsIGZ1bmN0aW9uKCkgZW5kKQogICAgZW5kCmVuZApsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBVdGlsID0gUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJVdGlsIiwgNSkKaWYgVXRpbCB0aGVuCiAgICBsb2NhbCBDYW1lcmFTaGFrZXIgPSBVdGlsOkZpbmRGaXJzdENoaWxkKCJDYW1lcmFTaGFrZXIiKQogICAgaWYgQ2FtZXJhU2hha2VyIHRoZW4KICAgICAgICByZXF1aXJlKENhbWVyYVNoYWtlcik6U3RvcCgpCiAgICBlbmQKZW5kCmxvY2FsIHBsYWNlSWQgPSBnYW1lLlBsYWNlSWQKbG9jYWwgd29ybGRNYXAgPSB7CiAgICBbMjc1MzkxNTU0OV0gPSB0cnVlLAogICAgWzQ0NDIyNzIxODNdID0gdHJ1ZSwKICAgIFs3NDQ5NDIzNjM1XSA9IHRydWUKfQppZiB3b3JsZE1hcFtwbGFjZUlkXSB0aGVuCiAgICBpZiBwbGFjZUlkID09IDI3NTM5MTU1NDkgdGhlbgogICAgICAgIFdvcmxkMSA9IHRydWUKICAgIGVsc2VpZiBwbGFjZUlkID09IDQ0NDIyNzIxODMgdGhlbgogICAgICAgIFdvcmxkMiA9IHRydWUKICAgIGVsc2VpZiBwbGFjZUlkID09IDc0NDk0MjM2MzUgdGhlbgogICAgICAgIFdvcmxkMyA9IHRydWUKICAgIGVuZAplbHNlCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXI6S2ljaygiVW5zdXBwb3J0ZWQgR2FtZSIpCmVuZApyZXBlYXQKICAgIHdhaXQoKQp1bnRpbCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCmZ1bmN0aW9uIENoZWNrUXVlc3QoKSAKICAgIE15TGV2ZWwgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLkxldmVsLlZhbHVlCiAgICBpZiBXb3JsZDEgdGhlbgogICAgICAgIGlmIE15TGV2ZWwgPj0gMSBhbmQgTXlMZXZlbCA8PSA5IHRoZW4KICAgICAgICAgICAgTW9uID0gIkJhbmRpdCIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkJhbmRpdFF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJCYW5kaXQiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygxMDU5LjM3MTk1LCAxNS40NDk1MDY4LCAxNTUwLjQyMzEsIDAuOTM5NzAwNTQ0LCAtMCwgLTAuMzQxOTk4MzY5LCAwLCAxLCAtMCwgMC4zNDE5OTgzNjksIDAsIDAuOTM5NzAwNTQ0KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KDEwNDUuOTYyNjQ2NDg0Mzc1LCAyNy4wMDI1MDgxNjM0NTIxNSwgMTU2MC44MjAzMTI1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDEwIGFuZCBNeUxldmVsIDw9IDE0IHRoZW4KICAgICAgICAgICAgTW9uID0gIk1vbmtleSIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkp1bmdsZVF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIk1vbmtleSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xNTk4LjA4OTExLCAzNS41NTAxMTc1LCAxNTMuMzc3ODM4LCAwLCAwLCAxLCAwLCAxLCAtMCwgLTEsIDAsIDApCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTE0NDguNTE4MDY2NDA2MjUsIDY3Ljg1MzAxMjA4NDk2MDk0LCAxMS40NjU3OTY0NzA2NDIwOSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxNSBhbmQgTXlMZXZlbCA8PSAyOSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJHb3JpbGxhIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiSnVuZ2xlUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiR29yaWxsYSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xNTk4LjA4OTExLCAzNS41NTAxMTc1LCAxNTMuMzc3ODM4LCAwLCAwLCAxLCAwLCAxLCAtMCwgLTEsIDAsIDApCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTExMjkuODgzNjY2OTkyMTg3NSwgNDAuNDYzNTQ2NzUyOTI5NjksIC01MjUuNDIzNzA2MDU0Njg3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAzMCBhbmQgTXlMZXZlbCA8PSAzOSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJQaXJhdGUiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJCdWdneVF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJQaXJhdGUiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtMTE0MS4wNzQ4MywgNC4xMDAwMTgwMiwgMzgzMS41NDk4LCAwLjk2NTkyOTYyNywgLTAsIC0wLjI1ODgwNDc5OCwgMCwgMSwgLTAsIDAuMjU4ODA0Nzk4LCAwLCAwLjk2NTkyOTYyNykKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMTEwMy41MTM0Mjc3MzQzNzUsIDEzLjc1MjA1MjMwNzEyODkwNiwgMzg5Ni4wOTEwNjQ0NTMxMjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gNDAgYW5kIE15TGV2ZWwgPD0gNTkgdGhlbgogICAgICAgICAgICBNb24gPSAiQnJ1dGUiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJCdWdneVF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJCcnV0ZSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xMTQxLjA3NDgzLCA0LjEwMDAxODAyLCAzODMxLjU0OTgsIDAuOTY1OTI5NjI3LCAtMCwgLTAuMjU4ODA0Nzk4LCAwLCAxLCAtMCwgMC4yNTg4MDQ3OTgsIDAsIDAuOTY1OTI5NjI3KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0xMTQwLjA4Mzc0MDIzNDM3NSwgMTQuODA5ODg1MDI1MDI0NDE0LCA0MzIyLjkyMTM4NjcxODc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDYwIGFuZCBNeUxldmVsIDw9IDc0IHRoZW4KICAgICAgICAgICAgTW9uID0gIkRlc2VydCBCYW5kaXQiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJEZXNlcnRRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJEZXNlcnQgQmFuZGl0IgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoODk0LjQ4ODY0NywgNS4xNDAwMDcwMiwgNDM5Mi40MzM1OSwgMC44MTkxNTU2OTMsIC0wLCAtMC41NzM1NzEyNjUsIDAsIDEsIC0wLCAwLjU3MzU3MTI2NSwgMCwgMC44MTkxNTU2OTMpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoOTI0Ljc5OTgwNDY4NzUsIDYuNDQ4Njc0Njc4ODAyNDksIDQ0ODEuNTg1OTM3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA3NSBhbmQgTXlMZXZlbCA8PSA4OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJEZXNlcnQgT2ZmaWNlciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkRlc2VydFF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIkRlc2VydCBPZmZpY2VyIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoODk0LjQ4ODY0NywgNS4xNDAwMDcwMiwgNDM5Mi40MzM1OSwgMC44MTkxNTU2OTMsIC0wLCAtMC41NzM1NzEyNjUsIDAsIDEsIC0wLCAwLjU3MzU3MTI2NSwgMCwgMC44MTkxNTU2OTMpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoMTYwOC4yODIyMjY1NjI1LCA4LjYxNDIyNDQzMzg5ODkyNiwgNDM3MS4wMDczMjQyMTg3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA5MCBhbmQgTXlMZXZlbCA8PSA5OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJTbm93IEJhbmRpdCIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIlNub3dRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJTbm93IEJhbmRpdCIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDEzODkuNzQ0NTEsIDg4LjE1MTkzMTgsIC0xMjk4LjkwNzk2LCAtMC4zNDIwNDI2ODUsIDAsIDAuOTM5Njg0MzkxLCAwLCAxLCAwLCAtMC45Mzk2ODQzOTEsIDAsIC0wLjM0MjA0MjY4NSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygxMzU0LjM0NzkwMDM5MDYyNSwgODcuMjcyNzczNzQyNjc1NzgsIC0xMzkzLjk0NjUzMzIwMzEyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxMDAgYW5kIE15TGV2ZWwgPD0gMTE5IHRoZW4KICAgICAgICAgICAgTW9uID0gIlNub3dtYW4iCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJTbm93UXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiU25vd21hbiIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDEzODkuNzQ0NTEsIDg4LjE1MTkzMTgsIC0xMjk4LjkwNzk2LCAtMC4zNDIwNDI2ODUsIDAsIDAuOTM5Njg0MzkxLCAwLCAxLCAwLCAtMC45Mzk2ODQzOTEsIDAsIC0wLjM0MjA0MjY4NSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygxMjAxLjY0MTIzNTM1MTU2MjUsIDE0NC41Nzk1ODk4NDM3NSwgLTE1NTAuMDY3MDE2NjAxNTYyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxMjAgYW5kIE15TGV2ZWwgPD0gMTQ5IHRoZW4KICAgICAgICAgICAgTW9uID0gIkNoaWVmIFBldHR5IE9mZmljZXIiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJNYXJpbmVRdWVzdDIiCiAgICAgICAgICAgIE5hbWVNb24gPSAiQ2hpZWYgUGV0dHkgT2ZmaWNlciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC01MDM5LjU4NjQzLCAyNy4zNTAwMzg1LCA0MzI0LjY4MDE4LCAwLCAwLCAtMSwgMCwgMSwgMCwgMSwgMCwgMCkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtNDg4MS4yMzA5NTcwMzEyNSwgMjIuNjUyMDQ0Mjk2MjY0NjUsIDQyNzMuNzUyNDQxNDA2MjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTUwIGFuZCBNeUxldmVsIDw9IDE3NCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJTa3kgQmFuZGl0IgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiU2t5UXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiU2t5IEJhbmRpdCIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC00ODM5LjUzMDI3LCA3MTYuMzY4NTkxLCAtMjYxOS40NDE2NSwgMC44NjYwMDcyNjgsIDAsIDAuNTAwMDMxNDEyLCAwLCAxLCAwLCAtMC41MDAwMzE0MTIsIDAsIDAuODY2MDA3MjY4KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC00OTUzLjIwNzAzMTI1LCAyOTUuNzQ0MjAxNjYwMTU2MjUsIC0yODk5LjIyOTAwMzkwNjI1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDE3NSBhbmQgTXlMZXZlbCA8PSAxODkgdGhlbgogICAgICAgICAgICBNb24gPSAiRGFyayBNYXN0ZXIiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJTa3lRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJEYXJrIE1hc3RlciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC00ODM5LjUzMDI3LCA3MTYuMzY4NTkxLCAtMjYxOS40NDE2NSwgMC44NjYwMDcyNjgsIDAsIDAuNTAwMDMxNDEyLCAwLCAxLCAwLCAtMC41MDAwMzE0MTIsIDAsIDAuODY2MDA3MjY4KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC01MjU5Ljg0NDcyNjU2MjUsIDM5MS4zOTc2NzQ1NjA1NDY5LCAtMjIyOS4wMzU0MDAzOTA2MjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTkwIGFuZCBNeUxldmVsIDw9IDIwOSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJQcmlzb25lciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIlByaXNvbmVyUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiUHJpc29uZXIiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldyg1MzA4LjkzMTE1LCAxLjY1NTE3NTIxLCA0NzUuMTIwNTE0LCAtMC4wODk0Mjc0NzEyLCAtNS4wMDI5MjkxOGUtMDksIC0wLjk5NTk5MzMxNiwgMS42MDgxNzg1OWUtMDksIDEsIC01LjE2NzQ0ODY5ZS0wOSwgMC45OTU5OTMzMTYsIC0yLjA2Mzg0NzA5ZS0wOSwgLTAuMDg5NDI3NDcxMikKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg1MDk4Ljk3MzYzMjgxMjUsIC0wLjMyMDQwNTgxMTA3MTM5NTksIDQ3NC4yMzczMzUyMDUwNzgxKQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDIxMCBhbmQgTXlMZXZlbCA8PSAyNDkgdGhlbgogICAgICAgICAgICBNb24gPSAiRGFuZ2Vyb3VzIFByaXNvbmVyIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiUHJpc29uZXJRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJEYW5nZXJvdXMgUHJpc29uZXIiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldyg1MzA4LjkzMTE1LCAxLjY1NTE3NTIxLCA0NzUuMTIwNTE0LCAtMC4wODk0Mjc0NzEyLCAtNS4wMDI5MjkxOGUtMDksIC0wLjk5NTk5MzMxNiwgMS42MDgxNzg1OWUtMDksIDEsIC01LjE2NzQ0ODY5ZS0wOSwgMC45OTU5OTMzMTYsIC0yLjA2Mzg0NzA5ZS0wOSwgLTAuMDg5NDI3NDcxMikKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg1NjU0LjU2MzQ3NjU2MjUsIDE1LjYzMzQwMTg3MDcyNzUzOSwgODY2LjI5OTE5NDMzNTkzNzUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjUwIGFuZCBNeUxldmVsIDw9IDI3NCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJUb2dhIFdhcnJpb3IiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJDb2xvc3NldW1RdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJUb2dhIFdhcnJpb3IiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtMTU4MC4wNDY2MywgNi4zNTAwMDI3NywgLTI5ODYuNDc1MzQsIC0wLjUxNTAzNzI5OCwgMCwgLTAuODU3MTY3NzIxLCAwLCAxLCAwLCAwLjg1NzE2NzcyMSwgMCwgLTAuNTE1MDM3Mjk4KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0xODIwLjIxNDg0Mzc1LCA1MS42ODM4NTY5NjQxMTEzMywgLTI3NDAuNjY1MDM5MDYyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAyNzUgYW5kIE15TGV2ZWwgPD0gMjk5IHRoZW4KICAgICAgICAgICAgTW9uID0gIkdsYWRpYXRvciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkNvbG9zc2V1bVF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIkdsYWRpYXRvciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xNTgwLjA0NjYzLCA2LjM1MDAwMjc3LCAtMjk4Ni40NzUzNCwgLTAuNTE1MDM3Mjk4LCAwLCAtMC44NTcxNjc3MjEsIDAsIDEsIDAsIDAuODU3MTY3NzIxLCAwLCAtMC41MTUwMzcyOTgpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTEyOTIuODM4MTM0NzY1NjI1LCA1Ni4zODA4ODIyNjMxODM1OTQsIC0zMzM5LjAzMTQ5NDE0MDYyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAzMDAgYW5kIE15TGV2ZWwgPD0gMzI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIk1pbGl0YXJ5IFNvbGRpZXIiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJNYWdtYVF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIk1pbGl0YXJ5IFNvbGRpZXIiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtNTMxMy4zNzAxMiwgMTAuOTUwMDA4NCwgODUxNS4yOTM5NSwgLTAuNDk5OTU5NDY5LCAwLCAwLjg2NjA0ODgxMywgMCwgMSwgMCwgLTAuODY2MDQ4ODEzLCAwLCAtMC40OTk5NTk0NjkpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTU0MTEuMTY0NTUwNzgxMjUsIDExLjA4MTU1NDQxMjg0MTc5NywgODQ1NC4yOTI5Njg3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAzMjUgYW5kIE15TGV2ZWwgPD0gMzc0IHRoZW4KICAgICAgICAgICAgTW9uID0gIk1pbGl0YXJ5IFNweSIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIk1hZ21hUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiTWlsaXRhcnkgU3B5IgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTUzMTMuMzcwMTIsIDEwLjk1MDAwODQsIDg1MTUuMjkzOTUsIC0wLjQ5OTk1OTQ2OSwgMCwgMC44NjYwNDg4MTMsIDAsIDEsIDAsIC0wLjg2NjA0ODgxMywgMCwgLTAuNDk5OTU5NDY5KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC01ODAyLjg2ODE2NDA2MjUsIDg2LjI2MjQxMzAyNDkwMjM0LCA4ODI4Ljg1OTM3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAzNzUgYW5kIE15TGV2ZWwgPD0gMzk5IHRoZW4KICAgICAgICAgICAgTW9uID0gIkZpc2htYW4gV2FycmlvciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkZpc2htYW5RdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJGaXNobWFuIFdhcnJpb3IiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldyg2MTEyMi42NTIzNDM3NSwgMTguNDk3NDQyMjQ1NDgzLCAxNTY5LjM5OTc4MDI3MzQpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoNjA4NzguMzAwNzgxMjUsIDE4LjQ4MjgzMDA0NzYwNzQyMiwgMTU0My43NTc0NDYyODkwNjI1KQogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0Zhcm0gYW5kIChDRnJhbWVRdWVzdC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigicmVxdWVzdEVudHJhbmNlIixWZWN0b3IzLm5ldyg2MTE2My44NTE1NjI1LCAxMS42Nzk2ODc1LCAxODE5Ljc4NDE3OTY4NzUpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA0MDAgYW5kIE15TGV2ZWwgPD0gNDQ5IHRoZW4KICAgICAgICAgICAgTW9uID0gIkZpc2htYW4gQ29tbWFuZG8iCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJGaXNobWFuUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiRmlzaG1hbiBDb21tYW5kbyIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDYxMTIyLjY1MjM0Mzc1LCAxOC40OTc0NDIyNDU0ODMsIDE1NjkuMzk5NzgwMjczNCkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg2MTkyMi42MzI4MTI1LCAxOC40ODI4MzAwNDc2MDc0MjIsIDE0OTMuOTM0MzI2MTcxODc1KQogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0Zhcm0gYW5kIChDRnJhbWVRdWVzdC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigicmVxdWVzdEVudHJhbmNlIixWZWN0b3IzLm5ldyg2MTE2My44NTE1NjI1LCAxMS42Nzk2ODc1LCAxODE5Ljc4NDE3OTY4NzUpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA0NTAgYW5kIE15TGV2ZWwgPD0gNDc0IHRoZW4KICAgICAgICAgICAgTW9uID0gIkdvZCdzIEd1YXJkIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiU2t5RXhwMVF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIkdvZCdzIEd1YXJkIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTQ3MjEuODg4NjcsIDg0My44NzQ2OTUsIC0xOTQ5Ljk2NjQzLCAwLjk5NjE5MTg1OSwgLTAsIC0wLjA4NzE4ODQzMDEsIDAsIDEsIC0wLCAwLjA4NzE4ODQzMDEsIDAsIDAuOTk2MTkxODU5KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC00NzEwLjA0Mjk2ODc1LCA4NDUuMjc2OTc3NTM5MDYyNSwgLTE5MjcuMzA3OTgzMzk4NDM3NSkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9GYXJtIGFuZCAoQ0ZyYW1lUXVlc3QuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDEwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoInJlcXVlc3RFbnRyYW5jZSIsVmVjdG9yMy5uZXcoLTQ2MDcuODIyNzUsIDg3Mi41NDI0OCwgLTE2NjcuNTU2ODgpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA0NzUgYW5kIE15TGV2ZWwgPD0gNTI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIlNoYW5kYSIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIlNreUV4cDFRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJTaGFuZGEiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtNzg1OS4wOTgxNCwgNTU0NC4xOTA0MywgLTM4MS40NzYxOTYsIC0wLjQyMjU5Mjk5OCwgMCwgMC45MDYzMTk2MTgsIDAsIDEsIDAsIC0wLjkwNjMxOTYxOCwgMCwgLTAuNDIyNTkyOTk4KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC03Njc4LjQ4OTc0NjA5Mzc1LCA1NTY2LjQwMzgwODU5Mzc1LCAtNDk3LjIxNTYwNjY4OTQ1MzEpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvRmFybSBhbmQgKENGcmFtZVF1ZXN0LlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPiAxMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJyZXF1ZXN0RW50cmFuY2UiLFZlY3RvcjMubmV3KC03ODk0LjYxNzY3NTc4MTMsIDU1NDcuMTQxNjAxNTYyNSwgLTM4MC4yOTExOTg3MzA0NykpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDUyNSBhbmQgTXlMZXZlbCA8PSA1NDkgdGhlbgogICAgICAgICAgICBNb24gPSAiUm95YWwgU3F1YWQiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJTa3lFeHAyUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiUm95YWwgU3F1YWQiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtNzkwNi44MTU5MiwgNTYzNC42NjI2LCAtMTQxMS45OTE5NCwgMCwgMCwgLTEsIDAsIDEsIDAsIDEsIDAsIDApCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTc2MjQuMjUyNDQxNDA2MjUsIDU2NTguMTMzMzAwNzgxMjUsIC0xNDY3LjM1NDI0ODA0Njg3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA1NTAgYW5kIE15TGV2ZWwgPD0gNjI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIlJveWFsIFNvbGRpZXIiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJTa3lFeHAyUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiUm95YWwgU29sZGllciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC03OTA2LjgxNTkyLCA1NjM0LjY2MjYsIC0xNDExLjk5MTk0LCAwLCAwLCAtMSwgMCwgMSwgMCwgMSwgMCwgMCkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtNzgzNi43NTM0MTc5Njg3NSwgNTY0NS42NjQwNjI1LCAtMTc5MC42MjM2NTcyMjY1NjI1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDYyNSBhbmQgTXlMZXZlbCA8PSA2NDkgdGhlbgogICAgICAgICAgICBNb24gPSAiR2FsbGV5IFBpcmF0ZSIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkZvdW50YWluUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiR2FsbGV5IFBpcmF0ZSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDUyNTkuODE5ODIsIDM3LjM1MDAxNzUsIDQwNTAuMDI5MywgMC4wODcxMzEzODEsIDAsIDAuOTk2MTk2ODY2LCAwLCAxLCAwLCAtMC45OTYxOTY4NjYsIDAsIDAuMDg3MTMxMzgxKQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KDU1NTEuMDIxOTcyNjU2MjUsIDc4LjkwMTM1MTkyODcxMDk0LCAzOTMwLjQxMjg0MTc5Njg3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA2NTAgdGhlbgogICAgICAgICAgICBNb24gPSAiR2FsbGV5IENhcHRhaW4iCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJGb3VudGFpblF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIkdhbGxleSBDYXB0YWluIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoNTI1OS44MTk4MiwgMzcuMzUwMDE3NSwgNDA1MC4wMjkzLCAwLjA4NzEzMTM4MSwgMCwgMC45OTYxOTY4NjYsIDAsIDEsIDAsIC0wLjk5NjE5Njg2NiwgMCwgMC4wODcxMzEzODEpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoNTQ0MS45NTE2NjAxNTYyNSwgNDIuNTAyMDU5OTM2NTIzNDQsIDQ5NTAuMDkzNzUpCiAgICAgICAgZW5kCiAgICBlbHNlaWYgV29ybGQyIHRoZW4KICAgICAgICBpZiBNeUxldmVsID49IDcwMCBhbmQgTXlMZXZlbCA8PSA3MjQgdGhlbgogICAgICAgICAgICBNb24gPSAiUmFpZGVyIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiQXJlYTFRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJSYWlkZXIiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtNDI5LjU0MzUxOCwgNzEuNzY5OTk2NiwgMTgzNi4xODE4OCwgLTAuMjI0OTU5ODUsIDAsIC0wLjk3NDM2ODA5NSwgMCwgMSwgMCwgMC45NzQzNjgwOTUsIDAsIC0wLjIyNDk1OTg1KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC03MjguMzI2NzIxMTkxNDA2MiwgNTIuNzc5MzE5NzYzMTgzNTk0LCAyMzQ1Ljc3MDUwNzgxMjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gNzI1IGFuZCBNeUxldmVsIDw9IDc3NCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJNZXJjZW5hcnkiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJBcmVhMVF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIk1lcmNlbmFyeSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC00MjkuNTQzNTE4LCA3MS43Njk5OTY2LCAxODM2LjE4MTg4LCAtMC4yMjQ5NTk4NSwgMCwgLTAuOTc0MzY4MDk1LCAwLCAxLCAwLCAwLjk3NDM2ODA5NSwgMCwgLTAuMjI0OTU5ODUpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTEwMDQuMzI0NDAxODU1NDY4OCwgODAuMTU4ODY2ODgyMzI0MjIsIDE0MjQuNjE5Mzg0NzY1NjI1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDc3NSBhbmQgTXlMZXZlbCA8PSA3OTkgdGhlbgogICAgICAgICAgICBNb24gPSAiU3dhbiBQaXJhdGUiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJBcmVhMlF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIlN3YW4gUGlyYXRlIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoNjM4LjQzODExLCA3MS43Njk5ODksIDkxOC4yODI4OTgsIDAuMTM5MjAzOTA2LCAwLCAwLjk5MDI2Mzc2LCAwLCAxLCAwLCAtMC45OTAyNjM3NiwgMCwgMC4xMzkyMDM5MDYpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoMTA2OC42NjQzMDY2NDA2MjUsIDEzNy42MTQyODgzMzAwNzgxMiwgMTMyMi4xMDYwNzkxMDE1NjI1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDgwMCBhbmQgTXlMZXZlbCA8PSA4NzQgdGhlbgogICAgICAgICAgICBNb24gPSAiRmFjdG9yeSBTdGFmZiIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkFyZWEyUXVlc3QiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVNb24gPSAiRmFjdG9yeSBTdGFmZiIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDYzMi42OTg2MDgsIDczLjEwNTU5MDgsIDkxOC42NjYzMjEsIC0wLjAzMTk3MjIzNjksIDguOTYwNzQ4ODFlLTEwLCAtMC45OTk0ODg3NzEsIDEuMzYzMjY1MzNlLTEwLCAxLCA4LjkyMTcyMzM2ZS0xMCwgMC45OTk0ODg3NzEsIC0xLjA3NzMyMDg3ZS0xMCwgLTAuMDMxOTcyMjM2OSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg3My4wNzg2NzQzMTY0MDYyNSwgODEuODYzNDQxNDY3Mjg1MTYsIC0yNy40NzA2NzI2MDc0MjE4NzUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gODc1IGFuZCBNeUxldmVsIDw9IDg5OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJNYXJpbmUgTGlldXRlbmFudCIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIk1hcmluZVF1ZXN0MyIKICAgICAgICAgICAgTmFtZU1vbiA9ICJNYXJpbmUgTGlldXRlbmFudCIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0yNDQwLjc5NjM5LCA3MS43MTQwNzMyLCAtMzIxNi4wNjgxMiwgMC44NjYwMDcyNjgsIDAsIDAuNTAwMDMxNDEyLCAwLCAxLCAwLCAtMC41MDAwMzE0MTIsIDAsIDAuODY2MDA3MjY4KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0yODIxLjM3MjMxNDQ1MzEyNSwgNzUuODk3Mjc3ODMyMDMxMjUsIC0zMDcwLjA4OTExMTMyODEyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA5MDAgYW5kIE15TGV2ZWwgPD0gOTQ5IHRoZW4KICAgICAgICAgICAgTW9uID0gIk1hcmluZSBDYXB0YWluIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiTWFyaW5lUXVlc3QzIgogICAgICAgICAgICBOYW1lTW9uID0gIk1hcmluZSBDYXB0YWluIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTI0NDAuNzk2MzksIDcxLjcxNDA3MzIsIC0zMjE2LjA2ODEyLCAwLjg2NjAwNzI2OCwgMCwgMC41MDAwMzE0MTIsIDAsIDEsIDAsIC0wLjUwMDAzMTQxMiwgMCwgMC44NjYwMDcyNjgpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTE4NjEuMjMxMDc5MTAxNTYyNSwgODAuMTc2NTgyMzM2NDI1NzgsIC0zMjU0LjY5NzUwOTc2NTYyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSA5NTAgYW5kIE15TGV2ZWwgPD0gOTc0IHRoZW4KICAgICAgICAgICAgTW9uID0gIlpvbWJpZSIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIlpvbWJpZVF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIlpvbWJpZSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC01NDk3LjA2MTUyLCA0Ny41OTIzMDA0LCAtNzk1LjIzNzA2MSwgLTAuMjkyNDIxNDYsIDAsIC0wLjk1NjI4OTUzLCAwLCAxLCAwLCAwLjk1NjI4OTUzLCAwLCAtMC4yOTI0MjE0NikKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtNTY1Ny43NzY4NTU0Njg3NSwgNzguOTY5NzM0MTkxODk0NTMsIC05MjguNjg3MDExNzE4NzUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gOTc1IGFuZCBNeUxldmVsIDw9IDk5OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJWYW1waXJlIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiWm9tYmllUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiVmFtcGlyZSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC01NDk3LjA2MTUyLCA0Ny41OTIzMDA0LCAtNzk1LjIzNzA2MSwgLTAuMjkyNDIxNDYsIDAsIC0wLjk1NjI4OTUzLCAwLCAxLCAwLCAwLjk1NjI4OTUzLCAwLCAtMC4yOTI0MjE0NikKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtNjAzNy42Njc5Njg3NSwgMzIuMTg0NjM4OTc3MDUwNzgsIC0xMzQwLjY1OTc5MDAzOTA2MjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTAwMCBhbmQgTXlMZXZlbCA8PSAxMDQ5IHRoZW4KICAgICAgICAgICAgTW9uID0gIlNub3cgVHJvb3BlciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIlNub3dNb3VudGFpblF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIlNub3cgVHJvb3BlciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDYwOS44NTg4MjYsIDQwMC4xMTk5MDQsIC01MzcyLjI1OTI4LCAtMC4zNzQ2MDQxMDYsIDAsIDAuOTI3MTg0ODgsIDAsIDEsIDAsIC0wLjkyNzE4NDg4LCAwLCAtMC4zNzQ2MDQxMDYpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoNTQ5LjE0NzMzODg2NzE4NzUsIDQyNy4zODcwNTQ0NDMzNTk0LCAtNTU2My42OTg3MzA0Njg3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxMDUwIGFuZCBNeUxldmVsIDw9IDEwOTkgdGhlbgogICAgICAgICAgICBNb24gPSAiV2ludGVyIFdhcnJpb3IiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJTbm93TW91bnRhaW5RdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJXaW50ZXIgV2FycmlvciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDYwOS44NTg4MjYsIDQwMC4xMTk5MDQsIC01MzcyLjI1OTI4LCAtMC4zNzQ2MDQxMDYsIDAsIDAuOTI3MTg0ODgsIDAsIDEsIDAsIC0wLjkyNzE4NDg4LCAwLCAtMC4zNzQ2MDQxMDYpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoMTE0Mi43NDUxMTcxODc1LCA0NzUuNjM5ODAxMDI1MzkwNiwgLTUxOTkuNDE2NTAzOTA2MjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTEwMCBhbmQgTXlMZXZlbCA8PSAxMTI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIkxhYiBTdWJvcmRpbmF0ZSIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkljZVNpZGVRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJMYWIgU3Vib3JkaW5hdGUiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtNjA2NC4wNjg4NSwgMTUuMjQyMjg1NywgLTQ5MDIuOTc4NTIsIDAuNDUzOTcyNTc4LCAtMCwgLTAuODkxMDE1NjQ5LCAwLCAxLCAtMCwgMC44OTEwMTU2NDksIDAsIDAuNDUzOTcyNTc4KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC01NzA3LjQ3MTY3OTY4NzUsIDE1Ljk1MTcwOTc0NzMxNDQ1MywgLTQ1MTMuMzkyMDg5ODQzNzUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTEyNSBhbmQgTXlMZXZlbCA8PSAxMTc0IHRoZW4KICAgICAgICAgICAgTW9uID0gIkhvcm5lZCBXYXJyaW9yIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiSWNlU2lkZVF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIkhvcm5lZCBXYXJyaW9yIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTYwNjQuMDY4ODUsIDE1LjI0MjI4NTcsIC00OTAyLjk3ODUyLCAwLjQ1Mzk3MjU3OCwgLTAsIC0wLjg5MTAxNTY0OSwgMCwgMSwgLTAsIDAuODkxMDE1NjQ5LCAwLCAwLjQ1Mzk3MjU3OCkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtNjM0MS4zNjY2OTkyMTg3NSwgMTUuOTUxNzcwNzgyNDcwNzAzLCAtNTcyMy4xNjIxMDkzNzUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTE3NSBhbmQgTXlMZXZlbCA8PSAxMTk5IHRoZW4KICAgICAgICAgICAgTW9uID0gIk1hZ21hIE5pbmphIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiRmlyZVNpZGVRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJNYWdtYSBOaW5qYSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC01NDI4LjAzMTc0LCAxNS4wNjIyOTIxLCAtNTI5OS40MzQ1NywgLTAuODgyOTUyMjEzLCAwLCAwLjQ2OTQ2MzU1NywgMCwgMSwgMCwgLTAuNDY5NDYzNTU3LCAwLCAtMC44ODI5NTIyMTMpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTU0NDkuNjcyODUxNTYyNSwgNzYuNjU4NzQ0ODEyMDExNzIsIC01ODA4LjIwMDY4MzU5Mzc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDEyMDAgYW5kIE15TGV2ZWwgPD0gMTI0OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJMYXZhIFBpcmF0ZSIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkZpcmVTaWRlUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiTGF2YSBQaXJhdGUiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtNTQyOC4wMzE3NCwgMTUuMDYyMjkyMSwgLTUyOTkuNDM0NTcsIC0wLjg4Mjk1MjIxMywgMCwgMC40Njk0NjM1NTcsIDAsIDEsIDAsIC0wLjQ2OTQ2MzU1NywgMCwgLTAuODgyOTUyMjEzKQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC01MjEzLjMzMTU0Mjk2ODc1LCA0OS43Mzc4ODA3MDY3ODcxMSwgLTQ3MDEuNDUxMTcxODc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDEyNTAgYW5kIE15TGV2ZWwgPD0gMTI3NCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJTaGlwIERlY2toYW5kIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiU2hpcFF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJTaGlwIERlY2toYW5kIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoMTAzNy44MDEyNywgMTI1LjA5MjE3MSwgMzI5MTEuNjAxNikgICAgICAgICAKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygxMjEyLjAxMTEwODM5ODQzNzUsIDE1MC43OTIwNTMyMjI2NTYyNSwgMzMwNTkuMjQ2MDkzNzUpICAgIAogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0Zhcm0gYW5kIChDRnJhbWVRdWVzdC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigicmVxdWVzdEVudHJhbmNlIixWZWN0b3IzLm5ldyg5MjMuMjEyNTI0NDE0MDYsIDEyNi45NzYwMDU1NTQyLCAzMjg1Mi44MzIwMzEyNSkpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDEyNzUgYW5kIE15TGV2ZWwgPD0gMTI5OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJTaGlwIEVuZ2luZWVyIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiU2hpcFF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJTaGlwIEVuZ2luZWVyIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoMTAzNy44MDEyNywgMTI1LjA5MjE3MSwgMzI5MTEuNjAxNikgICAKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg5MTkuNDc4NjM3Njk1MzEyNSwgNDMuNTQ0MDEzOTc3MDUwNzgsIDMyNzc5Ljk2ODc1KSAgIAogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0Zhcm0gYW5kIChDRnJhbWVRdWVzdC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigicmVxdWVzdEVudHJhbmNlIixWZWN0b3IzLm5ldyg5MjMuMjEyNTI0NDE0MDYsIDEyNi45NzYwMDU1NTQyLCAzMjg1Mi44MzIwMzEyNSkpCiAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxMzAwIGFuZCBNeUxldmVsIDw9IDEzMjQgdGhlbgogICAgICAgICAgICBNb24gPSAiU2hpcCBTdGV3YXJkIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiU2hpcFF1ZXN0MiIKICAgICAgICAgICAgTmFtZU1vbiA9ICJTaGlwIFN0ZXdhcmQiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldyg5NjguODA5NTcsIDEyNS4wOTIxNzEsIDMzMjQ0LjEyNSkgICAgICAgICAKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg5MTkuNDM4NTM3NTk3NjU2MiwgMTI5LjU1NTk5OTc1NTg1OTM4LCAzMzQzNi4wMzUxNTYyNSkgICAgICAKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9GYXJtIGFuZCAoQ0ZyYW1lUXVlc3QuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDEwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoInJlcXVlc3RFbnRyYW5jZSIsVmVjdG9yMy5uZXcoOTIzLjIxMjUyNDQxNDA2LCAxMjYuOTc2MDA1NTU0MiwgMzI4NTIuODMyMDMxMjUpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxMzI1IGFuZCBNeUxldmVsIDw9IDEzNDkgdGhlbgogICAgICAgICAgICBNb24gPSAiU2hpcCBPZmZpY2VyIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiU2hpcFF1ZXN0MiIKICAgICAgICAgICAgTmFtZU1vbiA9ICJTaGlwIE9mZmljZXIiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldyg5NjguODA5NTcsIDEyNS4wOTIxNzEsIDMzMjQ0LjEyNSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygxMDM2LjAxNzk0NDMzNTkzNzUsIDE4MS40MzkwNDExMzc2OTUzLCAzMzMxNS43MjY1NjI1KQogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0Zhcm0gYW5kIChDRnJhbWVRdWVzdC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigicmVxdWVzdEVudHJhbmNlIixWZWN0b3IzLm5ldyg5MjMuMjEyNTI0NDE0MDYsIDEyNi45NzYwMDU1NTQyLCAzMjg1Mi44MzIwMzEyNSkpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDEzNTAgYW5kIE15TGV2ZWwgPD0gMTM3NCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJBcmN0aWMgV2FycmlvciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkZyb3N0UXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiQXJjdGljIFdhcnJpb3IiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldyg1NjY3LjY1ODIsIDI2Ljc5OTc4MTgsIC02NDg2LjA4OTg0LCAtMC45MzM1ODc5MDksIDAsIC0wLjM1ODM0OTUwMiwgMCwgMSwgMCwgMC4zNTgzNDk1MDIsIDAsIC0wLjkzMzU4NzkwOSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg1OTY2LjI0NjA5Mzc1LCA2Mi45NzAwMjAyOTQxODk0NSwgLTYxNzkuMzgyODEyNSkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9GYXJtIGFuZCAoQ0ZyYW1lUXVlc3QuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDEwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoInJlcXVlc3RFbnRyYW5jZSIsVmVjdG9yMy5uZXcoLTY1MDguNTU4MTA1NDY4OCwgNTAwMC4wMzQ5OTYwMzI3MTUsIC0xMzIuODM5NTM4NTc0MjIpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxMzc1IGFuZCBNeUxldmVsIDw9IDE0MjQgdGhlbgogICAgICAgICAgICBNb24gPSAiU25vdyBMdXJrZXIiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJGcm9zdFF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIlNub3cgTHVya2VyIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoNTY2Ny42NTgyLCAyNi43OTk3ODE4LCAtNjQ4Ni4wODk4NCwgLTAuOTMzNTg3OTA5LCAwLCAtMC4zNTgzNDk1MDIsIDAsIDEsIDAsIDAuMzU4MzQ5NTAyLCAwLCAtMC45MzM1ODc5MDkpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoNTQwNy4wNzM3MzA0Njg3NSwgNjkuMTk0Mzc0MDg0NDcyNjYsIC02ODgwLjg4MDM3MTA5Mzc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDE0MjUgYW5kIE15TGV2ZWwgPD0gMTQ0OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJTZWEgU29sZGllciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkZvcmdvdHRlblF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIlNlYSBTb2xkaWVyIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTMwNTQuNDQ0NTgsIDIzNS41NDQyODEsIC0xMDE0Mi44MTkzLCAwLjk5MDI3MDM3NiwgLTAsIC0wLjEzOTE1NjY0LCAwLCAxLCAtMCwgMC4xMzkxNTY2NCwgMCwgMC45OTAyNzAzNzYpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTMwMjguMjIzNjMyODEyNSwgNjQuNjc0NTE0NzcwNTA3ODEsIC05Nzc1LjQyNjc1NzgxMjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTQ1MCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJXYXRlciBGaWdodGVyIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiRm9yZ290dGVuUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiV2F0ZXIgRmlnaHRlciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0zMDU0LCAyNDAsIC0xMDE0NikKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMzI5MSwgMjUyLCAtMTA1MDEpCiAgICAgICAgZW5kCiAgICBlbHNlaWYgV29ybGQzIHRoZW4KICAgICAgICBpZiBNeUxldmVsID49IDE1MDAgYW5kIE15TGV2ZWwgPD0gMTUyNCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJQaXJhdGUgTWlsbGlvbmFpcmUiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJQaXJhdGVQb3J0UXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiUGlyYXRlIE1pbGxpb25haXJlIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTI5MC4wNzQ2NzcsIDQyLjkwMzQ2NTMsIDU1ODEuNTg5ODQsIDAuOTY1OTI5NjI3LCAtMCwgLTAuMjU4ODA0Nzk4LCAwLCAxLCAtMCwgMC4yNTg4MDQ3OTgsIDAsIDAuOTY1OTI5NjI3KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0yNDUuOTk2MzgzNjY2OTkyMiwgNDcuMzA2MTUyMzQzNzUsIDU1ODQuMTAwNTg1OTM3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxNTI1IGFuZCBNeUxldmVsIDw9IDE1NzQgdGhlbgogICAgICAgICAgICBNb24gPSAiUGlzdG9sIEJpbGxpb25haXJlIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiUGlyYXRlUG9ydFF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIlBpc3RvbCBCaWxsaW9uYWlyZSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0yOTAuMDc0Njc3LCA0Mi45MDM0NjUzLCA1NTgxLjU4OTg0LCAwLjk2NTkyOTYyNywgLTAsIC0wLjI1ODgwNDc5OCwgMCwgMSwgLTAsIDAuMjU4ODA0Nzk4LCAwLCAwLjk2NTkyOTYyNykKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMTg3LjMzMDE1NDQxODk0NTMsIDg2LjIzOTg3NTc5MzQ1NzAzLCA2MDEzLjUxMzY3MTg3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxNTc1IGFuZCBNeUxldmVsIDw9IDE1OTkgdGhlbgogICAgICAgICAgICBNb24gPSAiRHJhZ29uIENyZXcgV2FycmlvciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkRyYWdvbkNyZXdRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJEcmFnb24gQ3JldyBXYXJyaW9yIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoNjczOC45NjE0MjU3ODEyNSwgMTI3LjgxNjQ1OTY1NTc2MTcyLCAtNzEzLjUxMTQ3NDYwOTM3NSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg2OTIwLjcxNDM1NTQ2ODc1LCA1Ni4xNTU5NzE1MjcwOTk2MSwgLTk0Mi41MDQ0NTU1NjY0MDYyKQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDE2MDAgYW5kIE15TGV2ZWwgPD0gMTYyNCB0aGVuIAogICAgICAgICAgICBNb24gPSAiRHJhZ29uIENyZXcgQXJjaGVyIgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiRHJhZ29uQ3Jld1F1ZXN0IgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lTW9uID0gIkRyYWdvbiBDcmV3IEFyY2hlciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDY3MzguOTYxNDI1NzgxMjUsIDEyNy44MTY0NTk2NTU3NjE3MiwgLTcxMy41MTE0NzQ2MDkzNzUpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoNjgxNy45MTI1OTc2NTYyNSwgNDg0LjgwNDQ0MzM1OTM3NSwgNTEzLjQxNDEyMzUzNTE1NjIpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTYyNSBhbmQgTXlMZXZlbCA8PSAxNjQ5IHRoZW4KICAgICAgICAgICAgTW9uID0gIkh5ZHJhIEVuZm9yY2VyIgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiVmVub21DcmV3UXVlc3QiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVNb24gPSAiSHlkcmEgRW5mb3JjZXIiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldyg1MjEzLjg3NDAyMzQzNzUsIDEwMDQuNTA0MjcyNDYwOTM3NSwgNzU4LjY5NDQ1ODAwNzgxMjUpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoNDU4NC42OTI4NzEwOTM3NSwgMTAwMi42NDM1NTQ2ODc1LCA3MDUuNzk1ODk4NDM3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxNjUwIGFuZCBNeUxldmVsIDw9IDE2OTkgdGhlbiAKICAgICAgICAgICAgTW9uID0gIlZlbm9tb3VzIEFzc2FpbGFudCIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIlZlbm9tQ3Jld1F1ZXN0IgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lTW9uID0gIlZlbm9tb3VzIEFzc2FpbGFudCIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KDUyMTMuODc0MDIzNDM3NSwgMTAwNC41MDQyNzI0NjA5Mzc1LCA3NTguNjk0NDU4MDA3ODEyNSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldyg0NjM4Ljc4NTY0NDUzMTI1LCAxMDc4Ljk0MDkxNzk2ODc1LCA4ODEuODAwMjMxOTMzNTkzOCkgICAgICAgIAogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDE3MDAgYW5kIE15TGV2ZWwgPD0gMTcyNCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJNYXJpbmUgQ29tbW9kb3JlIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiTWFyaW5lVHJlZUlzbGFuZCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJNYXJpbmUgQ29tbW9kb3JlIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoMjE4MC41NDEyNiwgMjcuODE1NjgxNSwgLTY3NDEuNTQ5OCwgLTAuOTY1OTI5NzQ3LCAwLCAwLjI1ODgwNDc5OCwgMCwgMSwgMCwgLTAuMjU4ODA0Nzk4LCAwLCAtMC45NjU5Mjk3NDcpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoMjI4Ni4wMDc4MTI1LCA3My4xMzM5MTg3NjIyMDcwMywgLTcxNTkuODA5MDgyMDMxMjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTcyNSBhbmQgTXlMZXZlbCA8PSAxNzc0IHRoZW4KICAgICAgICAgICAgTW9uID0gIk1hcmluZSBSZWFyIEFkbWlyYWwiCiAgICAgICAgICAgIE5hbWVNb24gPSAiTWFyaW5lIFJlYXIgQWRtaXJhbCIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIk1hcmluZVRyZWVJc2xhbmQiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygyMTc5Ljk4ODI4MTI1LCAyOC43MzEyMzkzMTg4NDgsIC02NzQwLjA1NTE3NTc4MTMpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoMzY1Ni43NzM2ODE2NDA2MjUsIDE2MC41MjQwNjMxMTAzNTE1NiwgLTcwMDEuNTk4NjMyODEyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxNzc1IGFuZCBNeUxldmVsIDw9IDE3OTkgdGhlbgogICAgICAgICAgICBNb24gPSAiRmlzaG1hbiBSYWlkZXIiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJEZWVwRm9yZXN0SXNsYW5kMyIKICAgICAgICAgICAgTmFtZU1vbiA9ICJGaXNobWFuIFJhaWRlciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xMDU4MS42NTYzLCAzMzAuODcyOTU1LCAtODc2MS4xODY1MiwgLTAuODgyOTUyMjEzLCAwLCAwLjQ2OTQ2MzU1NywgMCwgMSwgMCwgLTAuNDY5NDYzNTU3LCAwLCAtMC44ODI5NTIyMTMpICAgCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTEwNDA3LjUyNjM2NzE4NzUsIDMzMS43NjI2MzQyNzczNDM3NSwgLTgzNjguNTE2NjAxNTYyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxODAwIGFuZCBNeUxldmVsIDw9IDE4MjQgdGhlbgogICAgICAgICAgICBNb24gPSAiRmlzaG1hbiBDYXB0YWluIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiRGVlcEZvcmVzdElzbGFuZDMiCiAgICAgICAgICAgIE5hbWVNb24gPSAiRmlzaG1hbiBDYXB0YWluIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTEwNTgxLjY1NjMsIDMzMC44NzI5NTUsIC04NzYxLjE4NjUyLCAtMC44ODI5NTIyMTMsIDAsIDAuNDY5NDYzNTU3LCAwLCAxLCAwLCAtMC40Njk0NjM1NTcsIDAsIC0wLjg4Mjk1MjIxMykgICAKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMTA5OTQuNzAxMTcxODc1LCAzNTIuMzgxNDA4NjkxNDA2MjUsIC05MDAyLjExMDM1MTU2MjUpIAogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDE4MjUgYW5kIE15TGV2ZWwgPD0gMTg0OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJGb3Jlc3QgUGlyYXRlIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiRGVlcEZvcmVzdElzbGFuZCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJGb3Jlc3QgUGlyYXRlIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTEzMjM0LjA0LCAzMzEuNDg4NDk1LCAtNzYyNS40MDEzNywgMC43MDcxMzQyNDcsIC0wLCAtMC43MDcwNzkyOTEsIDAsIDEsIC0wLCAwLjcwNzA3OTI5MSwgMCwgMC43MDcxMzQyNDcpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTEzMjc0LjQ3ODUxNTYyNSwgMzMyLjM3ODE0MzMxMDU0NjksIC03NzY5LjU4MDU2NjQwNjI1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDE4NTAgYW5kIE15TGV2ZWwgPD0gMTg5OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJNeXRob2xvZ2ljYWwgUGlyYXRlIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiRGVlcEZvcmVzdElzbGFuZCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJNeXRob2xvZ2ljYWwgUGlyYXRlIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTEzMjM0LjA0LCAzMzEuNDg4NDk1LCAtNzYyNS40MDEzNywgMC43MDcxMzQyNDcsIC0wLCAtMC43MDcwNzkyOTEsIDAsIDEsIC0wLCAwLjcwNzA3OTI5MSwgMCwgMC43MDcxMzQyNDcpICAgCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTEzNjgwLjYwNzQyMTg3NSwgNTAxLjA4MTU0Mjk2ODc1LCAtNjk5MS4xODk0NTMxMjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMTkwMCBhbmQgTXlMZXZlbCA8PSAxOTI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIkp1bmdsZSBQaXJhdGUiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJEZWVwRm9yZXN0SXNsYW5kMiIKICAgICAgICAgICAgTmFtZU1vbiA9ICJKdW5nbGUgUGlyYXRlIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTEyNjgwLjM4MTgsIDM4OS45NzEwMzksIC05OTAyLjAxOTUzLCAtMC4wODcxMzE1MDAyLCAwLCAwLjk5NjE5Njg2NiwgMCwgMSwgMCwgLTAuOTk2MTk2ODY2LCAwLCAtMC4wODcxMzE1MDAyKQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0xMjI1Ni4xNjAxNTYyNSwgMzMxLjczODI4MTI1LCAtMTA0ODUuODM2OTE0MDYyNSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAxOTI1IGFuZCBNeUxldmVsIDw9IDE5NzQgdGhlbgogICAgICAgICAgICBNb24gPSAiTXVza2V0ZWVyIFBpcmF0ZSIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkRlZXBGb3Jlc3RJc2xhbmQyIgogICAgICAgICAgICBOYW1lTW9uID0gIk11c2tldGVlciBQaXJhdGUiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtMTI2ODAuMzgxOCwgMzg5Ljk3MTAzOSwgLTk5MDIuMDE5NTMsIC0wLjA4NzEzMTUwMDIsIDAsIDAuOTk2MTk2ODY2LCAwLCAxLCAwLCAtMC45OTYxOTY4NjYsIDAsIC0wLjA4NzEzMTUwMDIpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTEzNDU3LjkwNDI5Njg3NSwgMzkxLjU0NTY1NDI5Njg3NSwgLTk4NTkuMTc3NzM0Mzc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDE5NzUgYW5kIE15TGV2ZWwgPD0gMTk5OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJSZWJvcm4gU2tlbGV0b24iCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJIYXVudGVkUXVlc3QxIgogICAgICAgICAgICBOYW1lTW9uID0gIlJlYm9ybiBTa2VsZXRvbiIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC05NDc5LjIxNjgsIDE0MS4yMTUwODgsIDU1NjYuMDkyNzcsIDAsIDAsIDEsIDAsIDEsIC0wLCAtMSwgMCwgMCkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtODc2My43MjM2MzI4MTI1LCAxNjUuNzIyOTkxOTQzMzU5MzgsIDYxNTkuODYxODE2NDA2MjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjAwMCBhbmQgTXlMZXZlbCA8PSAyMDI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIkxpdmluZyBab21iaWUiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJIYXVudGVkUXVlc3QxIgogICAgICAgICAgICBOYW1lTW9uID0gIkxpdmluZyBab21iaWUiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtOTQ3OS4yMTY4LCAxNDEuMjE1MDg4LCA1NTY2LjA5Mjc3LCAwLCAwLCAxLCAwLCAxLCAtMCwgLTEsIDAsIDApCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTEwMTQ0LjEzMTgzNTkzNzUsIDEzOC42MjY2Nzg0NjY3OTY4OCwgNTgzOC4wODg4NjcxODc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDIwMjUgYW5kIE15TGV2ZWwgPD0gMjA0OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJEZW1vbmljIFNvdWwiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJIYXVudGVkUXVlc3QyIgogICAgICAgICAgICBOYW1lTW9uID0gIkRlbW9uaWMgU291bCIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC05NTE2Ljk5MzE2LCAxNzIuMDE3MTgxLCA2MDc4LjQ2NTMzLCAwLCAwLCAtMSwgMCwgMSwgMCwgMSwgMCwgMCkgCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTk1MDUuODcyMDcwMzEyNSwgMTcyLjEwNDgyNzg4MDg1OTM4LCA2MTU4Ljk5MzE2NDA2MjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjA1MCBhbmQgTXlMZXZlbCA8PSAyMDc0IHRoZW4KICAgICAgICAgICAgTW9uID0gIlBvc2Vzc2VkIE11bW15IgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiSGF1bnRlZFF1ZXN0MiIKICAgICAgICAgICAgTmFtZU1vbiA9ICJQb3Nlc3NlZCBNdW1teSIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC05NTE2Ljk5MzE2LCAxNzIuMDE3MTgxLCA2MDc4LjQ2NTMzLCAwLCAwLCAtMSwgMCwgMSwgMCwgMSwgMCwgMCkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtOTU4Mi4wMjI0NjA5Mzc1LCA2LjI1MTUyNzMwOTQxNzcyNSwgNjIwNS40Nzg1MTU2MjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjA3NSBhbmQgTXlMZXZlbCA8PSAyMDk5IHRoZW4KICAgICAgICAgICAgTW9uID0gIlBlYW51dCBTY291dCIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIk51dHNJc2xhbmRRdWVzdCIKICAgICAgICAgICAgTmFtZU1vbiA9ICJQZWFudXQgU2NvdXQiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtMjEwNC4zOTA4NjkxNDA2LCAzOC4xMDQxNjc5MzgyMzIsIC0xMDE5NC4yMTg3NSwgMCwgMCwgLTEsIDAsIDEsIDAsIDEsIDAsIDApCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTIxNDMuMjQxOTQzMzU5Mzc1LCA0Ny43MjE5ODQ4NjMyODEyNSwgLTEwMDI5Ljk5NTExNzE4NzUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjEwMCBhbmQgTXlMZXZlbCA8PSAyMTI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIlBlYW51dCBQcmVzaWRlbnQiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJOdXRzSXNsYW5kUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiUGVhbnV0IFByZXNpZGVudCIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0yMTA0LjM5MDg2OTE0MDYsIDM4LjEwNDE2NzkzODIzMiwgLTEwMTk0LjIxODc1LCAwLCAwLCAtMSwgMCwgMSwgMCwgMSwgMCwgMCkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMTg1OS4zNTQwMDM5MDYyNSwgMzguMTAzMTY4NDg3NTQ4ODMsIC0xMDQyMi40Mjk2ODc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDIxMjUgYW5kIE15TGV2ZWwgPD0gMjE0OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJJY2UgQ3JlYW0gQ2hlZiIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkljZUNyZWFtSXNsYW5kUXVlc3QiCiAgICAgICAgICAgIE5hbWVNb24gPSAiSWNlIENyZWFtIENoZWYiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtODIwLjY0ODI1NDM5NDUzLCA2NS44MTk1MjY2NzIzNjMsIC0xMDk2NS43OTU4OTg0MzgsIDAsIDAsIC0xLCAwLCAxLCAwLCAxLCAwLCAwKQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC04NzIuMjQ2NTgyMDMxMjUsIDY1LjgxOTU3MjQ0ODczMDQ3LCAtMTA5MTkuOTU3MDMxMjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjE1MCBhbmQgTXlMZXZlbCA8PSAyMTk5IHRoZW4KICAgICAgICAgICAgTW9uID0gIkljZSBDcmVhbSBDb21tYW5kZXIiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAyCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJJY2VDcmVhbUlzbGFuZFF1ZXN0IgogICAgICAgICAgICBOYW1lTW9uID0gIkljZSBDcmVhbSBDb21tYW5kZXIiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtODIwLjY0ODI1NDM5NDUzLCA2NS44MTk1MjY2NzIzNjMsIC0xMDk2NS43OTU4OTg0MzgsIDAsIDAsIC0xLCAwLCAxLCAwLCAxLCAwLCAwKQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC01NTguMDYxMDM1MTU2MjUsIDExMi4wNDg5NTc4MjQ3MDcwMywgLTExMjkwLjc3NDQxNDA2MjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjIwMCBhbmQgTXlMZXZlbCA8PSAyMjI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIkNvb2tpZSBDcmFmdGVyIgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiQ2FrZVF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJDb29raWUgQ3JhZnRlciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0yMDIxLjMyMDA3LCAzNy43OTgyMjU0LCAtMTIwMjguNzI5NSwgMC45NTc1NzY5MzEsIC04LjgwMzAyMDUzZS0wOCwgMC4yODgxNzc4MTgsIDYuOTMwMTE4N2UtMDgsIDEsIDcuNTE5MzEyMTFlLTA4LCAtMC4yODgxNzc4MTgsIC01LjIwMzIxMzVlLTA4LCAwLjk1NzU3NjkzMSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMjM3NC4xMzY3MTg3NSwgMzcuNzk4MjYzNTQ5ODA0NjksIC0xMjEyNS4zMDg1OTM3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAyMjI1IGFuZCBNeUxldmVsIDw9IDIyNDkgdGhlbgogICAgICAgICAgICBNb24gPSAiQ2FrZSBHdWFyZCIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkNha2VRdWVzdDEiCiAgICAgICAgICAgIE5hbWVNb24gPSAiQ2FrZSBHdWFyZCIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0yMDIxLjMyMDA3LCAzNy43OTgyMjU0LCAtMTIwMjguNzI5NSwgMC45NTc1NzY5MzEsIC04LjgwMzAyMDUzZS0wOCwgMC4yODgxNzc4MTgsIDYuOTMwMTE4N2UtMDgsIDEsIDcuNTE5MzEyMTFlLTA4LCAtMC4yODgxNzc4MTgsIC01LjIwMzIxMzVlLTA4LCAwLjk1NzU3NjkzMSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMTU5OC4zMDcwMDY4MzU5Mzc1LCA0My43NzMxOTcxNzQwNzIyNjYsIC0xMjI0NC41ODEwNTQ2ODc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDIyNTAgYW5kIE15TGV2ZWwgPD0gMjI3NCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJCYWtpbmcgU3RhZmYiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJDYWtlUXVlc3QyIgogICAgICAgICAgICBOYW1lTW9uID0gIkJha2luZyBTdGFmZiIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xOTI3LjkxNjAyLCAzNy43OTgxMzM5LCAtMTI4NDIuNTM5MSwgLTAuOTY4MDQ0NDYsIDQuMjIxNDIxNDNlLTA4LCAwLjI1MDc3ODU4NiwgNC43NDkxMTA2MmUtMDgsIDEsIDEuNDk5MDQ3MTFlLTA4LCAtMC4yNTA3Nzg1ODYsIDIuNjQyMTE5NDFlLTA4LCAtMC45NjgwNDQ0NikKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMTg4Ny44MDk5MzY1MjM0Mzc1LCA3Ny42MTg1MDczODUyNTM5LCAtMTI5OTguMzUwNTg1OTM3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAyMjc1IGFuZCBNeUxldmVsIDw9IDIyOTkgdGhlbgogICAgICAgICAgICBNb24gPSAiSGVhZCBCYWtlciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkNha2VRdWVzdDIiCiAgICAgICAgICAgIE5hbWVNb24gPSAiSGVhZCBCYWtlciIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xOTI3LjkxNjAyLCAzNy43OTgxMzM5LCAtMTI4NDIuNTM5MSwgLTAuOTY4MDQ0NDYsIDQuMjIxNDIxNDNlLTA4LCAwLjI1MDc3ODU4NiwgNC43NDkxMTA2MmUtMDgsIDEsIDEuNDk5MDQ3MTFlLTA4LCAtMC4yNTA3Nzg1ODYsIDIuNjQyMTE5NDFlLTA4LCAtMC45NjgwNDQ0NikKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygtMjIxNi4xODgyMzI0MjE4NzUsIDgyLjg4NDUyMTQ4NDM3NSwgLTEyODY5LjI5Mzk0NTMxMjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjMwMCBhbmQgTXlMZXZlbCA8PSAyMzI0IHRoZW4KICAgICAgICAgICAgTW9uID0gIkNvY29hIFdhcnJpb3IiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJDaG9jUXVlc3QxIgogICAgICAgICAgICBOYW1lTW9uID0gIkNvY29hIFdhcnJpb3IiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygyMzMuMjI4MzYzMDM3MTA5MzgsIDI5Ljg3NjAwMTM1ODAzMjIyNywgLTEyMjAxLjIzMzM5ODQzNzUpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTIxLjU1MzI4MzY5MTQwNjI1LCA4MC41NzQ5OTY5NDgyNDIxOSwgLTEyMzUyLjM4NzY5NTMxMjUpCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjMyNSBhbmQgTXlMZXZlbCA8PSAyMzQ5IHRoZW4KICAgICAgICAgICAgTW9uID0gIkNob2NvbGF0ZSBCYXIgQmF0dGxlciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkNob2NRdWVzdDEiCiAgICAgICAgICAgIE5hbWVNb24gPSAiQ2hvY29sYXRlIEJhciBCYXR0bGVyIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoMjMzLjIyODM2MzAzNzEwOTM4LCAyOS44NzYwMDEzNTgwMzIyMjcsIC0xMjIwMS4yMzMzOTg0Mzc1KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KDU4Mi41OTA1NzYxNzE4NzUsIDc3LjE4ODA5NTA5Mjc3MzQ0LCAtMTI0NjMuMTYyMTA5Mzc1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDIzNTAgYW5kIE15TGV2ZWwgPD0gMjM3NCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJTd2VldCBUaGllZiIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDEKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkNob2NRdWVzdDIiCiAgICAgICAgICAgIE5hbWVNb24gPSAiU3dlZXQgVGhpZWYiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygxNTAuNTA2NjM3NTczMjQyMiwgMzAuNjkzNjkzMTYxMDEwNzQyLCAtMTI3NzQuNTAyOTI5Njg3NSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygxNjUuMTg4NDc2NTYyNSwgNzYuMDU4ODUzMTQ5NDE0MDYsIC0xMjYwMC44MzY5MTQwNjI1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDIzNzUgYW5kIE15TGV2ZWwgPD0gMjM5OSB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJDYW5keSBSZWJlbCIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkNob2NRdWVzdDIiCiAgICAgICAgICAgIE5hbWVNb24gPSAiQ2FuZHkgUmViZWwiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygxNTAuNTA2NjM3NTczMjQyMiwgMzAuNjkzNjkzMTYxMDEwNzQyLCAtMTI3NzQuNTAyOTI5Njg3NSkKICAgICAgICAgICAgQ0ZyYW1lTW9uID0gQ0ZyYW1lLm5ldygxMzQuODY1NjMxMTAzNTE1NjIsIDc3LjI0NzY4MDY2NDA2MjUsIC0xMjg3Ni41NDc4NTE1NjI1KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDI0MDAgYW5kIE15TGV2ZWwgPD0gMjQyNCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJDYW5keSBQaXJhdGUiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJDYW5keVF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJDYW5keSBQaXJhdGUiCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtMTE1MC4wNDAwMzkwNjI1LCAyMC4zNzg5MzQ4NjAyMjk0OTIsIC0xNDQ0Ni4zMzQ5NjA5Mzc1KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0xMzEwLjUwMDM2NjIxMDkzNzUsIDI2LjAxNjUyMzM2MTIwNjA1NSwgLTE0NTYyLjQwNDI5Njg3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAyNDI1IGFuZCBNeUxldmVsIDw9IDI0NDkgdGhlbgogICAgICAgICAgICBNb24gPSAiU25vdyBEZW1vbiIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIkNhbmR5UXVlc3QxIgogICAgICAgICAgICBOYW1lTW9uID0gIlNub3cgRGVtb24iCiAgICAgICAgICAgIENGcmFtZVF1ZXN0ID0gQ0ZyYW1lLm5ldygtMTE1MC4wNDAwMzkwNjI1LCAyMC4zNzg5MzQ4NjAyMjk0OTIsIC0xNDQ0Ni4zMzQ5NjA5Mzc1KQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC04ODAuMjAwNjIyNTU4NTkzOCwgNzEuMjQ3NzY0NTg3NDAyMzQsIC0xNDUzOC42MDkzNzUpICAgICAgICAgICAgCiAgICAgICAgZWxzZWlmIE15TGV2ZWwgPj0gMjQ1MCBhbmQgTXlMZXZlbCA8PSAyNDc0IHRoZW4KICAgICAgICAgICAgTW9uID0gIklzbGUgT3V0bGF3IgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMQogICAgICAgICAgICBOYW1lUXVlc3QgPSAiVGlraVF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJJc2xlIE91dGxhdyIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xNjU0Ny43NDgwNDY4NzUsIDYxLjEzNTMzNDAxNDg5MjU4LCAtMTczLjQxMzYwNDczNjMyODEyKQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0xNjQ0Mi44MTQ0NTMxMjUsIDExNi4xMzg5OTk5Mzg5NjQ4NCwgLTI2NC40NjM3NzU2MzQ3NjU2KQogICAgICAgIGVsc2VpZiBNeUxldmVsID49IDI0NzUgYW5kIE15TGV2ZWwgPD0gMjUyNCB0aGVuCiAgICAgICAgICAgIE1vbiA9ICJJc2xhbmQgQm95IgogICAgICAgICAgICBMZXZlbFF1ZXN0ID0gMgogICAgICAgICAgICBOYW1lUXVlc3QgPSAiVGlraVF1ZXN0MSIKICAgICAgICAgICAgTmFtZU1vbiA9ICJJc2xhbmQgQm95IgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTE2NTQ3Ljc0ODA0Njg3NSwgNjEuMTM1MzM0MDE0ODkyNTgsIC0xNzMuNDEzNjA0NzM2MzI4MTIpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTE2OTAxLjI2MTcxODc1LCA4NC4wNjc1NjU5MTc5Njg3NSwgLTE5Mi44ODkwNjg2MDM1MTU2MikKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAyNTI1IGFuZCBNeUxldmVsIDw9IDI1NTAgdGhlbgogICAgICAgICAgICBNb24gPSAiSXNsZSBDaGFtcGlvbiIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIlRpa2lRdWVzdDIiCiAgICAgICAgICAgIE5hbWVNb24gPSAiSXNsZSBDaGFtcGlvbiIKICAgICAgICAgICAgQ0ZyYW1lUXVlc3QgPSBDRnJhbWUubmV3KC0xNjUzOS4wNzgxMjUsIDU1LjY4NjMyODg4NzkzOTQ1LCAxMDUxLjU3Mzg1MjUzOTA2MjUpCiAgICAgICAgICAgIENGcmFtZU1vbiA9IENGcmFtZS5uZXcoLTE2NjQxLjY3OTY4NzUsIDIzNS43ODI1NDY5OTcwNzAzLCAxMDMxLjI4Mjk1ODk4NDM3NSkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAyNTUwIGFuZCBNeUxldmVsIDw9IDI1NzQgdGhlbgogICAgICAgICAgICBNb24gPSAiU2VycGVudCBIdW50ZXIiCiAgICAgICAgICAgIExldmVsUXVlc3QgPSAxCiAgICAgICAgICAgIE5hbWVRdWVzdCA9ICJUaWtpUXVlc3QzIgogICAgICAgICAgICBOYW1lTW9uID0gIlNlcnBlbnQgSHVudGVyIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTE2NjY1LjE5MTQsIDEwNC41OTY0MDUsIDE1NzkuNjk0MzQsIDAuOTUxMDY4NDAxLCAtMCwgLTAuMzA4OTgwNDY1LCAwLCAxLCAtMCwgMC4zMDg5ODA0NjUsIDAsIDAuOTUxMDY4NDAxKQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0xNjUyMS4wNjI1LCAxMDYuMDkyODUsIDE0ODguNzg0NjcsIDAuNDY5NDY3MDQ0LCAwLCAwLjg4Mjk1MDAwOCwgMCwgMSwgMCwgLTAuODgyOTUwMDA4LCAwLCAwLjQ2OTQ2NzA0NCkKICAgICAgICBlbHNlaWYgTXlMZXZlbCA+PSAyNTc1IHRoZW4KICAgICAgICAgICAgTW9uID0gIlNrdWxsIFNsYXllciIKICAgICAgICAgICAgTGV2ZWxRdWVzdCA9IDIKICAgICAgICAgICAgTmFtZVF1ZXN0ID0gIlRpa2lRdWVzdDMiCiAgICAgICAgICAgIE5hbWVNb24gPSAiU2t1bGwgU2xheWVyIgogICAgICAgICAgICBDRnJhbWVRdWVzdCA9IENGcmFtZS5uZXcoLTE2NjY1LjE5MTQsIDEwNC41OTY0MDUsIDE1NzkuNjk0MzQsIDAuOTUxMDY4NDAxLCAtMCwgLTAuMzA4OTgwNDY1LCAwLCAxLCAtMCwgMC4zMDg5ODA0NjUsIDAsIDAuOTUxMDY4NDAxKQogICAgICAgICAgICBDRnJhbWVNb24gPSBDRnJhbWUubmV3KC0xNjg1NS4wNDMsIDEyMi40NTcyNTMsIDE0NzguMTUzMDgsIC0wLjk5OTM5MjI3MSwgMCwgLTAuMDM0ODY4Nzk5MSwgMCwgMSwgMCwgMC4wMzQ4Njg3OTkxLCAwLCAtMC45OTkzOTIyNzEpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCmZ1bmN0aW9uIE1hdGVyaWFsTW9uKCkKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IHBsYXllci5DaGFyYWN0ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbm90IGh1bWFub2lkUm9vdFBhcnQgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBmdW5jdGlvbiBzaG91bGRSZXF1ZXN0RW50cmFuY2UodGFyZ2V0UG9zaXRpb24sIGRpc3RhbmNlVGhyZXNob2xkKQogICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKGh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSB0YXJnZXRQb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgaWYgZGlzdGFuY2UgPj0gZGlzdGFuY2VUaHJlc2hvbGQgdGhlbgogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJyZXF1ZXN0RW50cmFuY2UiLCB0YXJnZXRQb3NpdGlvbikKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgV29ybGQxIHRoZW4KICAgICAgICBpZiBTZWxlY3RNYXRlcmlhbCA9PSAiQW5nZWwgV2luZ3MiIHRoZW4KICAgICAgICAgICAgTU1vbiA9IHsgIlNoYW5kYSIsICJSb3lhbCBTcXVhZCIsICJSb3lhbCBTb2xkaWVyIiwgIld5c3BlciIsICJUaHVuZGVyIEdvZCIgfQogICAgICAgICAgICBNUG9zID0gQ0ZyYW1lLm5ldygtNDY5OCwgODQ1LCAtMTkxMikKICAgICAgICAgICAgU1AgPSAiRGVmYXVsdCIKICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zaXRpb24gPSBWZWN0b3IzLm5ldygtNDYwNy44MjI3NSwgODcyLjU0MjQ4LCAtMTY2Ny41NTY4OCkKICAgICAgICAgICAgc2hvdWxkUmVxdWVzdEVudHJhbmNlKHRhcmdldFBvc2l0aW9uLCAxMDAwMCkKICAgICAgICBlbHNlaWYgU2VsZWN0TWF0ZXJpYWwgPT0gIkxlYXRoZXIgKyBTY3JhcCBNZXRhbCIgdGhlbgogICAgICAgICAgICBNTW9uID0geyAiQnJ1dGUiLCAiUGlyYXRlIiB9CiAgICAgICAgICAgIE1Qb3MgPSBDRnJhbWUubmV3KC0xMTQ1LCAxNSwgNDM1MCkKICAgICAgICAgICAgU1AgPSAiRGVmYXVsdCIKICAgICAgICBlbHNlaWYgU2VsZWN0TWF0ZXJpYWwgPT0gIk1hZ21hIE9yZSIgdGhlbgogICAgICAgICAgICBNTW9uID0geyAiTWlsaXRhcnkgU29sZGllciIsICJNaWxpdGFyeSBTcHkiLCAiTWFnbWEgQWRtaXJhbCIgfQogICAgICAgICAgICBNUG9zID0gQ0ZyYW1lLm5ldygtNTgxNSwgODQsIDg4MjApCiAgICAgICAgICAgIFNQID0gIkRlZmF1bHQiCiAgICAgICAgZWxzZWlmIFNlbGVjdE1hdGVyaWFsID09ICJGaXNoIFRhaWwiIHRoZW4KICAgICAgICAgICAgTU1vbiA9IHsgIkZpc2htYW4gV2FycmlvciIsICJGaXNobWFuIENvbW1hbmRvIiwgIkZpc2htYW4gTG9yZCIgfQogICAgICAgICAgICBNUG9zID0gQ0ZyYW1lLm5ldyg2MTEyMywgMTksIDE1NjkpCiAgICAgICAgICAgIFNQID0gIkRlZmF1bHQiCiAgICAgICAgICAgIGxvY2FsIHRhcmdldFBvc2l0aW9uID0gVmVjdG9yMy5uZXcoNjExNjMuODUxNTYyNSwgNS4zNDIzNDIzNzY3MDg5ODQsIDE4MTkuNzg0MTc5Njg3NSkKICAgICAgICAgICAgc2hvdWxkUmVxdWVzdEVudHJhbmNlKHRhcmdldFBvc2l0aW9uLCAxNzAwMCkKICAgICAgICBlbmQKICAgIGVsc2VpZiBXb3JsZDIgdGhlbgogICAgICAgIGlmIFNlbGVjdE1hdGVyaWFsID09ICJMZWF0aGVyICsgU2NyYXAgTWV0YWwiIHRoZW4KICAgICAgICAgICAgTU1vbiA9IHsgIk1hcmluZSBDYXB0YWluIiB9CiAgICAgICAgICAgIE1Qb3MgPSBDRnJhbWUubmV3KC0yMDEwLjUwNTk4MTQ0NTMxMjUsIDczLjAwMTE1OTY2Nzk2ODc1LCAtMzMyNi42MjA4NDk2MDkzNzUpCiAgICAgICAgICAgIFNQID0gIkRlZmF1bHQiCiAgICAgICAgZWxzZWlmIFNlbGVjdE1hdGVyaWFsID09ICJNYWdtYSBPcmUiIHRoZW4KICAgICAgICAgICAgTU1vbiA9IHsgIk1hZ21hIE5pbmphIiwgIkxhdmEgUGlyYXRlIiB9CiAgICAgICAgICAgIE1Qb3MgPSBDRnJhbWUubmV3KC01NDI4LCA3OCwgLTU5NTkpCiAgICAgICAgICAgIFNQID0gIkRlZmF1bHQiCiAgICAgICAgZWxzZWlmIFNlbGVjdE1hdGVyaWFsID09ICJFY3RvcGxhc20iIHRoZW4KICAgICAgICAgICAgTU1vbiA9IHsgIlNoaXAgRGVja2hhbmQiLCAiU2hpcCBFbmdpbmVlciIsICJTaGlwIFN0ZXdhcmQiLCAiU2hpcCBPZmZpY2VyIiB9CiAgICAgICAgICAgIE1Qb3MgPSBDRnJhbWUubmV3KDkxMS4zNTgyNzYzNjcxOSwgMTI1Ljk1ODEyOTg4MjgxLCAzMzE1OS41MzkwNjI1KQogICAgICAgICAgICBTUCA9ICJEZWZhdWx0IgogICAgICAgICAgICBsb2NhbCB0YXJnZXRQb3NpdGlvbiA9IFZlY3RvcjMubmV3KDYxMTYzLjg1MTU2MjUsIDUuMzQyMzQyMzc2NzA4OTg0LCAxODE5Ljc4NDE3OTY4NzUpCiAgICAgICAgICAgIHNob3VsZFJlcXVlc3RFbnRyYW5jZSh0YXJnZXRQb3NpdGlvbiwgMTgwMDApCiAgICAgICAgZWxzZWlmIFNlbGVjdE1hdGVyaWFsID09ICJNeXN0aWMgRHJvcGxldCIgdGhlbgogICAgICAgICAgICBNTW9uID0geyAiV2F0ZXIgRmlnaHRlciIgfQogICAgICAgICAgICBNUG9zID0gQ0ZyYW1lLm5ldygtMzM4NSwgMjM5LCAtMTA1NDIpCiAgICAgICAgICAgIFNQID0gIkRlZmF1bHQiCiAgICAgICAgZWxzZWlmIFNlbGVjdE1hdGVyaWFsID09ICJSYWRpb2FjdGl2ZSBNYXRlcmlhbCIgdGhlbgogICAgICAgICAgICBNTW9uID0geyAiRmFjdG9yeSBTdGFmZiIgfQogICAgICAgICAgICBNUG9zID0gQ0ZyYW1lLm5ldygyOTUsIDczLCAtNTYpCiAgICAgICAgICAgIFNQID0gIkRlZmF1bHQiCiAgICAgICAgZWxzZWlmIFNlbGVjdE1hdGVyaWFsID09ICJWYW1waXJlIEZhbmciIHRoZW4KICAgICAgICAgICAgTU1vbiA9IHsgIlZhbXBpcmUiIH0KICAgICAgICAgICAgTVBvcyA9IENGcmFtZS5uZXcoLTYwMzMsIDcsIC0xMzE3KQogICAgICAgICAgICBTUCA9ICJEZWZhdWx0IgogICAgICAgIGVuZAogICAgZWxzZWlmIFdvcmxkMyB0aGVuCiAgICAgICAgaWYgU2VsZWN0TWF0ZXJpYWwgPT0gIkxlYXRoZXIgKyBTY3JhcCBNZXRhbCIgdGhlbgogICAgICAgICAgICBNTW9uID0geyAiSnVuZ2xlIFBpcmF0ZSIsICJGb3Jlc3QgUGlyYXRlIiB9CiAgICAgICAgICAgIE1Qb3MgPSBDRnJhbWUubmV3KC0xMTk3NS43ODUxNTYyNSwgMzMxLjc3MzQwNjk4MjQyMTksIC0xMDYyMC4wMzAyNzM0Mzc1KQogICAgICAgICAgICBTUCA9ICJEZWZhdWx0IgogICAgICAgIGVsc2VpZiBTZWxlY3RNYXRlcmlhbCA9PSAiRmlzaCBUYWlsIiB0aGVuCiAgICAgICAgICAgIE1Nb24gPSB7ICJGaXNobWFuIFJhaWRlciIsICJGaXNobWFuIENhcHRhaW4iIH0KICAgICAgICAgICAgTVBvcyA9IENGcmFtZS5uZXcoLTEwOTkzLCAzMzIsIC04OTQwKQogICAgICAgICAgICBTUCA9ICJEZWZhdWx0IgogICAgICAgIGVsc2VpZiBTZWxlY3RNYXRlcmlhbCA9PSAiQ29uanVyZWQgQ29jb2EiIHRoZW4KICAgICAgICAgICAgTU1vbiA9IHsgIkNob2NvbGF0ZSBCYXIgQmF0dGxlciIsICJDb2NvYSBXYXJyaW9yIiB9CiAgICAgICAgICAgIE1Qb3MgPSBDRnJhbWUubmV3KDYyMC42MzQ0NjA0NDkyMTg4LCA3OC45MzY0NDcxNDM1NTQ2OSwgLTEyNTgxLjM2OTE0MDYyNSkKICAgICAgICAgICAgU1AgPSAiRGVmYXVsdCIKICAgICAgICBlbHNlaWYgU2VsZWN0TWF0ZXJpYWwgPT0gIkRyYWdvbiBTY2FsZSIgdGhlbgogICAgICAgICAgICBNTW9uID0geyAiRHJhZ29uIENyZXcgV2FycmlvciIgfQogICAgICAgICAgICBNUG9zID0gQ0ZyYW1lLm5ldyg2NTk0LCAzODMsIDEzOSkKICAgICAgICAgICAgU1AgPSAiRGVmYXVsdCIKICAgICAgICBlbHNlaWYgU2VsZWN0TWF0ZXJpYWwgPT0gIkd1bnBvd2RlciIgdGhlbgogICAgICAgICAgICBNTW9uID0geyAiUGlzdG9sIEJpbGxpb25haXJlIiB9CiAgICAgICAgICAgIE1Qb3MgPSBDRnJhbWUubmV3KC00NjksIDc0LCA1OTA0KQogICAgICAgICAgICBTUCA9ICJEZWZhdWx0IgogICAgICAgIGVsc2VpZiBTZWxlY3RNYXRlcmlhbCA9PSAiTWluaSBUdXNrIiB0aGVuCiAgICAgICAgICAgIE1Nb24gPSB7ICJNeXRob2xvZ2ljYWwgUGlyYXRlIiB9CiAgICAgICAgICAgIE1Qb3MgPSBDRnJhbWUubmV3KC0xMzU0NSwgNDcwLCAtNjkxNykKICAgICAgICAgICAgU1AgPSAiRGVmYXVsdCIKICAgICAgICBlbmQKICAgIGVuZAplbmQKbG9jYWwgbGFzdEhha2lUaW1lID0gMApsb2NhbCBoYWtpQ29vbGRvd24gPSAxCmZ1bmN0aW9uIEF1dG9IYWtpKCkKICAgIGlmIG5vdCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhc0J1c28iKSB0aGVuCiAgICAgICAgbG9jYWwgY3VycmVudFRpbWUgPSB0aWNrKCkKICAgICAgICBpZiBjdXJyZW50VGltZSAtIGxhc3RIYWtpVGltZSA+PSBoYWtpQ29vbGRvd24gdGhlbgogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXNvIikKICAgICAgICAgICAgbGFzdEhha2lUaW1lID0gY3VycmVudFRpbWUKICAgICAgICBlbmQKICAgIGVuZAplbmQKbG9jYWwgbGFzdFVuRXF1aXBUaW1lID0gMApsb2NhbCB1bkVxdWlwQ29vbGRvd24gPSAwLjUKZnVuY3Rpb24gVW5FcXVpcFdlYXBvbihXZWFwb24pCiAgICBsb2NhbCBjdXJyZW50VGltZSA9IHRpY2soKQogICAgaWYgY3VycmVudFRpbWUgLSBsYXN0VW5FcXVpcFRpbWUgPj0gdW5FcXVpcENvb2xkb3duIHRoZW4KICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKFdlYXBvbikgdGhlbgogICAgICAgICAgICBnZXRnZW52KCkuTm90QXV0b0VxdWlwID0gdHJ1ZQogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyW1dlYXBvbl0uUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgICAgIGdldGdlbnYoKS5Ob3RBdXRvRXF1aXAgPSBmYWxzZQogICAgICAgIGVuZAogICAgICAgIGxhc3RVbkVxdWlwVGltZSA9IGN1cnJlbnRUaW1lCiAgICBlbmQKZW5kCmxvY2FsIGxhc3RFcXVpcFRpbWUgPSAwCmxvY2FsIGVxdWlwQ29vbGRvd24gPSAwLjUKZnVuY3Rpb24gRXF1aXBXZWFwb24oVG9vbFNlKQogICAgbG9jYWwgY3VycmVudFRpbWUgPSB0aWNrKCkKICAgIGlmIGN1cnJlbnRUaW1lIC0gbGFzdEVxdWlwVGltZSA+PSBlcXVpcENvb2xkb3duIHRoZW4gICAgICAgIAogICAgICAgIGlmIG5vdCBnZXRnZW52KCkuTm90QXV0b0VxdWlwIHRoZW4KICAgICAgICAgICAgbG9jYWwgdG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZChUb29sU2UpCiAgICAgICAgICAgIGlmIHRvb2wgdGhlbgogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodG9vbCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgbGFzdEVxdWlwVGltZSA9IGN1cnJlbnRUaW1lCiAgICBlbmQKZW5kCmZ1bmN0aW9uIEJUUChwKQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBodW1hbm9pZFJvb3RQYXJ0ID0gcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CiAgICBsb2NhbCBodW1hbm9pZCA9IHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQKICAgIGxvY2FsIHBsYXllckd1aSA9IHBsYXllci5QbGF5ZXJHdWkuTWFpbgogICAgbG9jYWwgdGFyZ2V0UG9zaXRpb24gPSBwLlBvc2l0aW9uCiAgICBsb2NhbCBsYXN0UG9zaXRpb24gPSBodW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uCiAgICByZXBlYXQKICAgICAgICBodW1hbm9pZC5IZWFsdGggPSAwCiAgICAgICAgaHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBwCiAgICAgICAgcGxheWVyR3VpLlF1ZXN0LlZpc2libGUgPSBmYWxzZQogICAgICAgIGlmIChodW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gbGFzdFBvc2l0aW9uKS5NYWduaXR1ZGUgPiAxIHRoZW4KICAgICAgICAgICAgbGFzdFBvc2l0aW9uID0gaHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICBodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHAKICAgICAgICBlbmQKICAgICAgICB0YXNrLndhaXQoMC41KQogICAgdW50aWwgKHAuUG9zaXRpb24gLSBodW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMjAwMAplbmQKZnVuY3Rpb24gQlRQWih2MjA5KQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBpZiBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgcm9vdFBhcnQuQ0ZyYW1lID0gdjIwOQogICAgZW5kCmVuZApsb2NhbCBsYXN0VHdlZW5UaW1lID0gMApsb2NhbCB0d2VlbkNvb2xkb3duID0gMC41CmZ1bmN0aW9uIGZhc3Rwb3MoUG9zKQogICAgbG9jYWwgY3VycmVudFRpbWUgPSB0aWNrKCkKICAgIGlmIGN1cnJlbnRUaW1lIC0gbGFzdFR3ZWVuVGltZSA+PSB0d2VlbkNvb2xkb3duIHRoZW4KICAgICAgICBsb2NhbCBEaXN0YW5jZSA9IChQb3MuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgIGxvY2FsIFNwZWVkID0gMTAwMCAgICAgICAgCiAgICAgICAgbG9jYWwgdHdlZW4gPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpOkNyZWF0ZSgKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQsCiAgICAgICAgICAgIFR3ZWVuSW5mby5uZXcoRGlzdGFuY2UgLyBTcGVlZCwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpLAogICAgICAgICAgICB7IENGcmFtZSA9IFBvcyB9CiAgICAgICAgKQogICAgICAgIHR3ZWVuOlBsYXkoKQogICAgICAgIGxhc3RUd2VlblRpbWUgPSBjdXJyZW50VGltZQogICAgZW5kCmVuZApsb2NhbCBsYXN0VFBCVGltZSA9IDAKbG9jYWwgdHBiQ29vbGRvd24gPSAwLjUKZnVuY3Rpb24gVFBCKHBvcywgYm9hdCkKICAgIGxvY2FsIGN1cnJlbnRUaW1lID0gdGljaygpCiAgICBpZiBjdXJyZW50VGltZSAtIGxhc3RUUEJUaW1lID49IHRwYkNvb2xkb3duIHRoZW4KICAgICAgICBsb2NhbCB0d2Vlbl9zID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKQogICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKGJvYXQuQ0ZyYW1lLlBvc2l0aW9uIC0gcG9zLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICBsb2NhbCBzcGVlZCA9IGdldGdlbnYoKS5TcGVlZEJvYXQKICAgICAgICBsb2NhbCBpbmZvID0gVHdlZW5JbmZvLm5ldyhkaXN0YW5jZSAvIHNwZWVkLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhcikKICAgICAgICBpZiBkaXN0YW5jZSA8PSAyNSB0aGVuCiAgICAgICAgICAgIHJldHVybiB7U3RvcCA9IGZ1bmN0aW9uKCkgZW5kfQogICAgICAgIGVsc2UKICAgICAgICAgICAgbG9jYWwgdHdlZW4gPSB0d2Vlbl9zOkNyZWF0ZShib2F0LCBpbmZvLCB7Q0ZyYW1lID0gcG9zfSkKICAgICAgICAgICAgdHdlZW46UGxheSgpCiAgICAgICAgICAgIGxhc3RUUEJUaW1lID0gY3VycmVudFRpbWUKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN0b3AgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgdHdlZW46Q2FuY2VsKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9CiAgICAgICAgZW5kCiAgICBlbmQKZW5kCmxvY2FsIGxhc3RFcXVpcFRpbWUgPSAwCmxvY2FsIGVxdWlwQ29vbGRvd24gPSAwLjIKZnVuY3Rpb24gRXF1aXBBbGxXZWFwb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIGN1cnJlbnRUaW1lID0gdGljaygpCiAgICAgICAgaWYgY3VycmVudFRpbWUgLSBsYXN0RXF1aXBUaW1lID49IGVxdWlwQ29vbGRvd24gdGhlbgogICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIHY6SXNBKCdUb29sJykgYW5kIG5vdCAodi5OYW1lID09ICJTdW1tb24gU2VhIEJlYXN0IiBvciB2Lk5hbWUgPT0gIldhdGVyIEJvZHkiIG9yIHYuTmFtZSA9PSAiQXdha2VuaW5nIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRvb2xIdW1hbm9pZCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCh2Lk5hbWUpCiAgICAgICAgICAgICAgICAgICAgaWYgVG9vbEh1bWFub2lkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woVG9vbEh1bWFub2lkKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsYXN0RXF1aXBUaW1lID0gY3VycmVudFRpbWUKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCmZ1bmN0aW9uIENoZWNrTmVhcmVzdFRlbGVwb3J0ZXIoYUkpCiAgICBsb2NhbCBNeUxldmVsID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkRhdGEuTGV2ZWwuVmFsdWUKICAgIGxvY2FsIHZjc3BvcyA9IGFJLlBvc2l0aW9uCiAgICBsb2NhbCBtaW4gPSBtYXRoLmh1Z2UKICAgIGxvY2FsIG1pbjIgPSBtYXRoLmh1Z2UKICAgIGxvY2FsIHkgPSBnYW1lLlBsYWNlSWQKICAgIGxvY2FsIFdvcmxkMSwgV29ybGQyLCBXb3JsZDMKICAgIGlmIHkgPT0gMjc1MzkxNTU0OSB0aGVuCiAgICAgICAgV29ybGQxID0gdHJ1ZQogICAgZWxzZWlmIHkgPT0gNDQ0MjI3MjE4MyB0aGVuCiAgICAgICAgV29ybGQyID0gdHJ1ZQogICAgZWxzZWlmIHkgPT0gNzQ0OTQyMzYzNSB0aGVuCiAgICAgICAgV29ybGQzID0gdHJ1ZQogICAgZW5kCiAgICBsb2NhbCBUYWJsZUxvY2F0aW9ucyA9IHt9CiAgICBpZiBXb3JsZDMgdGhlbgogICAgICAgIFRhYmxlTG9jYXRpb25zID0gewogICAgICAgICAgICBbIk1hbnNpb24iXSA9IFZlY3RvcjMubmV3KC0xMjQ3MSwgMzc0LCAtNzU1MSksCiAgICAgICAgICAgIFsiSHlkcmEiXSA9IFZlY3RvcjMubmV3KDU2NTksIDEwMTMsIC0zNDEpLAogICAgICAgICAgICBbIkNhc2x0ZSBPbiBUaGUgU2VhIl0gPSBWZWN0b3IzLm5ldygtNTA5MiwgMzE1LCAtMzEzMCksCiAgICAgICAgICAgIFsiRmxvYXRpbmcgVHVydGxlIl0gPSBWZWN0b3IzLm5ldygtMTIwMDEsIDMzMiwgLTg4NjEpLAogICAgICAgICAgICBbIkJlYXV0aWZ1bCBQaXJhdGUiXSA9IFZlY3RvcjMubmV3KDUzMTksIDIzLCAtOTMpLAogICAgICAgICAgICBbIlRlbXBsZSBPZiBUaW1lIl0gPSBWZWN0b3IzLm5ldygyODI4NiwgMTQ4OTcsIDEwMykKICAgICAgICB9CiAgICBlbHNlaWYgV29ybGQyIHRoZW4KICAgICAgICBUYWJsZUxvY2F0aW9ucyA9IHsKICAgICAgICAgICAgWyJGbGFtaW5nbyBNYW5zaW9uIl0gPSBWZWN0b3IzLm5ldygtMzE3LCAzMzEsIDU5NyksCiAgICAgICAgICAgIFsiRmxhbWluZ28gUm9vbSJdID0gVmVjdG9yMy5uZXcoMjI4MywgMTUsIDg2NyksCiAgICAgICAgICAgIFsiQ3Vyc2VkIFNoaXAiXSA9IFZlY3RvcjMubmV3KDkyMywgMTI1LCAzMjg1MyksCiAgICAgICAgICAgIFsiWm9tYmllIElzbGFuZCJdID0gVmVjdG9yMy5uZXcoLTY1MDksIDgzLCAtMTMzKQogICAgICAgIH0KICAgIGVsc2VpZiBXb3JsZDEgdGhlbgogICAgICAgIFRhYmxlTG9jYXRpb25zID0gewogICAgICAgICAgICBbIlNreSBJc2xhbmQgMSJdID0gVmVjdG9yMy5uZXcoLTQ2NTIsIDg3MywgLTE3NTQpLAogICAgICAgICAgICBbIlNreSBJc2xhbmQgMiJdID0gVmVjdG9yMy5uZXcoLTc4OTUsIDU1NDcsIC0zODApLAogICAgICAgICAgICBbIlVuZGVyIFdhdGVyIElzbGFuZCJdID0gVmVjdG9yMy5uZXcoNjExNjQsIDUsIDE4MjApLAogICAgICAgICAgICBbIlVuZGVyIFdhdGVyIElzbGFuZCBFbnRyYWNlIl0gPSBWZWN0b3IzLm5ldygzODY1LCA1LCAtMTkyNikKICAgICAgICB9CiAgICBlbmQKICAgIGxvY2FsIFRhYmxlTG9jYXRpb25zMiA9IHt9CiAgICBmb3IgciwgdiBpbiBwYWlycyhUYWJsZUxvY2F0aW9ucykgZG8KICAgICAgICBUYWJsZUxvY2F0aW9uczJbcl0gPSAodiAtIHZjc3BvcykuTWFnbml0dWRlCiAgICBlbmQKICAgIGZvciByLCB2IGluIHBhaXJzKFRhYmxlTG9jYXRpb25zMikgZG8KICAgICAgICBpZiB2IDwgbWluIHRoZW4KICAgICAgICAgICAgbWluID0gdgogICAgICAgICAgICBtaW4yID0gdgogICAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBjaG9vc2UKICAgIGZvciByLCB2IGluIHBhaXJzKFRhYmxlTG9jYXRpb25zMikgZG8KICAgICAgICBpZiB2IDw9IG1pbiB0aGVuCiAgICAgICAgICAgIGNob29zZSA9IFRhYmxlTG9jYXRpb25zW3JdCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGxvY2FsIG1pbjMgPSAodmNzcG9zIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgIGlmIG1pbjIgPD0gbWluMyB0aGVuCiAgICAgICAgcmV0dXJuIGNob29zZQogICAgZW5kCmVuZCAgICAKZnVuY3Rpb24gcmVxdWVzdEVudHJhbmNlKGFKKQogICAgbG9jYWwgYXJncyA9IHsicmVxdWVzdEVudHJhbmNlIiwgYUp9CiAgICBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpICAgIAogICAgbG9jYWwgb2xkY2ZyYW1lID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydAogICAgY2hhci5DRnJhbWUgPSBDRnJhbWUubmV3KG9sZGNmcmFtZS5YLCBvbGRjZnJhbWUuWSArIDUwLCBvbGRjZnJhbWUuWikgICAgCiAgICB0YXNrLndhaXQoMC41KQplbmQgICAKZnVuY3Rpb24gdG9wb3MoVHdlZW5fUG9zKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyIAogICAgICAgICAgICBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIAogICAgICAgICAgICBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIAogICAgICAgICAgICBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgCiAgICAgICAgICAgIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoID4gMCAKICAgICAgICAgICAgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgaWYgbm90IFR3ZWVuU3BlZWQgdGhlbgogICAgICAgICAgICAgICAgVHdlZW5TcGVlZCA9IDM1MAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgRGVmdWFsdFkgPSBUd2Vlbl9Qb3MuWQogICAgICAgICAgICBUYXJnZXRZID0gVHdlZW5fUG9zLlkKICAgICAgICAgICAgdGFyZ2V0Q0ZyYW1lV2l0aERlZnVhbHRZID0gQ0ZyYW1lLm5ldyhUd2Vlbl9Qb3MuWCwgRGVmdWFsdFksIFR3ZWVuX1Bvcy5aKQogICAgICAgICAgICB0YXJnZXRQb3MgPSBUd2Vlbl9Qb3MuUG9zaXRpb24KICAgICAgICAgICAgb2xkY2ZyYW1lID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICBEaXN0YW5jZSA9ICh0YXJnZXRQb3MgLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICBpZiBEaXN0YW5jZSA8PSAzMDAgdGhlbgogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFR3ZWVuX1BvcwogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbG9jYWwgYU0gPSBDaGVja05lYXJlc3RUZWxlcG9ydGVyKFR3ZWVuX1BvcykKICAgICAgICAgICAgaWYgYU0gdGhlbgogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHR3ZWVuOkNhbmNlbCgpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICByZXF1ZXN0RW50cmFuY2UoYU0pCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBiMSA9IENGcmFtZS5uZXcoCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlgsCiAgICAgICAgICAgICAgICBEZWZ1YWx0WSwKICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWgogICAgICAgICAgICApCiAgICAgICAgICAgIEluZ29yZVkgPSB0cnVlCiAgICAgICAgICAgIGlmIEluZ29yZVkgYW5kIChiMS5Qb3NpdGlvbiAtIHRhcmdldENGcmFtZVdpdGhEZWZ1YWx0WS5Qb3NpdGlvbikuTWFnbml0dWRlID4gNSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygKICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlgsCiAgICAgICAgICAgICAgICAgICAgRGVmdWFsdFksCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5aCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBsb2NhbCB0d2VlbmZ1bmMgPSB7fQogICAgICAgICAgICAgICAgbG9jYWwgYU4gPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCiAgICAgICAgICAgICAgICBsb2NhbCBhTyA9IFR3ZWVuSW5mby5uZXcoCiAgICAgICAgICAgICAgICAgICAgKHRhcmdldFBvcyAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKS5Qb3NpdGlvbikuTWFnbml0dWRlIC8gVHdlZW5TcGVlZCwKICAgICAgICAgICAgICAgICAgICBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhcgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgdHdlZW4gPSBhTjpDcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyWyJIdW1hbm9pZFJvb3RQYXJ0Il0sCiAgICAgICAgICAgICAgICAgICAgYU8sCiAgICAgICAgICAgICAgICAgICAge0NGcmFtZSA9IHRhcmdldENGcmFtZVdpdGhEZWZ1YWx0WX0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHR3ZWVuOlBsYXkoKQogICAgICAgICAgICAgICAgZnVuY3Rpb24gdHdlZW5mdW5jOlN0b3AoKQogICAgICAgICAgICAgICAgICAgIHR3ZWVuOkNhbmNlbCgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHR3ZWVuLkNvbXBsZXRlZDpXYWl0KCkKICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KAogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWCwKICAgICAgICAgICAgICAgICAgICBUYXJnZXRZLAogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsb2NhbCB0d2VlbmZ1bmMgPSB7fQogICAgICAgICAgICAgICAgbG9jYWwgYU4gPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCiAgICAgICAgICAgICAgICBsb2NhbCBhTyA9IFR3ZWVuSW5mby5uZXcoCiAgICAgICAgICAgICAgICAgICAgKHRhcmdldFBvcyAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKS5Qb3NpdGlvbikuTWFnbml0dWRlIC8gVHdlZW5TcGVlZCwKICAgICAgICAgICAgICAgICAgICBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhcgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgdHdlZW4gPSBhTjpDcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyWyJIdW1hbm9pZFJvb3RQYXJ0Il0sCiAgICAgICAgICAgICAgICAgICAgYU8sCiAgICAgICAgICAgICAgICAgICAge0NGcmFtZSA9IFR3ZWVuX1Bvc30KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHR3ZWVuOlBsYXkoKQogICAgICAgICAgICAgICAgZnVuY3Rpb24gdHdlZW5mdW5jOlN0b3AoKQogICAgICAgICAgICAgICAgICAgIHR3ZWVuOkNhbmNlbCgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHR3ZWVuLkNvbXBsZXRlZDpXYWl0KCkKICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KAogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWCwKICAgICAgICAgICAgICAgICAgICBUYXJnZXRZLAogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuWgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgbm90IHR3ZWVuIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiB0d2VlbgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmV0dXJuIHR3ZWVuZnVuYwogICAgICAgIGVuZAogICAgZW5kKQplbmQKZnVuY3Rpb24gU3RvcFR3ZWVuKHRhcmdldCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3QgdGFyZ2V0IHRoZW4KICAgICAgICAgICAgZ2V0Z2VudigpLlN0b3BUd2VlbiA9IHRydWUgICAgICAgICAgICAKICAgICAgICAgICAgaWYgdHdlZW4gdGhlbgogICAgICAgICAgICAgICAgdHdlZW46Q2FuY2VsKCkKICAgICAgICAgICAgICAgIHR3ZWVuID0gbmlsCiAgICAgICAgICAgIGVuZCAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgaWYgaHVtYW5vaWRSb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICBodW1hbm9pZFJvb3RQYXJ0LkFuY2hvcmVkID0gdHJ1ZQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgIGh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gaHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgIGh1bWFub2lkUm9vdFBhcnQuQW5jaG9yZWQgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbG9jYWwgYm9keUNsaXAgPSBodW1hbm9pZFJvb3RQYXJ0IGFuZCBodW1hbm9pZFJvb3RQYXJ0OkZpbmRGaXJzdENoaWxkKCJCb2R5Q2xpcCIpCiAgICAgICAgICAgIGlmIGJvZHlDbGlwIHRoZW4KICAgICAgICAgICAgICAgIGJvZHlDbGlwOkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZ2V0Z2VudigpLlN0b3BUd2VlbiA9IGZhbHNlCiAgICAgICAgICAgIGdldGdlbnYoKS5DbGlwID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuVGVsZXBvcnRJc2xhbmQgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvRmFybSBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9NYXRlcmlhbCBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLk1hc3RlcnlGYXJtIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0dldE1lbGVlIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuVGVsZXBvcnRUb0ZydWl0IG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b05ld1dvcmxkIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b1RoaXJkU2VhIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0ZhY3Rvcnkgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvUGlyYXRlUmFpZCBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9FbGl0ZUh1bnRlciBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9Ub3VjaFBhZEhha2kgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvUmlwSW5kcmEgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvU291bFJlYXBlciBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9Eb3VnaEtpbmcgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvRGFya2JlYXJkIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuRG9qb0NsYWltUXVlc3Qgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5EcmFnb25UYWxvblVwZ3JhZGUgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5CbGF6ZUVtYmVyRmFybSBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9PYnNlcnZhdGlvbkhha2lWMiBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9PYnNlcnZhdGlvbiBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9GYXJtQm9zcyBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9GYXJtQWxsQm9zcyBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9fRHVuZ2VvbiBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNhaWxCb2F0IG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuUmVsekZpc2hCb2F0IG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuUmVselBpcmF0ZUJyaWdhZGUgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5SZWx6UGlyYXRlR3JhbmRCcmlnYWRlIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b1RlcnJvcnNoYXJrIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b1NlYUJlc3Qgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvRnJvemVuRGltZW5zaW9uIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuS2lsbExldmkgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLlVwZ3JhZGVSYWNlVjIgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9DeWJvcmcgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9HaG91bCBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuUXVlc3RUcmFpbl8yIG9yCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5UZWxlcG9ydE1pZ2FyZSBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuVHdlZW50b2hpZ2hlc3Rwb2ludCBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuVGVsZXBvcnRUb0dlYXIgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9UcmlhbFJhY2Ugb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9LaWxsUGxheWVyQWZ0ZXJUcmlhbCBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b1JhaW5ib3dIYWtpIG9yCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvU2t1bGxHdWl0YXIgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9HZXRDREsgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9UdXNoaXRhIG9yCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvU2FiZXIgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLlRlbGVwb3J0UGxheWVyCiAgICAgICAgICAgIHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydDpGaW5kRmlyc3RDaGlsZCgiQm9keUNsaXAiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTm9jbGlwID0gSW5zdGFuY2UubmV3KCJCb2R5VmVsb2NpdHkiKQogICAgICAgICAgICAgICAgICAgIE5vY2xpcC5OYW1lID0gIkJvZHlDbGlwIgogICAgICAgICAgICAgICAgICAgIE5vY2xpcC5QYXJlbnQgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydAogICAgICAgICAgICAgICAgICAgIE5vY2xpcC5NYXhGb3JjZSA9IFZlY3RvcjMubmV3KDEwMDAwMCwgMTAwMDAwLCAxMDAwMDApCiAgICAgICAgICAgICAgICAgICAgTm9jbGlwLlZlbG9jaXR5ID0gVmVjdG9yMy5uZXcoMCwgMCwgMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsb2NhbCBib2R5Q2xpcCA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0OkZpbmRGaXJzdENoaWxkKCJCb2R5Q2xpcCIpCiAgICAgICAgICAgICAgICBpZiBib2R5Q2xpcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgYm9keUNsaXA6RGVzdHJveSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5UZWxlcG9ydElzbGFuZCBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9GYXJtIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b01hdGVyaWFsIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuTWFzdGVyeUZhcm0gb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvR2V0TWVsZWUgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5UZWxlcG9ydFRvRnJ1aXQgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvTmV3V29ybGQgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvVGhpcmRTZWEgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvRmFjdG9yeSBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9QaXJhdGVSYWlkIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0VsaXRlSHVudGVyIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b1RvdWNoUGFkSGFraSBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9SaXBJbmRyYSBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9Tb3VsUmVhcGVyIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0RvdWdoS2luZyBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9EYXJrYmVhcmQgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5Eb2pvQ2xhaW1RdWVzdCBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkRyYWdvblRhbG9uVXBncmFkZSBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkJsYXplRW1iZXJGYXJtIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uSGFraVYyIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0Zhcm1Cb3NzIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0Zhcm1BbGxCb3NzIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b19EdW5nZW9uIG9yIAogICAgICAgICAgICAgICBnZXRnZW52KCkuU2FpbEJvYXQgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5SZWx6RmlzaEJvYXQgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5SZWx6UGlyYXRlQnJpZ2FkZSBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLlJlbHpQaXJhdGVHcmFuZEJyaWdhZGUgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvVGVycm9yc2hhcmsgb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvU2VhQmVzdCBvciAKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9Gcm96ZW5EaW1lbnNpb24gb3IgCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5LaWxsTGV2aSBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuVXBncmFkZVJhY2VWMiBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0N5Ym9yZyBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0dob3VsIG9yCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5RdWVzdFRyYWluXzIgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLlRlbGVwb3J0TWlnYXJlIG9yCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5Ud2VlbnRvaGlnaGVzdHBvaW50IG9yCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5UZWxlcG9ydFRvR2VhciBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b1RyaWFsUmFjZSBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0tpbGxQbGF5ZXJBZnRlclRyaWFsIG9yCiAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvUmFpbmJvd0hha2kgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9Ta3VsbEd1aXRhciBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0dldENESyBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b1R1c2hpdGEgb3IKICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9TYWJlciBvcgogICAgICAgICAgICAgICBnZXRnZW52KCkuVGVsZXBvcnRQbGF5ZXIKICAgICAgICAgICAgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB2LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBsYXN0Q2FsbCA9IDAKICAgIGxvY2FsIGNhbGxJbnRlcnZhbCA9IDEKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIChnZXRnZW52KCkuQXV0b0Zhcm0gb3IgZ2V0Z2VudigpLktpbGxfVHJpYWxfVjQpIGFuZCB0aWNrKCkgLSBsYXN0Q2FsbCA+IGNhbGxJbnRlcnZhbCB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1FOkZpcmVTZXJ2ZXIoIktlbiIsIHRydWUpCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgbGFzdENhbGwgPSB0aWNrKCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGxhc3RQb3NVcGRhdGUgPSB0aWNrKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9TZWFCZXN0IGFuZCBDaGVja1NlYUJlYXN0KCkgdGhlbgogICAgICAgICAgICBsb2NhbCBjdXJyZW50VGltZSA9IHRpY2soKQogICAgICAgICAgICBpZiBjdXJyZW50VGltZSAtIGxhc3RQb3NVcGRhdGUgPj0gMC41IHRoZW4KICAgICAgICAgICAgICAgIFBvcyA9IENGcmFtZS5uZXcobWF0aC5yYW5kb20oLTYwMCwgNjAwKSwgbWF0aC5yYW5kb20oMCwgMzAwKSwgbWF0aC5yYW5kb20oLTYwMCwgNjAwKSkKICAgICAgICAgICAgICAgIGxhc3RQb3NVcGRhdGUgPSBjdXJyZW50VGltZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCmxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBmdW5jdGlvbiBJc0VudGl0eUFsaXZlKGVudGl0eSkKICAgIGlmIG5vdCBlbnRpdHkgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICBsb2NhbCBodW1hbm9pZCA9IGVudGl0eTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgcmV0dXJuIGh1bWFub2lkIGFuZCBodW1hbm9pZC5IZWFsdGggPiAwCmVuZApsb2NhbCBmdW5jdGlvbiBHZXRFbmVtaWVzSW5SYW5nZShjaGFyYWN0ZXIsIHJhbmdlKQogICAgbG9jYWwgZW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpCiAgICBsb2NhbCBwbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIik6R2V0UGxheWVycygpCiAgICBsb2NhbCB0YXJnZXRzID0ge30KICAgIGxvY2FsIHBsYXllclBvcyA9IGNoYXJhY3RlcjpHZXRQaXZvdCgpLlBvc2l0aW9uCiAgICBmb3IgXywgZW5lbXkgaW4gaXBhaXJzKGVuZW1pZXMpIGRvCiAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgaWYgcm9vdFBhcnQgYW5kIElzRW50aXR5QWxpdmUoZW5lbXkpIHRoZW4KICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAocm9vdFBhcnQuUG9zaXRpb24gLSBwbGF5ZXJQb3MpLk1hZ25pdHVkZQogICAgICAgICAgICBpZiBkaXN0YW5jZSA8PSByYW5nZSB0aGVuCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQodGFyZ2V0cywgZW5lbXkpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICBmb3IgXywgb3RoZXJQbGF5ZXIgaW4gaXBhaXJzKHBsYXllcnMpIGRvCiAgICAgICAgaWYgb3RoZXJQbGF5ZXIgfj0gcGxheWVyIGFuZCBvdGhlclBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICBsb2NhbCByb290UGFydCA9IG90aGVyUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgIGlmIHJvb3RQYXJ0IGFuZCBJc0VudGl0eUFsaXZlKG90aGVyUGxheWVyLkNoYXJhY3RlcikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAocm9vdFBhcnQuUG9zaXRpb24gLSBwbGF5ZXJQb3MpLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgaWYgZGlzdGFuY2UgPD0gcmFuZ2UgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh0YXJnZXRzLCBvdGhlclBsYXllci5DaGFyYWN0ZXIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiB0YXJnZXRzCmVuZApmdW5jdGlvbiBBdHRhY2tOb0Nvb2xEb3duKCkKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgIGlmIG5vdCBjaGFyYWN0ZXIgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBlcXVpcHBlZFdlYXBvbgogICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKGNoYXJhY3RlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIGl0ZW06SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICBlcXVpcHBlZFdlYXBvbiA9IGl0ZW0KICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgbm90IGVxdWlwcGVkV2VhcG9uIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgZW5lbWllc0luUmFuZ2UgPSBHZXRFbmVtaWVzSW5SYW5nZShjaGFyYWN0ZXIsIDYwKQogICAgaWYgZXF1aXBwZWRXZWFwb246RmluZEZpcnN0Q2hpbGQoIkxlZnRDbGlja1JlbW90ZSIpIHRoZW4KICAgICAgICBsb2NhbCBhdHRhY2tDb3VudCA9IDEgIAogICAgICAgIGZvciBfLCBlbmVteSBpbiBpcGFpcnMoZW5lbWllc0luUmFuZ2UpIGRvCiAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICBpZiByb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBkaXJlY3Rpb24gPSAocm9vdFBhcnQuUG9zaXRpb24gLSBjaGFyYWN0ZXI6R2V0UGl2b3QoKS5Qb3NpdGlvbikuVW5pdAogICAgICAgICAgICAgICAgZXF1aXBwZWRXZWFwb24uTGVmdENsaWNrUmVtb3RlOkZpcmVTZXJ2ZXIoZGlyZWN0aW9uLCBhdHRhY2tDb3VudCkKICAgICAgICAgICAgICAgIGF0dGFja0NvdW50ID0gYXR0YWNrQ291bnQgKyAxCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGxvY2FsIHRhcmdldHMsIG1haW5UYXJnZXQgPSB7fSwgbmlsCiAgICAgICAgZm9yIF8sIGVuZW15IGluIGlwYWlycyhlbmVtaWVzSW5SYW5nZSkgZG8KICAgICAgICAgICAgaWYgbm90IGVuZW15OkdldEF0dHJpYnV0ZSgiSXNCb2F0IikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaGVhZCA9IGVuZW15OkZpbmRGaXJzdENoaWxkKCJIZWFkIikKICAgICAgICAgICAgICAgIGlmIGhlYWQgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh0YXJnZXRzLCB7IGVuZW15LCBoZWFkIH0pCiAgICAgICAgICAgICAgICAgICAgbWFpblRhcmdldCA9IGhlYWQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBpZiBtYWluVGFyZ2V0IHRoZW4KICAgICAgICAgICAgbG9jYWwgc3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgICAgICAgICBsb2NhbCBhdHRhY2tFdmVudCA9IHN0b3JhZ2U6V2FpdEZvckNoaWxkKCJNb2R1bGVzIik6V2FpdEZvckNoaWxkKCJOZXQiKTpXYWl0Rm9yQ2hpbGQoIlJFL1JlZ2lzdGVyQXR0YWNrIikKICAgICAgICAgICAgbG9jYWwgaGl0RXZlbnQgPSBzdG9yYWdlOldhaXRGb3JDaGlsZCgiTW9kdWxlcyIpOldhaXRGb3JDaGlsZCgiTmV0Iik6V2FpdEZvckNoaWxkKCJSRS9SZWdpc3RlckhpdCIpCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGF0dGFja0V2ZW50OkZpcmVTZXJ2ZXIoMC4xKQogICAgICAgICAgICAgICAgaGl0RXZlbnQ6RmlyZVNlcnZlcihtYWluVGFyZ2V0LCB0YXJnZXRzKQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCnByaW50KCItLVtbTG9hZGVkIFVJXV0tLSIpCkZsdWVudCA9IGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTHVhQ3JhY2svTGlicmFyeS9yZWZzL2hlYWRzL21haW4vTGlicmFyeUZsdWVudC5sdWEiKSkoKQpXaW5kb3cgPSBGbHVlbnQ6Q3JlYXRlV2luZG93KHsKICAgIFRpdGxlID0gIkhpcnUgSHViLUJsb3ggRnJ1aXQiLAogICAgU3ViVGl0bGUgPSAiYnkgS2lkZG8iLAogICAgVGFiV2lkdGggPSAxNTUsCiAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCg1NTUsIDMyMCksCiAgICBBY3J5bGljID0gZmFsc2UsIAogICAgVGhlbWUgPSAiTHVmZnkiLAogICAgTWluaW1pemVLZXkgPSBFbnVtLktleUNvZGUuTGVmdENvbnRyb2wgCn0pClNob3AgPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiVGFiIFNob3AiLCBJY29uID0gIiIgfSkKc2V4ID0gewogICAgIldpbGREYXJlcyIsCiAgICAiQm9zc0J1aWxkIiwKICAgICJHZXRQcmFua2VkIiwKICAgICJTdWIyT2ZmaWNpYWxOb29iaWUiLAogICAgIlN1YjJEYWlncm9jayIsCiAgICAiU3ViMk5vb2JNYXN0ZXIxMjMiLAogICAgIkJsdXh4eSIsCiAgICAiSkNXSyIsCiAgICAiRW55dV9pc19Qcm8iLAogICAgIlN1YjJGZXI5OTkiLAogICAgImtpdHRnYW1pbmciLAogICAgIlRoZUdyZWF0QWNlIiwKICAgICJTdHJhd0hhdE1haW5lIiwKICAgICJUYW50YWlHYW1pbmciLAogICAgIkF4aW9yZSIsCiAgICAiU1VCMkdBTUVSUk9CT1RfRVhQMSIsCiAgICAiTWFnaWNCdXMiLAogICAgIlN0YXJjb2RlSEVPIiwKICAgICJTdWIyQ2FwdGFpbk1hdWkiLAogICAgIkZJR0hUNEZSVUlUIiwKICAgICJFQVJOX0ZSVUlUUyIsCn0KU2hvcDpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiUmVkZWVtIENvZGUiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgZnVuY3Rpb24gUmVkZWVtQ29kZShWYWx1ZSkKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuUmVkZWVtOkludm9rZVNlcnZlcihWYWx1ZSkKICAgICAgICBlbmQKICAgICAgICBsb2NhbCBkZWxheUJldHdlZW5SZXF1ZXN0cyA9IDAuNQogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKHNleCkgZG8KICAgICAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgUmVkZWVtQ29kZSh2KQogICAgICAgICAgICAgICAgd2FpdChkZWxheUJldHdlZW5SZXF1ZXN0cykKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCn0pCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIENvbW1GX1JlbW90ZSA9IFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiQ29tbUZfIikKU2hvcDpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiVGVsZXBvcnQgT2xkIFdvcmxkIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIENvbW1GX1JlbW90ZTpJbnZva2VTZXJ2ZXIoIlRyYXZlbE1haW4iKQogICAgICAgIGVuZCkKICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgZW5kCiAgICBlbmQKfSkKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgUmVtb3RlcyA9IFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiUmVtb3RlcyIpCmxvY2FsIENvbW1GX1JlbW90ZSA9IFJlbW90ZXM6V2FpdEZvckNoaWxkKCJDb21tRl8iKQpTaG9wOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJUZWxlcG9ydCBOZXcgV29ybGQiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gQ29tbUZfUmVtb3RlOkludm9rZVNlcnZlcigiVHJhdmVsRHJlc3Nyb3NhIikKICAgICAgICBlbmQpCiAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbiAgICAgICAgICAgIAogICAgICAgIGVuZAogICAgZW5kCn0pCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIFJlbW90ZXMgPSBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKQpsb2NhbCBDb21tRl9SZW1vdGUgPSBSZW1vdGVzOldhaXRGb3JDaGlsZCgiQ29tbUZfIikKU2hvcDpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiVGVsZXBvcnQgVGhpcmQgU2VhIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIENvbW1GX1JlbW90ZTpJbnZva2VTZXJ2ZXIoIlRyYXZlbFpvdSIpCiAgICAgICAgZW5kKQogICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4KICAgICAgICBlbmQKICAgIGVuZAp9KQpTaG9wOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJGaWdodGluZyBTaG9wIiwKICAgIENvbnRlbnQgPSBzdHJpbmcucmVwKCItIiwgMjEpCn0pCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIFJlbW90ZXMgPSBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKQpsb2NhbCBDb21tRl9SZW1vdGUgPSBSZW1vdGVzOldhaXRGb3JDaGlsZCgiQ29tbUZfIikKU2hvcDpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiQmxhY2sgTGVnIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIENvbW1GX1JlbW90ZTpJbnZva2VTZXJ2ZXIoIkJ1eUJsYWNrTGVnIikKICAgICAgICBlbmQpCiAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbiAgICAgICAgICAgIAogICAgICAgIGVuZAogICAgZW5kCn0pCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIFJlbW90ZXMgPSBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKQpsb2NhbCBDb21tRl9SZW1vdGUgPSBSZW1vdGVzOldhaXRGb3JDaGlsZCgiQ29tbUZfIikKU2hvcDpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiRmlzaG1hbiBLYXJhdGUiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gQ29tbUZfUmVtb3RlOkludm9rZVNlcnZlcigiQnV5RmlzaG1hbkthcmF0ZSIpCiAgICAgICAgZW5kKQogICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4gICAgICAgICAgICAKICAgICAgICBlbmQKICAgIGVuZAp9KQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBSZW1vdGVzID0gUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJSZW1vdGVzIikKbG9jYWwgQ29tbUZfUmVtb3RlID0gUmVtb3RlczpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpClNob3A6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIkVsZWN0cm8iLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gQ29tbUZfUmVtb3RlOkludm9rZVNlcnZlcigiQnV5RWxlY3RybyIpCiAgICAgICAgZW5kKQogICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4gICAgICAgICAgICAKICAgICAgICBlbmQKICAgIGVuZAp9KQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBSZW1vdGVzID0gUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJSZW1vdGVzIikKbG9jYWwgQ29tbUZfUmVtb3RlID0gUmVtb3RlczpXYWl0Rm9yQ2hpbGQoIkNvbW1GXyIpClNob3A6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIkRyYWdvbiBCcmVhdGgiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgc3VjY2VzczEsIHJlc3VsdDEgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHJldHVybiBDb21tRl9SZW1vdGU6SW52b2tlU2VydmVyKCJCbGFja2JlYXJkUmV3YXJkIiwgIkRyYWdvbkNsYXciLCAiMSIpCiAgICAgICAgZW5kKQogICAgICAgIGlmIG5vdCBzdWNjZXNzMSB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIGxvY2FsIHN1Y2Nlc3MyLCByZXN1bHQyID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gQ29tbUZfUmVtb3RlOkludm9rZVNlcnZlcigiQmxhY2tiZWFyZFJld2FyZCIsICJEcmFnb25DbGF3IiwgIjIiKQogICAgICAgIGVuZCkKICAgICAgICBpZiBub3Qgc3VjY2VzczIgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgIGVuZAp9KQpTaG9wOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJTdXBlckh1bWFuIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCiAgICAgICAgbG9jYWwgQ29tbUZfID0gUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl8KICAgICAgICBDb21tRl86SW52b2tlU2VydmVyKCJCdXlTdXBlcmh1bWFuIikKICAgIGVuZAp9KQpTaG9wOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJEZWF0aCBTdGVwIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCiAgICAgICAgbG9jYWwgQ29tbUZfID0gUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl8KICAgICAgICBDb21tRl86SW52b2tlU2VydmVyKCJCdXlEZWF0aFN0ZXAiKQogICAgZW5kCn0pClNob3A6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIlNoYXJrbWFuIEthcmF0ZSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgICAgIGxvY2FsIENvbW1GXyA9IFJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfCiAgICAgICAgQ29tbUZfOkludm9rZVNlcnZlcigiQnV5U2hhcmttYW5LYXJhdGUiLCB0cnVlKQogICAgICAgIHdhaXQoMC4yKQogICAgICAgIENvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eVNoYXJrbWFuS2FyYXRlIikKICAgIGVuZAp9KQpTaG9wOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJFbGVjdHJpYyBDbGF3IiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCiAgICAgICAgbG9jYWwgQ29tbUZfID0gUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl8KICAgICAgICBDb21tRl86SW52b2tlU2VydmVyKCJCdXlFbGVjdHJpY0NsYXciKQogICAgZW5kCn0pClNob3A6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIkRyYWdvbiBUYWxvbiIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgICAgIGxvY2FsIENvbW1GXyA9IFJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfCiAgICAgICAgQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RHJhZ29uVGFsb24iKQogICAgZW5kCn0pClNob3A6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIkdvZCBIdW1hbiIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgICAgIGxvY2FsIENvbW1GXyA9IFJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfCiAgICAgICAgQ29tbUZfOkludm9rZVNlcnZlcigiQnV5R29kaHVtYW4iKQogICAgZW5kCn0pClNob3A6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIlNhbmd1aW5lIEFydCIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgICAgIGxvY2FsIENvbW1GXyA9IFJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfCiAgICAgICAgQ29tbUZfOkludm9rZVNlcnZlcigiQnV5U2FuZ3VpbmVBcnQiLCB0cnVlKQogICAgICAgIHdhaXQoMC4yKQogICAgICAgIENvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eVNhbmd1aW5lQXJ0IikKICAgIGVuZAp9KQpTaG9wOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJBYmlsaXRpZXMgU2hvcCIsCiAgICBDb250ZW50ID0gc3RyaW5nLnJlcCgiLSIsIDIxKQp9KQpTaG9wOkFkZEJ1dHRvbih7CglUaXRsZSA9ICJTa3lqdW1wIFsgJDEwLDAwMCBCZWxpIF0iLAoJQ2FsbGJhY2sgPSBmdW5jdGlvbigpCgkJZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5SGFraSIsIkdlcHBvIikKCWVuZAp9KQpTaG9wOkFkZEJ1dHRvbih7CglUaXRsZSA9ICJCdXNvIEhha2kgWyAkMjUsMDAwIEJlbGkgXSIsCglDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQlnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlIYWtpIiwiQnVzbyIpCgllbmQKfSkKU2hvcDpBZGRCdXR0b24oewoJVGl0bGUgPSAiT2JzZXJ2YXRpb24gaGFraSBbICQ3NTAsMDAwIEJlbGkgXSIsCglDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJLZW5UYWxrIiwiQnV5IikKCWVuZAp9KQpTaG9wOkFkZEJ1dHRvbih7CglUaXRsZSA9ICJTb3J1IFsgJDEwMCwwMDAgQmVsaSBdIiwKCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCWdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUhha2kiLCJTb3J1IikKCWVuZAp9KQpTaG9wOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJNaXNjIFNob3AiLAogICAgQ29udGVudCA9IHN0cmluZy5yZXAoIi0iLCAyMSkKfSkKU2hvcDpBZGRCdXR0b24oewogICAgIFRpdGxlID0gIkJ1eSBSZWZ1bmQgU3RhdCAoMjUwMEYpIiwKICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkgICAgICAgICAgICAKICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQmxhY2tiZWFyZFJld2FyZCIsIlJlZnVuZCIsIjEiKQogICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCbGFja2JlYXJkUmV3YXJkIiwiUmVmdW5kIiwiMiIpCiAgICAgZW5kCn0pClNob3A6QWRkQnV0dG9uKHsKICAgICBUaXRsZSA9ICJCdXkgUmVyb2xsIFJhY2UgKDMwMDBGKSIsCiAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpICAgICAgICAgICAgCiAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJsYWNrYmVhcmRSZXdhcmQiLCJSZXJvbGwiLCIxIikKCSAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQmxhY2tiZWFyZFJld2FyZCIsIlJlcm9sbCIsIjIiKQogICAgIGVuZAp9KQpTaG9wOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJCdXkgR2hvdWwgUmFjZSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBhcmdzMSA9IHtbMV0gPSAiRWN0b3BsYXNtIiwgWzJdID0gIkJ1eUNoZWNrIiwgWzNdID0gNH0KICAgICAgICBsb2NhbCBhcmdzMiA9IHtbMV0gPSAiRWN0b3BsYXNtIiwgWzJdID0gIkNoYW5nZSIsIFszXSA9IDR9CiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJnczEpKSAgICAgICAgCiAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJnczIpKQogICAgZW5kCn0pClNob3A6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIkJ1eSBDeWJvcmcgUmFjZSAoMjUwMEYpIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGlmIG5vdCBpc0J1eWluZyB0aGVuCiAgICAgICAgICAgIGlzQnV5aW5nID0gdHJ1ZQogICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICJDeWJvcmdUcmFpbmVyIiwgWzJdID0gIkJ1eSJ9CiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKSAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICB3YWl0KDAuNSkKICAgICAgICAgICAgaXNCdXlpbmcgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCn0pClNlcnZlciA9IFdpbmRvdzpBZGRUYWIoeyBUaXRsZSA9ICJUYWIgU3RhdHVzIEFuZCBTZXJ2ZXIiLCBJY29uID0gIiIgfSkKVGltZSA9IFNlcnZlcjpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiVGltZSBab25lIiwKICAgIENvbnRlbnQgPSAiIgp9KQpmdW5jdGlvbiBVcGRhdGVPUygpCiAgICBsb2NhbCBkYXRlID0gb3MuZGF0ZSgiKnQiKQogICAgbG9jYWwgaG91ciA9IChkYXRlLmhvdXIpICUgMjQKICAgIGxvY2FsIGFtcG0gPSBob3VyIDwgMTIgYW5kICJBTSIgb3IgIlBNIgogICAgbG9jYWwgdGltZXpvbmUgPSBzdHJpbmcuZm9ybWF0KCIlMDJpOiUwMmk6JTAyaSAlcyIsICgoaG91ciAtIDEpICUgMTIpICsgMSwgZGF0ZS5taW4sIGRhdGUuc2VjLCBhbXBtKQogICAgbG9jYWwgZGF0ZXRpbWUgPSBzdHJpbmcuZm9ybWF0KCIlMDJkLyUwMmQvJTA0ZCIsIGRhdGUuZGF5LCBkYXRlLm1vbnRoLCBkYXRlLnllYXIpICAgIAogICAgbG9jYWwgTG9jYWxpemF0aW9uU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiTG9jYWxpemF0aW9uU2VydmljZSIpCiAgICBsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKICAgIGxvY2FsIHBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIG5hbWUgPSBwbGF5ZXIuTmFtZQogICAgbG9jYWwgcmVzdWx0LCBjb2RlICAgIAogICAgaWYgbm90IGdldGdlbnYoKS5jb3VudHJ5UmVnaW9uQ29kZSB0aGVuCiAgICAgICAgcmVzdWx0LCBjb2RlID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gTG9jYWxpemF0aW9uU2VydmljZTpHZXRDb3VudHJ5UmVnaW9uRm9yUGxheWVyQXN5bmMocGxheWVyKQogICAgICAgIGVuZCkKICAgICAgICBpZiByZXN1bHQgdGhlbgogICAgICAgICAgICBnZXRnZW52KCkuY291bnRyeVJlZ2lvbkNvZGUgPSBjb2RlCiAgICAgICAgZWxzZQogICAgICAgICAgICBnZXRnZW52KCkuY291bnRyeVJlZ2lvbkNvZGUgPSAiVW5rbm93biIKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBjb2RlID0gZ2V0Z2VudigpLmNvdW50cnlSZWdpb25Db2RlCiAgICBlbmQKICAgIFRpbWU6U2V0RGVzYyhkYXRldGltZS4uIiAtICIuLnRpbWV6b25lLi4iIFsgIiAuLiBjb2RlIC4uICIgXSIpCmVuZApzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgVXBkYXRlT1MoKQogICAgICAgIHdhaXQoMSkKICAgIGVuZAplbmQpClRpbW1lc3NzcyA9IFNlcnZlcjpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiVGltZSIsCiAgICBDb250ZW50ID0gIiIKfSkKZnVuY3Rpb24gVXBkYXRlVGltZSgpCiAgICBsb2NhbCBHYW1lVGltZSA9IG1hdGguZmxvb3Iod29ya3NwYWNlLkRpc3RyaWJ1dGVkR2FtZVRpbWUgKyAwLjUpCiAgICBsb2NhbCBIb3VyID0gbWF0aC5mbG9vcihHYW1lVGltZSAvICg2MF4yKSkgJSAyNAogICAgbG9jYWwgTWludXRlID0gbWF0aC5mbG9vcihHYW1lVGltZSAvICg2MF4xKSkgJSA2MAogICAgbG9jYWwgU2Vjb25kID0gbWF0aC5mbG9vcihHYW1lVGltZSAvICg2MF4wKSkgJSA2MAogICAgVGltbWVzc3NzOlNldERlc2MoSG91ci4uIiBIb3VyIChoKSAiLi5NaW51dGUuLiIgTWludXRlIChtKSAiLi5TZWNvbmQuLiIgU2Vjb25kIChzKSAiKQplbmQKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIFVwZGF0ZVRpbWUoKQogICAgICAgIHdhaXQoMSkKICAgIGVuZAplbmQpCk1pcmFnZWNoZWNrID0gU2VydmVyOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJNaXJhZ2UgSXNsYW5kIiwKICAgIENvbnRlbnQgPSAiU3RhdHVzOiAiCn0pCmxvY2FsIHByZXZpb3VzU3RhdHVzID0gIiIKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgd2FpdCgxKSAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBtaXJhZ2VJc2xhbmRFeGlzdHMgPSBnYW1lLldvcmtzcGFjZS5fV29ybGRPcmlnaW4uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKCdNaXJhZ2UgSXNsYW5kJykgfj0gbmlsCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRTdGF0dXMgPSBtaXJhZ2VJc2xhbmRFeGlzdHMgYW5kICfinIXvuI8nIG9yICfinYzvuI8nCiAgICAgICAgICAgIGlmIGN1cnJlbnRTdGF0dXMgfj0gcHJldmlvdXNTdGF0dXMgdGhlbgogICAgICAgICAgICAgICAgTWlyYWdlY2hlY2s6U2V0RGVzYygnU3RhdHVzOiAnIC4uIGN1cnJlbnRTdGF0dXMpCiAgICAgICAgICAgICAgICBwcmV2aW91c1N0YXR1cyA9IGN1cnJlbnRTdGF0dXMKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKS2l0c3VuZWNoZWNrID0gU2VydmVyOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJLaXRzdW5lIElzbGFuZCIsCiAgICBDb250ZW50ID0gIlN0YXR1czogIgp9KQpzcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBwcmV2aW91c1N0YXR1cyA9ICIiCiAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICBsb2NhbCBjdXJyZW50U3RhdHVzID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXA6RmluZEZpcnN0Q2hpbGQoIktpdHN1bmVJc2xhbmQiKSBhbmQgJ+Kche+4jycgb3IgJ+KdjO+4jycKICAgICAgICBpZiBjdXJyZW50U3RhdHVzIH49IHByZXZpb3VzU3RhdHVzIHRoZW4KICAgICAgICAgICAgS2l0c3VuZWNoZWNrOlNldERlc2MoJ1N0YXR1czogJyAuLiBjdXJyZW50U3RhdHVzKQogICAgICAgICAgICBwcmV2aW91c1N0YXR1cyA9IGN1cnJlbnRTdGF0dXMKICAgICAgICBlbmQKICAgIGVuZAplbmQpCkNQcmVoaXN0b3JpY2NoZWNrID0gU2VydmVyOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJQcmVoaXN0b3JpYyBJc2xhbmQiLAogICAgRGVzYyA9ICJTdGF0dXM6ICIKfSkKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBwcmV2aW91c1N0YXR1cyA9ICIiCiAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICBsb2NhbCBjdXJyZW50U3RhdHVzID0gZ2FtZS5Xb3Jrc3BhY2UuX1dvcmxkT3JpZ2luLkxvY2F0aW9uczpGaW5kRmlyc3RDaGlsZCgiUHJlaGlzdG9yaWMgSXNsYW5kIikgYW5kICfinIXvuI8nIG9yICfinYzvuI8nCiAgICAgICAgaWYgY3VycmVudFN0YXR1cyB+PSBwcmV2aW91c1N0YXR1cyB0aGVuCiAgICAgICAgICAgIENQcmVoaXN0b3JpY2NoZWNrOlNldERlc2MoIlN0YXR1czogIiAuLiBjdXJyZW50U3RhdHVzKQogICAgICAgICAgICBwcmV2aW91c1N0YXR1cyA9IGN1cnJlbnRTdGF0dXMKICAgICAgICBlbmQKICAgIGVuZAplbmQpCkZyb3plbklzbGFuZCA9IFNlcnZlcjpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiRnJvemVuIERpbWVuc2lvbiIsCiAgICBDb250ZW50ID0gIlN0YXR1czogIgp9KQpzcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBwcmV2aW91c1N0YXR1cyA9ICIiCiAgICB3aGlsZSB3YWl0KDEpIGRvCiAgICAgICAgbG9jYWwgY3VycmVudFN0YXR1cyA9IGdhbWUuV29ya3NwYWNlLl9Xb3JsZE9yaWdpbi5Mb2NhdGlvbnM6RmluZEZpcnN0Q2hpbGQoJ0Zyb3plbiBEaW1lbnNpb24nKSBhbmQgJ+Kche+4jycgb3IgJ+KdjO+4jycKICAgICAgICBpZiBjdXJyZW50U3RhdHVzIH49IHByZXZpb3VzU3RhdHVzIHRoZW4KICAgICAgICAgICAgRnJvemVuSXNsYW5kOlNldERlc2MoJ1N0YXR1czogJyAuLiBjdXJyZW50U3RhdHVzKQogICAgICAgICAgICBwcmV2aW91c1N0YXR1cyA9IGN1cnJlbnRTdGF0dXMKICAgICAgICBlbmQKICAgIGVuZAplbmQpCk1vYkNha2VQcmluY2UgPSBTZXJ2ZXI6QWRkUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIkRpbWVuc2lvbiBLaWxsZWQiLAogICAgQ29udGVudCA9ICIiCn0pCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoMSkgZG8KICAgICAgICBsb2NhbCBjYWtlUHJpbmNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQ2FrZVByaW5jZVNwYXduZXIiKQogICAgICAgIGxvY2FsIGtpbGxTdGF0dXMgPSAiQ2FrZSBQcmluY2U6IOKche+4jyIKICAgICAgICBpZiBzdHJpbmcubGVuKGNha2VQcmluY2UpID49IDg2IHRoZW4KICAgICAgICAgICAgbG9jYWwga2lsbENvdW50ID0gc3RyaW5nLnN1YihjYWtlUHJpbmNlLCAzOSwgNDEpCiAgICAgICAgICAgIGtpbGxTdGF0dXMgPSAiS2lsbDogIiAuLiBraWxsQ291bnQKICAgICAgICBlbmQKICAgICAgICBNb2JDYWtlUHJpbmNlOlNldERlc2Moa2lsbFN0YXR1cykKICAgIGVuZAplbmQpCkNoZWNrUmlwID0gU2VydmVyOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJSaXBfSW5kcmEiLAogICAgQ29udGVudCA9ICJTdGF0dXM6ICIKfSkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgcHJldmlvdXNTdGF0dXMgPSAiIgogICAgd2hpbGUgd2FpdCgxKSBkbwogICAgICAgIGxvY2FsIGN1cnJlbnRTdGF0dXMgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoInJpcF9pbmRyYSBUcnVlIEZvcm0iKSBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoInJpcF9pbmRyYSIpIGFuZCAn4pyF77iPJyBvciAn4p2M77iPJwogICAgICAgIGlmIGN1cnJlbnRTdGF0dXMgfj0gcHJldmlvdXNTdGF0dXMgdGhlbgogICAgICAgICAgICBDaGVja1JpcDpTZXREZXNjKCJTdGF0dXM6ICIgLi4gY3VycmVudFN0YXR1cykKICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMgPSBjdXJyZW50U3RhdHVzCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpDaGVja0RvdWdoS2luZyA9IFNlcnZlcjpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiRG91Z2ggS2luZyIsCiAgICBDb250ZW50ID0gIlN0YXR1czogIgp9KQpzcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBwcmV2aW91c1N0YXR1cyA9ICIiCiAgICB3aGlsZSB3YWl0KDEpIGRvCiAgICAgICAgbG9jYWwgY3VycmVudFN0YXR1cyA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZCgiRG91Z2ggS2luZyIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRG91Z2ggS2luZyIpIGFuZCAn4pyF77iPJyBvciAn4p2M77iPJwogICAgICAgIGlmIGN1cnJlbnRTdGF0dXMgfj0gcHJldmlvdXNTdGF0dXMgdGhlbgogICAgICAgICAgICBDaGVja0RvdWdoS2luZzpTZXREZXNjKCJTdGF0dXM6ICIgLi4gY3VycmVudFN0YXR1cykKICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMgPSBjdXJyZW50U3RhdHVzCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpFbGl0ZUh1bnRlciA9IFNlcnZlcjpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiRWxpdGUgSHVudGVyIiwKICAgIENvbnRlbnQgPSAiU3RhdHVzOiAiCn0pCnNwYXduKGZ1bmN0aW9uKCkKICAgIGxvY2FsIHByZXZpb3VzU3RhdHVzID0gIiIKICAgIHdoaWxlIHdhaXQoMSkgZG8KICAgICAgICBsb2NhbCBjdXJyZW50U3RhdHVzID0gKGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZCgiRGlhYmxvIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJEZWFuZHJlIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJVcmJhbiIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRGlhYmxvIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJEZWFuZHJlIikgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJVcmJhbiIpKSBhbmQgJ+Kche+4jycgb3IgJ+KdjO+4jycKICAgICAgICBsb2NhbCBwcm9ncmVzcyA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkVsaXRlSHVudGVyIiwiUHJvZ3Jlc3MiKQogICAgICAgIGlmIGN1cnJlbnRTdGF0dXMgfj0gcHJldmlvdXNTdGF0dXMgdGhlbgogICAgICAgICAgICBFbGl0ZUh1bnRlcjpTZXREZXNjKCJTdGF0dXM6ICIgLi4gY3VycmVudFN0YXR1cyAuLiAiIHwgS2lsbGVkOiAiIC4uIHByb2dyZXNzKQogICAgICAgICAgICBwcmV2aW91c1N0YXR1cyA9IGN1cnJlbnRTdGF0dXMKICAgICAgICBlbmQKICAgIGVuZAplbmQpCkZNID0gU2VydmVyOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJGdWxsIE1vb24iLAogICAgQ29udGVudCA9ICIiCn0pCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDEpIGRvCiAgICAgICAgbG9jYWwgbW9vblRleHR1cmVJZCA9IGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKS5Ta3kuTW9vblRleHR1cmVJZAogICAgICAgIGxvY2FsIG1vb25TdGF0dXMgPSAiTW9vbjogMC81IgogICAgICAgIGlmIG1vb25UZXh0dXJlSWQgPT0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9OTcwOTE0OTQzMSIgdGhlbgogICAgICAgICAgICBtb29uU3RhdHVzID0gIk1vb246IDUvNSIKICAgICAgICBlbHNlaWYgbW9vblRleHR1cmVJZCA9PSAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD05NzA5MTQ5MDUyIiB0aGVuCiAgICAgICAgICAgIG1vb25TdGF0dXMgPSAiTW9vbjogNC81IgogICAgICAgIGVsc2VpZiBtb29uVGV4dHVyZUlkID09ICJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTk3MDkxNDM3MzMiIHRoZW4KICAgICAgICAgICAgbW9vblN0YXR1cyA9ICJNb29uOiAzLzUiCiAgICAgICAgZWxzZWlmIG1vb25UZXh0dXJlSWQgPT0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9OTcwOTE1MDQwMSIgdGhlbgogICAgICAgICAgICBtb29uU3RhdHVzID0gIk1vb246IDIvNSIKICAgICAgICBlbHNlaWYgbW9vblRleHR1cmVJZCA9PSAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD05NzA5MTQ5NjgwIiB0aGVuCiAgICAgICAgICAgIG1vb25TdGF0dXMgPSAiTW9vbjogMS81IgogICAgICAgIGVuZAogICAgICAgIEZNOlNldERlc2MobW9vblN0YXR1cykKICAgIGVuZAplbmQpCkxlZ2VuZGFyeVN3b3JkID0gU2VydmVyOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJMZWdlbmRhcnkgU3dvcmQiLAogICAgQ29udGVudCA9ICJTdGF0dXM6ICIKfSkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgcHJldmlvdXNTdGF0dXMgPSAiIgogICAgd2hpbGUgd2FpdCgxKSBkbwogICAgICAgIGxvY2FsIHN3b3JkU3RhdHVzID0gIk5vdCBGb3VuZCBMZWdlbmQgU3dvcmRzIgogICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkxlZ2VuZGFyeVN3b3JkRGVhbGVyIiwgIjEiKSB0aGVuCiAgICAgICAgICAgIHN3b3JkU3RhdHVzID0gIlNoaXN1aSIKICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiTGVnZW5kYXJ5U3dvcmREZWFsZXIiLCAiMiIpIHRoZW4KICAgICAgICAgICAgc3dvcmRTdGF0dXMgPSAiV2FuZG8iCiAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkxlZ2VuZGFyeVN3b3JkRGVhbGVyIiwgIjMiKSB0aGVuCiAgICAgICAgICAgIHN3b3JkU3RhdHVzID0gIlNhZGRpIgogICAgICAgIGVuZAogICAgICAgIExlZ2VuZGFyeVN3b3JkOlNldERlc2Moc3dvcmRTdGF0dXMpCiAgICBlbmQKZW5kKQpTdGF0dXNCb25lID0gU2VydmVyOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJCb25lIiwKICAgIENvbnRlbnQgPSAiIgp9KQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KDEpIGRvCiAgICAgICAgU3RhdHVzQm9uZTpTZXREZXNjKCJZb3UgSGF2ZTogIiAuLiB0b3N0cmluZyhnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCb25lcyIsICJDaGVjayIpKSAuLiAiIEJvbmVzIikKICAgIGVuZAplbmQpCSAgICAgICAgCklucHV0ID0gU2VydmVyOkFkZElucHV0KCJJbnB1dCIsIHsKICAgICBUaXRsZSA9ICJJbnB1dCBKb2IgSWQiLAogICAgIERlZmF1bHQgPSAiIiwKICAgICBQbGFjZWhvbGRlciA9ICJQYXN0ZSBKb2IgSWQiLAogICAgIE51bWVyaWMgPSBmYWxzZSwKICAgICBGaW5pc2hlZCA9IGZhbHNlLAogICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgIGdldGdlbnYoKS5Kb2IgPSBWYWx1ZQogICAgIGVuZAp9KSAgICAKVG9nZ2xlID0gU2VydmVyOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIlNwYW0gSm9pbiIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQpnZXRnZW52KCkuSm9pbiA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgbGFzdFRlbGVwb3J0VGltZSA9IDAKICAgIGxvY2FsIHRlbGVwb3J0Q29vbGRvd24gPSAxICAgIAogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuSm9pbiBhbmQgdGljaygpIC0gbGFzdFRlbGVwb3J0VGltZSA+PSB0ZWxlcG9ydENvb2xkb3duIHRoZW4KICAgICAgICAgICAgbGFzdFRlbGVwb3J0VGltZSA9IHRpY2soKQogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlRlbGVwb3J0U2VydmljZSIpOlRlbGVwb3J0VG9QbGFjZUluc3RhbmNlKGdhbWUucGxhY2VJZCwgZ2V0Z2VudigpLkpvYiwgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKbG9jYWwgbGFzdFRlbGVwb3J0VGltZSA9IDAKbG9jYWwgdGVsZXBvcnRDb29sZG93biA9IDUKU2VydmVyOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJKb2luIFNlcnZlciIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBpZiB0aWNrKCkgLSBsYXN0VGVsZXBvcnRUaW1lID49IHRlbGVwb3J0Q29vbGRvd24gdGhlbgogICAgICAgICAgICBsYXN0VGVsZXBvcnRUaW1lID0gdGljaygpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIik6VGVsZXBvcnRUb1BsYWNlSW5zdGFuY2UoZ2FtZS5wbGFjZUlkLCBnZXRnZW52KCkuSm9iLCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIpICAgICAgICAKICAgICAgICBlbmQKICAgIGVuZAp9KQpsb2NhbCBsYXN0Q29weVRpbWUgPSAwCmxvY2FsIGNvcHlDb29sZG93biA9IDIKU2VydmVyOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJDb3B5IEpvYklkIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGlmIHRpY2soKSAtIGxhc3RDb3B5VGltZSA+PSBjb3B5Q29vbGRvd24gdGhlbgogICAgICAgICAgICBsYXN0Q29weVRpbWUgPSB0aWNrKCkKICAgICAgICAgICAgc2V0Y2xpcGJvYXJkKHRvc3RyaW5nKGdhbWUuSm9iSWQpKQogICAgICAgICAgICBwcmludCgiSm9iSWQgQ29waWVkISIpCiAgICAgICAgZWxzZQogICAgICAgICAgICBwcmludCgiUGxlYXNlIHRyeSBhZ2FpbiBpbiBhIG1vbWVudCEiKQogICAgICAgIGVuZAogICAgZW5kCn0pCmxvY2FsIGxhc3RUZWxlcG9ydFRpbWUgPSAwCmxvY2FsIHRlbGVwb3J0Q29vbGRvd24gPSAzClNlcnZlcjpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiUmVqb2luIFNlcnZlciIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBpZiB0aWNrKCkgLSBsYXN0VGVsZXBvcnRUaW1lID49IHRlbGVwb3J0Q29vbGRvd24gdGhlbgogICAgICAgICAgICBsYXN0VGVsZXBvcnRUaW1lID0gdGljaygpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIik6VGVsZXBvcnQoZ2FtZS5QbGFjZUlkLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcikgICAgICAgIAogICAgICAgIGVuZAogICAgZW5kCn0pClNlcnZlcjpBZGRCdXR0b24oewoJICBUaXRsZSA9ICJIb3AgU2VydmVyIiwKCSAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgICBIb3AoKQogICAgICBlbmQKfSkKZnVuY3Rpb24gSG9wKCkKICAgIGxvY2FsIFBsYWNlSUQgPSBnYW1lLlBsYWNlSWQKICAgIGxvY2FsIEFsbElEcyA9IHt9CiAgICBsb2NhbCBmb3VuZEFueXRoaW5nID0gIiIKICAgIGxvY2FsIGFjdHVhbEhvdXIgPSBvcy5kYXRlKCIhKnQiKS5ob3VyCiAgICBsb2NhbCBEZWxldGVkID0gZmFsc2UKICAgIGZ1bmN0aW9uIFRQUmV0dXJuZXIoKQogICAgICAgIGxvY2FsIFNpdGU7CiAgICAgICAgaWYgZm91bmRBbnl0aGluZyA9PSAiIiB0aGVuCiAgICAgICAgICAgIFNpdGUgPSBnYW1lLkh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoZ2FtZTpIdHRwR2V0KCdodHRwczovL2dhbWVzLnJvYmxveC5jb20vdjEvZ2FtZXMvJyAuLiBQbGFjZUlEIC4uICcvc2VydmVycy9QdWJsaWM/c29ydE9yZGVyPUFzYyZsaW1pdD0xMDAnKSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIFNpdGUgPSBnYW1lLkh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoZ2FtZTpIdHRwR2V0KCdodHRwczovL2dhbWVzLnJvYmxveC5jb20vdjEvZ2FtZXMvJyAuLiBQbGFjZUlEIC4uICcvc2VydmVycy9QdWJsaWM/c29ydE9yZGVyPUFzYyZsaW1pdD0xMDAmY3Vyc29yPScgLi4gZm91bmRBbnl0aGluZykpCiAgICAgICAgZW5kICAgICAgICAKICAgICAgICBsb2NhbCBJRCA9ICIiCiAgICAgICAgaWYgU2l0ZS5uZXh0UGFnZUN1cnNvciBhbmQgU2l0ZS5uZXh0UGFnZUN1cnNvciB+PSAibnVsbCIgYW5kIFNpdGUubmV4dFBhZ2VDdXJzb3Igfj0gbmlsIHRoZW4KICAgICAgICAgICAgZm91bmRBbnl0aGluZyA9IFNpdGUubmV4dFBhZ2VDdXJzb3IKICAgICAgICBlbmQgICAgICAgIAogICAgICAgIGxvY2FsIG51bSA9IDAKICAgICAgICBmb3IgaSx2IGluIHBhaXJzKFNpdGUuZGF0YSkgZG8KICAgICAgICAgICAgbG9jYWwgUG9zc2libGUgPSB0cnVlCiAgICAgICAgICAgIElEID0gdG9zdHJpbmcodi5pZCkgICAgICAgICAgICAKICAgICAgICAgICAgaWYgdG9udW1iZXIodi5tYXhQbGF5ZXJzKSA+IHRvbnVtYmVyKHYucGxheWluZykgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sRXhpc3RpbmcgaW4gcGFpcnMoQWxsSURzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG51bSB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgSUQgPT0gdG9zdHJpbmcoRXhpc3RpbmcpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0b251bWJlcihhY3R1YWxIb3VyKSB+PSB0b251bWJlcihFeGlzdGluZykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGVsRmlsZSA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxJRHMgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChBbGxJRHMsIGFjdHVhbEhvdXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIG51bSA9IG51bSArIDEKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgUG9zc2libGUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KEFsbElEcywgSUQpCiAgICAgICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlRlbGVwb3J0U2VydmljZSIpOlRlbGVwb3J0VG9QbGFjZUluc3RhbmNlKFBsYWNlSUQsIElELCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIpCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICBmdW5jdGlvbiBUZWxlcG9ydCgpIAogICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgVFBSZXR1cm5lcigpCiAgICAgICAgICAgICAgICBpZiBmb3VuZEFueXRoaW5nIH49ICIiIHRoZW4KICAgICAgICAgICAgICAgICAgICBUUFJldHVybmVyKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHdhaXQoMikKICAgICAgICBlbmQKICAgIGVuZAogICAgVGVsZXBvcnQoKQplbmQKTEdhID0gV2luZG93OkFkZFRhYih7IFRpdGxlID0gIlRhYiBMb2NhbCBQbGF5ZXIiLCBJY29uID0gIiIgfSkKTEdhOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJTdG9wIFR3ZWVuIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIFN0b3BUd2VlbigpCiAgICBlbmQKfSkKTEdhOkFkZEJ1dHRvbih7CglUaXRsZSA9ICJTaG93IEl0ZW0iLAoJRGVzY3JpcHRpb24gPSAiSSdtIFN0aWxsIEZpeGluZy4uLi4iLAoJQ2FsbGJhY2sgPSBmdW5jdGlvbigpCQoJZW5kCn0pCkxHYTpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiT3BlbiBEZXZpbCBGcnVpdCBTaG9wIFsgTWlyYWdlIF0iLAogICAgRGVzY3JpcHRpb24gPSAiSSdtIFN0aWxsIEZpeGluZy4uLi4iLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpICAgICAKICAgIGVuZAp9KQpMR2E6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIk9wZW4gRGV2aWwgRnJ1aXQgU2hvcCIsCiAgICBEZXNjcmlwdGlvbiA9ICJJJ20gU3RpbGwgRml4aW5nLi4uLiIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkgICAgICAgICAgICAKICAgIGVuZAp9KQpMR2E6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIk9wZW4gVGl0bGUiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgYXJncyA9IHsiZ2V0VGl0bGVzIn0KICAgICAgICBsb2NhbCBzdWNjZXNzLCByZXN1bHQgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHJldHVybiBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICBlbmQpCiAgICAgICAgaWYgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5UaXRsZXMuVmlzaWJsZSA9IHRydWUKICAgICAgICBlbmQKICAgIGVuZAp9KQpsb2NhbCBsYXN0QnV0dG9uUHJlc3NUaW1lID0gMApsb2NhbCBidXR0b25Db29sZG93biA9IDIKTEdhOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJPcGVuIENvbG9yIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGlmIHRpY2soKSAtIGxhc3RCdXR0b25QcmVzc1RpbWUgPj0gYnV0dG9uQ29vbGRvd24gdGhlbgogICAgICAgICAgICBsYXN0QnV0dG9uUHJlc3NUaW1lID0gdGljaygpCiAgICAgICAgICAgIGxvY2FsIGNvbG9yc0d1aSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbjpGaW5kRmlyc3RDaGlsZCgiQ29sb3JzIikKICAgICAgICAgICAgaWYgY29sb3JzR3VpIHRoZW4KICAgICAgICAgICAgICAgIGNvbG9yc0d1aS5WaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAp9KQpMR2E6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIkJvb3N0IEZQUyIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBGUFNCb29zdGVyKCkKICAgIGVuZAp9KQpmdW5jdGlvbiBGUFNCb29zdGVyKCkKICAgIGxvY2FsIGRlY2Fsc3llZXRlZCA9IHRydWUKICAgIGxvY2FsIGcgPSBnYW1lCiAgICBsb2NhbCB3ID0gZy5Xb3Jrc3BhY2UKICAgIGxvY2FsIGwgPSBnLkxpZ2h0aW5nCiAgICBsb2NhbCB0ID0gdy5UZXJyYWluICAgIAogICAgc2V0aGlkZGVucHJvcGVydHkobCwgIlRlY2hub2xvZ3kiLCAyKQogICAgc2V0aGlkZGVucHJvcGVydHkodCwgIkRlY29yYXRpb24iLCBmYWxzZSkKICAgIHQuV2F0ZXJXYXZlU2l6ZSA9IDAKICAgIHQuV2F0ZXJXYXZlU3BlZWQgPSAwCiAgICB0LldhdGVyUmVmbGVjdGFuY2UgPSAwCiAgICB0LldhdGVyVHJhbnNwYXJlbmN5ID0gMAogICAgbC5HbG9iYWxTaGFkb3dzID0gZmFsc2UKICAgIGwuRm9nRW5kID0gOWU5CiAgICBsLkJyaWdodG5lc3MgPSAwCiAgICBzZXR0aW5ncygpLlJlbmRlcmluZy5RdWFsaXR5TGV2ZWwgPSAiTGV2ZWwwMSIgICAgCiAgICBsb2NhbCBmdW5jdGlvbiBvcHRpbWl6ZVBhcnQodikKICAgICAgICBpZiB2OklzQSgiUGFydCIpIG9yIHY6SXNBKCJVbmlvbiIpIG9yIHY6SXNBKCJDb3JuZXJXZWRnZVBhcnQiKSBvciB2OklzQSgiVHJ1c3NQYXJ0IikgdGhlbgogICAgICAgICAgICB2Lk1hdGVyaWFsID0gIlBsYXN0aWMiCiAgICAgICAgICAgIHYuUmVmbGVjdGFuY2UgPSAwCiAgICAgICAgZWxzZWlmIHY6SXNBKCJEZWNhbCIpIG9yIHY6SXNBKCJUZXh0dXJlIikgYW5kIGRlY2Fsc3llZXRlZCB0aGVuCiAgICAgICAgICAgIHYuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgIGVsc2VpZiB2OklzQSgiUGFydGljbGVFbWl0dGVyIikgb3IgdjpJc0EoIlRyYWlsIikgdGhlbgogICAgICAgICAgICB2LkxpZmV0aW1lID0gTnVtYmVyUmFuZ2UubmV3KDApCiAgICAgICAgZWxzZWlmIHY6SXNBKCJFeHBsb3Npb24iKSB0aGVuCiAgICAgICAgICAgIHYuQmxhc3RQcmVzc3VyZSA9IDEKICAgICAgICAgICAgdi5CbGFzdFJhZGl1cyA9IDEKICAgICAgICBlbHNlaWYgdjpJc0EoIkZpcmUiKSBvciB2OklzQSgiU3BvdExpZ2h0Iikgb3IgdjpJc0EoIlNtb2tlIikgb3IgdjpJc0EoIlNwYXJrbGVzIikgdGhlbgogICAgICAgICAgICB2LkVuYWJsZWQgPSBmYWxzZQogICAgICAgIGVsc2VpZiB2OklzQSgiTWVzaFBhcnQiKSB0aGVuCiAgICAgICAgICAgIHYuTWF0ZXJpYWwgPSAiUGxhc3RpYyIKICAgICAgICAgICAgdi5SZWZsZWN0YW5jZSA9IDAKICAgICAgICAgICAgdi5UZXh0dXJlSUQgPSAxMDM4NTkwMjc1ODcyODk1NwogICAgICAgIGVuZAogICAgZW5kICAgIAogICAgZm9yIGksIHYgaW4gcGFpcnModzpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgIGlmIHY6SXNBKCJQYXJ0Iikgb3IgdjpJc0EoIlVuaW9uIikgb3IgdjpJc0EoIkNvcm5lcldlZGdlUGFydCIpIG9yIHY6SXNBKCJUcnVzc1BhcnQiKSBvciB2OklzQSgiTWVzaFBhcnQiKSB0aGVuCiAgICAgICAgICAgIG9wdGltaXplUGFydCh2KQogICAgICAgIGVuZAogICAgZW5kCiAgICBmb3IgaSwgZSBpbiBwYWlycyhsOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgZTpJc0EoIkJsdXJFZmZlY3QiKSBvciBlOklzQSgiU3VuUmF5c0VmZmVjdCIpIG9yIGU6SXNBKCJDb2xvckNvcnJlY3Rpb25FZmZlY3QiKSBvciBlOklzQSgiQmxvb21FZmZlY3QiKSBvciBlOklzQSgiRGVwdGhPZkZpZWxkRWZmZWN0IikgdGhlbgogICAgICAgICAgICBlLkVuYWJsZWQgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCmVuZApEcm9wZG93biA9IExHYTpBZGREcm9wZG93bigiRHJvcGRvd24iLCB7CiAgICBUaXRsZSA9ICJTZWxlY3QgU3RhdHMiLAogICAgVmFsdWVzID0geyJNZWxlZSIsICJEZWZlbnNlIiwgIlN3b3JkIiwgIkd1biIsICJGcnVpdCJ9LAogICAgTXVsdGkgPSBmYWxzZSwKfSkKRHJvcGRvd246U2V0VmFsdWUoIiIpCkRyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKU3RhdHNNb2RlID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgaWYgcGxheWVyIGFuZCBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkRhdGEiKSBhbmQgcGxheWVyLkRhdGE6RmluZEZpcnN0Q2hpbGQoIlBvaW50cyIpIHRoZW4KICAgICAgICAgICAgaWYgcGxheWVyLkRhdGEuUG9pbnRzLlZhbHVlID49IFBvaW50U3RhdHMgYW5kIGdldGdlbnYoKS5BdXRvU3RhdHMgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgc3RhdFR5cGVzID0gewogICAgICAgICAgICAgICAgICAgIE1lbGVlID0gIk1lbGVlIiwKICAgICAgICAgICAgICAgICAgICBEZWZlbnNlID0gIkRlZmVuc2UiLAogICAgICAgICAgICAgICAgICAgIFN3b3JkID0gIlN3b3JkIiwKICAgICAgICAgICAgICAgICAgICBHdW4gPSAiR3VuIiwKICAgICAgICAgICAgICAgICAgICBGcnVpdCA9ICJEZW1vbiBGcnVpdCIKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RlZFN0YXQgPSBzdGF0VHlwZXNbU3RhdHNNb2RlXQogICAgICAgICAgICAgICAgaWYgc2VsZWN0ZWRTdGF0IHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJBZGRQb2ludCIsIHNlbGVjdGVkU3RhdCwgUG9pbnRTdGF0cykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClNsaWRlciA9IExHYTpBZGRTbGlkZXIoIlNsaWRlciIsIHsKICAgICAgICBUaXRsZSA9ICJQb2ludCBTdGF0cyIsCiAgICAgICAgRGVzY3JpcHRpb24gPSAiIiwKICAgICAgICBEZWZhdWx0ID0gMSwKICAgICAgICBNaW4gPSAxLAogICAgICAgIE1heCA9IDEwMDAsCiAgICAgICAgUm91bmRpbmcgPSAwLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgUG9pbnRTdGF0cyA9IHZhbHVlCiAgICBlbmQKfSkKVG9nZ2xlID0gTEdhOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgeyBUaXRsZSA9ICJBdXRvIFN0YXRzIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b1N0YXRzID0gVmFsdWUKZW5kKQpsb2NhbCBjYW5DaGFuZ2VUZWFtID0gdHJ1ZQpsb2NhbCBkZWJvdW5jZVRpbWUgPSAyCkxHYTpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiQ2hhbmdlIFRlYW0gVG8gUGlyYXRlcyIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3QgY2FuQ2hhbmdlVGVhbSB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIGNhbkNoYW5nZVRlYW0gPSBmYWxzZQogICAgICAgIHRhc2sud2FpdChkZWJvdW5jZVRpbWUpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTZXRUZWFtIiwgIlBpcmF0ZXMiKQogICAgICAgIGVuZCkKICAgICAgICBjYW5DaGFuZ2VUZWFtID0gdHJ1ZQogICAgZW5kCn0pCmxvY2FsIGNhbkNoYW5nZVRlYW0gPSB0cnVlCmxvY2FsIGRlYm91bmNlVGltZSA9IDIKTEdhOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJDaGFuZ2UgVGVhbSBUbyBNYXJpbmVzIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGlmIG5vdCBjYW5DaGFuZ2VUZWFtIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgY2FuQ2hhbmdlVGVhbSA9IGZhbHNlCiAgICAgICAgdGFzay53YWl0KGRlYm91bmNlVGltZSkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlNldFRlYW0iLCAiTWFyaW5lcyIpCiAgICAgICAgZW5kKQogICAgICAgIGNhbkNoYW5nZVRlYW0gPSB0cnVlCiAgICBlbmQKfSkKVG9nZ2xlID0gTEdhOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgeyBUaXRsZSA9ICJBdXRvIFN1bW1vbiBDYWtlIFByaW5jZSIsIERlc2NyaXB0aW9uID0gIldoZW4geW91IGF0dGFjayA1MDAgbW9uc3RlcnMsIHlvdSB3aWxsIGF1dG9tYXRpY2FsbHkgc3VtbW9uIENha2UgUHJpbmNlIiwgRGVmYXVsdCA9IHRydWUgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvU3Bhd25DUCA9IFZhbHVlCmVuZCkKbG9jYWwgbGFzdFNwYXduVGltZSA9IDAKbG9jYWwgc3Bhd25Db29sZG93biA9IDEKc3Bhd24oZnVuY3Rpb24oKSAKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9TcGF3bkNQIGFuZCB0aWNrKCkgLSBsYXN0U3Bhd25UaW1lID49IHNwYXduQ29vbGRvd24gdGhlbgogICAgICAgICAgICBsYXN0U3Bhd25UaW1lID0gdGljaygpCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkNha2VQcmluY2VTcGF3bmVyIiwgdHJ1ZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IExHYTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJCbGFjayBTY3JlZW4iLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKCWdldGdlbnYoKS5TdGFydEJsYWNrU2NyZWVuID0gVmFsdWUKZW5kKQpsb2NhbCBsYXN0VXBkYXRlVGltZSA9IDAKbG9jYWwgdXBkYXRlQ29vbGRvd24gPSAwLjUKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiB0aWNrKCkgLSBsYXN0VXBkYXRlVGltZSA+PSB1cGRhdGVDb29sZG93biB0aGVuCiAgICAgICAgICAgIGxhc3RVcGRhdGVUaW1lID0gdGljaygpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5TdGFydEJsYWNrU2NyZWVuIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLkJsYWNrc2NyZWVuLlNpemUgPSBVRGltMi5uZXcoNTAwLCAwLCA1MDAsIDUwMCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uQmxhY2tzY3JlZW4uU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCA1MDAsIDUwMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBMR2E6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiV2hpdGUgU2NyZWVuIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuV2hpdGVTY3JlZW4gPSBWYWx1ZQogICAgaWYgZ2V0Z2VudigpLldoaXRlU2NyZWVuID09IHRydWUgdGhlbgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpOlNldDNkUmVuZGVyaW5nRW5hYmxlZChmYWxzZSkKICAgIGVsc2VpZiBnZXRnZW52KCkuV2hpdGVTY3JlZW4gPT0gZmFsc2UgdGhlbgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpOlNldDNkUmVuZGVyaW5nRW5hYmxlZCh0cnVlKQogICAgZW5kCmVuZCkKVG9nZ2xlID0gTEdhOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkhpZGUgTW9iIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICAgZ2V0Z2VudigpLkhpZGVNb2IgPSBWYWx1ZQkJCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuSGlkZU1vYiB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuQ2xhc3NOYW1lID09ICJNZXNoUGFydCIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB2LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJIZWFkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHYuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2LkNsYXNzTmFtZSA9PSAiQWNjZXNzb3J5IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSGFuZGxlLlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5DbGFzc05hbWUgPT0gIkRlY2FsIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHYuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IExHYTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJSZW1vdmUgRGFtZSBUZXh0IiwgRGVmYXVsdCA9IHRydWUgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5SZW1vdmVUZXh0ID0gVmFsdWUKICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5Bc3NldHMuR1VJLkRhbWFnZUNvdW50ZXIuRW5hYmxlZCA9IG5vdCBnZXRnZW52KCkuUmVtb3ZlVGV4dAplbmQpClRvZ2dsZSA9IExHYTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJSZW1vdmUgTm90aWZpY2F0aW9uIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuUmVtb3ZlTm90aWZpY2F0aW9uID0gVmFsdWUKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTm90aWZpY2F0aW9ucy5FbmFibGVkID0gbm90IGdldGdlbnYoKS5SZW1vdmVOb3RpZmljYXRpb24KZW5kKQpUb2dnbGUgPSBMR2E6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBSZWpvaW4gT24gS2ljayIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9SZWpvaW5LaWNrID0gVmFsdWUKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBnZXRnZW52KCkucmVqb2luID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuUm9ibG94UHJvbXB0R3VpLnByb21wdE92ZXJsYXkuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICBpZiBjaGlsZC5OYW1lID09ICdFcnJvclByb21wdCcgYW5kIGNoaWxkOkZpbmRGaXJzdENoaWxkKCdNZXNzYWdlQXJlYScpIGFuZCBjaGlsZC5NZXNzYWdlQXJlYTpGaW5kRmlyc3RDaGlsZCgiRXJyb3JGcmFtZSIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIik6VGVsZXBvcnQoZ2FtZS5QbGFjZUlkKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgaWYgZ2V0Z2VudigpLnJlam9pbiB0aGVuCiAgICAgICAgICAgIGdldGdlbnYoKS5yZWpvaW46RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGdldGdlbnYoKS5yZWpvaW4gPSBuaWwKICAgICAgICBlbmQKICAgIGVuZAplbmQpCkxHYTpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiUmFpbiBGcnVpdCIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBmcnVpdE9iamVjdHMgPSBnYW1lOkdldE9iamVjdHMoInJieGFzc2V0aWQ6Ly8xNDc1OTM2ODIwMSIpWzFdOkdldENoaWxkcmVuKCkKICAgICAgICBsb2NhbCBtYXhGcnVpdHMgPSAxMAogICAgICAgIGxvY2FsIGNvdW50ID0gMAogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGZydWl0T2JqZWN0cykgZG8KICAgICAgICAgICAgaWYgY291bnQgPj0gbWF4RnJ1aXRzIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGNvdW50ID0gY291bnQgKyAxCiAgICAgICAgICAgIHYuUGFyZW50ID0gZ2FtZS5Xb3Jrc3BhY2UuTWFwCiAgICAgICAgICAgIHY6TW92ZVRvKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24gKyBWZWN0b3IzLm5ldyhtYXRoLnJhbmRvbSgtNTAsIDUwKSwgMTAwLCBtYXRoLnJhbmRvbSgtNTAsIDUwKSkpICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGZydWl0QW5pbWF0aW9uQ29udHJvbGxlciA9IHYuRnJ1aXQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdGlvbkNvbnRyb2xsZXIiKQogICAgICAgICAgICBpZiBmcnVpdEFuaW1hdGlvbkNvbnRyb2xsZXIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaWRsZUFuaW1hdGlvbiA9IGZydWl0QW5pbWF0aW9uQ29udHJvbGxlcjpGaW5kRmlyc3RDaGlsZCgiSWRsZSIpCiAgICAgICAgICAgICAgICBpZiBpZGxlQW5pbWF0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZGxlQW5pbWF0aW9uOlBsYXkoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB2LkhhbmRsZS5Ub3VjaGVkOkNvbm5lY3QoZnVuY3Rpb24ob3RoZXJQYXJ0KQogICAgICAgICAgICAgICAgaWYgb3RoZXJQYXJ0LlBhcmVudCA9PSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICB2LlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHYpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCn0pCmlmIFdvcmxkMSB0aGVuCiAgICBEcm9wZG93biA9IExHYTpBZGREcm9wZG93bigiRHJvcGRvd24iLCB7CiAgICAgICAgVGl0bGUgPSAiU2VsZWN0IElzbGFuZCIsCiAgICAgICAgVmFsdWVzID0gewogICAgICAgICAgICAiV2luZE1pbGwiLCAiTWFyaW5lIiwgIk1pZGRsZSBUb3duIiwgIkp1bmdsZSIsICJQaXJhdGUgVmlsbGFnZSIsIAogICAgICAgICAgICAiRGVzZXJ0IiwgIlNub3cgSXNsYW5kIiwgIk1hcmluZUZvcmQiLCAiQ29sb3NzZXVtIiwgIlNreSBJc2xhbmQgMSIsIAogICAgICAgICAgICAiU2t5IElzbGFuZCAyIiwgIlNreSBJc2xhbmQgMyIsICJQcmlzb24iLCAiTWFnbWEgVmlsbGFnZSIsIAogICAgICAgICAgICAiVW5kZXIgV2F0ZXIgSXNsYW5kIiwgIkZvdW50YWluIENpdHkiLCAiU2hhbmsgUm9vbSIsICJNb2IgSXNsYW5kIgogICAgICAgIH0sCiAgICAgICAgTXVsdGkgPSBmYWxzZSwKICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICB9KQogICAgRHJvcGRvd246U2V0VmFsdWUoIjAuMTUiKQogICAgRHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPSBWYWx1ZQogICAgZW5kKQplbmQKaWYgV29ybGQyIHRoZW4KICAgIERyb3Bkb3duID0gTEdhOkFkZERyb3Bkb3duKCJEcm9wZG93biIsIHsKICAgICAgICBUaXRsZSA9ICJTZWxlY3QgSXNsYW5kIiwKICAgICAgICBWYWx1ZXMgPSB7CiAgICAgICAgICAgICJUaGUgQ2FmZSIsICJGcmlzdCBTcG90IiwgIkRhcmsgQXJlYSIsICJGbGFtaW5nbyBNYW5zaW9uIiwgIkZsYW1pbmdvIFJvb20iLCAKICAgICAgICAgICAgIkdyZWVuIFpvbmUiLCAiRmFjdG9yeSIsICJDb2xvc3N1aW0iLCAiWm9tYmllIElzbGFuZCIsICJUd28gU25vdyBNb3VudGFpbiIsIAogICAgICAgICAgICAiUHVuayBIYXphcmQiLCAiQ3Vyc2VkIFNoaXAiLCAiSWNlIENhc3RsZSIsICJGb3Jnb3R0ZW4gSXNsYW5kIiwgCiAgICAgICAgICAgICJVc3NvcCBJc2xhbmQiLCAiTWluaSBTa3kgSXNsYW5kIgogICAgICAgIH0sCiAgICAgICAgTXVsdGkgPSBmYWxzZSwKICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICB9KQogICAgRHJvcGRvd246U2V0VmFsdWUoIjAuMTUiKQogICAgRHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPSBWYWx1ZQogICAgZW5kKQplbmQKaWYgV29ybGQzIHRoZW4KICAgIERyb3Bkb3duID0gTEdhOkFkZERyb3Bkb3duKCJEcm9wZG93biIsIHsKICAgICAgICBUaXRsZSA9ICJTZWxlY3QgSXNsYW5kIiwKICAgICAgICBWYWx1ZXMgPSB7CiAgICAgICAgICAgICJNYW5zaW9uIiwgIlBvcnQgVG93biIsICJHcmVhdCBUcmVlIiwgIkNhc3RsZSBPbiBUaGUgU2VhIiwgIk1pbmlTa3kiLCAKICAgICAgICAgICAgIkh5ZHJhIElzbGFuZCIsICJGbG9hdGluZyBUdXJ0bGUiLCAiSGF1bnRlZCBDYXN0bGUiLCAiSWNlIENyZWFtIElzbGFuZCIsIAogICAgICAgICAgICAiUGVhbnV0IElzbGFuZCIsICJDYWtlIElzbGFuZCIsICJDb2NvYSBJc2xhbmQiLCAiQ2FuZHkgSXNsYW5kIiwgIlRpa2kgT3V0cG9zdCIKICAgICAgICB9LAogICAgICAgIE11bHRpID0gZmFsc2UsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgfSkKICAgIERyb3Bkb3duOlNldFZhbHVlKCIwLjE1IikKICAgIERyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgICAgICBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID0gVmFsdWUKICAgIGVuZCkKZW5kICAgIApUb2dnbGUgPSBMR2E6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiVGVsZXBvcnQgSXNsYW5kIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuVGVsZXBvcnRJc2xhbmQgPSBWYWx1ZQogICAgaWYgZ2V0Z2VudigpLlRlbGVwb3J0SXNsYW5kID09IHRydWUgdGhlbgogICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJXaW5kTWlsbCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldyg5NzkuNzk4OTUwMTk1MzEsIDE2LjUxNjYxMzAwNjU5MiwgMTQyOS4wNDY2MzA4NTk0KSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIk1hcmluZSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMjU2Ni40Mjk2ODc1LCA2Ljg1NTY2ODA2NzkzMjEsIDIwNDUuMjU2MTAzNTE1NikpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJNaWRkbGUgVG93biIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtNjkwLjMzMDgxMDU0Njg4LCAxNS4wOTQyNTE2MzI2OSwgMTU4Mi4yMzgwMzcxMDk0KSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIkp1bmdsZSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTYxMi43OTU3NzYzNjcyLCAzNi44NTIwODEyOTg4MjgsIDE0OS4xMjg0MzMyMjc1NCkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJQaXJhdGUgVmlsbGFnZSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTE4MS4zMDkzMjYxNzE5LCA0Ljc1MTQ5MDU5Mjk1NjUsIDM4MDMuNTQ1NjU0Mjk2OSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJEZXNlcnQiIHRoZW4KICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoOTQ0LjE1Nzg5Nzk0OTIyLCAyMC45MTk3MjkyMzI3ODgsIDQzNzMuMzAwMjkyOTY4OCkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJTbm93IElzbGFuZCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygxMzQ3LjgwNjc2MjY5NTMsIDEwNC42NjgwNjAzMDI3MywgLTEzMTkuNzM3MDYwNTQ2OSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJNYXJpbmVGb3JkIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC00OTE0LjgyMTI4OTA2MjUsIDUwLjk2MzYyNjg2MTU3MiwgNDI4MS4wMjc4MzIwMzEzKSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIkNvbG9zc2V1bSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTQyNy42MjAzNjEzMjgxLCA3LjI4ODEwNzg3MjAwOTMsIC0yNzkyLjc3MjIxNjc5NjkpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiU2t5IElzbGFuZCAxIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC00ODY5LjEwMjUzOTA2MjUsIDczMy40NjA1MTAyNTM5MSwgLTI2NjcuMDE4MDY2NDA2MykpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJTa3kgSXNsYW5kIDIiIHRoZW4gIAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigicmVxdWVzdEVudHJhbmNlIiwgVmVjdG9yMy5uZXcoLTQ2MDcuODIyNzUsIDg3Mi41NDI0OCwgLTE2NjcuNTU2ODgpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiU2t5IElzbGFuZCAzIiB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJyZXF1ZXN0RW50cmFuY2UiLCBWZWN0b3IzLm5ldygtNzg5NC42MTc2NzU3ODEzLCA1NTQ3LjE0MTYwMTU2MjUsIC0zODAuMjkxMTk4NzMwNDcpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiUHJpc29uIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KDQ4NzUuMzMwMDc4MTI1LCA1LjY1MTk4MTgzMDU5NjksIDczNC44NTAyMTk3MjY1NikpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJNYWdtYSBWaWxsYWdlIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC01MjQ3LjcxNjMwODU5MzgsIDEyLjg4MzkzNDAyMDk5NiwgODUwNC45Njg3NSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJVbmRlciBXYXRlciBJc2xhbmQiIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoInJlcXVlc3RFbnRyYW5jZSIsIFZlY3RvcjMubmV3KDYxMTYzLjg1MTU2MjUsIDExLjY3OTY4NzUsIDE4MTkuNzg0MTc5Njg3NSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJGb3VudGFpbiBDaXR5IiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KDUxMjcuMTI4NDE3OTY4OCwgNTkuNTAxMzY1NjYxNjIxLCA0MTA1LjQ0NTgwMDc4MTMpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiU2hhbmsgUm9vbSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTQ0Mi4xNjU1MywgMjkuODc4ODI2MSwgLTI4LjM1NDc0NzgpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiTW9iIElzbGFuZCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMjg1MC4yMDA2OCwgNy4zOTIyNDc2OCwgNTM1NC45OTI2OCkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJUaGUgQ2FmZSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMzgwLjQ3OTI3ODU2NDQ1LCA3Ny4yMjAzOTAzMTk4MjQsIDI1NS44MjU1MDA0ODgyOCkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJGcmlzdCBTcG90IiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xMS4zMTE0NTU3MjY2MjQsIDI5LjI3NjczMzM5ODQzOCwgMjc3MS41MjI0NjA5Mzc1KSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIkRhcmsgQXJlYSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygzNzgwLjAzMDI3MzQzNzUsIDIyLjY1MjE2NDQ1OTIyOSwgLTM0OTguNTg1OTM3NSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJGbGFtaW5nbyBNYW5zaW9uIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC00ODMuNzMzNzAzNjEzMjgsIDMzMi4wMzgzNjA1OTU3LCA1OTUuMzI3MDg3NDAyMzQpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiRmxhbWluZ28gUm9vbSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygyMjg0LjQxNDA2MjUsIDE1LjE1MjAzNzYyMDU0NCwgODc1LjcyNTM0MTc5Njg4KSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIkdyZWVuIFpvbmUiIHRoZW4KICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTI0NDguNTMwMDI5Mjk2OSwgNzMuMDE2MTA1NjUxODU1LCAtMzIxMC42MzA2MTUyMzQ0KSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIkZhY3RvcnkiIHRoZW4KICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoNDI0LjEyNjk4MzY0MjU4LCAyMTEuMTYxNzEyNjQ2NDgsIC00MjcuNTQwNDk2ODI2MTcpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiQ29sb3NzdWltIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xNTAzLjYyMjQzNjUyMzQsIDIxOS43OTU2MjM3NzkzLCAxMzY5LjMxMDE4MDY2NDEpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiWm9tYmllIElzbGFuZCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtNTYyMi4wMzMyMDMxMjUsIDQ5Mi4xOTYwNDQ5MjE4OCwgLTc4MS43ODU1MjI0NjA5NCkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJUd28gU25vdyBNb3VudGFpbiIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldyg3NTMuMTQyODgzMzAwNzgsIDQwOC4yMzU1OTU3MDMxMywgLTUyNzQuNjE0NzQ2MDkzOCkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJQdW5rIEhhemFyZCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtNjEyNy42NTQyOTY4NzUsIDE1Ljk1MTc2MjE5OTQwMiwgLTUwNDAuMjg2MTMyODEyNSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJDdXJzZWQgU2hpcCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldyg5MjMuNDAxOTc3NTM5MDYsIDEyNS4wNTcxMjg5MDYyNSwgMzI4ODUuODc1KSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIkljZSBDYXN0bGUiIHRoZW4KICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoNjE0OC40MTE2MjEwOTM4LCAyOTQuMzg2ODcxMzM3ODksIC02NzQxLjExNjY5OTIxODgpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiRm9yZ290dGVuIElzbGFuZCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMzAzMi43NjQxNjAxNTYzLCAzMTcuODk2NzI4NTE1NjMsIC0xMDA3NS4zNzMwNDY4NzUpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiVXNzb3AgSXNsYW5kIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KDQ4MTYuODYxODE2NDA2MywgOC40NTk5ODg1OTQwNTUyLCAyODYzLjgxOTU4MDA3ODEpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiTWluaSBTa3kgSXNsYW5kIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0yODguNzQwNjAwNTg1OTQsIDQ5MzI2LjMxNjQwNjI1LCAtMzUyNDguNTkzNzUpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiR3JlYXQgVHJlZSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygyNjgxLjI3MzY4MTY0MDYsIDE2ODIuODA5MjA0MTAxNiwgLTcxOTAuOTg1MzUxNTYyNSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJDYXN0bGUgT24gVGhlIFNlYSIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtNTA3NC40NTU1NjY0MDYyNSwgMzE0LjUxNTUzMzQ0NzI2NTYsIC0yOTkxLjA1NDQ0MzM1OTM3NSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJNaW5pU2t5IiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0yNjAuNjU1NTc4NjEzMjgsIDQ5MzI1LjgwNDY4NzUsIC0zNTI1My41NzAzMTI1KSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIlBvcnQgVG93biIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtOTUsIDExLCA1NDU1KSkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RJc2xhbmQgPT0gIkh5ZHJhIElzbGFuZCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldyg1NDMzLCAxMDYyLCAyOTApKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiRmxvYXRpbmcgVHVydGxlIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xMzI3NC41MjgzMjAzMTMsIDUzMS44MjA3Mzk3NDYwOSwgLTc1NzkuMjIyNjU2MjUpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiTWFuc2lvbiIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTI1NTEsIDMzNywgLTc0NzYpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiSGF1bnRlZCBDYXN0bGUiIHRoZW4KICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTk1MTYsIDE0MiwgNTUzNykpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJJY2UgQ3JlYW0gSXNsYW5kIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC04NzQsIDY2LCAtMTA5MTUpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiUGVhbnV0IElzbGFuZCIgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMjA2Mi43NDc1NTg1OTM4LCA1MC40NzM4OTIyMTE5MTQsIC0xMDIzMi41NjgzNTkzNzUpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiQ2FrZSBJc2xhbmQiIHRoZW4KICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTE4ODQuNzc0NzgwMjczNDM3NSwgMTkuMzI3NTI2MDkyNTI5Mjk3LCAtMTE2NjYuODk3NDYwOTM3NSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJDb2NvYSBJc2xhbmQiIHRoZW4KICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoODcuOTQyNzY0MjgyMjI2NTYsIDczLjU1NDUxMjAyMzkyNTc4LCAtMTIzMTkuNDY0ODQzNzUpKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdElzbGFuZCA9PSAiQ2FuZHkgSXNsYW5kIiB0aGVuCiAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xMDE0LjQyNDE5NDMzNTkzNzUsIDE0OS4xMTA2ODcyNTU4NTkzOCwgLTE0NTU1Ljk2Mjg5MDYyNSkpCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0SXNsYW5kID09ICJUaWtpIE91dHBvc3QiIHRoZW4KICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTE2MTAxLjE4ODUsIDEyLjg0MjIxNjUsIDM4MC45NDIyOTEsIDAuMTk0MTEzOTg1LCAxLjM5MTk0MDYxZS0wOCwgLTAuOTgwOTc4OTY2LCAtOS44MjkwNDY5MWUtMDksIDEsIDEuMjI0NDM1MDRlLTA4LCAwLjk4MDk3ODk2NiwgNy4yNjUyODgzN2UtMDksIDAuMTk0MTEzOTg1KSkKICAgICAgICAgICAgZW5kCiAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5UZWxlcG9ydElzbGFuZAogICAgZW5kCmVuZCkKU2V0dGluZ3MgPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiU2V0dGluZyBGYXJtIiwgSWNvbiA9ICIiIH0pCkRyb3Bkb3duID0gU2V0dGluZ3M6QWRkRHJvcGRvd24oIkRyb3Bkb3duRmFybSIsIHsKICAgIFRpdGxlID0gIlNlbGVjdCBXZWFwb24iLAogICAgVmFsdWVzID0geyJNZWxlZSIsIlN3b3JkIiwiQmxveCBGcnVpdCJ9LAogICAgTXVsdGkgPSBmYWxzZSwKfSkKRHJvcGRvd246U2V0VmFsdWUoIk1lbGVlIikKRHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLlNlbGVjdFdlYXBvbiA9IHZhbHVlCmVuZCkKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBsYXN0V2VhcG9uID0gbmlsCiAgICB3aGlsZSB0YXNrLndhaXQoMC41KSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlNlbGVjdFdlYXBvbiA9PSBsYXN0V2VhcG9uIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbGFzdFdlYXBvbiA9IGdldGdlbnYoKS5TZWxlY3RXZWFwb24KICAgICAgICAgICAgbG9jYWwgd2VhcG9uRm91bmQgPSBuaWwKICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBpZiB2LlRvb2xUaXAgPT0gZ2V0Z2VudigpLlNlbGVjdFdlYXBvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgd2VhcG9uRm91bmQgPSB2Lk5hbWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiB3ZWFwb25Gb3VuZCB0aGVuCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuU2VsZWN0V2VhcG9uID0gd2VhcG9uRm91bmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKVG9nZ2xlID0gU2V0dGluZ3M6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBUdXJuIE9uIEJ1c28iLCBEZWZhdWx0ID0gdHJ1ZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkFVVE9IQUtJID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBjYW5Vc2VIYWtpID0gdHJ1ZQogICAgbG9jYWwgZGVib3VuY2VUaW1lID0gMgogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQVVUT0hBS0kgdGhlbgogICAgICAgICAgICBpZiBub3QgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFzQnVzbyIpIGFuZCBjYW5Vc2VIYWtpIHRoZW4KICAgICAgICAgICAgICAgIGNhblVzZUhha2kgPSBmYWxzZQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiQnVzbyIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIHdhaXQoZGVib3VuY2VUaW1lKQogICAgICAgICAgICAgICAgY2FuVXNlSGFraSA9IHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTZXR0aW5nczpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsgVGl0bGUgPSAiQXV0byBUdXJuIE9uIFJhY2UgVjQiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvVHVybk9uVjQgPSBWYWx1ZQplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgbGFzdENoZWNrVGltZSA9IDAKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIGlmIGdldGdlbnYoKS5BdXRvVHVybk9uVjQgdGhlbgogICAgICAgICAgICBsb2NhbCBjdXJyZW50VGltZSA9IHRpY2soKQogICAgICAgICAgICBpZiBjdXJyZW50VGltZSAtIGxhc3RDaGVja1RpbWUgPj0gMC41IHRoZW4KICAgICAgICAgICAgICAgIGxhc3RDaGVja1RpbWUgPSBjdXJyZW50VGltZQogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJhY2VFbmVyZ3kiKSBhbmQKICAgICAgICAgICAgICAgICAgIGNoYXJhY3Rlci5SYWNlRW5lcmd5LlZhbHVlID49IDEgYW5kCiAgICAgICAgICAgICAgICAgICBub3QgY2hhcmFjdGVyLlJhY2VUcmFuc2Zvcm1lZC5WYWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYmUgPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKQogICAgICAgICAgICAgICAgICAgIGJlOlNlbmRLZXlFdmVudCh0cnVlLCAiWSIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgYmU6U2VuZEtleUV2ZW50KGZhbHNlLCAiWSIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKVG9nZ2xlID0gU2V0dGluZ3M6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBUdXJuIE9uIFJhY2UgVjMiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvVHVybk9uVjMgPSBWYWx1ZQplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgcHJldlN0YXRlID0gZmFsc2UgICAgCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgdGFzay53YWl0KDAuMSkgICAgICAgIAogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9UdXJuT25WMyB+PSBwcmV2U3RhdGUgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9UdXJuT25WMyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUU6RmlyZVNlcnZlcigiQWN0aXZhdGVBYmlsaXR5IikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcHJldlN0YXRlID0gZ2V0Z2VudigpLkF1dG9UdXJuT25WMwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpsb2NhbCBUb2dnbGUgPSBTZXR0aW5nczpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFNldCBTcGF3biBQb2ludCIsIERlZmF1bHQgPSBmYWxzZSB9KQpsb2NhbCBsYXN0U2V0U3RhdGUgPSBmYWxzZQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlNldCA9IFZhbHVlCiAgICBpZiBWYWx1ZSB+PSBsYXN0U2V0U3RhdGUgdGhlbgogICAgICAgIGxhc3RTZXRTdGF0ZSA9IFZhbHVlCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTZXRTcGF3blBvaW50IikKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKVG9nZ2xlID0gU2V0dGluZ3M6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQW50aSBBRksiLCBEZWZhdWx0ID0gdHJ1ZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkFudGlBRksgPSBWYWx1ZSAKZW5kKQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQW50aUFGSyB0aGVuCiAgICAgICAgICAgIGxvY2FsIHZ1ID0gZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpCiAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgIHBsYXllci5JZGxlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHZ1OkJ1dHRvbjJEb3duKFZlY3RvcjIubmV3KDAsIDApLCB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUpCiAgICAgICAgICAgICAgICB3YWl0KDEpCiAgICAgICAgICAgICAgICB2dTpCdXR0b24yVXAoVmVjdG9yMi5uZXcoMCwgMCksIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZSkKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDp3YWl0KCkKICAgIGVuZAplbmQpClRvZ2dsZSA9IFNldHRpbmdzOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIlJlc2V0IFRlbGVwb3J0IiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBCeXBhc3NUUCA9IFZhbHVlIAplbmQpClRvZ2dsZSA9IFNldHRpbmdzOkFkZFRvZ2dsZSgiQnlwYXNzIFRQIiwgeyBUaXRsZSA9ICJTdG9wIFJlc2V0IFRlbGVwb3J0IFdoZW4gSGF2ZSBMZWdlbmRhcnkiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5TdG9wVFAgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKCXdoaWxlIHRhc2sud2FpdCgxKSBkbwoJCWlmIGdldGdlbnYoKS5TdG9wVFAgdGhlbgoJCQlpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZpc3Qgb2YgRGFya25lc3MiKSBvciBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGaXN0IG9mIERhcmtuZXNzIikgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJHb2QncyBDaGFsaWNlIikgb3IgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiR29kJ3MgQ2hhbGljZSIpIHRoZW4KCQkJCUJ5cGFzc1RQID0gZmFsc2UKCQkJZW5kCgkJZW5kCgllbmQKZW5kKQpnZXRnZW52KCkuRmFzdEF0dGFjayA9IGZhbHNlClRvZ2dsZSA9IFNldHRpbmdzOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkZhc3QgQXR0YWNrIiwgRGVmYXVsdCA9IHRydWV9KQpsb2NhbCBGYXN0QXR0YWNrVGFzawpsb2NhbCBmdW5jdGlvbiBGYXN0QXR0YWNrTG9vcCgpCiAgICB3aGlsZSBnZXRnZW52KCkuRmFzdEF0dGFjayBkbwogICAgICAgIGlmIHR5cGUoQXR0YWNrTm9Db29sRG93bikgPT0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgICAgIEF0dGFja05vQ29vbERvd24oKQogICAgICAgIGVuZAogICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICBlbmQKZW5kClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuRmFzdEF0dGFjayA9IFZhbHVlCiAgICBpZiBWYWx1ZSBhbmQgbm90IEZhc3RBdHRhY2tUYXNrIHRoZW4KICAgICAgICBGYXN0QXR0YWNrVGFzayA9IHRhc2suc3Bhd24oRmFzdEF0dGFja0xvb3ApCiAgICBlbmQKICAgIGlmIG5vdCBWYWx1ZSBhbmQgRmFzdEF0dGFja1Rhc2sgdGhlbgogICAgICAgIEZhc3RBdHRhY2tUYXNrID0gbmlsCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTZXR0aW5nczpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJCcmluZyBNb2IiLCBEZWZhdWx0ID0gdHJ1ZX0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQnJpbmdNb25zdGVyID0gVmFsdWUKZW5kKQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBDaGVja1F1ZXN0KCkKICAgICAgICAgICAgbG9jYWwgZW5lbWllcyA9IFdvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkKICAgICAgICAgICAgbG9jYWwgTW9uc3RlckNvdW50ID0gMAogICAgICAgICAgICBmb3IgXywgZW5lbXkgaW4gaXBhaXJzKGVuZW1pZXMpIGRvCiAgICAgICAgICAgICAgICBpZiBNb25zdGVyQ291bnQgPj0gMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5CcmluZ01vbnN0ZXIgYW5kIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQgYW5kIHJvb3RQYXJ0IGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAocm9vdFBhcnQuUG9zaXRpb24gLSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5TdGFydE1hZ25ldCBhbmQgKGVuZW15Lk5hbWUgPT0gTW9uRmFybSBvciBlbmVteS5OYW1lID09IE1vbikgYW5kIGh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIGRpc3RhbmNlIDw9IDM1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBlbmVteS5OYW1lID09ICJGYWN0b3J5IFN0YWZmIiBhbmQgUG9zTW9uIGFuZCAocm9vdFBhcnQuUG9zaXRpb24gLSBQb3NNb24uUG9zaXRpb24pLk1hZ25pdHVkZSA8PSA1MDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByb290UGFydC5QYXJlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDYwLCA2MCwgNjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RQYXJ0LkNGcmFtZSA9IFBvc01vbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltYXRvciA9IGh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFuaW1hdG9yIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KExvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9uc3RlckNvdW50ID0gTW9uc3RlckNvdW50ICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIChlbmVteS5OYW1lID09IE1vbkZhcm0gb3IgZW5lbXkuTmFtZSA9PSBNb24pIGFuZCBQb3NNb24gYW5kIChyb290UGFydC5Qb3NpdGlvbiAtIFBvc01vbi5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDQ1MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJvb3RQYXJ0LlBhcmVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNjAsIDYwLCA2MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdFBhcnQuQ0ZyYW1lID0gUG9zTW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1hdG9yID0gaHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoIkFuaW1hdG9yIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYW5pbWF0b3IgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb25zdGVyQ291bnQgPSBNb25zdGVyQ291bnQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKVG9nZ2xlID0gU2V0dGluZ3M6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiU3BpbiBQb3NpdGlvbiIsIERlc2NyaXB0aW9uID0gIlNwaW4gUG9zaXRpb24gV2hlbiBGYXJtIiwgRGVmYXVsdCA9IHRydWUgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5TcGluUG9zID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KCkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuU3BpblBvcyB0aGVuCiAgICAgICAgICAgIFBvcyA9IENGcmFtZS5uZXcoMCwgUG9zWSwgLTIwKQogICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgUG9zID0gQ0ZyYW1lLm5ldygtMjAsIFBvc1ksIDApCiAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICBQb3MgPSBDRnJhbWUubmV3KDAsIFBvc1ksIDIwKQogICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgUG9zID0gQ0ZyYW1lLm5ldygyMCwgUG9zWSwgMCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIFBvcyA9IENGcmFtZS5uZXcoMCwgUG9zWSwgMCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClNsaWRlciA9IFNldHRpbmdzOkFkZFNsaWRlcigiU2xpZGVyIiwgewogICAgIFRpdGxlID0gIkZhcm0gRGlzdGFuY2UiLAogICAgIERlZmF1bHQgPSAxNSwKICAgICBNaW4gPSAwLAogICAgIE1heCA9IDMwLAogICAgIFJvdW5kaW5nID0gNSwKICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICBQb3NZID0gVmFsdWUKICAgIGVuZAp9KQpUb2dnbGUgPSBTZXR0aW5nczpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFJlZHVjZSBMYWcgRmFybSBTYWZlbHkiLCBEZWZhdWx0ID0gdHJ1ZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlJlZHVjZUxhZyA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgwLjEpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLlJlZHVjZUxhZyB0aGVuCiAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlWyJfV29ybGRPcmlnaW4iXTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgdiBhbmQgKHYuTmFtZSA9PSAiQ3VydmVkUmluZyIgb3Igdi5OYW1lID09ICJTbGFzaEhpdCIgb3Igdi5OYW1lID09ICJTd29yZFNsYXNoIiBvciB2Lk5hbWUgPT0gIlNsYXNoVGFpbCIgb3Igdi5OYW1lID09ICJTb3VuZHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICB2OkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IFNldHRpbmdzOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkFudGkgQ2hlYXQgRmFybWluZyIsIERlc2NyaXB0aW9uID0gIlRoaXMgZmVhdHVyZSBoZWxwcyB5b3UgRmFybSBzYWZlbHkgd2l0aG91dCBiZWluZyBkZXRlY3RlZCIsIERlZmF1bHQgPSB0cnVlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuUmVzZXRGbGFncyA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDUpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuUmVzZXRGbGFncyB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKHBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiTG9jYWxTY3JpcHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHNjcmlwdHNUb1JlbW92ZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJHZW5lcmFsIiwgIlNoaWZ0bG9jayIsICJGYWxsRGFtYWdlIiwgIjQ0NDQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDYW1Cb2IiLCAiSnVtcENEIiwgIkxvb2tpbmciLCAiUnVuIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQoc2NyaXB0c1RvUmVtb3ZlLCB2Lk5hbWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhwbGF5ZXIuUGxheWVyU2NyaXB0czpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJMb2NhbFNjcmlwdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2NyaXB0c1RvUmVtb3ZlID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlJvYmxveE1vdG9yNkRCdWdGaXgiLCAiQ2xhbnMiLCAiQ29kZXMiLCAiQ3VzdG9tRm9yY2VGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTWVudUJsb29kU3AiLCAiUGxheWVyTGlzdCIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0YWJsZS5maW5kKHNjcmlwdHNUb1JlbW92ZSwgdi5OYW1lKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2OkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpNYWluID0gV2luZG93OkFkZFRhYih7IFRpdGxlID0gIlRhYiBGYXJtaW5nIiwgSWNvbiA9ICIiIH0pCk1haW46QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIkNvcHkgZGlzY29yZCBpbnZpdGUgbGluayIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHNldGNsaXBib2FyZCgiaHR0cHM6Ly9kaXNjb3JkLmdnLzJZQ0dmdFJCIikKICAgICAgICBlbmQpCiAgICBlbmQKfSkKTWFpbjpBZGRQYXJhZ3JhcGgoewogICAgIFRpdGxlID0gIk1haW4gRmFybSIsCiAgICAgQ29udGVudCA9IHN0cmluZy5yZXAoIi0iLCAyMSkKfSkKRHJvcGRvd24gPSBNYWluOkFkZERyb3Bkb3duKCJEcm9wZG93bkZhcm0iLCB7CiAgICBUaXRsZSA9ICJTZWxlY3QgTWV0aG9kIEZhcm0iLAogICAgVmFsdWVzID0geyJGYXJtIExldmVsIiwgIkZhcm0gQm9uZSIsICJGYXJtIEthdGFrdXJpIn0sCiAgICBNdWx0aSA9IGZhbHNlLAp9KQpEcm9wZG93bjpTZXRWYWx1ZSgiRmFybSBMZXZlbCIpCkRyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKRmFybU1vZGUgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGNhblJ1biA9IHRydWUKICAgIGxvY2FsIGRlYm91bmNlVGltZSA9IDAuNQogICAgd2hpbGUgd2FpdChkZWJvdW5jZVRpbWUpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9GYXJtIGFuZCBGYXJtTW9kZSA9PSAiRmFybSBMZXZlbCIgdGhlbgogICAgICAgICAgICBpZiBjYW5SdW4gdGhlbgogICAgICAgICAgICAgICAgY2FuUnVuID0gZmFsc2UKICAgICAgICAgICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHF1ZXN0VGl0bGUgPSBwbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHF1ZXN0VmlzaWJsZSA9IHBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5WaXNpYmxlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWRSb290ID0gcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHN0cmluZy5maW5kKHF1ZXN0VGl0bGUsIE5hbWVNb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlN0YXJ0TWFnbmV0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQWJhbmRvblF1ZXN0IikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgcXVlc3RWaXNpYmxlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlN0YXJ0TWFnbmV0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tRdWVzdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEJ5cGFzc1RQIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKGh1bWFub2lkUm9vdC5Qb3NpdGlvbiAtIENGcmFtZVF1ZXN0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRpc3RhbmNlID4gMTUwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQlRQKENGcmFtZVF1ZXN0ICogQ0ZyYW1lLm5ldygwLCAyMCwgNSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZGlzdGFuY2UgPCAxNTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWVRdWVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWVRdWVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChodW1hbm9pZFJvb3QuUG9zaXRpb24gLSBDRnJhbWVRdWVzdC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDIwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0YXJ0UXVlc3QiLCBOYW1lUXVlc3QsIExldmVsUXVlc3QpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBxdWVzdFZpc2libGUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDaGVja1F1ZXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGVuZW1pZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgdi5OYW1lID09IE1vbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQsIE5hbWVNb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU3RhcnRNYWduZXQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkocGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b0Zhcm0gb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3Qgdi5QYXJlbnQgb3Igbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlN0YXJ0TWFnbmV0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkFiYW5kb25RdWVzdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgICAgIGNhblJ1biA9IHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpsb2NhbCBCb25lID0gewogICAgWyJSZWJvcm4gU2tlbGV0b24iXSA9IENGcmFtZS5uZXcoLTg3NjkuNTg5ODQsIDE0Mi4xMzA2MywgNjA1NS4yNzYzNyksCiAgICBbIkxpdmluZyBab21iaWUiXSA9IENGcmFtZS5uZXcoLTEwMTU2LjQ1MzEsIDEzOC42NTI0ODEsIDU5NjQuNTc1MiksCiAgICBbIkRlbW9uaWMgU291bCJdID0gQ0ZyYW1lLm5ldygtOTUyNS4xNzE4OCwgMTcyLjEzMDYzLCA2MTUyLjMwNTY2KSwKICAgIFsiUG9zZXNzZWQgTXVtbXkiXSA9IENGcmFtZS5uZXcoLTk1NzAuODgyODEsIDUuODE4MzE4ODQsIDYxODcuODYyNzkpCn0Kc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMikgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQm9uZXNCcmluZyB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIGlwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgQm9uZVt2Lk5hbWVdIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQm9uZVt2Lk5hbWVdCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5TaXQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDExKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkOkNoYW5nZVN0YXRlKDE0KQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSnVtcFBvd2VyID0gMAogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbWF0b3IgPSB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFuaW1hdG9yIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdG9yOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpCb25lUG9zID0gQ0ZyYW1lLm5ldygtOTUwNi4yMzQzNzUsIDE3Mi4xMzA2MTUyMzQzNzUsIDYxMTcuMDc3MTQ4NDM3NSkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgwLjEpIGRvCiAgICAgICAgaWYgRmFybU1vZGUgPT0gIkZhcm0gQm9uZSIgYW5kIGdldGdlbnYoKS5BdXRvRmFybSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgZW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpCiAgICAgICAgICAgICAgICBsb2NhbCBmb3VuZEVuZW15ID0gZmFsc2UKICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGVuZW1pZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJSZWJvcm4gU2tlbGV0b24iIG9yIHYuTmFtZSA9PSAiTGl2aW5nIFpvbWJpZSIgb3Igdi5OYW1lID09ICJEZW1vbmljIFNvdWwiIG9yIHYuTmFtZSA9PSAiUG9zZXNzZWQgTXVtbXkiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRFbmVteSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB3YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5Cb25lc0JyaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9GYXJtIG9yIG5vdCB2LlBhcmVudCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGZvdW5kRW5lbXkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIEJ5cGFzc1RQIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyUG9zID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJQb3MgLSBCb25lUG9zLlBvc2l0aW9uKS5NYWduaXR1ZGUgPiAxNTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJUUChCb25lUG9zKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhCb25lUG9zKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKEJvbmVQb3MpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgVW5FcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5Cb25lc0JyaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC05NTE1LCAxNjQsIDU3ODYpKSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiUmVib3JuIFNrZWxldG9uIiBvciB2Lk5hbWUgPT0gIkxpdmluZyBab21iaWUiIG9yIHYuTmFtZSA9PSAiRGVtb25pYyBTb3VsIiBvciB2Lk5hbWUgPT0gIlBvc2Vzc2VkIE11bW15IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygyLCAyMCwgMikpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCmxvY2FsIENha2UgPSB7CiAgICBbIkNvb2tpZSBDcmFmdGVyIl0gPSBDRnJhbWUubmV3KC0yMzMzLjI4MDUyLCAzNy44MjM5MDU5LCAtMTIwOTMuMjg2MSksCiAgICBbIkNha2UgR3VhcmQiXSA9IENGcmFtZS5uZXcoLTE1NzUuNTY0MzMsIDM3LjgyMzg5MDcsIC0xMjQxNi4yNTI5KSwKICAgIFsiQmFraW5nIFN0YWZmIl0gPSBDRnJhbWUubmV3KC0xODcyLjM1NzQyLCAzNy44MjM5NTE3LCAtMTI4OTkuNDI0OCksCiAgICBbIkhlYWQgQmFrZXIiXSA9IENGcmFtZS5uZXcoLTIyMjMuMTQxNiwgNTMuNTI4MzIwMywgLTEyODU0Ljc1MikKfQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4yKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5DYWtlQnJpbmcgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgQ2FrZVt2Lk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0Q0ZyYW1lID0gQ2FrZVt2Lk5hbWVdCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldENGcmFtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gdGFyZ2V0Q0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuU2l0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxMSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgxNCkKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkp1bXBQb3dlciA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoJ0FuaW1hdG9yJykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBpZiBGYXJtTW9kZSA9PSAiRmFybSBLYXRha3VyaSIgYW5kIGdldGdlbnYoKS5BdXRvRmFybSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkNha2VQcmluY2VTcGF3bmVyIikgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJDYWtlIFByaW5jZSIpIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ2FrZSBQcmluY2UiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDYWtlIFByaW5jZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9GYXJtIGFuZCB2Lk5hbWUgPT0gIkNha2UgUHJpbmNlIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6d2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCwgNjAsIDYwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b0Zhcm0gb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLkNha2VMb2FmLkJpZ01pcnJvci5PdGhlci5UcmFuc3BhcmVuY3kgPT0gMCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCAoQ0ZyYW1lLm5ldygtMTk5MC42NzI2MDc0MjE4NzUsIDQ1MzIuOTk5NTExNzE4NzUsIC0xNDk3My42NzQ4MDQ2ODc1KS5Qb3NpdGlvbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPj0gMjAwMCB0aGVuICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMjE1MS44MjE1MywgMTQ5LjMxNTcwNCwgLTEyNDA0LjkwNTMpKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkNvb2tpZSBDcmFmdGVyIikgCiAgICAgICAgICAgICAgICAgICAgICAgIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ2FrZSBHdWFyZCIpIAogICAgICAgICAgICAgICAgICAgICAgICBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkJha2luZyBTdGFmZiIpIAogICAgICAgICAgICAgICAgICAgICAgICBvciBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkhlYWQgQmFrZXIiKSB0aGVuICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5OYW1lID09ICJDb29raWUgQ3JhZnRlciIgb3Igdi5OYW1lID09ICJDYWtlIEd1YXJkIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Igdi5OYW1lID09ICJCYWtpbmcgU3RhZmYiIG9yIHYuTmFtZSA9PSAiSGVhZCBCYWtlciIpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDp3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuQ2FrZUJyaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9GYXJtIG9yIG5vdCB2LlBhcmVudCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBDYWtlUG9zID0gQ0ZyYW1lLm5ldygtMjA3NywgMjUyLCAtMTIzNzMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEJ5cGFzc1RQIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJUUChDYWtlUG9zKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDYWtlUG9zKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBNYWluOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgeyBUaXRsZSA9ICJTdGFydCBGYXJtIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b0Zhcm0gPSBWYWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvRmFybSkKZW5kKQpNYWluOkFkZFBhcmFncmFwaCh7CiAgICAgVGl0bGUgPSAiRmFybWluZyBNYXRlcmlhbCIsCiAgICAgQ29udGVudCA9IHN0cmluZy5yZXAoIi0iLCAyMSkKfSkKaWYgV29ybGQxIHRoZW4KTWF0ZXJpYWxMaXN0ID0gewogICAgICJMZWF0aGVyICsgU2NyYXAgTWV0YWwiLCAiQW5nZWwgV2luZ3MiLCAiTWFnbWEgT3JlIiwgIkZpc2ggVGFpbCIKICAgICAgfQplbHNlaWYgV29ybGQyIHRoZW4KTWF0ZXJpYWxMaXN0ID0gewogICAgICJMZWF0aGVyICsgU2NyYXAgTWV0YWwiLCAiUmFkaW9hY3RpdmUgTWF0ZXJpYWwiLCAiRWN0b3BsYXNtIiwgIk15c3RpYyBEcm9wbGV0IiwgIk1hZ21hIE9yZSIsICJWYW1waXJlIEZhbmciCiAgICAgIH0KZWxzZWlmIFdvcmxkMyB0aGVuCk1hdGVyaWFsTGlzdCA9IHsKICAgICAgIkxlYXRoZXIgKyBTY3JhcCBNZXRhbCIsICJEZW1vbmljIFdpc3AiLCAiQ29uanVyZWQgQ29jb2EiLCAiRHJhZ29uIFNjYWxlIiwgIkd1bnBvd2RlciIsICJGaXNoIFRhaWwiLCAiTWluaSBUdXNrIgogICAgICB9CmVuZApNYXRlcmlhbExpc3RNb24gPSBNYWluOkFkZERyb3Bkb3duKCJNYXRlcmlhbExpc3RNb24iLCB7CiAgICAgVGl0bGUgPSAiU2VsZWN0IE1hdGVyaWFsIiwKICAgICBWYWx1ZXMgPSBNYXRlcmlhbExpc3QsCiAgICAgTXVsdGkgPSBmYWxzZSwKfSkKTWF0ZXJpYWxMaXN0TW9uOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIFNlbGVjdE1hdGVyaWFsID0gVmFsdWUKZW5kKQpUb2dnbGUgPSBNYWluOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgeyBUaXRsZSA9ICJGYXJtIE1hdGVyaWFsIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b01hdGVyaWFsID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b01hdGVyaWFsKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGZ1bmN0aW9uIHByb2Nlc3NFbmVteSh2LCBFbmVteU5hbWUpCiAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICBpZiB2Lk5hbWUgPT0gRW5lbXlOYW1lIHRoZW4KICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgaWYgKFBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSB2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlN0YXJ0TWFnbmV0ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIE1vbkZhcm0gPSB2Lk5hbWUKICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9NYXRlcmlhbCBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgVW5FcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gaGFuZGxlRW5lbXlTcGF3bnMoKQogICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIilbIl9Xb3JsZE9yaWdpbiJdLkVuZW15U3Bhd25zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGZvciBfLCBFbmVteU5hbWUgaW4gaXBhaXJzKE1Nb24pIGRvCiAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZCh2Lk5hbWUsIEVuZW15TmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSB2LlBvc2l0aW9uKS5NYWduaXR1ZGUgPj0gMTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2LkNGcmFtZSAqIFBvcykKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b01hdGVyaWFsIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgTWF0ZXJpYWxNb24oU2VsZWN0TWF0ZXJpYWwpCiAgICAgICAgICAgICAgICB0b3BvcyhNUG9zKQogICAgICAgICAgICAgICAgZm9yIF8sIEVuZW15TmFtZSBpbiBpcGFpcnMoTU1vbikgZG8KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoRW5lbXlOYW1lKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NFbmVteSh2LCBFbmVteU5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBoYW5kbGVFbmVteVNwYXducygpCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCk1haW46QWRkUGFyYWdyYXBoKHsKICAgICBUaXRsZSA9ICJNYXN0ZXJ5IEZhcm0iLAogICAgIENvbnRlbnQgPSBzdHJpbmcucmVwKCItIiwgMjEpCn0pClNsaWRlciA9IE1haW46QWRkU2xpZGVyKCJTbGlkZXIiLCB7CiAgICAgVGl0bGUgPSAiU2VsZWN0IEhlYWx0aCBbICUgXSIsCiAgICAgRGVmYXVsdCA9IDMwLAogICAgIE1pbiA9IDAsCiAgICAgTWF4ID0gMTAwLAogICAgIFJvdW5kaW5nID0gNSwKICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICBnZXRnZW52KCkuS2lsbF9BdCA9IFZhbHVlCiAgICBlbmQKfSkKRHJvcGRvd24gPSBNYWluOkFkZERyb3Bkb3duKCJEcm9wZG93bkZhcm0iLCB7CiAgICBUaXRsZSA9ICJTZWxlY3QgTWV0aG9kIEZhcm0gTWFzdGVyeSIsCiAgICBWYWx1ZXMgPSB7IkJsb3ggRnJ1aXQiLCAiR3VuIn0sCiAgICBNdWx0aSA9IGZhbHNlLAp9KQpEcm9wZG93bjpTZXRWYWx1ZSgiQmxveCBGcnVpdCIpCkRyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKRmFybU1vZGUyID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgIGlmIEZhcm1Nb2RlMiA9PSAiQmxveCBGcnVpdCIgYW5kIGdldGdlbnYoKS5NYXN0ZXJ5RmFybSB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIFF1ZXN0VGl0bGUgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0CiAgICAgICAgICAgICAgICBpZiBub3Qgc3RyaW5nLmZpbmQoUXVlc3RUaXRsZSwgTmFtZU1vbikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVzZVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBTa2lsbGFpbWJvdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQWJhbmRvblF1ZXN0IikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXNlU2tpbGwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIENoZWNrUXVlc3QoKQogICAgICAgICAgICAgICAgICAgIGlmIEJ5cGFzc1RQIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIENGcmFtZVF1ZXN0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPiAyMDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJUUChDRnJhbWVRdWVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBDRnJhbWVRdWVzdC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDIwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lUXVlc3QpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZVF1ZXN0KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lUXVlc3QpCiAgICAgICAgICAgICAgICAgICAgdW50aWwgKENGcmFtZVF1ZXN0LlBvc2l0aW9uIC0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAzIG9yIG5vdCBnZXRnZW52KCkuTWFzdGVyeUZhcm0KICAgICAgICAgICAgICAgICAgICBpZiAoQ0ZyYW1lUXVlc3QuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3RhcnRRdWVzdCIsIE5hbWVRdWVzdCwgTGV2ZWxRdWVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBDaGVja1F1ZXN0KCkKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoTW9uKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSBNb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0LCBOYW1lTW9uKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsdGhNcyA9IHYuSHVtYW5vaWQuTWF4SGVhbHRoICogZ2V0Z2VudigpLktpbGxfQXQgLyAxMDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQuSGVhbHRoIDw9IEhlYWx0aE1zIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLkRldmlsRnJ1aXQuVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDEwLCAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb25NYXN0ZXJ5RnJ1aXQgPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vbkZhcm0gPSB2Lk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VTa2lsbCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VTa2lsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNraWxsYWltYm90ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb25GYXJtID0gdi5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc01vbiA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3Modi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIFBvcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb25NYXN0ZXJ5RnJ1aXQgPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlN0YXJ0TWFnbmV0ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5NYXN0ZXJ5RmFybSBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIG5vdCB2LlBhcmVudCBvciBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5WaXNpYmxlID09IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkFiYW5kb25RdWVzdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lTW9uKQogICAgICAgICAgICAgICAgICAgICAgICBVc2VTa2lsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFNraWxsYWltYm90ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgTW9iID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKE1vbikKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIE1vYiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhNb2IuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDAsIDEwKSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlkgPD0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkp1bXAgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSnVtcCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICBpZiBVc2VTa2lsbCB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIENoZWNrUXVlc3QoKQogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuRGV2aWxGcnVpdC5WYWx1ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBNYXNCRiA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcltnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLkRldmlsRnJ1aXQuVmFsdWVdLkxldmVsLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuRGV2aWxGcnVpdC5WYWx1ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBNYXNCRiA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrW2dhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuRGV2aWxGcnVpdC5WYWx1ZV0uTGV2ZWwuVmFsdWUKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5EZXZpbEZydWl0LlZhbHVlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbFogdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSBQb3NNb25NYXN0ZXJ5RnJ1aXQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcltnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikuTmFtZV0uUmVtb3RlRXZlbnQ6RmlyZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIloiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwgIloiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbFggdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSBQb3NNb25NYXN0ZXJ5RnJ1aXQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcltnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikuTmFtZV0uUmVtb3RlRXZlbnQ6RmlyZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIlgiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwgIlgiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSBQb3NNb25NYXN0ZXJ5RnJ1aXQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcltnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikuTmFtZV0uUmVtb3RlRXZlbnQ6RmlyZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIkMiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwgIkMiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbFYgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSBQb3NNb25NYXN0ZXJ5RnJ1aXQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcltnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikuTmFtZV0uUmVtb3RlRXZlbnQ6RmlyZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIlYiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwgIlYiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEYgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSBQb3NNb25NYXN0ZXJ5RnJ1aXQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcltnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikuTmFtZV0uUmVtb3RlRXZlbnQ6RmlyZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIkYiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwgIkYiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIFVzZVNraWxsIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5Ob3RpZmljYXRpb25zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJOb3RpZmljYXRpb25UZW1wbGF0ZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZCh2LlRleHQsICJTa2lsbCBsb2NrZWQhIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBVc2VTa2lsbCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgIFsxXSA9IFBvc01vbk1hc3RlcnlGcnVpdC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyW2dhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuRGV2aWxGcnVpdC5WYWx1ZV0uUmVtb3RlRXZlbnQ6RmlyZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKZW5kKSAgICAKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgICAgIGlmIEZhcm1Nb2RlMiA9PSAiR3VuIiBhbmQgZ2V0Z2VudigpLk1hc3RlcnlGYXJtIHRoZW4KICAgICAgICAgICAgICAgIFF1ZXN0VGl0bGUgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0CiAgICAgICAgICAgICAgICBpZiBub3Qgc3RyaW5nLmZpbmQoUXVlc3RUaXRsZSwgTmFtZU1vbikgdGhlbiAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBTa2lsbGFpbWJvdCA9IGZhbHNlICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkFiYW5kb25RdWVzdCIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgIENoZWNrUXVlc3QoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBCeXBhc3NUUCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gQ0ZyYW1lUXVlc3QuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDIwMDAgdGhlbgoJCQkJCQkgICAgICAgIEJUUChDRnJhbWVRdWVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gQ0ZyYW1lUXVlc3QuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAyMDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWVRdWVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWVRdWVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lUXVlc3QpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIChDRnJhbWVRdWVzdC5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdGFydFF1ZXN0IiwgTmFtZVF1ZXN0LCBMZXZlbFF1ZXN0KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ2hlY2tRdWVzdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKE1vbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSBNb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LkNvbnRhaW5lci5RdWVzdFRpdGxlLlRpdGxlLlRleHQsIE5hbWVNb24pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsdGhNaW4gPSB2Lkh1bWFub2lkLk1heEhlYWx0aCAqIGdldGdlbnYoKS5LaWxsX0F0LzEwMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWQuSGVhbHRoIDw9IEhlYWx0aE1pbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKFNlbGVjdFdlYXBvbkd1bikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFpbVNraWxsID0gdi5FbmdpbmUuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAtMTUsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFpbUJvdFNraWxsUG9zaXRpb24gPSBBaW1Ta2lsbC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb25GYXJtID0gdi5OYW1lICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsMCwxMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoMiwyLDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSGVhZC5DYW5Db2xsaWRlID0gZmFsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9IHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsyXSA9IHYuSHVtYW5vaWRSb290UGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcltTZWxlY3RXZWFwb25HdW5dLlJlbW90ZUZ1bmN0aW9uU2hvb3Q6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwxMjIsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsMTIyLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwxMjAsZmFsc2UsZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsMTIwLGZhbHNlLGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9uRmFybSA9IHYuTmFtZSAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UnVmlydHVhbFVzZXInOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlJ1ZpcnR1YWxVc2VyJzpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5TdGFydE1hZ25ldCA9IHRydWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zTW9uTWFzdGVyeUd1biA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU3RhcnRNYWduZXQgPSB0cnVlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkFiYW5kb25RdWVzdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3QgZ2V0Z2VudigpLk1hc3RlcnlGYXJtIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZU1vbikKICAgICAgICAgICAgICAgICAgICAgICAgTW9iID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKE1vbikgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIE1vYiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhNb2IuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsMCwxMCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5ZIDw9IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5KdW1wID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkp1bXAgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgaWYgZ2V0Z2VudigpLk1hc3RlcnlGYXJtIHRoZW4KICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIlJlbW90ZUZ1bmN0aW9uU2hvb3QiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RXZWFwb25HdW4gPSB2Lk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKbG9jYWwgcGxyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKc3Bhd24oZnVuY3Rpb24oKQogICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbyAgCiAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJSZW1vdGVGdW5jdGlvblNob290IikgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0V2VhcG9uR3VuID0gdi5OYW1lCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKbG9jYWwgRHJvcGRvd24gPSBNYWluOkFkZERyb3Bkb3duKCJEcm9wZG93biIsIHsKICAgIFRpdGxlID0gIlNlbGVjdCBTa2lsbCBNYXN0ZXJ5IiwKICAgIFZhbHVlcyA9IHsgIloiLCAiWCIsICJDIiwgIlYiLCAiRiIgfSwKICAgIE11bHRpID0gdHJ1ZSwKICAgIERlZmF1bHQgPSB7fSwKfSkKRHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKHNlbGVjdGVkVmFsdWVzKQogICAgZ2V0Z2VudigpLlNraWxsWiA9IHRhYmxlLmZpbmQoc2VsZWN0ZWRWYWx1ZXMsICJaIikgfj0gbmlsCiAgICBnZXRnZW52KCkuU2tpbGxYID0gdGFibGUuZmluZChzZWxlY3RlZFZhbHVlcywgIlgiKSB+PSBuaWwKICAgIGdldGdlbnYoKS5Ta2lsbEMgPSB0YWJsZS5maW5kKHNlbGVjdGVkVmFsdWVzLCAiQyIpIH49IG5pbAogICAgZ2V0Z2VudigpLlNraWxsViA9IHRhYmxlLmZpbmQoc2VsZWN0ZWRWYWx1ZXMsICJWIikgfj0gbmlsCiAgICBnZXRnZW52KCkuU2tpbGxGID0gdGFibGUuZmluZChzZWxlY3RlZFZhbHVlcywgIkYiKSB+PSBuaWwKZW5kKQpUb2dnbGUgPSBNYWluOkFkZFRvZ2dsZSgiQXV0byBGYXJtIiwgeyBUaXRsZSA9ICJBdXRvIEZhcm0gTWFzdGVyeSIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLk1hc3RlcnlGYXJtID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuTWFzdGVyeUZhcm0pCmVuZCkKU3RhY2sgPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiVGFiIFN0YWNrIEZhcm0iLCBJY29uID0gIiIgfSkKRHJvcGRvd24gPSBTdGFjazpBZGREcm9wZG93bigiRHJvcGRvd25GYXJtIiwgewogICAgVGl0bGUgPSAiU2VsZWN0IE1lbGVlIiwKICAgIFZhbHVlcyA9IHsiU3VwZXJodW1hbiIsICJEZWF0aFN0ZXAiLCAiU2hhcmttYW4gS2FyYXRlIiwgIkVsZWN0cmljIENsYXciLCAiRHJhZ29uIFRhbG9uIiwgIkdvZEh1bWFuIn0sCiAgICBNdWx0aSA9IGZhbHNlLAp9KQpEcm9wZG93bjpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCkdldE1vZGUgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgICAgICBpZiBHZXRNb2RlID09ICJTdXBlcmh1bWFuIiBhbmQgZ2V0Z2VudigpLkF1dG9HZXRNZWxlZSBhbmQgV29ybGQyIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgYmFja3BhY2sgPSBwbGF5ZXIuQmFja3BhY2sKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGJlbGkgPSBwbGF5ZXIuRGF0YS5CZWxpLlZhbHVlCiAgICAgICAgICAgICAgICBsb2NhbCBmcmFnbWVudHMgPSBwbGF5ZXIuRGF0YS5GcmFnbWVudHMgYW5kIHBsYXllci5EYXRhLkZyYWdtZW50cy5WYWx1ZSBvciAwICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJDb21iYXQiKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkNvbWJhdCIpKSBhbmQgYmVsaSA+PSAxNTAwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgIFVuRXF1aXBXZWFwb24oIkNvbWJhdCIpCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlCbGFja0xlZyIpCiAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiU3VwZXJodW1hbiIpIG9yIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU3VwZXJodW1hbiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU2VsZWN0V2VhcG9uID0gIlN1cGVyaHVtYW4iCiAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBtZWxlZVdlYXBvbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgeyJCbGFjayBMZWciLCAzMDAsICJCdXlFbGVjdHJvIiwgMzAwMDAwfSwKICAgICAgICAgICAgICAgICAgICB7IkVsZWN0cm8iLCAzMDAsICJCdXlGaXNobWFuS2FyYXRlIiwgNzUwMDAwfSwKICAgICAgICAgICAgICAgICAgICB7IkZpc2htYW4gS2FyYXRlIiwgMzAwLCAiRHJhZ29uQ2xhdyIsIDE1MDAsICJCbGFja2JlYXJkUmV3YXJkIn0sCiAgICAgICAgICAgICAgICAgICAgeyJEcmFnb24gQ2xhdyIsIDMwMCwgIkJ1eVN1cGVyaHVtYW4iLCAzMDAwMDAwfQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBfLCB3ZWFwb25EYXRhIGluIGlwYWlycyhtZWxlZVdlYXBvbnMpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgd2VhcG9uTmFtZSA9IHdlYXBvbkRhdGFbMV0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBsZXZlbFJlcXVpcmVtZW50ID0gd2VhcG9uRGF0YVsyXQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHB1cmNoYXNlQWN0aW9uID0gd2VhcG9uRGF0YVszXQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGNvc3QgPSB3ZWFwb25EYXRhWzRdCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaXNGcmFnbWVudCA9IHdlYXBvbkRhdGFbNV0gPT0gIkJsYWNrYmVhcmRSZXdhcmQiICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCB3ZWFwb24gPSBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCh3ZWFwb25OYW1lKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQod2VhcG9uTmFtZSkKICAgICAgICAgICAgICAgICAgICBpZiB3ZWFwb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiB3ZWFwb24uTGV2ZWwuVmFsdWUgPCBsZXZlbFJlcXVpcmVtZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5TZWxlY3RXZWFwb24gPSB3ZWFwb25OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiB3ZWFwb24uTGV2ZWwuVmFsdWUgPj0gbGV2ZWxSZXF1aXJlbWVudCBhbmQgKChpc0ZyYWdtZW50IGFuZCBmcmFnbWVudHMgPj0gY29zdCkgb3IgKG5vdCBpc0ZyYWdtZW50IGFuZCBiZWxpID49IGNvc3QpKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVbkVxdWlwV2VhcG9uKHdlYXBvbk5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNGcmFnbWVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcihwdXJjaGFzZUFjdGlvbiwgIkRyYWdvbkNsYXciLCAiMSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcihwdXJjaGFzZUFjdGlvbiwgIkRyYWdvbkNsYXciLCAiMiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcihwdXJjaGFzZUFjdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICAgICAgaWYgR2V0TW9kZSA9PSAiRGVhdGhTdGVwIiBhbmQgZ2V0Z2VudigpLkF1dG9HZXRNZWxlZSBhbmQgV29ybGQyIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBiYWNrcGFjayA9IHBsYXllci5CYWNrcGFjawogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgbG9jYWwgYmxhY2tMZWcgPSBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmxhY2sgTGVnIikgb3IgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJCbGFjayBMZWciKQogICAgICAgICAgICAgICAgbG9jYWwgZGVhdGhTdGVwID0gYmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkRlYXRoIFN0ZXAiKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRlYXRoIFN0ZXAiKQogICAgICAgICAgICAgICAgaWYgYmxhY2tMZWcgb3IgZGVhdGhTdGVwIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBibGFja0xlZyBhbmQgYmxhY2tMZWcuTGV2ZWwuVmFsdWUgPj0gNDUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RGVhdGhTdGVwIikKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlbGVjdFdlYXBvbiA9ICJEZWF0aCBTdGVwIgogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBibGFja0xlZyBhbmQgYmxhY2tMZWcuTGV2ZWwuVmFsdWUgPCA0NTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU2VsZWN0V2VhcG9uID0gIkJsYWNrIExlZyIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlCbGFja0xlZyIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgICAgIGlmIEdldE1vZGUgPT0gIlNoYXJrbWFuIEthcmF0ZSIgYW5kIGdldGdlbnYoKS5BdXRvR2V0TWVsZWUgYW5kIFdvcmxkMiB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlGaXNobWFuS2FyYXRlIikgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBzaGFya21hbkthcmF0ZUF2YWlsYWJsZSA9IHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eVNoYXJrbWFuS2FyYXRlIiksICJrZXlzIikKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBiYWNrcGFjayA9IHBsYXllci5CYWNrcGFjawogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgbG9jYWwgaGFzV2F0ZXJLZXkgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldhdGVyIEtleSIpIG9yIGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJXYXRlciBLZXkiKQogICAgICAgICAgICAgICAgbG9jYWwgaGFzRmlzaG1hbkthcmF0ZSA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmlzaG1hbiBLYXJhdGUiKSBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGaXNobWFuIEthcmF0ZSIpLkxldmVsLlZhbHVlID49IDQwMCAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNoYXJrbWFuS2FyYXRlQXZhaWxhYmxlIHRoZW4gIAogICAgICAgICAgICAgICAgICAgIGlmIGhhc1dhdGVyS2V5IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMjYwNC42OTU4LCAyMzkuNDMyNTI2LCAtMTAzMTUuMTk4MiwgMC4wNDI1NzAxMzY1LCAwLCAtMC45OTkwOTM0MTMsIDAsIDEsIDAsIDAuOTk5MDkzNDEzLCAwLCAwLjA0MjU3MDEzNjUpKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlTaGFya21hbkthcmF0ZSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG5vdCBoYXNGaXNobWFuS2FyYXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgTXMgPSAiVGlkZSBLZWVwZXIiCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGVuZW15ID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKE1zKSAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBlbmVteSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE9sZENGcmFtZVNoYXJrID0gdGFyZ2V0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LlBhcmVudC5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5DRnJhbWUgPSBPbGRDRnJhbWVTaGFyawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh0YXJnZXQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygyLCAyMCwgMikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IHRhcmdldC5QYXJlbnQgb3IgdGFyZ2V0LlBhcmVudC5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3QgZ2V0Z2VudigpLkF1dG9HZXRNZWxlZSBvciBoYXNXYXRlcktleQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTM1NzAuMTg2NTIsIDEyMy4zMjg5NDksIC0xMTU1NS45MDcyLCAwLjQ2NTE5OTIwMiwgLTEuMzg1NzMyNmUtMDgsIDAuODg1MjA2MDQ0LCA0LjAzMzI4OTdlLTA5LCAxLCAxLjM1MzQ3NTExZS0wOCwgLTAuODg1MjA2MDQ0LCAtMi43MjYwNjI3MWUtMDksIDAuNDY1MTk5MjAyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlTaGFya21hbkthcmF0ZSIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgIGxvY2FsIGJhY2twYWNrID0gcGxheWVyLkJhY2twYWNrCiAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgbG9jYWwgZWxlY3RybyA9IGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJvIikgb3IgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJFbGVjdHJvIikKICAgICAgICAgICAgbG9jYWwgZWxlY3RyaWNDbGF3ID0gYmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkVsZWN0cmljIENsYXciKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkVsZWN0cmljIENsYXciKQogICAgICAgICAgICBsb2NhbCBlbGVjdHJvTGV2ZWwgPSBlbGVjdHJvIGFuZCBlbGVjdHJvLkxldmVsLlZhbHVlIG9yIDAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgR2V0TW9kZSA9PSAiRWxlY3RyaWMgQ2xhdyIgYW5kIGdldGdlbnYoKS5BdXRvR2V0TWVsZWUgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgICAgICBpZiBlbGVjdHJvIGFuZCBlbGVjdHJvTGV2ZWwgPj0gNDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlFbGVjdHJpY0NsYXciKQogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5TZWxlY3RXZWFwb24gPSAiRWxlY3RyaWMgQ2xhdyIKICAgICAgICAgICAgICAgIGVsc2VpZiBub3QgZWxlY3RybyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RWxlY3RybyIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvR2V0TWVsZWUgdGhlbgogICAgICAgICAgICAgICAgaWYgZWxlY3RybyB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgZWxlY3Ryb0xldmVsID49IDQwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuQXV0b0Zhcm0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTEwMzcxLjQ3MTcsIDMzMC43NjQ0OTYsIC0xMDEzMS40MTk5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b0dldE1lbGVlIG9yIChjaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIENGcmFtZS5uZXcoLTEwMzcxLjQ3MTcsIDMzMC43NjQ0OTYsIC0xMDEzMS40MTk5KS5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDEwICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RWxlY3RyaWNDbGF3IiwgIlN0YXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTEyNTUwLjUzMjIyNjU2MywgMzM2LjIyNjMxODM1OTM4LCAtNzUxMC40MjMzMzk4NDM4KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b0dldE1lbGVlIG9yIChjaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIENGcmFtZS5uZXcoLTEyNTUwLjUzMjIyNjU2MywgMzM2LjIyNjMxODM1OTM4LCAtNzUxMC40MjMzMzk4NDM4KS5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xMDM3MS40NzE3LCAzMzAuNzY0NDk2LCAtMTAxMzEuNDE5OSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9HZXRNZWxlZSBvciAoY2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBDRnJhbWUubmV3KC0xMDM3MS40NzE3LCAzMzAuNzY0NDk2LCAtMTAxMzEuNDE5OSkuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMCAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5RWxlY3RyaWNDbGF3IikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5BdXRvRmFybSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0Zhcm0gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTAzNzEuNDcxNywgMzMwLjc2NDQ5NiwgLTEwMTMxLjQxOTkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvR2V0TWVsZWUgb3IgKGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gQ0ZyYW1lLm5ldygtMTAzNzEuNDcxNywgMzMwLjc2NDQ5NiwgLTEwMTMxLjQxOTkpLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlFbGVjdHJpY0NsYXciLCAiU3RhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTI1NTAuNTMyMjI2NTYzLCAzMzYuMjI2MzE4MzU5MzgsIC03NTEwLjQyMzMzOTg0MzgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvR2V0TWVsZWUgb3IgKGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gQ0ZyYW1lLm5ldygtMTI1NTAuNTMyMjI2NTYzLCAzMzYuMjI2MzE4MzU5MzgsIC03NTEwLjQyMzMzOTg0MzgpLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTEwMzcxLjQ3MTcsIDMzMC43NjQ0OTYsIC0xMDEzMS40MTk5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b0dldE1lbGVlIG9yIChjaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIENGcmFtZS5uZXcoLTEwMzcxLjQ3MTcsIDMzMC43NjQ0OTYsIC0xMDEzMS40MTk5KS5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDEwICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlFbGVjdHJpY0NsYXciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlbGVjdFdlYXBvbiA9ICJFbGVjdHJpYyBDbGF3IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvRmFybSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgICAgIGxvY2FsIGJhY2twYWNrID0gcGxheWVyLkJhY2twYWNrCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGRyYWdvbkNsYXcgPSBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRHJhZ29uIENsYXciKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBDbGF3IikKICAgICAgICBsb2NhbCBkcmFnb25UYWxvbiA9IGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJEcmFnb24gVGFsb24iKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkRyYWdvbiBUYWxvbiIpCiAgICAgICAgbG9jYWwgZHJhZ29uQ2xhd0xldmVsID0gZHJhZ29uQ2xhdyBhbmQgZHJhZ29uQ2xhdy5MZXZlbC5WYWx1ZSBvciAwCiAgICAgICAgaWYgR2V0TW9kZSA9PSAiRHJhZ29uIFRhbG9uIiBhbmQgZ2V0Z2VudigpLkF1dG9HZXRNZWxlZSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgaWYgZHJhZ29uQ2xhdyB0aGVuCiAgICAgICAgICAgICAgICBpZiBkcmFnb25DbGF3TGV2ZWwgPj0gNDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEcmFnb25UYWxvbiIpCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlbGVjdFdlYXBvbiA9ICJEcmFnb24gVGFsb24iCiAgICAgICAgICAgICAgICBlbHNlaWYgZHJhZ29uQ2xhd0xldmVsIDw9IDM5OSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlbGVjdFdlYXBvbiA9ICJEcmFnb24gQ2xhdyIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCbGFja2JlYXJkUmV3YXJkIiwgIkRyYWdvbkNsYXciLCAiMiIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgICAgIGlmIEdldE1vZGUgPT0gIkdvZEh1bWFuIiBhbmQgZ2V0Z2VudigpLkF1dG9HZXRNZWxlZSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgYmFja3BhY2sgPSBwbGF5ZXIuQmFja3BhY2sKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIGNoZWNrTGV2ZWwodG9vbE5hbWUsIGxldmVsUmVxdWlyZWQpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdG9vbCA9IGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvb2wgYW5kIHRvb2wuTGV2ZWwuVmFsdWUgPj0gbGV2ZWxSZXF1aXJlZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBub3QgKGNoZWNrTGV2ZWwoIlN1cGVyaHVtYW4iLCA0MDApIG9yIGNoZWNrTGV2ZWwoIkRlYXRoIFN0ZXAiLCA0MDApIG9yIGNoZWNrTGV2ZWwoIlNoYXJrbWFuIEthcmF0ZSIsIDQwMCkgb3IgY2hlY2tMZXZlbCgiRWxlY3RyaWMgQ2xhdyIsIDQwMCkgb3IgY2hlY2tMZXZlbCgiRHJhZ29uIFRhbG9uIiwgNDAwKSkgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eVN1cGVyaHVtYW4iKQogICAgICAgICAgICAgICAgICAgIGdhbWUuU3RhcnRlckd1aTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgeyBUaXRsZSA9ICJOb3QgSGF2ZSBTdXBlckh1bWFuISEiLCBUZXh0ID0gIiIsIER1cmF0aW9uID0gNSB9KQogICAgICAgICAgICAgICAgZWxzZWlmIGNoZWNrTGV2ZWwoIlN1cGVyaHVtYW4iLCA0MDApIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlEZWF0aFN0ZXAiKQogICAgICAgICAgICAgICAgICAgIGdhbWUuU3RhcnRlckd1aTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgeyBUaXRsZSA9ICJTdXBlcmh1bWFuIFJlYWR5ISIsIFRleHQgPSAiQnV5aW5nIERlYXRoIFN0ZXAuLi4iLCBEdXJhdGlvbiA9IDUgfSkKICAgICAgICAgICAgICAgIGVsc2VpZiBjaGVja0xldmVsKCJEZWF0aCBTdGVwIiwgNDAwKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnV5U2hhcmttYW5LYXJhdGUiKQogICAgICAgICAgICAgICAgICAgIGdhbWUuU3RhcnRlckd1aTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgeyBUaXRsZSA9ICJEZWF0aCBTdGVwIFJlYWR5ISIsIFRleHQgPSAiQnV5aW5nIFNoYXJrbWFuIEthcmF0ZS4uLiIsIER1cmF0aW9uID0gNSB9KQogICAgICAgICAgICAgICAgZWxzZWlmIGNoZWNrTGV2ZWwoIlNoYXJrbWFuIEthcmF0ZSIsIDQwMCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUVsZWN0cmljQ2xhdyIpCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5TdGFydGVyR3VpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7IFRpdGxlID0gIlNoYXJrbWFuIEthcmF0ZSBSZWFkeSEiLCBUZXh0ID0gIkJ1eWluZyBFbGVjdHJpYyBDbGF3Li4uIiwgRHVyYXRpb24gPSA1IH0pCiAgICAgICAgICAgICAgICBlbHNlaWYgY2hlY2tMZXZlbCgiRWxlY3RyaWMgQ2xhdyIsIDQwMCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eURyYWdvblRhbG9uIikKICAgICAgICAgICAgICAgICAgICBnYW1lLlN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsgVGl0bGUgPSAiRWxlY3RyaWMgQ2xhdyBSZWFkeSEiLCBUZXh0ID0gIkJ1eWluZyBEcmFnb24gVGFsb24uLi4iLCBEdXJhdGlvbiA9IDUgfSkKICAgICAgICAgICAgICAgIGVsc2VpZiBjaGVja0xldmVsKCJEcmFnb24gVGFsb24iLCA0MDApIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCByZXNwb25zZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUdvZGh1bWFuIiwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZChyZXNwb25zZSwgIkJyaW5nIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsgVGl0bGUgPSAiTm90IEVub3VnaCBNYXRlcmlhbCIsIFRleHQgPSAiWW91IG5lZWQgbW9yZSByZXNvdXJjZXMuIiwgRHVyYXRpb24gPSA1IH0pCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJCdXlHb2RodW1hbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuU3RhcnRlckd1aTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgeyBUaXRsZSA9ICJHb2RIdW1hbiBQdXJjaGFzZWQhIiwgVGV4dCA9ICJDb25ncmF0dWxhdGlvbnMhIiwgRHVyYXRpb24gPSA1IH0pCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKVG9nZ2xlID0gU3RhY2s6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7IFRpdGxlID0gIkF1dG8gR2V0IE1lbGVlIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b0dldE1lbGVlID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b0dldE1lbGVlKQplbmQpClRvZ2dsZSA9IFN0YWNrOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIlRlbGVwb3J0IFRvIEZydWl0IiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuVGVsZXBvcnRUb0ZydWl0ID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuVGVsZXBvcnRUb0ZydWl0KQplbmQpCmxvY2FsIFdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikKbG9jYWwgU3RhcnRlckd1aSA9IGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjIpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLlRlbGVwb3J0VG9GcnVpdCB0aGVuCiAgICAgICAgICAgIGxvY2FsIGZvdW5kRnJ1aXQgPSBmYWxzZQogICAgICAgICAgICBmb3IgXywgdiBpbiBpcGFpcnMoV29ya3NwYWNlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBpZiB2OklzQSgiTW9kZWwiKSBhbmQgc3RyaW5nLmZpbmQodi5OYW1lLCAiRnJ1aXQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSGFuZGxlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSGFuZGxlLkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICBmb3VuZEZydWl0ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIG5vdCBmb3VuZEZydWl0IHRoZW4KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTdGFjazpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJUZWxlcG9ydCBUbyBGcnVpdCBbIEhvcCBTZXJ2ZXIgXSIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlRlbGVwb3J0VG9GcnVpdEhvcCA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuNSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuVGVsZXBvcnRUb0ZydWl0IGFuZCBnZXRnZW52KCkuVGVsZXBvcnRUb0ZydWl0SG9wIHRoZW4KICAgICAgICAgICAgbG9jYWwgZm91bmRGcnVpdCA9IGZhbHNlCiAgICAgICAgICAgIGZvciBfLCB2IGluIGlwYWlycyhXb3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJNb2RlbCIpIGFuZCBzdHJpbmcuZmluZCh2Lk5hbWUsICJGcnVpdCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIYW5kbGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9wb3Modi5IYW5kbGUuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIGZvdW5kRnJ1aXQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgbm90IGZvdW5kRnJ1aXQgdGhlbgogICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICBTdGFydGVyR3VpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgICAgICAgICAgVGl0bGUgPSAiU2VydmVyIEhvcC4uIiwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiIsCiAgICAgICAgICAgICAgICAgICAgRHVyYXRpb24gPSA1LAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIEhvcCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKVG9nZ2xlID0gU3RhY2s6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBOZXcgV29ybGQiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvTmV3V29ybGQgPSBWYWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvTmV3V29ybGQpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b05ld1dvcmxkIGFuZCBXb3JsZDEgdGhlbgogICAgICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgd29ya3NwYWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKQogICAgICAgICAgICAgICAgbG9jYWwgcmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKICAgICAgICAgICAgICAgIGxvY2FsIG15TGV2ZWwgPSBwbGF5ZXIuRGF0YS5MZXZlbC5WYWx1ZQogICAgICAgICAgICAgICAgaWYgbXlMZXZlbCA+PSA3MDAgYW5kIFdvcmxkMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaWNlRG9vciA9IHdvcmtzcGFjZS5NYXAuSWNlLkRvb3IKICAgICAgICAgICAgICAgICAgICBpZiBpY2VEb29yLkNhbkNvbGxpZGUgPT0gZmFsc2UgYW5kIGljZURvb3IuVHJhbnNwYXJlbmN5ID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjZnJhbWUxID0gQ0ZyYW1lLm5ldyg0ODQ5LjI5ODgzLCA1LjY1MTM4MTQ5LCA3MTkuNjExODc3KQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKGNmcmFtZTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCAoY2ZyYW1lMS5Qb3NpdGlvbiAtIHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDMgb3Igbm90IGdldGdlbnYoKS5BdXRvTmV3V29ybGQKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuMSkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJEcmVzc3Jvc2FRdWVzdFByb2dyZXNzIiwgIkRldGVjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKCJLZXkiKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXRDRnJhbWUgPSBDRnJhbWUubmV3KDEzNDcuNzEyNCwgMzcuMzc1MTYwMiwgLTEzMjUuNjQ4OCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh0YXJnZXRDRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCAodGFyZ2V0Q0ZyYW1lLlBvc2l0aW9uIC0gcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMyBvciBub3QgZ2V0Z2VudigpLkF1dG9OZXdXb3JsZAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgd29ya3NwYWNlLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkljZSBBZG1pcmFsIFtMdi4gNzAwXSBbQm9zc10iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2UuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiSWNlIEFkbWlyYWwiIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBvbGRDRnJhbWVTZWNvbmQgPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gb2xkQ0ZyYW1lU2Vjb25kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9OZXdXb3JsZCBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJJY2UgQWRtaXJhbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhyZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCgiSWNlIEFkbWlyYWwiKS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoNSwgMTAsIDcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiVHJhdmVsRHJlc3Nyb3NhIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTdGFjazpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFRoaXJkIFdvcmxkIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b1RoaXJkU2VhID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b1RoaXJkU2VhKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9UaGlyZFNlYSBhbmQgV29ybGQyIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIHJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCiAgICAgICAgICAgICAgICBsb2NhbCB3b3Jrc3BhY2VFbmVtaWVzID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXIuRGF0YS5MZXZlbC5WYWx1ZSA+PSAxNTAwIGFuZCBXb3JsZDIgdGhlbgogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdXRvRmFybSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgcmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlc1siQ29tbUZfIl06SW52b2tlU2VydmVyKCJaUXVlc3RQcm9ncmVzcyIsICJHZW5lcmFsIikgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTE5MjYuMzIyLCAxMi44MiwgMTczOC4zMDkpKSAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ0ZyYW1lLm5ldygtMTkyNi4zMjIsIDEyLjgyLCAxNzM4LjMwOSkuUG9zaXRpb24gLSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJaUXVlc3RQcm9ncmVzcyIsICJCZWdpbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4zKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB3b3Jrc3BhY2VFbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJyaXBfaW5kcmEgW0x2LiAxNTAwXSBbQm9zc10iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2VFbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJyaXBfaW5kcmEiIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG9sZENGcmFtZVRoaXJkID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gb2xkQ0ZyYW1lVGhpcmQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiVHJhdmVsWm91IikgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b1RoaXJkU2VhIG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAgb3Igbm90IHYuUGFyZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG5vdCB3b3Jrc3BhY2VFbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJyaXBfaW5kcmEiKSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoQ0ZyYW1lLm5ldygtMjY4ODAuOTM0LCAyMi44NDksIDQ3My4xOSkuUG9zaXRpb24gLSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTI2ODgwLjkzNCwgMjIuODQ5LCA0NzMuMTkpKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTdGFjazpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIEZhY3RvcnkiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvRmFjdG9yeSA9IFZhbHVlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLkF1dG9GYWN0b3J5KQplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBpZiBub3QgZ2V0Z2VudigpLkF1dG9GYWN0b3J5IG9yIG5vdCBXb3JsZDIgdGhlbgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGVuZAogICAgICAgIGxvY2FsIGVuZW1pZXMgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXMKICAgICAgICBsb2NhbCBjb3JlRW5lbXkgPSBlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDb3JlIikKICAgICAgICBpZiBjb3JlRW5lbXkgYW5kIGNvcmVFbmVteS5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgIHRvcG9zKGNvcmVFbmVteS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgdW50aWwgY29yZUVuZW15Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIG5vdCBnZXRnZW52KCkuQXV0b0ZhY3RvcnkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoNDQ4LjQ2NzU2LCAxOTkuMzU2NzgxLCAtNDQxLjM4OTI1MikpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTdGFjazpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsgVGl0bGUgPSAiQXV0byBQaXJhdGUgUmFpZCIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9QaXJhdGVSYWlkID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b1BpcmF0ZVJhaWQpCmVuZCkKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgIGlmIG5vdCBnZXRnZW52KCkuQXV0b1BpcmF0ZVJhaWQgb3Igbm90IFdvcmxkMyB0aGVuCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZW5kCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBDRnJhbWVCb3NzID0gQ0ZyYW1lLm5ldygtNTQ5Ni4xNzQzMiwgMzEzLjc2ODkyMSwgLTI4NDEuNTMwMjcpCiAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICBsb2NhbCBodW1hbm9pZFJvb3RQYXJ0ID0gcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBodW1hbm9pZFJvb3RQYXJ0IHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBsb2NhbCBkaXN0YW5jZVRvQm9zcyA9IChDRnJhbWUubmV3KC01NTM5LjMxMSwgMzEzLjgwMSwgLTI5NzIuMzcyKS5Qb3NpdGlvbiAtIGh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICBpZiBkaXN0YW5jZVRvQm9zcyA8PSA1MDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIGVuZW15IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvUGlyYXRlUmFpZCBhbmQgZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBlbmVteURpc3RhbmNlID0gKGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBodW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZW5lbXlEaXN0YW5jZSA8IDIwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhlbmVteS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIFBvcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU3RhcnRNYWduZXQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBlbmVteS5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3QgZW5lbXkuUGFyZW50IG9yIG5vdCBnZXRnZW52KCkuQXV0b1BpcmF0ZVJhaWQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgVW5FcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgaWYgQnlwYXNzVFAgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlVG9DRnJhbWVCb3NzID0gKGh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBDRnJhbWVCb3NzLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZVRvQ0ZyYW1lQm9zcyA+IDE1MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBCVFAoQ0ZyYW1lQm9zcykKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZGlzdGFuY2VUb0NGcmFtZUJvc3MgPD0gMTUwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZUJvc3MpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTUxMjIsIDMxNSwgLTI5NjMpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTdGFjazpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIEVsaXRlIEh1bnRlciIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQWJhbmRvblF1ZXN0IikKICAgIGdldGdlbnYoKS5BdXRvRWxpdGVIdW50ZXIgPSBWYWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvRWxpdGVIdW50ZXIpCmVuZCkKVG9nZ2xlID0gU3RhY2s6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiSG9wIFNlcnZlciBFbGl0ZSBIdW50ZXIiLCBEZXNjcmlwdGlvbiA9ICJGaW5kIE5ldyBFbGl0ZSBIdW50ZXIgU2VydmVyIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b0VsaXRlSHVudGVySG9wID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4zKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5BdXRvRWxpdGVIdW50ZXIgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBxdWVzdEd1aSA9IHBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdAogICAgICAgICAgICAgICAgaWYgcXVlc3RHdWkuVmlzaWJsZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBxdWVzdFRpdGxlID0gcXVlc3RHdWkuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVsaXRlTmFtZXMgPSB7IkRpYWJsbyIsICJEZWFuZHJlIiwgIlVyYmFuIn0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBmb3VuZEVuZW15ID0gZmFsc2UgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciBfLCBlbmVteSBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGFibGUuZmluZChlbGl0ZU5hbWVzLCBlbmVteS5OYW1lKSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kRW5lbXkgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvRWxpdGVIdW50ZXIgb3IgZW5lbXkuSHVtYW5vaWQuSGVhbHRoIDw9IDAgb3Igbm90IGVuZW15LlBhcmVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGZvdW5kRW5lbXkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgbmFtZSBpbiBwYWlycyhlbGl0ZU5hbWVzKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW5lbXkgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQobmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVuZW15IGFuZCBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhlbmVteS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMiwgMjAsIDIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcmVzcG9uc2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlc1siQ29tbUZfIl06SW52b2tlU2VydmVyKCJFbGl0ZUh1bnRlciIpCiAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9FbGl0ZUh1bnRlckhvcCBhbmQgcmVzcG9uc2UgPT0gIkkgZG9uJ3QgaGF2ZSBhbnl0aGluZyBmb3IgeW91IHJpZ2h0IG5vdy4gQ29tZSBiYWNrIGxhdGVyLiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBIb3AoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IFN0YWNrOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gVG91Y2ggUGFkIEhha2kiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvVG91Y2hQYWRIYWtpID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b1RvdWNoUGFkSGFraSkKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvVG91Y2hQYWRIYWtpIGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiYWN0aXZhdGVDb2xvciIsICJXaW50ZXIgU2t5IikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXQxID0gQ0ZyYW1lLm5ldygtNTQyMC4xNjYwMiwgMTA4NC45NjU3LCAtMjY2Ni44MjA4KQogICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgdG9wb3ModGFyZ2V0MSkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4yKQogICAgICAgICAgICAgICAgdW50aWwgZ2V0Z2VudigpLlN0b3BUd2VlbiA9PSB0cnVlIG9yIGdldGdlbnYoKS5BdXRvVG91Y2hQYWRIYWtpID09IGZhbHNlIG9yCiAgICAgICAgICAgICAgICAgICAgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIHRhcmdldDEuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJhY3RpdmF0ZUNvbG9yIiwgIlB1cmUgUmVkIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXQyID0gQ0ZyYW1lLm5ldygtNTQxNC40MTM1NywgMzA5Ljg2NTc1MywgLTIyMTIuNDU3NzYpCiAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICB0b3Bvcyh0YXJnZXQyKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgICAgICAgICB1bnRpbCBnZXRnZW52KCkuU3RvcFR3ZWVuID09IHRydWUgb3IgZ2V0Z2VudigpLkF1dG9Ub3VjaFBhZEhha2kgPT0gZmFsc2Ugb3IKICAgICAgICAgICAgICAgICAgICAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gdGFyZ2V0Mi5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDEwCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KSAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoImFjdGl2YXRlQ29sb3IiLCAiU25vdyBXaGl0ZSIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0MyA9IENGcmFtZS5uZXcoLTQ5NzEuNDc1NTksIDMzMS41NjU3NjUsIC0zNzIwLjAyOTU0KQogICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgdG9wb3ModGFyZ2V0MykKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4yKQogICAgICAgICAgICAgICAgdW50aWwgZ2V0Z2VudigpLlN0b3BUd2VlbiA9PSB0cnVlIG9yIGdldGdlbnYoKS5BdXRvVG91Y2hQYWRIYWtpID09IGZhbHNlIG9yCiAgICAgICAgICAgICAgICAgICAgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIHRhcmdldDMuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2MDApKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjAwKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKVG9nZ2xlID0gU3RhY2s6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBSaXAgSW5kcmEiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvUmlwSW5kcmEgPSBWYWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvUmlwSW5kcmEpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRhc2sud2FpdCgxKSBkbwogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1JpcEluZHJhIGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllcwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJyaXBfaW5kcmEgVHJ1ZSBGb3JtIikgb3IgZW5lbWllczpGaW5kRmlyc3RDaGlsZCgicmlwX2luZHJhIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuTmFtZSA9PSAicmlwX2luZHJhIFRydWUgRm9ybSIgb3Igdi5OYW1lID09ICJyaXBfaW5kcmEiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIGFuZCB2OklzQSgiTW9kZWwiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgZ2V0Z2VudigpLkF1dG9SaXBJbmRyYSA9PSBmYWxzZSBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiR29kJ3MgQ2hhbGljZSIpIG9yIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkdvZCdzIENoYWxpY2UiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjMpCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTU1NjMuNzUwNDg4MjgxMjUsIDMyMC40Mjc2MTIzMDQ2ODc1LCAtMjY2Mi41MDk1MjE0ODQzNzUpKQogICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbigiR29kJ3MgQ2hhbGljZSIpCiAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IChwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkdvZCdzIENoYWxpY2UiKSBvciBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJHb2QncyBDaGFsaWNlIikpCiAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJyaXBfaW5kcmEgVHJ1ZSBGb3JtIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHJpcEluZHJhVHJ1ZUZvcm0gPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoInJpcF9pbmRyYSBUcnVlIEZvcm0iKQogICAgICAgICAgICAgICAgICAgIHRvcG9zKHJpcEluZHJhVHJ1ZUZvcm0uSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKVG9nZ2xlID0gU3RhY2s6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBTb3VsIFJlYXBlciIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9Tb3VsUmVhcGVyID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b1NvdWxSZWFwZXIpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5BdXRvU291bFJlYXBlciBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgd29ya3NwYWNlRW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllcwogICAgICAgICAgICAgICAgbG9jYWwgcmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBiYWNrcGFjayA9IHBsYXllci5CYWNrcGFjawogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgIGlmIHdvcmtzcGFjZUVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlNvdWwgUmVhcGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKHdvcmtzcGFjZUVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQodi5OYW1lLCAiU291bCBSZWFwZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3QgZ2V0Z2VudigpLkF1dG9Tb3VsUmVhcGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJIYWxsb3cgRXNzZW5jZSIpIG9yIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFsbG93IEVzc2VuY2UiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zaXRpb24gPSBDRnJhbWUubmV3KC04OTMyLjMyMjI2NTYyNSwgMTQ2LjgzMTU0Mjk2ODc1LCA2MDYyLjU1MDc4MTI1KQogICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh0YXJnZXRQb3NpdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICB1bnRpbCAodGFyZ2V0UG9zaXRpb24uUG9zaXRpb24gLSBodW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gOAogICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKCJIYWxsb3cgRXNzZW5jZSIpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc291bFJlYXBlciA9IHJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJTb3VsIFJlYXBlciIpCiAgICAgICAgICAgICAgICAgICAgaWYgc291bFJlYXBlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHNvdWxSZWFwZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDIsIDIwLCAyKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICAgICAgdGFzay53YWl0KDAuMSkKICAgIGVuZAplbmQpClRvZ2dsZSA9IFN0YWNrOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gUHJheSIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9QcmF5ID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b1ByYXkpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgwLjUpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9QcmF5IGFuZCBXb3JsZDMgdGhlbiAgICAKICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zID0gQ0ZyYW1lLm5ldygtODY1Mi45OTcwNywgMTQzLjQ1MDExOSwgNjE3MC41MDg3OSkKICAgICAgICAgICAgaWYgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIHRhcmdldFBvcy5Qb3NpdGlvbikubWFnbml0dWRlID4gNSB0aGVuCiAgICAgICAgICAgICAgICB0b3Bvcyh0YXJnZXRQb3MpCiAgICAgICAgICAgICAgICB3YWl0KDAuNSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoImdyYXZlc3RvbmVFdmVudCIsIDEpCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IFN0YWNrOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gVHJ5IEx1Y2siLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvVHJ5THVjayA9IFZhbHVlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLkF1dG9UcnlMdWNrKSAgCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgwLjUpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9UcnlMdWNrIGFuZCBXb3JsZDMgdGhlbiAgICAKICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zID0gQ0ZyYW1lLm5ldygtODY1Mi45OTcwNywgMTQzLjQ1MDExOSwgNjE3MC41MDg3OSkKICAgICAgICAgICAgaWYgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIHRhcmdldFBvcy5Qb3NpdGlvbikubWFnbml0dWRlID4gNSB0aGVuCiAgICAgICAgICAgICAgICB0b3Bvcyh0YXJnZXRQb3MpCiAgICAgICAgICAgICAgICB3YWl0KDAuNSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoImdyYXZlc3RvbmVFdmVudCIsIDIpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTdGFjazpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIERvdWdoIEtpbmciLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvRG91Z2hLaW5nID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b0RvdWdoS2luZykKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvRG91Z2hLaW5nIGFuZCBTdGFydENha2VnZXRnZW52KCkuU3RhcnRNYWduZXQgYW5kIAogICAgICAgICAgICAgICAgICAgKHYuTmFtZSA9PSAiQ29va2llIENyYWZ0ZXIiIG9yIHYuTmFtZSA9PSAiQ2FrZSBHdWFyZCIgb3Igdi5OYW1lID09ICJCYWtpbmcgU3RhZmYiIG9yIHYuTmFtZSA9PSAiSGVhZCBCYWtlciIpIGFuZCAKICAgICAgICAgICAgICAgICAgICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBQT1NDQUtFLlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMzAwIHRoZW4KICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUE9TQ0FLRQogICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBpZiB2Lkh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJBbmltYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5BbmltYXRvcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4yKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5BdXRvRG91Z2hLaW5nIGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkdvZCdzIENoYWxpY2UiKSBvciAKICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkdvZCdzIENoYWxpY2UiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3dlZXRDaGFsaWNlTnBjIiksICJXaGVyZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5TdGFydGVyR3VpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJOb3QgSGF2ZSBFbm91Z2ggTWF0ZXJpYWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWNvbiA9ICJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDIuNQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiU3dlZXRDaGFsaWNlTnBjIikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlN3ZWV0IENoYWxpY2UiKSBvciAKICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTd2VldCBDaGFsaWNlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkNha2VQcmluY2VTcGF3bmVyIiksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJEbyB5b3Ugd2FudCB0byBvcGVuIHRoZSBwb3J0YWwgbm93PyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQ2FrZVByaW5jZVNwYXduZXIiKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQmFraW5nIFN0YWZmIikgb3IgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkhlYWQgQmFrZXIiKSBvciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiQ2FrZSBHdWFyZCIpIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDb29raWUgQ3JhZnRlciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbyAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuTmFtZSA9PSAiQmFraW5nIFN0YWZmIiBvciB2Lk5hbWUgPT0gIkhlYWQgQmFrZXIiIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lk5hbWUgPT0gIkNha2UgR3VhcmQiIG9yIHYuTmFtZSA9PSAiQ29va2llIENyYWZ0ZXIiKSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnRDYWtlZ2V0Z2VudigpLlN0YXJ0TWFnbmV0ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUE9TQ0FLRSA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIGdldGdlbnYoKS5BdXRvRG91Z2hLaW5nID09IGZhbHNlIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIkNha2UgUHJpbmNlIikgb3IgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCB2LlBhcmVudCBvciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0Q2FrZWdldGdlbnYoKS5TdGFydE1hZ25ldCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xODIwLjA2MywgMjEwLjc0OCwgLTEyMjk3LjQ5NikpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGdhbWUuUmVwbGljYXRlZFN0b3JhZ2U6RmluZEZpcnN0Q2hpbGQoIkRvdWdoIEtpbmciKSBvciAKICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkRvdWdoIEtpbmciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJEb3VnaCBLaW5nIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkRvdWdoIEtpbmciIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIGdldGdlbnYoKS5BdXRvRG91Z2hLaW5nID09IGZhbHNlIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCB2LlBhcmVudCBvciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAgICAKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTIwMDkuMjgwLCA0NTMyLjk3MiwgLTE0OTM3LjMwOCkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJSZWQgS2V5Iikgb3IgCiAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmVkIEtleSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSAiQ2FrZVNjaWVudGlzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFsyXSA9ICJDaGVjayIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuVmlzaWJsZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCwgIkRpYWJsbyIpIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcuZmluZChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0LCAiRGVhbmRyZSIpIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcuZmluZChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5RdWVzdC5Db250YWluZXIuUXVlc3RUaXRsZS5UaXRsZS5UZXh0LCAiVXJiYW4iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkRpYWJsbyIpIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJEZWFuZHJlIikgb3IgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlVyYmFuIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkRpYWJsbyIgb3Igdi5OYW1lID09ICJEZWFuZHJlIiBvciB2Lk5hbWUgPT0gIlVyYmFuIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKSAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3Modi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIFBvcykgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBnZXRnZW52KCkuQXV0b0RvdWdoS2luZyA9PSBmYWxzZSBvciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCB2LlBhcmVudCBvciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkdvZCdzIENoYWxpY2UiKSBvciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJHb2QncyBDaGFsaWNlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTdGFjazpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIERhcmtiZWFyZCIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9EYXJrYmVhcmQgPSBWYWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvRGFya2JlYXJkKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9EYXJrYmVhcmQgYW5kIFdvcmxkMiB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIGVuZW1pZXMgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXMKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBpZiBlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJEYXJrYmVhcmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkRhcmtiZWFyZCIgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9EYXJrYmVhcmQgb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGaXN0IG9mIERhcmtuZXNzIikgb3IgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmlzdCBvZiBEYXJrbmVzcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygzNzc4LjU4NCwgMTUuNzkxLCAtMzQ5OS40MDQpKQogICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbigiRmlzdCBvZiBEYXJrbmVzcyIpCiAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvRGFya2JlYXJkCiAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJEYXJrYmVhcmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9wb3MoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJEYXJrYmVhcmQiKS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIFBvcykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpPdGhlciA9IFdpbmRvdzpBZGRUYWIoeyBUaXRsZSA9ICJUYWIgRmFybWluZyBPdGhlciIsIEljb24gPSAiIiB9KQpPdGhlcjpBZGRQYXJhZ3JhcGgoewogICAgICAgIFRpdGxlID0gIlF1ZXN0IERyYWdvbiIsCiAgICAgICAgQ29udGVudCA9ICIiCn0pCk90aGVyOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJUZWxlcG9ydCBUbyBEcmFnb24gRG9qbyIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJyZXF1ZXN0RW50cmFuY2UiLCBWZWN0b3IzLm5ldyg1NjYxLjUzMjIyNjU2MjUsIDEwMTMuMDkwNzU5Mjc3MzQzOCwgLSAzMzQuOTY0OTk2MzM3ODkwNikpCiAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldyg1ODE0LjQyNzI0NjA5Mzc1LCAxMjA4LjMyNjc4MjIyNjU2MjUsIDg4NC41Nzg1NTIyNDYwOTM4KSkKICAgIGVuZAp9KQpUb2dnbGUgPSBPdGhlcjpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFF1ZXN0IERvam8gVHJhaW5lciIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkRvam9DbGFpbVF1ZXN0ID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuRG9qb0NsYWltUXVlc3QpCmVuZCkKbG9jYWwgRG9qb1F1ZXN0TnBjID0gQ0ZyYW1lLm5ldyg1ODU1LjE5NjI5LCAxMjA4LjMyMTc4LCA4NzIuNzEzNTAxLCAwLjYwNjk5NDc0OCwgLTEuODEwNTg4MjNlLTA5LCAtMC43OTQ3MDU4NjgsIDUuNzI3MTI3MjJlLTA5LCAxLCAyLjA5NjA1NTc3ZS0wOSwgMC43OTQ3MDU4NjgsIC01LjgyMzY3NjIxZS0wOSwgMC42MDY5OTQ3NDgpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjIpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkRvam9DbGFpbVF1ZXN0IGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBCeXBhc3NUUCB0aGVuCiAgICAgICAgICAgICAgICAgICAgQlRQKERvam9RdWVzdE5wYykKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0b3BvcyhEb2pvUXVlc3ROcGMpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKERvam9RdWVzdE5wYy5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA8PSA1IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBjbGFpbVF1ZXN0VGFibGUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFsiTlBDIl0gPSAiRG9qbyBUcmFpbmVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgWyJDb21tYW5kIl0gPSAiQ2xhaW1RdWVzdCIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLk1vZHVsZXMuTmV0WyJSRi9JbnRlcmFjdERyYWdvblF1ZXN0Il06SW52b2tlU2VydmVyKGNsYWltUXVlc3RUYWJsZSkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCByZXF1ZXN0UXVlc3RUYWJsZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgWyJOUEMiXSA9ICJEb2pvIFRyYWluZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBbIkNvbW1hbmQiXSA9ICJSZXF1ZXN0UXVlc3QiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5Nb2R1bGVzLk5ldFsiUkYvSW50ZXJhY3REcmFnb25RdWVzdCJdOkludm9rZVNlcnZlcihyZXF1ZXN0UXVlc3RUYWJsZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBPdGhlcjpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFVwZ3JhZGUgRHJhZ29uIFRhbG9uIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuRHJhZ29uVGFsb25VcGdyYWRlID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuRHJhZ29uVGFsb25VcGdyYWRlKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjIpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkRyYWdvblRhbG9uVXBncmFkZSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgbG9jYWwgVXpvdGhOUEMgPSBDRnJhbWUubmV3KDU2NjEuODkwMTQsIDEyMTEuMzE5MDksIDg2NC44MzY3MzEsIDAuODExNDEzMTY5LCAtMS4zNjgwNTgzOGUtMDgsIC0wLjU4NDQ3MzAxNCwgNC43NTIyNzM5NWUtMDgsIDEsIDQuMjU2ODI0NThlLTA4LCAwLjU4NDQ3MzAxNCwgLTYuMjMxNjE5NjZlLTA4LCAwLjgxMTQxMzE2OSkKICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAoVXpvdGhOUEMuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICBpZiBkaXN0YW5jZSA+IDUgdGhlbgogICAgICAgICAgICAgICAgdG9wb3MoVXpvdGhOUEMpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvY2FsIG9oVGFibGUxID0gewogICAgICAgICAgICAgICAgICAgIFsiTlBDIl0gPSAiVXpvdGgiLAogICAgICAgICAgICAgICAgICAgIFsiQ29tbWFuZCJdID0gIlVwZ3JhZGUiCiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLk1vZHVsZXMuTmV0WyJSRi9JbnRlcmFjdERyYWdvblF1ZXN0Il06SW52b2tlU2VydmVyKG9oVGFibGUxKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IE90aGVyOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gQXR0YWNrIEh5ZHJhIE1vYiBBbmQgQ29sbGVjdCBFbWJlciIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkJsYXplRW1iZXJGYXJtID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQmxhemVFbWJlckZhcm0pCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMikgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQmxhemVFbWJlckZhcm0gYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIHdvcmtzcGFjZUVuZW1pZXMgPSBnYW1lOkdldFNlcnZpY2UoJ1dvcmtzcGFjZScpLkVuZW1pZXMKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllclJvb3QgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgIGxvY2FsIGdob3N0ID0gd29ya3NwYWNlRW5lbWllczpGaW5kRmlyc3RDaGlsZCgnR2hvc3QnKQogICAgICAgICAgICAgICAgbG9jYWwgaHlkcmFFbmZvcmNlciA9IHdvcmtzcGFjZUVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoJ0h5ZHJhIEVuZm9yY2VyJykKICAgICAgICAgICAgICAgIGxvY2FsIHZlbm9tb3VzQXNzYWlsYW50ID0gd29ya3NwYWNlRW5lbWllczpGaW5kRmlyc3RDaGlsZCgnVmVub21vdXMgQXNzYWlsYW50JykKICAgICAgICAgICAgICAgIGlmIGdob3N0IG9yIGh5ZHJhRW5mb3JjZXIgb3IgdmVub21vdXNBc3NhaWxhbnQgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKHdvcmtzcGFjZUVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICdIeWRyYSBFbmZvcmNlcicgb3Igdi5OYW1lID09ICdWZW5vbW91cyBBc3NhaWxhbnQnIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoJ0h1bWFub2lkJykgYW5kIHY6RmluZEZpcnN0Q2hpbGQoJ0h1bWFub2lkUm9vdFBhcnQnKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDp3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU3RhcnRNYWduZXQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWRSb290UGFydC5TaXplIH49IFZlY3RvcjMubmV3KDYwLCA2MCwgNjApIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNjAsIDYwLCA2MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuSHVtYW5vaWRSb290UGFydC5UcmFuc3BhcmVuY3kgfj0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9uRmFybSA9IHYuTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5CbGF6ZUVtYmVyRmFybSBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldyg1Mzk0LjM2NDc1LCAxMDgyLjcxMDU3LCA1NjEuOTkzOTU4LCAtMC42MjQ1MzcxMSwgMy4xNzgyNjQwNWUtMDgsIC0wLjc4MDk5NTEzMSwgNi43NzUzMDk5MWUtMDgsIDEsIC0xLjM0ODQ5NTQ1ZS0wOCwgMC43ODA5OTUxMzEsIC02LjEzMzY2OTIyZS0wOCwgLTAuNjI0NTM3MTEpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IE90aGVyOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gQ29sbGVjdCBGaXJlRmxvd2VyIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b0NvbGxlY3RGaXJlRmxvd2VycyA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9Db2xsZWN0RmlyZUZsb3dlcnMgdGhlbgogICAgICAgICAgICBsb2NhbCB2NzQ3ID0gd29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJGaXJlRmxvd2VycyIpCiAgICAgICAgICAgIGlmIHY3NDcgdGhlbgogICAgICAgICAgICAgICAgZm9yIHY5MDMsIHY5MDQgaW4gcGFpcnModjc0NzpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmICh2OTA0OklzQSgiTW9kZWwiKSBhbmQgdjkwNC5QcmltYXJ5UGFydCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB2MTM2NyA9IHY5MDQuUHJpbWFyeVBhcnQuUG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHYxMzY4ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHYxMzY5ID0gKHYxMzY3IC0gdjEzNjgpLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodjEzNjkgPD0gMSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsICJFIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDEuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwgIkUiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldyh2MTM2NykpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKT3RoZXI6QWRkUGFyYWdyYXBoKHsKICAgICAgICBUaXRsZSA9ICJGYXJtIENoZXN0IiwKICAgICAgICBDb250ZW50ID0gc3RyaW5nLnJlcCgiLSIsIDIxKQp9KQpUb2dnbGVDaGVzdCA9IE90aGVyOkFkZFRvZ2dsZSgiVG9nZ2xlQ2hlc3QiLCB7VGl0bGUgPSAiQXV0byBDaGVzdCIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGVDaGVzdDpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b0Zhcm1DaGVzdCA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgbGFzdFRhcmdldCA9IG5pbAogICAgd2hpbGUgd2FpdCgwLjIpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9GYXJtQ2hlc3QgdGhlbgogICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyIG9yIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKICAgICAgICAgICAgbG9jYWwgcGxheWVyUG9zID0gY2hhcmFjdGVyOkdldFBpdm90KCkuUG9zaXRpb24KICAgICAgICAgICAgbG9jYWwgY2hlc3RTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb2xsZWN0aW9uU2VydmljZSIpCiAgICAgICAgICAgIGxvY2FsIGNoZXN0cyA9IGNoZXN0U2VydmljZTpHZXRUYWdnZWQoIl9DaGVzdFRhZ2dlZCIpCiAgICAgICAgICAgIGxvY2FsIGNsb3Nlc3RDaGVzdCwgbWluRGlzdCA9IG5pbCwgbWF0aC5odWdlCiAgICAgICAgICAgIGZvciBfLCBjaGVzdCBpbiBpcGFpcnMoY2hlc3RzKSBkbwogICAgICAgICAgICAgICAgaWYgbm90IGNoZXN0OkdldEF0dHJpYnV0ZSgiSXNEaXNhYmxlZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0ID0gKGNoZXN0OkdldFBpdm90KCkuUG9zaXRpb24gLSBwbGF5ZXJQb3MpLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgIGlmIGRpc3QgPCBtaW5EaXN0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbWluRGlzdCwgY2xvc2VzdENoZXN0ID0gZGlzdCwgY2hlc3QKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgY2xvc2VzdENoZXN0IGFuZCBjbG9zZXN0Q2hlc3Qgfj0gbGFzdFRhcmdldCB0aGVuCiAgICAgICAgICAgICAgICBsYXN0VGFyZ2V0ID0gY2xvc2VzdENoZXN0CiAgICAgICAgICAgICAgICB0b3BvcyhjbG9zZXN0Q2hlc3Q6R2V0UGl2b3QoKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBPdGhlcjpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJTdG9wIFdoZW4gSGF2ZSBHb2QncyBDaGFsaWNlJiBGaXN0IE9mIERhcmtuZXNzIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuU3RvcENoZXN0ID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC41KSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5TdG9wQ2hlc3QgdGhlbgogICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgaWYgbm90IHBsYXllciB0aGVuIGNvbnRpbnVlIGVuZCAgICAgICAKICAgICAgICAgICAgbG9jYWwgYmFja3BhY2sgPSBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikKICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciAgICAgICAgICAgIAogICAgICAgICAgICBpZiBiYWNrcGFjayBhbmQgY2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgIGlmIGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGaXN0IG9mIERhcmtuZXNzIikgb3IgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGaXN0IG9mIERhcmtuZXNzIikgb3IgCiAgICAgICAgICAgICAgICAgICBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiR29kJ3MgQ2hhbGljZSIpIG9yIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiR29kJ3MgQ2hhbGljZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b0Zhcm1DaGVzdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgVG9nZ2xlQ2hlc3QgYW5kIHR5cGVvZihUb2dnbGVDaGVzdC5TZXQpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBUb2dnbGVDaGVzdDpTZXQoZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCk90aGVyOkFkZFBhcmFncmFwaCh7CiAgICAgVGl0bGUgPSAiRmFybSBPYnNlcnZhdGlvbiIsCiAgICAgQ29udGVudCA9IHN0cmluZy5yZXAoIi0iLCAyMSkKfSkKT2JzZXJ2YXRpb25SYW5nZSA9IE90aGVyOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJPYnNlcnZhdGlvbiBMZXZlbCIsCiAgICBDb250ZW50ID0gIiIKfSkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgbGFzdFZhbHVlID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuVmlzaW9uUmFkaXVzLlZhbHVlCiAgICB3aGlsZSB3YWl0KDAuMSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRWYWx1ZSA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlZpc2lvblJhZGl1cy5WYWx1ZQogICAgICAgICAgICBpZiBjdXJyZW50VmFsdWUgfj0gbGFzdFZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIE9ic2VydmF0aW9uUmFuZ2U6U2V0RGVzYygiT2JzZXJ2YXRpb24gUmFuZ2UgTGV2ZWw6ICIgLi4gbWF0aC5mbG9vcihjdXJyZW50VmFsdWUpKQogICAgICAgICAgICAgICAgbGFzdFZhbHVlID0gY3VycmVudFZhbHVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpClRvZ2dsZSA9IE90aGVyOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gVVAgT2JzZXJ2YXRpb24gVjIiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvT2JzZXJ2YXRpb25IYWtpVjIgPSBWYWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvT2JzZXJ2YXRpb25IYWtpVjIpCmVuZCkgICAgCnNwYXduKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGxhc3RVcGRhdGVUaW1lID0gdGljaygpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9PYnNlcnZhdGlvbkhha2lWMiBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0LlZpc2libGUgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHRpY2soKSAtIGxhc3RVcGRhdGVUaW1lID49IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xMjQ0NC43ODUxNTYyNSwgMzMyLjQwMzk2MTE4MTY0LCAtNzY3My4xODA2NjQwNjI1KSkKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFVwZGF0ZVRpbWUgPSB0aWNrKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJDaXRpemVuUXVlc3RQcm9ncmVzcyIsICJDaXRpemVuIikKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJTdGFydFF1ZXN0IiwgIkNpdGl6ZW5RdWVzdCIsIDEpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCwgIkRlZmVhdCA1MCBGb3Jlc3QgUGlyYXRlcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJGb3Jlc3QgUGlyYXRlIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJGb3Jlc3QgUGlyYXRlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhc0J1c28iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnVzbyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zSGVlID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCwgNTAsIDUwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uSGFraVYyID09IGZhbHNlIG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uUXVlc3QuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dCA9PSAiRGVmZWF0IENhcHRhaW4gRWxlcGhhbnQgKDAvMSkiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDYXB0YWluIEVsZXBoYW50IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJDYXB0YWluIEVsZXBoYW50IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhc0J1c28iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQnVzbyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2V0aGlkZGVucHJvcGVydHkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsIDUwLCA1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgZ2V0Z2VudigpLkF1dG9PYnNlcnZhdGlvbkhha2lWMiA9PSBmYWxzZSBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQmFuYW5hIikgYW5kIAogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQXBwbGUiKSBhbmQgCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQaW5lYXBwbGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgdGljaygpIC0gbGFzdFVwZGF0ZVRpbWUgPj0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTEyNDQ0Ljc4NTE1NjI1LCAzMzIuNDAzOTYxMTgxNjQsIC03NjczLjE4MDY2NDA2MjUpKQogICAgICAgICAgICAgICAgICAgICAgICBsYXN0VXBkYXRlVGltZSA9IHRpY2soKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkNpdGl6ZW5RdWVzdFByb2dyZXNzIiwgIkNpdGl6ZW4iKQogICAgICAgICAgICAgICAgZWxzZWlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRnJ1aXQgQm93bCIpIG9yIAogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGcnVpdCBCb3dsIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHRpY2soKSAtIGxhc3RVcGRhdGVUaW1lID49IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xMDkyMC4xMjUsIDYyNC4yMDI3NTg3ODkwNiwgLTEwMjY2Ljk5NTExNzE4OCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RVcGRhdGVUaW1lID0gdGljaygpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiS2VuVGFsazIiLCAiU3RhcnQiKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIktlblRhbGsyIiwgIkJ1eSIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgbGFzdFVwZGF0ZSA9IHRpY2soKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uSGFraVYyIGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICAgICAgaWYgc2V0aGlkZGVucHJvcGVydHkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHRpY2soKSAtIGxhc3RVcGRhdGUgPj0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWUuUGxheWVycy5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RVcGRhdGUgPSB0aWNrKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uSGFraVYyIGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXIuSHVtYW5vaWQKICAgICAgICAgICAgICAgICAgICBpZiBodW1hbm9pZDpHZXRTdGF0ZSgpIH49IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuUGh5c2ljcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuUGh5c2ljcykKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9PYnNlcnZhdGlvbkhha2lWMiBhbmQgZ2V0Z2VudigpLlN0YXJ0TWFnbmV0IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGVuZW1pZXMgPSBnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkKICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIGlwYWlycyhlbmVtaWVzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiRm9yZXN0IFBpcmF0ZSIgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkUm9vdFBhcnQgPSB2Lkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlIH49IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBodW1hbm9pZFJvb3RQYXJ0LlNpemUgfj0gVmVjdG9yMy5uZXcoNTAsIDUwLCA1MCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsIDUwLCA1MCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lIH49IFBvc0hlZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IFBvc0hlZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9PYnNlcnZhdGlvbkhha2lWMiBhbmQgZ2V0Z2VudigpLlN0YXJ0TWFnbmV0IHRoZW4KICAgICAgICAgICAgICAgIENoZWNrUXVlc3QoKQogICAgICAgICAgICAgICAgbG9jYWwgZW5lbWllcyA9IGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKQogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gaXBhaXJzKGVuZW1pZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09IE1zIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSB2Lkh1bWFub2lkCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMTQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKZW5kKQpUb2dnbGUgPSBPdGhlcjpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJGYXJtIE9ic2VydmF0aW9uIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlZpc2lvblJhZGl1cy5WYWx1ZSA+PSA1MDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBBbGVydDpjcmVhdGUoIllvdSBIYXZlIE1heCBQb2ludHMiKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVuZW15TmFtZSwgc3Bhd25Qb3MKICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHdvcmtzcGFjZUVuZW1pZXMgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXMKICAgICAgICAgICAgICAgICAgICBsb2NhbCBndWkgPSBwbGF5ZXIuUGxheWVyR3VpLlNjcmVlbkd1aQogICAgICAgICAgICAgICAgICAgIGlmIFdvcmxkMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15TmFtZSA9ICJMYXZhIFBpcmF0ZSBbTHYuIDEyMDBdIgogICAgICAgICAgICAgICAgICAgICAgICBzcGF3blBvcyA9IENGcmFtZS5uZXcoLTU0NzguMzkyMDksIDE1Ljk3NzU2NjcsIC01MjQ2LjkxMjYpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIFdvcmxkMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15TmFtZSA9ICJHYWxsZXkgQ2FwdGFpbiIKICAgICAgICAgICAgICAgICAgICAgICAgc3Bhd25Qb3MgPSBDRnJhbWUubmV3KDU1MzMuMjk3ODUsIDg4LjEwNzkxMDIsIDQ4NTIuMzkxNikKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgV29ybGQzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXlOYW1lID0gIlZlbm9tb3VzIEFzc2FpbGFudCIKICAgICAgICAgICAgICAgICAgICAgICAgc3Bhd25Qb3MgPSBDRnJhbWUubmV3KDQ2MzguNzg1NjQ0NTMxMjUsIDEwNzguOTQwOTE3OTY4NzUsIDg4MS44MDAyMzE5MzM1OTM4KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVuZW15ID0gd29ya3NwYWNlRW5lbWllczpGaW5kRmlyc3RDaGlsZChlbmVteU5hbWUpCiAgICAgICAgICAgICAgICAgICAgaWYgZW5lbXkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBndWk6RmluZEZpcnN0Q2hpbGQoIkltYWdlTGFiZWwiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBlbmVteS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMywgMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uIG9yIG5vdCBndWk6RmluZEZpcnN0Q2hpbGQoIkltYWdlTGFiZWwiKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBlbmVteS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgNTAsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGd1aTpGaW5kRmlyc3RDaGlsZCgiSW1hZ2VMYWJlbCIpIGFuZCBnZXRnZW52KCkuQXV0b09ic2VydmF0aW9uX0hvcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIik6VGVsZXBvcnQoZ2FtZS5QbGFjZUlkLCBwbGF5ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9PYnNlcnZhdGlvbiBvciBndWk6RmluZEZpcnN0Q2hpbGQoIkltYWdlTGFiZWwiKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHNwYXduUG9zKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCk90aGVyOkFkZFBhcmFncmFwaCh7CiAgICAgVGl0bGUgPSAiQXV0byBCb3NzIiwKICAgICBDb250ZW50ID0gc3RyaW5nLnJlcCgiLSIsIDIxKQp9KQppZiBXb3JsZDEgdGhlbgogICAgdGFibGVCb3NzID0gewogICAgICAgICJUaGUgR29yaWxsYSBLaW5nIiwgIkJvYmJ5IiwgIllldGkiLCAiTW9iIExlYWRlciIsICJWaWNlIEFkbWlyYWwiLCAKICAgICAgICAiV2FyZGVuIiwgIkNoaWVmIFdhcmRlbiIsICJTd2FuIiwgIk1hZ21hIEFkbWlyYWwiLCAiRmlzaG1hbiBMb3JkIiwgCiAgICAgICAgIld5c3BlciIsICJUaHVuZGVyIEdvZCIsICJDeWJvcmciLCAiU2FiZXIgRXhwZXJ0IgogICAgfQplbHNlaWYgV29ybGQyIHRoZW4KICAgIHRhYmxlQm9zcyA9IHsKICAgICAgICAiRGlhbW9uZCIsICJKZXJlbXkiLCAiRmFqaXRhIiwgIkRvbiBTd2FuIiwgIlNtb2tlIEFkbWlyYWwiLCAKICAgICAgICAiQ3Vyc2VkIENhcHRhaW4iLCAiRGFya2JlYXJkIiwgIk9yZGVyIiwgIkF3YWtlbmVkIEljZSBBZG1pcmFsIiwgIlRpZGUgS2VlcGVyIgogICAgfQplbHNlaWYgV29ybGQzIHRoZW4KICAgIHRhYmxlQm9zcyA9IHsKICAgICAgICAiU3RvbmUiLCAiSXNsYW5kIEVtcHJlc3MiLCAiS2lsbyBBZG1pcmFsIiwgIkNhcHRhaW4gRWxlcGhhbnQiLCAKICAgICAgICAiQmVhdXRpZnVsIFBpcmF0ZSIsICJyaXBfaW5kcmEgVHJ1ZSBGb3JtIiwgIkxvbmdtYSIsICJTb3VsIFJlYXBlciIsIAogICAgICAgICJDYWtlIFF1ZWVuIiwgIkNha2UgUHJpbmNlIiwgIkRvdWdoIEtpbmciCiAgICB9CmVuZApEcm9wZG93biA9IE90aGVyOkFkZERyb3Bkb3duKCJEcm9wZG93biIsIHsKICAgIFRpdGxlID0gIlNlbGVjdCBCb3NzIiwKICAgIFZhbHVlcyA9IHRhYmxlQm9zcywKICAgIE11bHRpID0gZmFsc2UsCn0pCkRyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5TZWxlY3RCb3NzID0gVmFsdWUKZW5kKQpUb2dnbGUgPSBPdGhlcjpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIEtpbGwgQm9zcyIsIERlZmF1bHQgPSBnZXRnZW52KCkuQXV0b0Zhcm1Cb3NzIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b0Zhcm1Cb3NzID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b0Zhcm1Cb3NzKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjIpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9GYXJtQm9zcyBhbmQgZ2V0Z2VudigpLkJ5cGFzc1RQIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgd29ya3NwYWNlRW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllcwogICAgICAgICAgICAgICAgbG9jYWwgc2VsZWN0Qm9zcyA9IGdldGdlbnYoKS5TZWxlY3RCb3NzCiAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RXZWFwb24gPSBnZXRnZW52KCkuU2VsZWN0V2VhcG9uCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXJSb290ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBsb2NhbCBib3NzID0gd29ya3NwYWNlRW5lbWllczpGaW5kRmlyc3RDaGlsZChzZWxlY3RCb3NzKQogICAgICAgICAgICAgICAgaWYgYm9zcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMod29ya3NwYWNlRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gc2VsZWN0Qm9zcyBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gdi5IdW1hbm9pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IHYuSHVtYW5vaWRSb290UGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oc2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBodW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkLldhbGtTcGVlZCB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkUm9vdFBhcnQuU2l6ZSB+PSBWZWN0b3IzLm5ldyg4MCwgODAsIDgwKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg4MCwgODAsIDgwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoaHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvRmFybUJvc3Mgb3Igbm90IHYuUGFyZW50IG9yIGh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZChzZWxlY3RCb3NzKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYm9zc1JlcGxpY2F0ZWQgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKHNlbGVjdEJvc3MpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYm9zc1Jvb3QgPSBib3NzUmVwbGljYXRlZC5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgICAgICAgICAgICAgaWYgKGJvc3NSb290LkNGcmFtZS5Qb3NpdGlvbiAtIHBsYXllclJvb3QuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxNTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoYm9zc1Jvb3QuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgQlRQKGJvc3NSb290LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4yKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5BdXRvRmFybUJvc3MgYW5kIG5vdCBnZXRnZW52KCkuQnlwYXNzVFAgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCB3b3Jrc3BhY2VFbmVtaWVzID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzCiAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RCb3NzID0gZ2V0Z2VudigpLlNlbGVjdEJvc3MKICAgICAgICAgICAgICAgIGxvY2FsIHNlbGVjdFdlYXBvbiA9IGdldGdlbnYoKS5TZWxlY3RXZWFwb24KICAgICAgICAgICAgICAgIGxvY2FsIGJvc3MgPSB3b3Jrc3BhY2VFbmVtaWVzOkZpbmRGaXJzdENoaWxkKHNlbGVjdEJvc3MpCiAgICAgICAgICAgICAgICBpZiBib3NzIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2VFbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSBzZWxlY3RCb3NzIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSB2Lkh1bWFub2lkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBodW1hbm9pZFJvb3RQYXJ0ID0gdi5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBodW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihzZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQuV2Fsa1NwZWVkIH49IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWRSb290UGFydC5TaXplIH49IFZlY3RvcjMubmV3KDgwLCA4MCwgODApIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIFBvcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9GYXJtQm9zcyBvciBub3Qgdi5QYXJlbnQgb3IgaHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBsb2NhbCByZXBsaWNhdGVkQm9zcyA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZChzZWxlY3RCb3NzKQogICAgICAgICAgICAgICAgICAgIGlmIHJlcGxpY2F0ZWRCb3NzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MocmVwbGljYXRlZEJvc3MuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDUsIDEwLCA3KSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBPdGhlcjpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIEtpbGwgQWxsIEJvc3MiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkgICAgCiAgICBnZXRnZW52KCkuQXV0b0Zhcm1BbGxCb3NzID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuQXV0b0Zhcm1BbGxCb3NzKSAgICAKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4yKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5BdXRvRmFybUFsbEJvc3MgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgaSwgYm9zcyBpbiBwYWlycyh0YWJsZUJvc3MpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKGJvc3MpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gYm9zcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDgwLCA4MCwgODApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9GYXJtQWxsQm9zcyBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKGJvc3MpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZChib3NzKS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoNSwgMTAsIDIpKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpCbG9nID0gV2luZG93OkFkZFRhYih7IFRpdGxlID0gIlRhYiBGcnVpdCBBbmQgUmFpZCIsIEljb24gPSAiIiB9KQpUb2dnbGUgPSBCbG9nOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIlJhbmRvbSBEZXZpbCBGcnVpdCIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlJhbmRvbUZydWl0ID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICAgd2hpbGUgdGFzay53YWl0KDAuMikgZG8KICAgICAgICAgaWYgZ2V0Z2VudigpLlJhbmRvbUZydWl0IHRoZW4KICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJDb3VzaW4iLCJCdXkiKQogICAgICAgICAgZW5kIAogICAgIGVuZAplbmQpClRvZ2dsZSA9IEJsb2c6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBTdG9yZSBGcnVpdCIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9TdG9yZUZydWl0ID0gVmFsdWUKZW5kKSAgICAKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMikgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1N0b3JlRnJ1aXQgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1N0b3JlRnJ1aXQgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGJhY2twYWNrID0gcGxheWVyLkJhY2twYWNrCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZnJ1aXRzID0gewogICAgICAgICAgICAgICAgICAgICAgICB7IlJvY2tldCBGcnVpdCIsICJSb2NrZXQtUm9ja2V0In0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiU3BpbiBGcnVpdCIsICJTcGluLVNwaW4ifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJCbGFkZSBGcnVpdCIsICJCbGFkZS1CbGFkZSJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IlNwcmluZyBGcnVpdCIsICJTcHJpbmctU3ByaW5nIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiQm9tYiBGcnVpdCIsICJCb21iLUJvbWIifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJTbW9rZSBGcnVpdCIsICJTbW9rZS1TbW9rZSJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IlNwaWtlIEZydWl0IiwgIlNwaWtlLVNwaWtlIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiRmxhbWUgRnJ1aXQiLCAiRmxhbWUtRmxhbWUifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJGYWxjb24gRnJ1aXQiLCAiRmFsY29uLUZhbGNvbiJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IkljZSBGcnVpdCIsICJJY2UtSWNlIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiU2FuZCBGcnVpdCIsICJTYW5kLVNhbmQifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJEYXJrIEZydWl0IiwgIkRhcmstRGFyayJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IkRpYW1vbmQgRnJ1aXQiLCAiRGlhbW9uZC1EaWFtb25kIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiTGlnaHQgRnJ1aXQiLCAiTGlnaHQtTGlnaHQifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJSdWJiZXIgRnJ1aXQiLCAiUnViYmVyLVJ1YmJlciJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IkJhcnJpZXIgRnJ1aXQiLCAiQmFycmllci1CYXJyaWVyIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiR2hvc3QgRnJ1aXQiLCAiR2hvc3QtR2hvc3QifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJNYWdtYSBGcnVpdCIsICJNYWdtYS1NYWdtYSJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IlF1YWtlIEZydWl0IiwgIlF1YWtlLVF1YWtlIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiQnVkZGhhIEZydWl0IiwgIkJ1ZGRoYS1CdWRkaGEifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJMb3ZlIEZydWl0IiwgIkxvdmUtTG92ZSJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IlNwaWRlciBGcnVpdCIsICJTcGlkZXItU3BpZGVyIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiU291bmQgRnJ1aXQiLCAiU291bmQtU291bmQifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJQaG9lbml4IEZydWl0IiwgIlBob2VuaXgtUGhvZW5peCJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IlBvcnRhbCBGcnVpdCIsICJQb3J0YWwtUG9ydGFsIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiUnVtYmxlIEZydWl0IiwgIlJ1bWJsZS1SdW1ibGUifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJQYWluIEZydWl0IiwgIlBhaW4tUGFpbiJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IkJsaXp6YXJkIEZydWl0IiwgIkJsaXp6YXJkLUJsaXp6YXJkIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiR3Jhdml0eSBGcnVpdCIsICJHcmF2aXR5LUdyYXZpdHkifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJNYW1tb3RoIEZydWl0IiwgIk1hbW1vdGgtTWFtbW90aCJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IlQtUmV4IEZydWl0IiwgIlQtUmV4LVQtUmV4In0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiRG91Z2ggRnJ1aXQiLCAiRG91Z2gtRG91Z2gifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJTaGFkb3cgRnJ1aXQiLCAiU2hhZG93LVNoYWRvdyJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IlZlbm9tIEZydWl0IiwgIlZlbm9tLVZlbm9tIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiR2FzIEZydWl0IiwgIkdhcy1HYXMifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJDb250cm9sIEZydWl0IiwgIkNvbnRyb2wtQ29udHJvbCJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IlNwaXJpdCBGcnVpdCIsICJTcGlyaXQtU3Bpcml0In0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiTGVvcGFyZCBGcnVpdCIsICJMZW9wYXJkLUxlb3BhcmQifSwKICAgICAgICAgICAgICAgICAgICAgICAgeyJZZXRpIEZydWl0IiwgIllldGktWWV0aSJ9LAogICAgICAgICAgICAgICAgICAgICAgICB7IktpdHN1bmUgRnJ1aXQiLCAiS2l0c3VuZS1LaXRzdW5lIn0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsiRHJhZ29uIEZydWl0IiwgIkRyYWdvbi1EcmFnb24ifSwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGZydWl0IGluIGlwYWlycyhmcnVpdHMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGZydWl0TmFtZSwgc2VydmVyTmFtZSA9IGZydWl0WzFdLCBmcnVpdFsyXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoZnJ1aXROYW1lKSBvciBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZChmcnVpdE5hbWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlN0b3JlRnJ1aXQiLCBzZXJ2ZXJOYW1lLCBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZChmcnVpdE5hbWUpKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICAgICAgdGFzay53YWl0KDAuMSkKICAgIGVuZAplbmQpCkZydWl0TGlzdCA9IHsKICAiUm9ja2V0LVJvY2tldCIsCiAgIlNwaW4tU3BpbiIsCiAgIkJsYWRlLUJsYWRlIiwKICAiU3ByaW5nLVNwcmluZyIsCiAgIkJvbWItQm9tYiIsCiAgIlNtb2tlLVNtb2tlIiwKICAiU3Bpa2UtU3Bpa2UiLAogICJGbGFtZS1GbGFtZSIsCiAgIkZhbGNvbi1GYWxjb24iLAogICJJY2UtSWNlIiwKICAiU2FuZC1TYW5kIiwKICAiRGFyay1EYXJrIiwKICAiRGlhbW9uZC1EaWFtb25kIiwKICAiTGlnaHQtTGlnaHQiLAogICJSdWJiZXItUnViYmVyIiwKICAiQmFycmllci1CYXJyaWVyIiwKICAiR2hvc3QtR2hvc3QiLAogICJNYWdtYS1NYWdtYSIsCiAgIlF1YWtlLVF1YWtlIiwKICAiQnVkZGhhLUJ1ZGRoYSIsCiAgIkxvdmUtTG92ZSIsCiAgIlNwaWRlci1TcGlkZXIiLAogICJTb3VuZC1Tb3VuZCIsCiAgIlBob2VuaXgtUGhvZW5peCIsCiAgIlBvcnRhbC1Qb3J0YWwiLAogICJSdW1ibGUtUnVtYmxlIiwKICAiUGFpbi1QYWluIiwKICAiQmxpenphcmQtQmxpenphcmQiLAogICJHcmF2aXR5LUdyYXZpdHkiLAogICJULVJleC1ULVJleCIsCiAgIk1hbW1vdGgtTWFtbW90aCIsCiAgIkRvdWdoLURvdWdoIiwKICAiU2hhZG93LVNoYWRvdyIsCiAgIlZlbm9tLVZlbm9tIiwKICAiR2FzLUdhcyIsCiAgIkNvbnRyb2wtQ29udHJvbCIsCiAgIlNwaXJpdC1TcGlyaXQiLAogICJMZW9wYXJkLUxlb3BhcmQiLAogICJZZXRpLVlldGkiLAogICJLaXRzdW5lLUtpdHN1bmUiLAogICJEcmFnb24tRHJhZ29uIgogfQpEcm9wZG93biA9IEJsb2c6QWRkRHJvcGRvd24oIkRyb3Bkb3duIiwgewogICAgVGl0bGUgPSAiQmxveCBGcnVpdCBTbmlwZXIgU2hvcCIsCiAgICBWYWx1ZXMgPSBGcnVpdExpc3QsCiAgICBNdWx0aSA9IGZhbHNlLAp9KQpEcm9wZG93bjpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuU2VsZWN0RnJ1aXQgPSBWYWx1ZQplbmQpICAgIApUb2dnbGUgPSBCbG9nOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkJ1eSBCbG94IEZydWl0IFNuaXBlciBTaG9wIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b0J1eUZydWl0U25pcGVyID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KDEpIGRvCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvQnV5RnJ1aXRTbmlwZXIgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiR2V0RnJ1aXRzIikKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIlB1cmNoYXNlUmF3RnJ1aXQiLCBnZXRnZW52KCkuU2VsZWN0RnJ1aXQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCkJsb2c6QWRkUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIlJhaWRzIiwKICAgIENvbnRlbnQgPSBzdHJpbmcucmVwKCItIiwgMjEpCn0pCkRyb3Bkb3duID0gQmxvZzpBZGREcm9wZG93bigiRHJvcGRvd24iLCB7CiAgICBUaXRsZSA9ICJTZWxlY3QgUmFpZCIsCiAgICBWYWx1ZXMgPSB7CiAgICAgICAgIkRhcmsiLCAiU2FuZCIsICJNYWdtYSIsICJSdW1ibGUiLCAiRmxhbWUiLCAKICAgICAgICAiSWNlIiwgIkxpZ2h0IiwgIlF1YWtlIiwgIkJ1ZGRoYSIsICJTcGlkZXIiLCAKICAgICAgICAiUGhvZW5peCIsICJEb3VnaCIKICAgIH0sCiAgICBNdWx0aSA9IGZhbHNlLAp9KQpEcm9wZG93bjpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuU2VsZWN0Q2hpcCA9IFZhbHVlCmVuZCkKVG9nZ2xlID0gQmxvZzpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJHZXQgRnJ1aXQgSW4gSW52ZW50b3J5IExvdyBCZWxpIiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvR2V0RnJ1aXQgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCguMSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvR2V0RnJ1aXQgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZnJ1aXRzID0geyJSb2NrZXQtUm9ja2V0IiwgIlNwaW4tU3BpbiIsICJDaG9wLUNob3AiLCAiU3ByaW5nLVNwcmluZyIsICJCb21iLUJvbWIiLCAiU21va2UtU21va2UiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU3Bpa2UtU3Bpa2UiLCAiRmxhbWUtRmxhbWUiLCAiRmFsY29uLUZhbGNvbiIsICJJY2UtSWNlIiwgIlNhbmQtU2FuZCIsICJEYXJrLURhcmsiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiR2hvc3QtR2hvc3QiLCAiRGlhbW9uZC1EaWFtb25kIiwgIkxpZ2h0LUxpZ2h0IiwgIlJ1YmJlci1SdWJiZXIiLCAiQmFycmllci1CYXJyaWVyIn0KCiAgICAgICAgICAgICAgICBmb3IgXywgZnJ1aXQgaW4gaXBhaXJzKGZydWl0cykgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSAiTG9hZEZydWl0IiwKICAgICAgICAgICAgICAgICAgICAgICAgWzJdID0gZnJ1aXQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKVG9nZ2xlID0gQmxvZzpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFJhaWQiLCBEZWZhdWx0ID0gZmFsc2V9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9fRHVuZ2VvbiA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDEpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9fRHVuZ2VvbiB0aGVuCiAgICAgICAgICAgIGlmIG5vdCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW4uVG9wSFVETGlzdC5SYWlkVGltZXIuVmlzaWJsZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBpc2xhbmRzID0geyJJc2xhbmQgNSIsICJJc2xhbmQgNCIsICJJc2xhbmQgMyIsICJJc2xhbmQgMiIsICJJc2xhbmQgMSJ9CiAgICAgICAgICAgICAgICBmb3IgXywgaXNsYW5kIGluIGlwYWlycyhpc2xhbmRzKSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIGxvY2F0aW9uID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKVsiX1dvcmxkT3JpZ2luIl0uTG9jYXRpb25zOkZpbmRGaXJzdENoaWxkKGlzbGFuZCkKICAgICAgICAgICAgICAgICAgICBpZiBsb2NhdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKGxvY2F0aW9uLkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgNzAsIDEwMCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvX0R1bmdlb24gdGhlbgogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIilbIkxvY2FsUGxheWVyIl0uUGxheWVyR3VpLk1haW4uVGltZXIuVmlzaWJsZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3BlY2lhbE1pY3JvY2hpcCA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTcGVjaWFsIE1pY3JvY2hpcCIpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU3BlY2lhbCBNaWNyb2NoaXAiKQogICAgICAgICAgICAgICAgICAgIGlmIHNwZWNpYWxNaWNyb2NoaXAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBXb3JsZDIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZWNsaWNrZGV0ZWN0b3IoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuQ2lyY2xlSXNsYW5kLlJhaWRTdW1tb24yLkJ1dHRvbi5NYWluLkNsaWNrRGV0ZWN0b3IpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBXb3JsZDMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZWNsaWNrZGV0ZWN0b3IoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXBbIkJvYXQgQ2FzdGxlIl0uUmFpZFN1bW1vbjIuQnV0dG9uLk1haW4uQ2xpY2tEZXRlY3RvcikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDEpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9fRHVuZ2VvbiB0aGVuCiAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlLkVuZW1pZXM6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoLjAwMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuSGVhbHRoID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvX0R1bmdlb24gb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b19EdW5nZW9uIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAiUmFpZHNOcGMiLAogICAgICAgICAgICAgICAgICAgIFsyXSA9ICJTZWxlY3QiLAogICAgICAgICAgICAgICAgICAgIFszXSA9IGdldGdlbnYoKS5TZWxlY3RDaGlwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgxKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9fRHVuZ2VvbiB0aGVuCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKVsiTG9jYWxQbGF5ZXIiXS5QbGF5ZXJHdWkuTWFpbi5UaW1lci5WaXNpYmxlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBzcGVjaWFsTWljcm9jaGlwID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlNwZWNpYWwgTWljcm9jaGlwIikgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTcGVjaWFsIE1pY3JvY2hpcCIpCiAgICAgICAgICAgICAgICAgICAgaWYgc3BlY2lhbE1pY3JvY2hpcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFdvcmxkMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlY2xpY2tkZXRlY3RvcihnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5DaXJjbGVJc2xhbmQuUmFpZFN1bW1vbjIuQnV0dG9uLk1haW4uQ2xpY2tEZXRlY3RvcikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIFdvcmxkMyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlY2xpY2tkZXRlY3RvcihnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcFsiQm9hdCBDYXN0bGUiXS5SYWlkU3VtbW9uMi5CdXR0b24uTWFpbi5DbGlja0RldGVjdG9yKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBCbG9nOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gQXdha2VuIEZydWl0IiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvQXdha2VuID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgxKSBkbwogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0F3YWtlbiB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJBd2FrZW5lciIsICJDaGVjayIpCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJBd2FrZW5lciIsICJBd2FrZW4iKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQppZiBXb3JsZDIgdGhlbgpCbG9nOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJUZWxlcG9ydCBUbyBMYWIiLAogICAgRGVzY3JpcHRpb24gPSAiIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTY0MzguNzM1MzUsIDI1MC42NDUzNTUsIC00NTAxLjUwNjg0KSkKICAgIGVuZAp9KQplbmQKaWYgV29ybGQzIHRoZW4KQmxvZzpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiVGVsZXBvcnQgVG8gTGFiIiwKICAgIERlc2NyaXB0aW9uID0gIiIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC01MDE3LjQwODY5LCAzMTQuODQ0MDU1LCAtMjgyMy4wMTI3LCAtMC45MjU3NDM4MTgsIDQuNDgyMTc0OTllLTA4LCAtMC4zNzgxNTEyMzgsIDQuNTU1MDMxNDZlLTA5LCAxLCAxLjA3Mzc3NTU5ZS0wNywgMC4zNzgxNTEyMzgsIDkuNzY4MTYyMWUtMDgsIC0wLjkyNTc0MzgxOCkpCiAgICBlbmQKfSkKZW5kClNlYSA9IFdpbmRvdzpBZGRUYWIoeyBUaXRsZSA9ICJUYWIgU2VhIEV2ZW50IiwgSWNvbiA9ICIiIH0pClNldFNwZWVkQm9hdFNsaWRlciA9IFNlYTpBZGRTbGlkZXIoIlNsaWRlclNwZWVkQm9hdCIsIHsKCVRpdGxlID0gIlNoaXAgU3BlZWQiLAoJRGVmYXVsdCA9IDMwMCwKCU1pbiA9IDAsCglNYXggPSAxMDAwLAoJUm91bmRpbmcgPSAxLAoJQ2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgIFNldFNwZWVkQm9hdCA9IHZhbHVlCgllbmQKfSkKU2V0U3BlZWRCb2F0U2xpZGVyOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKCVNldFNwZWVkQm9hdCA9IHZhbHVlCmVuZCkKU2V0U3BlZWRCb2F0U2xpZGVyOlNldFZhbHVlKDMwMCkgICAgCkxpc3RTZWFab25lID0gewogICJab25lIDEiLAogICJab25lIDIiLAogICJab25lIDMiLAogICJab25lIDQiLAogICJab25lIDUiLAogICJab25lIDYiCn0Kem9uZXNlbGVjdCA9IFNlYTpBZGREcm9wZG93bigiem9uZXNlbGVjdCIsIHsKCVRpdGxlID0gIlNlbGVjdCBab25lIiwKCVZhbHVlcyA9IExpc3RTZWFab25lLAoJTXVsdGkgPSBmYWxzZSwKCURlZmF1bHQgPSBmYWxzZSwKfSkKem9uZXNlbGVjdDpPbkNoYW5nZWQoZnVuY3Rpb24odmFsdWUpCglnZXRnZW52KCkuU2VsZWN0ZWRab25lID0gdmFsdWUKZW5kKQpMaXN0U2VhQm9hdCA9IHsKICAiR3VhcmRpYW4iLAogICJQaXJhdGVHcmFuZEJyaWdhZGUiLAogICJNYXJpbmVHcmFuZEJyaWdhZGUiLAogICJQaXJhdGVCcmlnYWRlIiwKICAiTWFyaW5lQnJpZ2FkZSIsCiAgIlBpcmF0ZVNsb29wIiwKICAiTWFyaW5lU2xvb3AiLAogICJCZWFzdEh1bnRlciIsCn0Kc2VsZWN0dGh1eWVuID0gU2VhOkFkZERyb3Bkb3duKCJzZWxlY3R0aHV5ZW4iLCB7CglUaXRsZSA9ICJTZWxlY3QgQm9hdCIsCglWYWx1ZXMgPSBMaXN0U2VhQm9hdCwKCU11bHRpID0gZmFsc2UsCglEZWZhdWx0ID0gZmFsc2UsCn0pCnNlbGVjdHRodXllbjpPbkNoYW5nZWQoZnVuY3Rpb24odmFsdWUpCglnZXRnZW52KCkuU2VsZWN0ZWRCb2F0ID0gdmFsdWUKZW5kKQpib2F0dHdlZW4gPSBTZWE6QWRkRHJvcGRvd24oImJvYXR0d2VlbiIsIHsKICAgIFRpdGxlID0gIlNwZWVkIFR3ZWVuIEJvYXQiLAogICAgVmFsdWVzID0geyIxODAiLCAiMjAwIiwgIjI1MCIsICIzMDAiLCAiMzI1IiwgIjM1MCJ9LAogICAgTXVsdGkgPSBmYWxzZSwKICAgIERlZmF1bHQgPSAzMDAsCn0pCmJvYXR0d2VlbjpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuU3BlZWRCb2F0ID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5TZWxlY3RlZFpvbmUgPT0gIlpvbmUgMSIgdGhlbgogICAgICAgICAgICAgICAgQ0ZyYW1lU2VsZWN0ZWRab25lID0gQ0ZyYW1lLm5ldygKICAgICAgICAgICAgICAgICAgICAtMjE5OTguMzc1LCAzMC4wMDA2MDg0LCAtNjgyLjMwOTE0MywKICAgICAgICAgICAgICAgICAgICAwLjEyMDAxMzUyOCwgMC4wMDY5MDE1ODczNiwgMC45OTI3NDgyNiwKICAgICAgICAgICAgICAgICAgICAtMC4wNTc0MTE4OTQyLCAwLjk5ODM1MDU2MSwgLTIuMzY1MDkyMDFlLTEwLAogICAgICAgICAgICAgICAgICAgIC0wLjk5MTExMDgwMiwgLTAuMDU2OTk1NTU1OCwgMC4xMjAyMTE4MDIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RlZFpvbmUgPT0gIlpvbmUgMiIgdGhlbgogICAgICAgICAgICAgICAgQ0ZyYW1lU2VsZWN0ZWRab25lID0gQ0ZyYW1lLm5ldygKICAgICAgICAgICAgICAgICAgICAtMjY3NzkuNTIxNSwgMzAuMDAwNTQ3NCwgLTgyMi44NTgwMzIsCiAgICAgICAgICAgICAgICAgICAgMC4zMDc0NTc0MTcsIDAuMDE5NjQ3MzU4LCAwLjk1MTM1ODk3NCwKICAgICAgICAgICAgICAgICAgICAtMC4wNjM3NzI2MjYyLCAwLjk5Nzk2NDQ0MiwgLTQuMTUzMzQwMTdlLTEwLAogICAgICAgICAgICAgICAgICAgIC0wLjk0OTQyMjQ3OSwgLTAuMDYwNjcwNjU4OSwgMC4zMDgwODQ1MTgKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxzZWlmIGdldGdlbnYoKS5TZWxlY3RlZFpvbmUgPT0gIlpvbmUgMyIgdGhlbgogICAgICAgICAgICAgICAgQ0ZyYW1lU2VsZWN0ZWRab25lID0gQ0ZyYW1lLm5ldygKICAgICAgICAgICAgICAgICAgICAtMzExNzEuOTU3LCAzMC4wMDAxMDExLCAtMjI1Ni45Mzc3NCwKICAgICAgICAgICAgICAgICAgICAwLjM3NjM3NDkzLCAwLjAxNTA0ODM3OTEsIDAuOTI2MzQ1MjI5LAogICAgICAgICAgICAgICAgICAgIC0wLjAzOTk1MDQ5NzQsIDAuOTk5MjAxNjU1LCAyLjcwODk2NjczZS0xMSwKICAgICAgICAgICAgICAgICAgICAtMC45MjU2MDU2NTUsIC0wLjAzNzAwNzk1MDIsIDAuMzc2Njc1NjM2CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0ZWRab25lID09ICJab25lIDQiIHRoZW4KICAgICAgICAgICAgICAgIENGcmFtZVNlbGVjdGVkWm9uZSA9IENGcmFtZS5uZXcoCiAgICAgICAgICAgICAgICAgICAgLTM0MDU0LjY4NzUsIDMwLjIxODc3NjcsIC0yNTYwLjEyMDEyLAogICAgICAgICAgICAgICAgICAgIDAuMDkzNTg2NDc0NywgLTAuMDAxMjI5NTQyMTksIDAuOTk1NjEwNDE2LAogICAgICAgICAgICAgICAgICAgIDAuMDYyNDAzNDA2OSwgMC45OTgwNDAyNTksIC0wLjAwNDYzMzMyMDk2LAogICAgICAgICAgICAgICAgICAgIC0wLjk5MzY1MzUzNiwgMC4wNjI1NjMwOTksIDAuMDkzNDc5Nzk3MgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlNlbGVjdGVkWm9uZSA9PSAiWm9uZSA1IiB0aGVuCiAgICAgICAgICAgICAgICBDRnJhbWVTZWxlY3RlZFpvbmUgPSBDRnJhbWUubmV3KAogICAgICAgICAgICAgICAgICAgIC0zODg4Ny41NTQ3LCAzMC4wMDA0NTc4LCAtMjE2Mi45OTAyMywKICAgICAgICAgICAgICAgICAgICAtMC4xODg4OTU0OTQsIC0wLjAwNzA0MDg4Mjk1LCAwLjk4MTk3MTk3OSwKICAgICAgICAgICAgICAgICAgICAtMC4wMzcyNDgxMDExLCAwLjk5OTMwNjAyMywgLTEuMzk4ODIzMzllLTA5LAogICAgICAgICAgICAgICAgICAgIC0wLjk4MTI5MDUxOSwgLTAuMDM2NTc2NTkxNCwgLTAuMTg5MDI2NjY5CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsc2VpZiBnZXRnZW52KCkuU2VsZWN0ZWRab25lID09ICJab25lIDYiIHRoZW4KICAgICAgICAgICAgICAgIENGcmFtZVNlbGVjdGVkWm9uZSA9IENGcmFtZS5uZXcoCiAgICAgICAgICAgICAgICAgICAgLTQ0NTQxLjc2MTcsIDMwLjAwMDMyMDQsIC0xMjQ0Ljg1ODQsCiAgICAgICAgICAgICAgICAgICAgLTAuMDg0NDE5OTA2MSwgLTAuMDA1NTMzMTI3NTgsIDAuOTk2NDE0OSwKICAgICAgICAgICAgICAgICAgICAtMC4wNjU0MDI1ODk3LCAwLjk5Nzg1ODk0MiwgMi4wMjMxOTQxMWUtMTAsCiAgICAgICAgICAgICAgICAgICAgLTAuOTk0MjgxNTMsIC0wLjA2NTE2ODExMjUsIC0wLjA4NDYwMTAzNzIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKVG9nZ2xlID0gU2VhOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gU2VhIEV2ZW50IixEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihzdGF0ZSkKICAgIGdldGdlbnYoKS5TYWlsQm9hdCA9IHN0YXRlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLlNhaWxCb2F0KQplbmQpCmZ1bmN0aW9uIENoZWNrQm9hdCgpCiAgICBsb2NhbCB3b3Jrc3BhY2UgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpCiAgICBsb2NhbCBib2F0cyA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiQm9hdHMiKQogICAgbG9jYWwgc2VsZWN0ZWRCb2F0ID0gZ2V0Z2VudigpLlNlbGVjdGVkQm9hdAogICAgaWYgbm90IChib2F0cyBhbmQgc2VsZWN0ZWRCb2F0KSB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKICAgIGZvciBfLCBib2F0IGluIHBhaXJzKGJvYXRzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgYm9hdC5OYW1lID09IHNlbGVjdGVkQm9hdCB0aGVuCiAgICAgICAgICAgIGlmIGJvYXQ6RmluZEZpcnN0Q2hpbGQoIk15Qm9hdEVzcCIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBib2F0CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gZmFsc2UKZW5kCmZ1bmN0aW9uIENoZWNrRW5lbWllc0JvYXQoKQogICAgbG9jYWwgZW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIik6RmluZEZpcnN0Q2hpbGQoIkVuZW1pZXMiKSAgICAKICAgIGlmIG5vdCBlbmVtaWVzIHRoZW4KICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgcmV0dXJuIGVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkZpc2hCb2F0IikgCiAgICAgICAgb3IgZW5lbWllczpGaW5kRmlyc3RDaGlsZCgiUGlyYXRlQnJpZ2FkZSIpIAogICAgICAgIG9yIGVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlBpcmF0ZUdyYW5kQnJpZ2FkZSIpIAogICAgICAgIGFuZCB0cnVlIG9yIGZhbHNlCmVuZApmdW5jdGlvbiBDaGVja1NoYXJrKCkKICAgIGxvY2FsIHdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikKICAgIGxvY2FsIGVuZW1pZXMgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkVuZW1pZXMiKQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXIKICAgIGxvY2FsIHJvb3RQYXJ0ID0gY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbm90IChlbmVtaWVzIGFuZCByb290UGFydCkgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICBmb3IgXywgdiBpbiBwYWlycyhlbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgbG9jYWwgZW5lbXlSb290ID0gdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgaWYgdi5OYW1lID09ICJTaGFyayIgYW5kIGh1bWFub2lkIGFuZCBlbmVteVJvb3QgYW5kIGh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICBpZiAoZW5lbXlSb290LlBvc2l0aW9uIC0gcm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAyMDAgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBmYWxzZQplbmQKZnVuY3Rpb24gQ2hlY2tQaXJhbmhhKCkKICAgIGxvY2FsIHdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikKICAgIGxvY2FsIGVuZW1pZXMgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkVuZW1pZXMiKQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXIKICAgIGxvY2FsIHJvb3RQYXJ0ID0gY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbm90IChlbmVtaWVzIGFuZCByb290UGFydCkgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICBmb3IgXywgdiBpbiBwYWlycyhlbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgbG9jYWwgZW5lbXlSb290ID0gdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgaWYgdi5OYW1lID09ICJQaXJhbmhhIiBhbmQgaHVtYW5vaWQgYW5kIGVuZW15Um9vdCBhbmQgaHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgIGlmIChlbmVteVJvb3QuUG9zaXRpb24gLSByb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDIwMCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZApmdW5jdGlvbiBBZGRFc3AoTmFtZSwgUGFyZW50KQogICAgaWYgbm90IFBhcmVudCBvciBub3QgUGFyZW50OklzQSgiSW5zdGFuY2UiKSB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIGxvY2FsIEJpbGxib2FyZEd1aSA9IEluc3RhbmNlLm5ldygiQmlsbGJvYXJkR3VpIikKICAgIGxvY2FsIFRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgIEJpbGxib2FyZEd1aS5OYW1lID0gTmFtZQogICAgQmlsbGJvYXJkR3VpLlBhcmVudCA9IFBhcmVudAogICAgQmlsbGJvYXJkR3VpLlpJbmRleEJlaGF2aW9yID0gRW51bS5aSW5kZXhCZWhhdmlvci5TaWJsaW5nCiAgICBCaWxsYm9hcmRHdWkuQWx3YXlzT25Ub3AgPSB0cnVlCiAgICBCaWxsYm9hcmRHdWkuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDAsIDAsIDUwKQogICAgQmlsbGJvYXJkR3VpLlN0dWRzT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwgMi41LCAwKQogICAgVGV4dExhYmVsLlBhcmVudCA9IEJpbGxib2FyZEd1aQogICAgVGV4dExhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAxLCAwKQogICAgVGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZAogICAgVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMubmV3KDEsIDEsIDEpCiAgICBUZXh0TGFiZWwuVGV4dFNpemUgPSAxNQogICAgVGV4dExhYmVsLlRleHQgPSAiWU9VUiBCT0FUIElTIEhFUkXihpMiCiAgICByZXR1cm4gQmlsbGJvYXJkR3VpCmVuZApzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KDAuMikgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5TYWlsQm9hdCB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgQ2hlY2tCb2F0KCkgdGhlbgogICAgICAgICAgICAgICAgICAgIEJ1eUJvYXRDRnJhbWUgPSBDRnJhbWUubmV3KC0xNjkyNy40NTExNzE4NzUsIDkuMDg2MzYxODg1MDcwOCwgNDMzLjg2NDI4ODMzMDA3ODEpICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoQnV5Qm9hdENGcmFtZS5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMTAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIEJUUChCdXlCb2F0Q0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgYnV5YiA9IHRvcG9zKEJ1eUJvYXRDRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgKENGcmFtZS5uZXcoLTE2OTI3LjQ1MTE3MTg3NSwgOS4wODYzNjE4ODUwNzA4LCA0MzMuODY0Mjg4MzMwMDc4MSkuUG9zaXRpb24gCiAgICAgICAgICAgICAgICAgICAgICAgIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTAgdGhlbiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBidXliIHRoZW4gYnV5YjpTdG9wKCkgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJ1eUJvYXQiLCBnZXRnZW52KCkuU2VsZWN0ZWRCb2F0KQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkJvYXRzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gZ2V0Z2VudigpLlNlbGVjdGVkQm9hdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuVmVoaWNsZVNlYXQuQ0ZyYW1lLlBvc2l0aW9uIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkRXNwKCdNeUJvYXRFc3AnLCB2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIENoZWNrQm9hdCgpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkJvYXRzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSBnZXRnZW52KCkuU2VsZWN0ZWRCb2F0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIk15Qm9hdEVzcCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKS5TaXQgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKENoZWNrU2hhcmsoKSBhbmQgZ2V0Z2VudigpLkF1dG9LaWxsU2hhcmspIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiVGVycm9yc2hhcmsiKSBhbmQgZ2V0Z2VudigpLkF1dG9UZXJyb3JzaGFyaykgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAoQ2hlY2tQaXJhbmhhKCkgYW5kIGdldGdlbnYoKS5BdXRvS2lsbFBpcmFuaGEpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRmlzaCBDcmV3IE1lbWJlciIpIGFuZCBnZXRnZW52KCkuQXV0b0tpbGxGaXNoQ3JldykgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJGaXNoQm9hdCIpIGFuZCBnZXRnZW52KCkuUmVsekZpc2hCb2F0KSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlBpcmF0ZUJyaWdhZGUiKSBhbmQgZ2V0Z2VudigpLlJlbHpQaXJhdGVCcmlnYWRlKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlBpcmF0ZUdyYW5kQnJpZ2FkZSIpIGFuZCBnZXRnZW52KCkuUmVselBpcmF0ZUdyYW5kQnJpZ2FkZSkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAoQ2hlY2tTZWFCZWFzdCgpIGFuZCBnZXRnZW52KCkuQXV0b1NlYUJlc3QpKSB0aGVuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RvcHBvcyB0aGVuIHN0b3Bwb3M6U3RvcCgpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wcG9zID0gdG9wb3Modi5WZWhpY2xlU2VhdC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDEsIDApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcGJvYXQgPSBUUEIoQ0ZyYW1lU2VsZWN0ZWRab25lLCB2LlZlaGljbGVTZWF0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCAoKENoZWNrU2hhcmsoKSBhbmQgZ2V0Z2VudigpLkF1dG9LaWxsU2hhcmspIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiVGVycm9yc2hhcmsiKSBhbmQgZ2V0Z2VudigpLkF1dG9UZXJyb3JzaGFyaykgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAoQ2hlY2tQaXJhbmhhKCkgYW5kIGdldGdlbnYoKS5BdXRvS2lsbFBpcmFuaGEpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRmlzaCBDcmV3IE1lbWJlciIpIGFuZCBnZXRnZW52KCkuQXV0b0tpbGxGaXNoQ3JldykgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJGaXNoQm9hdCIpIGFuZCBnZXRnZW52KCkuUmVsekZpc2hCb2F0KSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlBpcmF0ZUJyaWdhZGUiKSBhbmQgZ2V0Z2VudigpLlJlbHpQaXJhdGVCcmlnYWRlKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIChnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIlBpcmF0ZUdyYW5kQnJpZ2FkZSIpIGFuZCBnZXRnZW52KCkuUmVselBpcmF0ZUdyYW5kQnJpZ2FkZSkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAoQ2hlY2tTZWFCZWFzdCgpIGFuZCBnZXRnZW52KCkuQXV0b1NlYUJlc3QpKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpLlNpdCA9PSBmYWxzZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGdldGdlbnYoKS5TYWlsQm9hdCA9PSBmYWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzdG9wYm9hdCB0aGVuIHN0b3Bib2F0OlN0b3AoKSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsIDMyLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudChmYWxzZSwgMzIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC4yKSBkbwogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLlNhaWxCb2F0IHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgIGxvY2FsIGVuZW1pZXMgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXMKICAgICAgICAgICAgbG9jYWwgaGFzRW5lbXkgPSBmYWxzZQogICAgICAgICAgICBpZiAoQ2hlY2tTaGFyaygpIGFuZCBnZXRnZW52KCkuQXV0b0tpbGxTaGFyaykgb3IgCiAgICAgICAgICAgICAgIChlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJUZXJyb3JzaGFyayIpIGFuZCBnZXRnZW52KCkuQXV0b1RlcnJvcnNoYXJrKSBvciAKICAgICAgICAgICAgICAgKENoZWNrUGlyYW5oYSgpIGFuZCBnZXRnZW52KCkuQXV0b0tpbGxQaXJhbmhhKSBvciAKICAgICAgICAgICAgICAgKGVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkZpc2ggQ3JldyBNZW1iZXIiKSBhbmQgZ2V0Z2VudigpLkF1dG9LaWxsRmlzaENyZXcpIG9yIAogICAgICAgICAgICAgICAoZW5lbWllczpGaW5kRmlyc3RDaGlsZCgiRmlzaEJvYXQiKSBhbmQgZ2V0Z2VudigpLlJlbHpGaXNoQm9hdCkgb3IgCiAgICAgICAgICAgICAgIChlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJQaXJhdGVCcmlnYWRlIikgYW5kIGdldGdlbnYoKS5SZWx6UGlyYXRlQnJpZ2FkZSkgb3IgCiAgICAgICAgICAgICAgIChlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJQaXJhdGVHcmFuZEJyaWdhZGUiKSBhbmQgZ2V0Z2VudigpLlJlbHpQaXJhdGVHcmFuZEJyaWdhZGUpIG9yIAogICAgICAgICAgICAgICAoQ2hlY2tTZWFCZWFzdCgpIGFuZCBnZXRnZW52KCkuQXV0b1NlYUJlc3QpIHRoZW4KICAgICAgICAgICAgICAgIGhhc0VuZW15ID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgaGFzRW5lbXkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICBpZiBodW1hbm9pZCBhbmQgaHVtYW5vaWQuU2l0IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCB2aW0gPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKQogICAgICAgICAgICAgICAgICAgIHZpbTpTZW5kS2V5RXZlbnQodHJ1ZSwgMzIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgdmltOlNlbmRLZXlFdmVudChmYWxzZSwgMzIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLlNhaWxCb2F0IHRoZW4gcmV0dXJuIGVuZCAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBlbmVtaWVzID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9LaWxsRmlzaENyZXcgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIGVuZW15IGluIHBhaXJzKGVuZW1pZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgZW5lbXkuTmFtZSA9PSAiRmlzaCBDcmV3IE1lbWJlciIgYW5kIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCBlbmVteS5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnRCcmluZyA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllclBvcyA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW5lbXlQb3MgPSBlbmVteS5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5lbXlQb3MgLSBwbGF5ZXJQb3MpLk1hZ25pdHVkZSA+IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU2VhU2tpbGwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9LaWxsRmlzaENyZXcgb3Igbm90IGVuZW15LlBhcmVudCBvciBlbmVteS5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICBTdGFydEJyaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlJlbHpGaXNoQm9hdCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgZW5lbXkgaW4gcGFpcnMoZW5lbWllcykgZG8KICAgICAgICAgICAgICAgICAgICBpZiBlbmVteTpGaW5kRmlyc3RDaGlsZCgiRW5naW5lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBib2F0Q0ZyYW1lID0gZW5lbXkuRW5naW5lLkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3MgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9hdENGcmFtZS5Qb3NpdGlvbiAtIHBsYXllclBvcykuTWFnbml0dWRlID4gNSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoYm9hdENGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlYVNraWxsID0gKGJvYXRDRnJhbWUuUG9zaXRpb24gLSBwbGF5ZXJQb3MpLk1hZ25pdHVkZSA8PSA1MAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBaW1Cb3RTa2lsbFBvc2l0aW9uID0gYm9hdENGcmFtZS5Qb3NpdGlvbiArIFZlY3RvcjMubmV3KDAsIC0xNSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGVuZW15LlBhcmVudCBvciBlbmVteS5IZWFsdGggPCAwIG9yIG5vdCBnZXRnZW52KCkuUmVsekZpc2hCb2F0CiAgICAgICAgICAgICAgICAgICAgICAgIFNraWxsYWltYm90ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlYVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5TYWlsQm9hdCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgbG9jYWwgZW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpHZXRDaGlsZHJlbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvS2lsbEZpc2hDcmV3IHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCBlbmVteSBpbiBwYWlycyhlbmVtaWVzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIGVuZW15Lk5hbWUgPT0gIkZpc2ggQ3JldyBNZW1iZXIiIGFuZCBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgZW5lbXkuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5TdGFydE1hZ25ldCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlYVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvS2lsbEZpc2hDcmV3IG9yIG5vdCBlbmVteS5QYXJlbnQgb3IgZW5lbXkuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlN0YXJ0TWFnbmV0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlaWYgZ2V0Z2VudigpLlJlbHpGaXNoQm9hdCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgZW5lbXkgaW4gcGFpcnMoZW5lbWllcykgZG8KICAgICAgICAgICAgICAgICAgICBpZiBlbmVteTpGaW5kRmlyc3RDaGlsZCgiRW5naW5lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBib2F0Q0ZyYW1lID0gZW5lbXkuRW5naW5lLkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3MgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5TZWFTa2lsbCA9IChib2F0Q0ZyYW1lLlBvc2l0aW9uIC0gcGxheWVyUG9zKS5NYWduaXR1ZGUgPD0gNTAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9hdENGcmFtZS5Qb3NpdGlvbiAtIHBsYXllclBvcykuTWFnbml0dWRlID4gNSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoYm9hdENGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBaW1Cb3RTa2lsbFBvc2l0aW9uID0gYm9hdENGcmFtZS5Qb3NpdGlvbiArIFZlY3RvcjMubmV3KDAsIC0xNSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGVuZW15LlBhcmVudCBvciBlbmVteS5IZWFsdGggPCAwIG9yIG5vdCBnZXRnZW52KCkuUmVsekZpc2hCb2F0CiAgICAgICAgICAgICAgICAgICAgICAgIFNraWxsYWltYm90ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlYVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTZWE6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBTaGFyayIsRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24odmFsdWUpCiAgIGdldGdlbnYoKS5BdXRvS2lsbFNoYXJrID0gdmFsdWUKICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvS2lsbFNoYXJrKQplbmQpClRvZ2dsZSA9IFNlYTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFBpcmFuaGEiLERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9LaWxsUGlyYW5oYSA9IHZhbHVlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLkF1dG9LaWxsUGlyYW5oYSkKZW5kKQpUb2dnbGUgPSBTZWE6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBGaXNoIENyZXciLERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9LaWxsRmlzaENyZXcgPSB2YWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvS2lsbEZpc2hDcmV3KQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgbG9jYWwgY2hhciA9IHBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICBsb2NhbCByb290ID0gY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgIGlmIG5vdCByb290IHRoZW4gcmV0dXJuIGVuZCAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBlbmVtaWVzID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9LaWxsU2hhcmsgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhlbmVtaWVzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiU2hhcmsiIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSByb290LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsIDUwLCA1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3Modi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIFBvcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b0tpbGxTaGFyayBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9LaWxsUGlyYW5oYSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGVuZW1pZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJQaXJhbmhhIiBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gcm9vdC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDUwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLCA1MCwgNTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9LaWxsUGlyYW5oYSBvciBub3Qgdi5QYXJlbnQgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9LaWxsRmlzaENyZXcgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhlbmVtaWVzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiRmlzaCBDcmV3IE1lbWJlciIgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIHJvb3QuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSA1MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg1MCwgNTAsIDUwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vbkZhcm0gPSB2Lk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NNb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9LaWxsRmlzaENyZXcgb3Igbm90IHYuUGFyZW50IG9yIHYuSHVtYW5vaWQuSGVhbHRoIDw9IDAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvVGVycm9yc2hhcmsgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhlbmVtaWVzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiVGVycm9yc2hhcmsiIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNjAsIDYwLCA2MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXIuSHVtYW5vaWQuSGVhbHRoIDwgMjAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFzdHBvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAzMDAsIDApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDU1LCAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVycm9yU2hhcmtwb3MgPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b1RlcnJvcnNoYXJrIG9yIG5vdCB2LlBhcmVudCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvVGVycm9yc2hhcmsgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gcGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBsb2NhbCByb290ID0gY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBpZiBub3Qgcm9vdCB0aGVuIHJldHVybiBlbmQgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBzaGFyayA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiVGVycm9yc2hhcmsiKQogICAgICAgICAgICAgICAgaWYgc2hhcmsgYW5kIHNoYXJrOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIChzaGFyay5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gcm9vdC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDE1MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvVGVycm9yc2hhcmsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpmdW5jdGlvbiBVcERvd25Qb3MocG9zKQogICAgaWYgdHlwZW9mKHBvcykgfj0gIkNGcmFtZSIgdGhlbiByZXR1cm4gZW5kCiAgICBmYXN0cG9zKHBvcyAqIENGcmFtZS5uZXcoMCwgNDAsIDApKQogICAgdGFzay53YWl0KDEpCiAgICBmYXN0cG9zKHBvcyAqIENGcmFtZS5uZXcoMCwgMzAwLCAwKSkKICAgIHRhc2sud2FpdCgyKQplbmQKVG9nZ2xlID0gU2VhOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiQXV0byBHaG9zdCBTaGlwIiwKICAgIERlZmF1bHQgPSBmYWxzZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLlJlbHpGaXNoQm9hdCA9IHZhbHVlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLlJlbHpGaXNoQm9hdCkKICAgIGlmIG5vdCBnZXRnZW52KCkuUmVsekZpc2hCb2F0IHRoZW4KICAgICAgICBnZXRnZW52KCkuU2VhU2tpbGwgPSBmYWxzZQogICAgICAgIFNraWxsYWltYm90ID0gZmFsc2UKICAgIGVuZAplbmQpClRvZ2dsZSA9IFNlYTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIkF1dG8gUGlyYXRlIEJyaWdhZGUiLAogICAgRGVmYXVsdCA9IGZhbHNlCn0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24odmFsdWUpCiAgICBnZXRnZW52KCkuUmVselBpcmF0ZUJyaWdhZGUgPSB2YWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5SZWx6UGlyYXRlQnJpZ2FkZSkKZW5kKQpUb2dnbGUgPSBTZWE6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7CiAgICBUaXRsZSA9ICJBdXRvIFBpcmF0ZSBHcmFuZCBCcmlnYWRlIiwKICAgIERlZmF1bHQgPSBmYWxzZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLlJlbHpQaXJhdGVHcmFuZEJyaWdhZGUgPSB2YWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5SZWx6UGlyYXRlR3JhbmRCcmlnYWRlKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLlJlbHpGaXNoQm9hdCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkZpc2hCb2F0IiBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiRW5naW5lIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBDRnJhbWVGaXNoQm9hdCA9IHYuRW5naW5lLkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgMTAsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gcGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3QgPSBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdCBhbmQgKHYuRW5naW5lLlBvc2l0aW9uIC0gcm9vdC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5TZWFTa2lsbCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlYVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJvb3QgYW5kIChyb290LlBvc2l0aW9uIC0gQ0ZyYW1lRmlzaEJvYXQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lRmlzaEJvYXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBTa2lsbGFpbWJvdCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgQWltQm90U2tpbGxQb3NpdGlvbiA9IHYuRW5naW5lLlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgdW50aWwgCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdCB2LlBhcmVudCBvciB2LkhlYWx0aC5WYWx1ZSA8PSAwIG9yIAogICAgICAgICAgICAgICAgICAgICAgICBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJGaXNoQm9hdCIpIG9yIAogICAgICAgICAgICAgICAgICAgICAgICBub3QgdjpGaW5kRmlyc3RDaGlsZCgiRW5naW5lIikgb3IgCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdCBnZXRnZW52KCkuUmVsekZpc2hCb2F0CiAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5TZWFTa2lsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKICAgClRvZ2dsZSA9IFNlYTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIkF1dG8gVGVycm9yIFNoYXJrIiwKICAgIERlZmF1bHQgPSBmYWxzZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9UZXJyb3JzaGFyayA9IHZhbHVlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLkF1dG9UZXJyb3JzaGFyaykKZW5kKQpUb2dnbGUgPSBTZWE6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7CiAgICBUaXRsZSA9ICJBdXRvIFNlYSBCZWFzdCIsCiAgICBEZWZhdWx0ID0gZmFsc2UKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvU2VhQmVzdCA9IHZhbHVlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLkF1dG9TZWFCZXN0KQogICAgaWYgbm90IGdldGdlbnYoKS5BdXRvU2VhQmVzdCB0aGVuCiAgICAgICAgZ2V0Z2VudigpLlNlYVNraWxsID0gZmFsc2UKICAgICAgICBTa2lsbGFpbWJvdCA9IGZhbHNlCiAgICBlbmQKZW5kKQpmdW5jdGlvbiBDaGVja1NlYUJlYXN0KCkKICAgIGxvY2FsIHNlYUJlYXN0cyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIik6RmluZEZpcnN0Q2hpbGQoIlNlYUJlYXN0cyIpCiAgICBpZiBub3Qgc2VhQmVhc3RzIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgZm9yIF8sIGJlYXN0IGluIGlwYWlycyhzZWFCZWFzdHM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGJlYXN0OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSBiZWFzdDpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgaWYgaHVtYW5vaWQgYW5kIHJvb3RQYXJ0IGFuZCBodW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjUpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9TZWFCZXN0IHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgd29ya3NwYWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKQogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBpZiB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIlNlYUJlYXN0cyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2UuU2VhQmVhc3RzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENoZWNrU2VhQmVhc3QoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDRnJhbWVTZWFCZWFzdCA9IHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDQwMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ0ZyYW1lU2VhQmVhc3QuUG9zaXRpb24gLSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU2VhU2tpbGwgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU2VhU2tpbGwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNraWxsYWltYm90ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFpbUJvdFNraWxsUG9zaXRpb24gPSB2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lU2VhQmVhc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3QgZ2V0Z2VudigpLkF1dG9TZWFCZXN0IG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0Iikgb3IgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5IZWFsdGggPCAwIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCB2LlBhcmVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlYVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKbG9jYWwgZnVuY3Rpb24gVXNlU2tpbGwoa2V5LCBob2xkVGltZSkKICAgIGdhbWU6c2VydmljZSgnVmlydHVhbElucHV0TWFuYWdlcicpOlNlbmRLZXlFdmVudCh0cnVlLCBrZXksIGZhbHNlLCBnYW1lKQogICAgdGFzay53YWl0KGhvbGRUaW1lKQogICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KGZhbHNlLCBrZXksIGZhbHNlLCBnYW1lKQplbmQKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5TZWFTa2lsbCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGJhY2twYWNrID0gcGxheWVyLkJhY2twYWNrICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlVzZVNlYUZydWl0U2tpbGwgYW5kIG5vdCBEb25lU2tpbGxGcnVpdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoYmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIlRvb2wiKSBhbmQgdi5Ub29sVGlwID09ICJCbG94IEZydWl0IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEZydWl0WiB0aGVuIFVzZVNraWxsKCJaIiwgZ2V0Z2VudigpLlNlYUhvbGRTS2lsbFopIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEZydWl0WCB0aGVuIFVzZVNraWxsKCJYIiwgZ2V0Z2VudigpLlNlYUhvbGRTS2lsbFgpIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEZydWl0QyB0aGVuIFVzZVNraWxsKCJDIiwgZ2V0Z2VudigpLlNlYUhvbGRTS2lsbEMpIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEZydWl0ViB0aGVuIFVzZVNraWxsKCJWIiwgZ2V0Z2VudigpLlNlYUhvbGRTS2lsbFYpIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEZydWl0RiB0aGVuIFVzZVNraWxsKCJGIiwgZ2V0Z2VudigpLlNlYUhvbGRTS2lsbEYpIGVuZCAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgRG9uZVNraWxsRnJ1aXQgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuVXNlU2VhTWVsZWVTa2lsbCBhbmQgbm90IERvbmVTa2lsbE1lbGVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhiYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIGFuZCB2LlRvb2xUaXAgPT0gIk1lbGVlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbE1lbGVlWiB0aGVuIFVzZVNraWxsKCJaIiwgMCkgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlNraWxsTWVsZWVYIHRoZW4gVXNlU2tpbGwoIlgiLCAwKSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuU2tpbGxNZWxlZUMgdGhlbiBVc2VTa2lsbCgiQyIsIDApIGVuZCAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgRG9uZVNraWxsTWVsZWUgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuVXNlU2VhU3dvcmRTa2lsbCBhbmQgbm90IERvbmVTa2lsbFN3b3JkIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhiYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIGFuZCB2LlRvb2xUaXAgPT0gIlN3b3JkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbFN3b3JkWiB0aGVuIFVzZVNraWxsKCJaIiwgMCkgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlNraWxsU3dvcmRYIHRoZW4gVXNlU2tpbGwoIlgiLCAwKSBlbmQgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIERvbmVTa2lsbFN3b3JkID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlVzZVNlYUd1blNraWxsIGFuZCBub3QgRG9uZVNraWxsR3VuIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhiYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiVG9vbCIpIGFuZCB2LlRvb2xUaXAgPT0gIkd1biIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuU2tpbGxHdW5aIHRoZW4gVXNlU2tpbGwoIloiLCAwLjEpIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEd1blggdGhlbiBVc2VTa2lsbCgiWCIsIDAuMSkgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgRG9uZVNraWxsR3VuID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgICAgIERvbmVTa2lsbEd1biwgRG9uZVNraWxsU3dvcmQsIERvbmVTa2lsbEZydWl0LCBEb25lU2tpbGxNZWxlZSA9IGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpICAgICAgICAgClNlYTpBZGRQYXJhZ3JhcGgoewogICAgICAgIFRpdGxlID0gIktpdHN1bmUgRXZlbnQiLAogICAgICAgIENvbnRlbnQgPSBzdHJpbmcucmVwKCItIiwgMjEpCiAgICB9KSAgICAKVG9nZ2xlID0gU2VhOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIlRlbGVwb3J0IFRvIEtpdHN1bmUgSXNsYW5kIixEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5Ud2VlblRvS2l0c3VuZSA9IHZhbHVlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLlR3ZWVuVG9LaXRzdW5lKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5Ud2VlblRvS2l0c3VuZSB0aGVuCiAgICAgICAgICAgIGxvY2FsIG1hcCA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwCiAgICAgICAgICAgIGxvY2FsIGtpdHN1bmVJc2xhbmQgPSBtYXA6RmluZEZpcnN0Q2hpbGQoIktpdHN1bmVJc2xhbmQiKQogICAgICAgICAgICBpZiBraXRzdW5lSXNsYW5kIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHNocmluZVBhcnQgPSBraXRzdW5lSXNsYW5kLlNocmluZUFjdGl2ZS5OZW9uU2hyaW5lUGFydAogICAgICAgICAgICAgICAgdG9wb3Moc2hyaW5lUGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDAsIDEwKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBTZWE6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBTdW1tb24gU291bCBFbUJlciIsRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24odmFsdWUpCiAgICBnZXRnZW52KCkuU3VtbW9uS2l0c3VtZSA9IHZhbHVlICAgIAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjYpIGRvICAKICAgICAgICBpZiBnZXRnZW52KCkuU3VtbW9uS2l0c3VtZSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgcmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKICAgICAgICAgICAgICAgIGxvY2FsIG5ldCA9IHJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJNb2R1bGVzIikgYW5kIHJlcGxpY2F0ZWRTdG9yYWdlLk1vZHVsZXM6RmluZEZpcnN0Q2hpbGQoIk5ldCIpCiAgICAgICAgICAgICAgICBsb2NhbCBwcmF5RnVuY3Rpb24gPSBuZXQgYW5kIG5ldDpGaW5kRmlyc3RDaGlsZCgiUkYvS2l0c3VuZVN0YXR1ZVByYXkiKSAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHByYXlGdW5jdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHJheUZ1bmN0aW9uOkludm9rZVNlcnZlcigpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKVG9nZ2xlID0gU2VhOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gQ29sbGVjdCBBenVyZSBXaXNwIixEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5Db2xsZWN0QXp1cmUgPSB2YWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5Db2xsZWN0QXp1cmUpCmVuZCkKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQ29sbGVjdEF6dXJlIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgYXR0YWNoZWRBenVyZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIik6RmluZEZpcnN0Q2hpbGQoIkF0dGFjaGVkQXp1cmVFbWJlciIpCiAgICAgICAgICAgICAgICBsb2NhbCBlbWJlclRlbXBsYXRlID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKTpGaW5kRmlyc3RDaGlsZCgiRW1iZXJUZW1wbGF0ZSIpCiAgICAgICAgICAgICAgICBpZiBhdHRhY2hlZEF6dXJlIGFuZCBlbWJlclRlbXBsYXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwYXJ0ID0gZW1iZXJUZW1wbGF0ZTpGaW5kRmlyc3RDaGlsZCgiUGFydCIpCiAgICAgICAgICAgICAgICAgICAgaWYgcGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllclBvcyA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXRQb3MgPSBwYXJ0LlBvc2l0aW9uICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJQb3MgLSB0YXJnZXRQb3MpLk1hZ25pdHVkZSA+IDEwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhc3Rwb3MocGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClNsaWRlciA9IFNlYTpBZGRTbGlkZXIoIlNsaWRlciIsIHsKICAgICBUaXRsZSA9ICJTZXQgQXp1cmUgRW1iZXIiLAogICAgIERlZmF1bHQgPSAyMCwKICAgICBNaW4gPSAwLAogICAgIE1heCA9IDI1LAogICAgIFJvdW5kaW5nID0gNSwKICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICBnZXRnZW52KCkuU2V0VG9UcmFkZUF1cmVFbWJlciA9IHN0YXRlCiAgICBlbmQKfSkKVG9nZ2xlID0gU2VhOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiQXV0byBUcmFkZSBBenVyZSBFbWJlciIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uIChzdGF0ZSkKICAgICAgICBnZXRnZW52KCkuVHJhZGVBdXJlRW1iZXIgPSBzdGF0ZQogICAgZW5kCn0pCmZ1bmN0aW9uIEdldENvdW50TWF0ZXJpYWxzKE1hdGVyaWFsTmFtZSkKICAgIGxvY2FsIEludmVudG9yeSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoImdldEludmVudG9yeSIpCiAgICBmb3IgXywgdiBpbiBwYWlycyhJbnZlbnRvcnkpIGRvCiAgICAgICAgaWYgdi5OYW1lID09IE1hdGVyaWFsTmFtZSB0aGVuCiAgICAgICAgICAgIHJldHVybiB2WyJDb3VudCJdCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiAwCmVuZAp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgzKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5UcmFkZUF1cmVFbWJlciB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIEF6dXJlQXZhaWxhYmxlID0gR2V0Q291bnRNYXRlcmlhbHMoIkF6dXJlIEVtYmVyIikgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBBenVyZUF2YWlsYWJsZSA+PSBnZXRnZW52KCkuU2V0VG9UcmFkZUF1cmVFbWJlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLk1vZHVsZXMuTmV0OkZpbmRGaXJzdENoaWxkKCJSRi9LaXRzdW5lU3RhdHVlUHJheSIpOkludm9rZVNlcnZlcigpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiS2l0c3VuZVN0YXR1ZVByYXkiKSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKICAgICAgICAgICAKU2VhOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJUcmFkZSBBenVyZSBXaXNwIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKSAgICAgICAgICAgIAogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIk1vZHVsZXMiKTpXYWl0Rm9yQ2hpbGQoIk5ldCIpOldhaXRGb3JDaGlsZCgiUkYvS2l0c3VuZVN0YXR1ZVByYXkiKTpJbnZva2VTZXJ2ZXIoKQogICAgZW5kCn0pClNlYTpBZGRQYXJhZ3JhcGgoewogICAgICAgIFRpdGxlID0gIkxldmlhdGhhbiBFdmVudCIsCiAgICAgICAgQ29udGVudCA9IHN0cmluZy5yZXAoIi0iLCAyMSkKICAgIH0pClNlYTpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiQnV5IFNweSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJJbmZvTGV2aWF0aGFuIiwgIjIiKQogICAgZW5kCn0pICAgIApUb2dnbGUgPSBTZWE6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiVGVsZXBvcnQgVG8gRnJvemVuIERpbWVuc2lvbiIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9Gcm96ZW5EaW1lbnNpb24gPSBWYWx1ZQplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDEpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0Zyb3plbkRpbWVuc2lvbiBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGZyb3plbkRpbSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwOkZpbmRGaXJzdENoaWxkKCJGcm96ZW5EaW1lbnNpb24iKQogICAgICAgICAgICAgICAgaWYgZnJvemVuRGltIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXRQb3MgPSBmcm96ZW5EaW0uQ2VudGVyLlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyUG9zID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyUG9zIC0gVmVjdG9yMy5uZXcodGFyZ2V0UG9zLlgsIDUwMCwgdGFyZ2V0UG9zLlopKS5NYWduaXR1ZGUgPiAxMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcodGFyZ2V0UG9zLlgsIDUwMCwgdGFyZ2V0UG9zLlopKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpClRvZ2dsZSA9IFNlYTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIEF0dGFjayBMZXZpYXRoYW4iLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihzdGF0ZSkKICAgIGdldGdlbnYoKS5LaWxsTGV2aSA9IHN0YXRlCmVuZCkKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC41KSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5LaWxsTGV2aSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5TZWFCZWFzdHM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIkxldmlhdGhhbiIgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMikgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gdi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPiAxMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3Modi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgNTAwLCAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuU2VhU2tpbGwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5TZWFTa2lsbCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBJc0hha2lBY3RpdmUoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQWltQm90U2tpbGxQb3NpdGlvbiA9IHYuSHVtYW5vaWRSb290UGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSB0cnVlICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIG9yIG5vdCBnZXRnZW52KCkuS2lsbExldmkgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlYVNraWxsID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgU2tpbGxhaW1ib3QgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCkNob29zZVNraWxsID0gV2luZG93OkFkZFRhYih7IFRpdGxlID0gIlRhYiBTZXR0aW5nIFNlbGVjdCBTa2lsbCIsIEljb24gPSAiIiB9KQpDaG9vc2VTa2lsbDpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiU2V0dGluZyBTZWEgRXZlbnQiLAogICAgQ29udGVudCA9IHN0cmluZy5yZXAoIi0iLCAyMSkKfSkKQ2hvb3NlU2tpbGw6QWRkUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIkFjdGl2YXRpbmcgU2tpbGwgRXZlbnQsXG5BbmQgU2tpbGwgTGV2aWF0aGFuIEZsYXdsZXNzIEZ1c2lvbiIsCn0pClRvZ2dsZSA9IENob29zZVNraWxsOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiU2VsZWN0IFVzZSBGcnVpdCIsCiAgICBEZWZhdWx0ID0gdHJ1ZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLlVzZVNlYUZydWl0U2tpbGwgPSB2YWx1ZQplbmQpClRvZ2dsZSA9IENob29zZVNraWxsOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiU2VsZWN0IFVzZSBNZWxlZSIsCiAgICBEZWZhdWx0ID0gdHJ1ZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLlVzZVNlYU1lbGVlU2tpbGwgPSB2YWx1ZQplbmQpClRvZ2dsZSA9IENob29zZVNraWxsOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiU2VsZWN0IFVzZSBTd29yZCIsCiAgICBEZWZhdWx0ID0gdHJ1ZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLlVzZVNlYVN3b3JkU2tpbGwgPSB2YWx1ZQplbmQpClRvZ2dsZSA9IENob29zZVNraWxsOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiU2VsZWN0IFVzZSBHdW4iLAogICAgRGVmYXVsdCA9IHRydWUKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5Vc2VTZWFHdW5Ta2lsbCA9IHZhbHVlCmVuZCkKQ2hvb3NlU2tpbGw6QWRkUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIkFjdGl2YXRlIFdlYXBvbiBGYXJtIEV2ZW50LFxuQ2xpY2sgdG8gQWN0aXZhdGUiLAp9KQpDaG9vc2VTa2lsbDpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiU2V0dGluZyBTa2lsbCBGcnVpdCIsCiAgICBDb250ZW50ID0gc3RyaW5nLnJlcCgiLSIsIDIxKQp9KQpUb2dnbGUgPSBDaG9vc2VTa2lsbDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIlNraWxsIEZydWl0IFoiLAogICAgRGVmYXVsdCA9IHRydWUKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5Ta2lsbEZydWl0WiA9IHZhbHVlCmVuZCkKVG9nZ2xlID0gQ2hvb3NlU2tpbGw6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7CiAgICBUaXRsZSA9ICJTa2lsbCBGcnVpdCBYIiwKICAgIERlZmF1bHQgPSB0cnVlCn0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24odmFsdWUpCiAgICBnZXRnZW52KCkuU2tpbGxGcnVpdFggPSB2YWx1ZQplbmQpClRvZ2dsZSA9IENob29zZVNraWxsOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiU2tpbGwgRnJ1aXQgQyIsCiAgICBEZWZhdWx0ID0gdHJ1ZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLlNraWxsRnJ1aXRDID0gdmFsdWUKZW5kKQpUb2dnbGUgPSBDaG9vc2VTa2lsbDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIlNraWxsIEZydWl0IFYiLAogICAgRGVmYXVsdCA9IGZhbHNlCn0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24odmFsdWUpCiAgICBnZXRnZW52KCkuU2tpbGxGcnVpdFYgPSB2YWx1ZQplbmQpClRvZ2dsZSA9IENob29zZVNraWxsOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiU2tpbGwgRnJ1aXQgRiIsCiAgICBEZWZhdWx0ID0gZmFsc2UKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5Ta2lsbEZydWl0RiA9IHZhbHVlCmVuZCkKQ2hvb3NlU2tpbGw6QWRkUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIlVzZSBUbyBFbmFibGUgU2tpbGwgRnJ1aXQsXG5QbGVhc2UgU2VsZWN0IENvcnJlY3QiLAp9KQpDaG9vc2VTa2lsbDpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiU2V0dGluZyBTa2lsbCBNZWxlZSIsCiAgICBDb250ZW50ID0gc3RyaW5nLnJlcCgiLSIsIDIxKQp9KQpUb2dnbGUgPSBDaG9vc2VTa2lsbDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIlNraWxsIE1lbGVlIFoiLAogICAgRGVmYXVsdCA9IHRydWUKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5Ta2lsbE1lbGVlWiA9IHZhbHVlCmVuZCkKVG9nZ2xlID0gQ2hvb3NlU2tpbGw6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7CiAgICBUaXRsZSA9ICJTa2lsbCBNZWxlZSBYIiwKICAgIERlZmF1bHQgPSB0cnVlCn0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24odmFsdWUpCiAgICBnZXRnZW52KCkuU2tpbGxNZWxlZVggPSB2YWx1ZQplbmQpClRvZ2dsZSA9IENob29zZVNraWxsOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiU2tpbGwgTWVsZWUgQyIsCiAgICBEZWZhdWx0ID0gdHJ1ZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLlNraWxsTWVsZWVDID0gdmFsdWUKZW5kKQpDaG9vc2VTa2lsbDpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiVXNlIFRvIEVuYWJsZSBTa2lsbCBNZWxlZSxcblBsZWFzZSBTZWxlY3QgQ29ycmVjdCIsCn0pCkNob29zZVNraWxsOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJTZXR0aW5nIFNraWxsIFN3b3JkIEFuZCBHdW4iLAogICAgQ29udGVudCA9IHN0cmluZy5yZXAoIi0iLCAyMSkKfSkKVG9nZ2xlID0gQ2hvb3NlU2tpbGw6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7CiAgICBUaXRsZSA9ICJTd29yZCBBbmQgR3VuIFNraWxsIFoiLAogICAgRGVmYXVsdCA9IHRydWUKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5Ta2lsbFN3b3JkWiA9IHZhbHVlCiAgICBnZXRnZW52KCkuU2tpbGxHdW5aID0gdmFsdWUKZW5kKSAKVG9nZ2xlID0gQ2hvb3NlU2tpbGw6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7CiAgICBUaXRsZSA9ICJTd29yZCBBbmQgR3VuIFNraWxsIFgiLAogICAgRGVmYXVsdCA9IHRydWUKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2YWx1ZSkKICAgIGdldGdlbnYoKS5Ta2lsbFN3b3JkWCA9IHZhbHVlCiAgICBnZXRnZW52KCkuU2tpbGxHdW5YID0gdmFsdWUKZW5kKQpDaG9vc2VTa2lsbDpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiVXNlIFRvIEVuYWJsZSBTa2lsbCBTd29yZCBhbmQgR3VuLFxuUGxlYXNlIFNlbGVjdCBDb3JyZWN0IiwKfSkKbG9jYWwgZ2cgPSBnZXRyYXdtZXRhdGFibGUoZ2FtZSkKbG9jYWwgb2xkID0gZ2cuX19uYW1lY2FsbApzZXRyZWFkb25seShnZywgZmFsc2UpCmdnLl9fbmFtZWNhbGwgPSBuZXdjY2xvc3VyZShmdW5jdGlvbiguLi4pCiAgICBsb2NhbCBtZXRob2QgPSBnZXRuYW1lY2FsbG1ldGhvZCgpCiAgICBsb2NhbCBhcmdzID0gey4uLn0gICAgCiAgICBpZiB0b3N0cmluZyhtZXRob2QpID09ICJGaXJlU2VydmVyIiB0aGVuCiAgICAgICAgaWYgdG9zdHJpbmcoYXJnc1sxXSkgPT0gIlJlbW90ZUV2ZW50IiB0aGVuCiAgICAgICAgICAgIGlmIHRvc3RyaW5nKGFyZ3NbMl0pIH49ICJ0cnVlIiBhbmQgdG9zdHJpbmcoYXJnc1syXSkgfj0gImZhbHNlIiB0aGVuCiAgICAgICAgICAgICAgICBpZiBTa2lsbGFpbWJvdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgYXJnc1syXSA9IEFpbUJvdFNraWxsUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2xkKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIG9sZCguLi4pCmVuZCkKbG9jYWwgZnVuY3Rpb24gdXNlU2tpbGwoc2tpbGxLZXksIGhvbGRUaW1lKQogICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KHRydWUsIHNraWxsS2V5LCBmYWxzZSwgZ2FtZSkKICAgIHdhaXQoaG9sZFRpbWUgb3IgMC4xKQogICAgZ2FtZTpzZXJ2aWNlKCdWaXJ0dWFsSW5wdXRNYW5hZ2VyJyk6U2VuZEtleUV2ZW50KGZhbHNlLCBza2lsbEtleSwgZmFsc2UsIGdhbWUpCmVuZAp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjUpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBVc2VTa2lsbCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gTW9uRmFybSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIAogICAgICAgICAgICAgICAgICAgIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA8PSB2Lkh1bWFub2lkLk1heEhlYWx0aCAqIGdldGdlbnYoKS5LaWxsX0F0IC8gMTAwIHRoZW4gICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlNraWxsWiB0aGVuIHVzZVNraWxsKCJaIiwgZ2V0Z2VudigpLkhvbGRTS2lsbFopIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuU2tpbGxYIHRoZW4gdXNlU2tpbGwoIlgiLCBnZXRnZW52KCkuSG9sZFNLaWxsWCkgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Ta2lsbEMgdGhlbiB1c2VTa2lsbCgiQyIsIGdldGdlbnYoKS5Ib2xkU0tpbGxDKSBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjUpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBVc2VHdW5Ta2lsbCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gTW9uRmFybSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIAogICAgICAgICAgICAgICAgICAgIGFuZCB2Lkh1bWFub2lkLkhlYWx0aCA8PSB2Lkh1bWFub2lkLk1heEhlYWx0aCAqIGdldGdlbnYoKS5LaWxsX0F0IC8gMTAwIHRoZW4gICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlNraWxsWiB0aGVuIHVzZVNraWxsKCJaIiwgMC4xKSBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpWb2xjYW5pYyA9IFdpbmRvdzpBZGRUYWIoeyBUaXRsZSA9ICJUYWIgVm9sY2FuaWMgRXZlbnQiLCBJY29uID0gIiIgfSkKVm9sY2FuaWM6QWRkQnV0dG9uKHsKCVRpdGxlID0gIkRlc3Ryb3kgTGF2YSBJbiBQcmVoaXN0b3JpYyBJc2xhbmQiLAoJQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZTpHZXREZXNjZW5kYW50cygpKSBkbwoJCQlpZiB2Lk5hbWUgPT0gIkxhdmEiIHRoZW4gICAKCQkJCXY6RGVzdHJveSgpCgkJCWVuZAoJCWVuZAoJCWZvciBpLHYgaW4gcGFpcnMoZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpHZXREZXNjZW5kYW50cygpKSBkbwoJCQlpZiB2Lk5hbWUgPT0gIkxhdmEiIHRoZW4gICAKCQkJCXY6RGVzdHJveSgpCgkJCWVuZAoJCWVuZAoJZW5kCn0pClZvbGNhbmljOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJDcmFmdGluZyBWb2xjYW5pYyBNYWduZXQiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgdjM5NSA9IHsKICAgICAgICAgICAgWzFdID0gIkNyYWZ0SXRlbSIsCiAgICAgICAgICAgIFsyXSA9ICJDcmFmdCIsCiAgICAgICAgICAgIFszXSA9ICJWb2xjYW5pYyBNYWduZXQiCiAgICAgICAgfQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKHYzOTUpKQogICAgZW5kCn0pClRvZ2dsZSA9IFZvbGNhbmljOkFkZFRvZ2dsZSgiTXlUb2dnbGUiLCB7VGl0bGUgPSAiVGVsZXBvcnQgUHJlaGlzdG9yaWMgSXNsYW5kIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuVHdlZW5QcmVoaXN0b3JpYyA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgaXNsYW5kCiAgICB3aGlsZSBub3QgaXNsYW5kIGRvCiAgICAgICAgaXNsYW5kID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXA6RmluZEZpcnN0Q2hpbGQoIlByZWhpc3RvcmljSXNsYW5kIikKICAgICAgICB3YWl0KCkKICAgIGVuZAogICAgd2hpbGUgd2FpdCgpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLlR3ZWVuUHJlaGlzdG9yaWMgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgIGxvY2FsIHByZWhpc3RvcmljSXNsYW5kQ29yZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwOkZpbmRGaXJzdENoaWxkKCJQcmVoaXN0b3JpY0lzbGFuZCIpCiAgICAgICAgICAgIGlmIHByZWhpc3RvcmljSXNsYW5kQ29yZSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCByZWxpYyA9IHByZWhpc3RvcmljSXNsYW5kQ29yZTpGaW5kRmlyc3RDaGlsZCgiQ29yZSIpIGFuZCBwcmVoaXN0b3JpY0lzbGFuZENvcmUuQ29yZTpGaW5kRmlyc3RDaGlsZCgiUHJlaGlzdG9yaWNSZWxpYyIpCiAgICAgICAgICAgICAgICBsb2NhbCBza3VsbCA9IHJlbGljIGFuZCByZWxpYzpGaW5kRmlyc3RDaGlsZCgiU2t1bGwiKQogICAgICAgICAgICAgICAgaWYgc2t1bGwgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoc2t1bGwuUG9zaXRpb24pKQogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5Ud2VlblByZWhpc3RvcmljID0gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IFZvbGNhbmljOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiQXV0byBFdmVudCBWb2xjYW5vIElzbGFuZCBEZWZlbnNlIiwKICAgIERlZmF1bHQgPSBmYWxzZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9EZWZlbmRWb2xjYW5vID0gdmFsdWUKZW5kKQpsb2NhbCBmdW5jdGlvbiBwcmVzc0tleShrZXkpCiAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwga2V5LCBmYWxzZSwgZ2FtZSkKICAgIHdhaXQoMC4xKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KGZhbHNlLCBrZXksIGZhbHNlLCBnYW1lKQplbmQKbG9jYWwgZnVuY3Rpb24gcmVtb3ZlTGF2YSgpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgbGF2YU1vZGVsID0gZ2FtZS5Xb3Jrc3BhY2UuTWFwLlByZWhpc3RvcmljSXNsYW5kLkNvcmU6RmluZEZpcnN0Q2hpbGQoIkludGVyaW9yTGF2YSIpCiAgICAgICAgaWYgbGF2YU1vZGVsIGFuZCBsYXZhTW9kZWw6SXNBKCJNb2RlbCIpIHRoZW4KICAgICAgICAgICAgbGF2YU1vZGVsOkRlc3Ryb3koKQogICAgICAgIGVuZAogICAgICAgIGxvY2FsIHByZWhpc3RvcmljSXNsYW5kID0gZ2FtZS5Xb3Jrc3BhY2UuTWFwOkZpbmRGaXJzdENoaWxkKCJQcmVoaXN0b3JpY0lzbGFuZCIpCiAgICAgICAgaWYgcHJlaGlzdG9yaWNJc2xhbmQgdGhlbgogICAgICAgICAgICBmb3IgXywgb2JqIGluIHBhaXJzKHByZWhpc3RvcmljSXNsYW5kOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiBvYmo6SXNBKCJQYXJ0IikgYW5kIG9iai5OYW1lOmxvd2VyKCk6ZmluZCgibGF2YSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBvYmo6RGVzdHJveSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIG9iajpJc0EoIk1lc2hQYXJ0IikgYW5kIG9iai5OYW1lOmxvd2VyKCk6ZmluZCgibGF2YSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBvYmo6RGVzdHJveSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZApsb2NhbCBmdW5jdGlvbiBmaW5kVm9sY2Fub1JvY2soKQogICAgbG9jYWwgdm9sY2Fub1JvY2tzID0gZ2FtZS5Xb3Jrc3BhY2UuTWFwLlByZWhpc3RvcmljSXNsYW5kLkNvcmU6RmluZEZpcnN0Q2hpbGQoIlZvbGNhbm9Sb2NrcyIpCiAgICBpZiBub3Qgdm9sY2Fub1JvY2tzIHRoZW4gcmV0dXJuIG5pbCBlbmQKICAgIGZvciBfLCBtb2RlbCBpbiBwYWlycyh2b2xjYW5vUm9ja3M6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBtb2RlbDpJc0EoIk1vZGVsIikgdGhlbgogICAgICAgICAgICBsb2NhbCByb2NrID0gbW9kZWw6RmluZEZpcnN0Q2hpbGQoInZvbGNhbm9yb2NrIikKICAgICAgICAgICAgaWYgcm9jayBhbmQgcm9jazpJc0EoIk1lc2hQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgcm9ja0NvbG9yID0gcm9jay5Db2xvcgogICAgICAgICAgICAgICAgaWYgcm9ja0NvbG9yID09IENvbG9yMy5mcm9tUkdCKDE4NSwgNTMsIDU2KSBvciByb2NrQ29sb3IgPT0gQ29sb3IzLmZyb21SR0IoMTg1LCA1MywgNTcpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9jawogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gbmlsCmVuZApsb2NhbCBmdW5jdGlvbiBlcXVpcEFuZFVzZVdlYXBvbih3ZWFwb25UeXBlKQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBiYWNrcGFjayA9IHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKQogICAgaWYgbm90IGJhY2twYWNrIHRoZW4gcmV0dXJuIGVuZAogICAgZm9yIF8sIHRvb2wgaW4gcGFpcnMoYmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB0b29sOklzQSgiVG9vbCIpIGFuZCB0b29sLlRvb2xUaXAgPT0gd2VhcG9uVHlwZSB0aGVuCiAgICAgICAgICAgIHRvb2wuUGFyZW50ID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICBmb3IgXywga2V5IGluIGlwYWlycyh7IloiLCAiWCIsICJDIiwgIlYiLCAiRiJ9KSBkbwogICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgcHJlc3NLZXkoa2V5KQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdG9vbC5QYXJlbnQgPSBiYWNrcGFjawogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZApzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KDAuMSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0RlZmVuZFZvbGNhbm8gdGhlbgogICAgICAgICAgICBpZiB0eXBlb2YoQXV0b0hha2kpID09ICJmdW5jdGlvbiIgdGhlbiBBdXRvSGFraSgpIGVuZAogICAgICAgICAgICByZW1vdmVMYXZhKCkKICAgICAgICAgICAgbG9jYWwgcm9jayA9IGZpbmRWb2xjYW5vUm9jaygpCiAgICAgICAgICAgIGlmIHJvY2sgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zaXRpb24gPSBDRnJhbWUubmV3KHJvY2suUG9zaXRpb24pCiAgICAgICAgICAgICAgICBpZiB0eXBlb2YodG9wb3MpID09ICJmdW5jdGlvbiIgdGhlbiB0b3Bvcyh0YXJnZXRQb3NpdGlvbikgZW5kCiAgICAgICAgICAgICAgICBpZiByb2NrLkNvbG9yID09IENvbG9yMy5mcm9tUkdCKDE4NSwgNTMsIDU2KSBvciByb2NrLkNvbG9yID09IENvbG9yMy5mcm9tUkdCKDE4NSwgNTMsIDU3KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gcGxheWVyIGFuZCBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgIGlmIHJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAocm9vdFBhcnQuUG9zaXRpb24gLSByb2NrLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGlzdGFuY2UgPD0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuVXNlTWVsZWUgdGhlbiBlcXVpcEFuZFVzZVdlYXBvbigiTWVsZWUiKSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Vc2VTd29yZCB0aGVuIGVxdWlwQW5kVXNlV2VhcG9uKCJTd29yZCIpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlVzZUd1biB0aGVuIGVxdWlwQW5kVXNlV2VhcG9uKCJHdW4iKSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlR3ZWVuVG9QcmVoaXN0b3JpYyA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcm9jayA9IGZpbmRWb2xjYW5vUm9jaygpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLlR3ZWVuVG9QcmVoaXN0b3JpYyA9IHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBWb2xjYW5pYzpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIkF1dG8gS2lsbCBBdXJhIEdvbGVtcyIsCiAgICBEZWZhdWx0ID0gZmFsc2UKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2NDEzKQogICAgZ2V0Z2VudigpLktpbGxBdXJhID0gdjQxMwplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHdhaXQoMC4xKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5LaWxsQXVyYSB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgIGZvciBfLCBlbmVteSBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkIGFuZCByb290UGFydCBhbmQgaHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkLkhlYWx0aCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgcm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKVG9nZ2xlID0gVm9sY2FuaWM6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBDb2xsZWN0IEJvbmUiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5Db2xsZWN0Qm9uZSA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgd2FpdCgwLjEpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9Db2xsZWN0Qm9uZSBhbmQgV29ybGQzIHRoZW4KICAgICAgICAgICAgbG9jYWwgYm9uZXMgPSB7fQogICAgICAgICAgICBmb3IgXywgb2JqIGluIGlwYWlycyh3b3Jrc3BhY2U6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgIGlmIG9iajpJc0EoIkJhc2VQYXJ0IikgYW5kIG9iai5OYW1lID09ICJEaW5vQm9uZSIgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChib25lcywgb2JqKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBmb3IgXywgYm9uZSBpbiBpcGFpcnMoYm9uZXMpIGRvCiAgICAgICAgICAgICAgICBpZiB0eXBlb2YodG9wb3MpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoYm9uZS5Qb3NpdGlvbikpCiAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMC4yKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3MgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcGxheWVyUG9zIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJvbmVQb3MgPSBib25lLlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKHBsYXllclBvcyAtIGJvbmVQb3MpLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgIHVudGlsIGRpc3RhbmNlIDw9IDEKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IFZvbGNhbmljOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gQ29sbGVjdCBFZ2ciLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5Db2xsZWN0RWdnID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB3YWl0KDAuMSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQ29sbGVjdEVnZyBhbmQgV29ybGQzIGFuZCB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIk1hcCIpIGFuZCB3b3Jrc3BhY2UuTWFwOkZpbmRGaXJzdENoaWxkKCJQcmVoaXN0b3JpY0lzbGFuZCIpIGFuZCB3b3Jrc3BhY2UuTWFwLlByZWhpc3RvcmljSXNsYW5kLkNvcmU6RmluZEZpcnN0Q2hpbGQoIlNwYXduZWREcmFnb25FZ2dzIikgdGhlbgogICAgICAgICAgICBsb2NhbCBlZ2dzID0gd29ya3NwYWNlLk1hcC5QcmVoaXN0b3JpY0lzbGFuZC5Db3JlLlNwYXduZWREcmFnb25FZ2dzOkdldENoaWxkcmVuKCkKICAgICAgICAgICAgaWYgI2VnZ3MgPiAwIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldEVnZyA9IGVnZ3NbbWF0aC5yYW5kb20oMSwgI2VnZ3MpXQogICAgICAgICAgICAgICAgaWYgdGFyZ2V0RWdnOklzQSgiTW9kZWwiKSBhbmQgdGFyZ2V0RWdnLlByaW1hcnlQYXJ0IGFuZCB0eXBlb2YodG9wb3MpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvcG9zKHRhcmdldEVnZy5QcmltYXJ5UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoMC4yKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3MgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcGxheWVyUG9zIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGVnZ1BvcyA9IHRhcmdldEVnZy5QcmltYXJ5UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChwbGF5ZXJQb3MgLSBlZ2dQb3MpLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgIHVudGlsIGRpc3RhbmNlIDw9IDEgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLCAiRSIsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsICJFIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpWb2xjYW5pYzpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiU2V0dGluZyBTa2lsbCBWb2xjYW5vIElzbGFuZCIsCiAgICBDb250ZW50ID0gc3RyaW5nLnJlcCgiLSIsIDIxKQp9KQpUb2dnbGUgPSBWb2xjYW5pYzpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIkF1dG8gVXNlIFNraWxsIE1lbGVlIiwKICAgIERlZmF1bHQgPSBmYWxzZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHY0MDIpCiAgICBnZXRnZW52KCkuVXNlTWVsZWUgPSB2NDAyCmVuZCkKVG9nZ2xlID0gVm9sY2FuaWM6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7CiAgICBUaXRsZSA9ICJBdXRvIFVzZSBTa2lsbCBTd29yZCIsCiAgICBEZWZhdWx0ID0gZmFsc2UKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbih2NDAzKQogICAgZ2V0Z2VudigpLlVzZVN3b3JkID0gdjQwMwplbmQpClRvZ2dsZSA9IFZvbGNhbmljOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiQXV0byBVc2UgU2tpbGwgR3VuIiwKICAgIERlZmF1bHQgPSBmYWxzZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHY0MDQpCiAgICBnZXRnZW52KCkuVXNlR3VuID0gdjQwNAplbmQpClJhY2UgPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiVGFiIFVwZ3JhZGUgUmFjZSIsIEljb24gPSAiIiB9KQpSYWNlOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJSYWNlIERyYWNvIiwKICAgIENvbnRlbnQgPSBzdHJpbmcucmVwKCItIiwgMjEpCn0pCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQpUb2dnbGUgPSBSYWNlOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIlRlbGVwb3J0IFRvIFRoZSBEcmFjbyBDbGFuIFRyaWFsIERvb3IiLCBEZWZhdWx0ID0gZmFsc2V9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlRyaWFsVGVsZXBvcnREcmFjbyA9IFZhbHVlCmVuZCkKbG9jYWwgZnVuY3Rpb24gc2FmZVRlbGVwb3J0KHRhcmdldENGcmFtZSkKICAgIGlmIHRvcG9zIGFuZCB0eXBlb2YodGFyZ2V0Q0ZyYW1lKSA9PSAiQ0ZyYW1lIiB0aGVuCiAgICAgICAgdG9wb3ModGFyZ2V0Q0ZyYW1lKQogICAgZW5kCmVuZApzcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCB0cmlhbFBhcnQgPSB3b3Jrc3BhY2U6V2FpdEZvckNoaWxkKCJNYXAiKTpGaW5kRmlyc3RDaGlsZCgiUHJlaGlzdG9yaWNJc2xhbmQiKQogICAgaWYgdHJpYWxQYXJ0IHRoZW4KICAgICAgICB0cmlhbFBhcnQgPSB0cmlhbFBhcnQ6RmluZEZpcnN0Q2hpbGQoIlRyaWFsVGVsZXBvcnQiKQogICAgZW5kCiAgICB3aGlsZSB0YXNrLndhaXQoMC41KSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5UcmlhbFRlbGVwb3J0RHJhY28gYW5kIHRyaWFsUGFydCBhbmQgdHJpYWxQYXJ0OklzQSgiUGFydCIpIHRoZW4KICAgICAgICAgICAgc2FmZVRlbGVwb3J0KENGcmFtZS5uZXcodHJpYWxQYXJ0LlBvc2l0aW9uKSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClJhY2U6QWRkUGFyYWdyYXBoKHsKICAgIFRpdGxlID0gIlJhY2UgTm9ybWFsIiwKICAgIENvbnRlbnQgPSBzdHJpbmcucmVwKCItIiwgMjEpCn0pClRvZ2dsZSA9IFJhY2U6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBVcGdyYWRlIFJhY2UgVjIiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5VcGdyYWRlUmFjZVYyID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KDAuMikgZG8KICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5VcGdyYWRlUmFjZVYyIG9yIG5vdCBXb3JsZDIgdGhlbgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZW5kICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkUm9vdFBhcnQgPSBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgbG9jYWwgYmFja3BhY2sgPSBwbGF5ZXIuQmFja3BhY2sKICAgICAgICAgICAgbG9jYWwgcmFjZURhdGEgPSBwbGF5ZXIuRGF0YS5SYWNlICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJhY2VEYXRhOkZpbmRGaXJzdENoaWxkKCJFdm9sdmVkIikgdGhlbgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGxvY2FsIGFsY2hlbWlzdFN0YXR1cyA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkFsY2hlbWlzdCIsIjEiKQogICAgICAgICAgICBpZiBhbGNoZW1pc3RTdGF0dXMgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXRQb3MgPSBDRnJhbWUubmV3KC0yNzc5LjgzNTIxLCA3Mi45NjYxNDA3LCAtMzU3NC4wMjAwMikKICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkUm9vdFBhcnQgYW5kICh0YXJnZXRQb3MuUG9zaXRpb24gLSBodW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPiA0IHRoZW4KICAgICAgICAgICAgICAgICAgICB0b3Bvcyh0YXJnZXRQb3MpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuMSkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJBbGNoZW1pc3QiLCIyIikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlaWYgYWxjaGVtaXN0U3RhdHVzID09IDEgdGhlbgogICAgICAgICAgICAgICAgaWYgbm90IChiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmxvd2VyIDEiKSBvciBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGbG93ZXIgMSIpKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9wb3MoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5GbG93ZXIxLkNGcmFtZSkKICAgICAgICAgICAgICAgIGVsc2VpZiBub3QgKGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGbG93ZXIgMiIpIG9yIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZsb3dlciAyIikpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0b3BvcyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkZsb3dlcjIuQ0ZyYW1lKQogICAgICAgICAgICAgICAgZWxzZWlmIG5vdCAoYmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZsb3dlciAzIikgb3IgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmxvd2VyIDMiKSkgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHpvbWJpZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiWm9tYmllIikKICAgICAgICAgICAgICAgICAgICBpZiB6b21iaWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiWm9tYmllIiBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsIDUwLCA1MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KDEyODAsIDY3MikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgYmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZsb3dlciAzIikgb3Igdi5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3Qgdi5QYXJlbnQgb3Igbm90IGdldGdlbnYoKS5VcGdyYWRlUmFjZVYyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC01Njg1LjkyMywgNDguNDgsIC04NTMuMjM3KSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlaWYgYWxjaGVtaXN0U3RhdHVzID09IDIgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcigiQWxjaGVtaXN0IiwiMyIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpClRvZ2dsZSA9IFJhY2U6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBHZXQgQ3lib3JnIiwgRGVzY3JpcHRpb24gPSAiQnV5IENoaXAgQW5kIEtpbGwgT3JkZXIiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvQ3lib3JnID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdGFzay53YWl0KDAuNSkgZG8KICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9DeWJvcmcgdGhlbgogICAgICAgICAgICAgICAgaWYgbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTWljcm9jaGlwIikgCiAgICAgICAgICAgICAgICBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJNaWNyb2NoaXAiKSAKICAgICAgICAgICAgICAgIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJPcmRlciIpIAogICAgICAgICAgICAgICAgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIk9yZGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHdhaXQoMC4zKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJsYWNrYmVhcmRSZXdhcmQiLCAiTWljcm9jaGlwIiwgIjEiKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkJsYWNrYmVhcmRSZXdhcmQiLCAiTWljcm9jaGlwIiwgIjIiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC41KSBkbwogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0N5Ym9yZyB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJPcmRlciIpIAogICAgICAgICAgICAgICAgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIk9yZGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTWljcm9jaGlwIikgCiAgICAgICAgICAgICAgICAgICAgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIk1pY3JvY2hpcCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZWNsaWNrZGV0ZWN0b3IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5DaXJjbGVJc2xhbmQuUmFpZFN1bW1vbi5CdXR0b24uTWFpbi5DbGlja0RldGVjdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZCgiT3JkZXIiKSAKICAgICAgICAgICAgICAgIG9yIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllczpGaW5kRmlyc3RDaGlsZCgiT3JkZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJPcmRlciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGkgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLk5hbWUgPT0gIk9yZGVyIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKGkuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldygxMjAsIDEyMCwgMTIwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBpLlBhcmVudCBvciBpLkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIGdldGdlbnYoKS5BdXRvQ3lib3JnID09IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZCgiT3JkZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTYyMTcuMjAyMTQ4NDM3NSwgMjguMDQ3NjQ1NTY4ODQ4LCAtNTA1My4xMzU3NDIxODc1KSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQpUb2dnbGUgPSBSYWNlOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gR2V0IEdob3VsIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b0dob3VsID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgIGlmIG5vdCBnZXRnZW52KCkuQXV0b0dob3VsIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgbG9jYWwgZW5lbWllcyA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRW5lbWllcwogICAgICAgIGxvY2FsIGN1cnNlZENhcHRhaW4gPSBlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDdXJzZWQgQ2FwdGFpbiIpCiAgICAgICAgaWYgY3Vyc2VkQ2FwdGFpbiBhbmQgY3Vyc2VkQ2FwdGFpbjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgY3Vyc2VkQ2FwdGFpbjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjdXJzZWRDYXB0YWluLkh1bWFub2lkCiAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gY3Vyc2VkQ2FwdGFpbi5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgICAgIGlmIGh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgcm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICBodW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICByb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoNTAsNTAsNTApCiAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICB0b3Bvcyhyb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDEwLCAwKSkKICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCAxMDAwKQogICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvR2hvdWwgb3IgaHVtYW5vaWQuSGVhbHRoIDw9IDAgb3Igbm90IGN1cnNlZENhcHRhaW4uUGFyZW50CiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgbG9jYWwgc3RvcmFnZUNhcHRhaW4gPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIkN1cnNlZCBDYXB0YWluIikKICAgICAgICAgICAgaWYgc3RvcmFnZUNhcHRhaW4gdGhlbgogICAgICAgICAgICAgICAgdG9wb3Moc3RvcmFnZUNhcHRhaW4uSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDUsMTAsMikpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKUmFjZTpBZGRQYXJhZ3JhcGgoewogICAgVGl0bGUgPSAiUmFjZSBWNCIsCiAgICBDb250ZW50ID0gc3RyaW5nLnJlcCgiLSIsIDIxKQp9KQpUb2dnbGUgPSBSYWNlOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIk5vIEZyb2ciLCBEZWZhdWx0ID0gZmFsc2V9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLk5vRnJvZyA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5Ob0Zyb2cgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCBsaWdodGluZyA9IGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKQogICAgICAgICAgICAgICAgaWYgbGlnaHRpbmc6RmluZEZpcnN0Q2hpbGQoIkxpZ2h0aW5nTGF5ZXJzIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxpZ2h0aW5nLkxpZ2h0aW5nTGF5ZXJzOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBsaWdodGluZzpGaW5kRmlyc3RDaGlsZCgiU2t5IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxpZ2h0aW5nLlNreTpEZXN0cm95KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICAgICAgd2FpdCgxKQogICAgICAgIHdoaWxlIG5vdCBnZXRnZW52KCkuTm9Gcm9nIGRvCiAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IFJhY2U6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiVGVsZXBvcnQgQW5jaWVudCBDbG9jayIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlRlbGVwb3J0QWNpZW50Q2xvY2sgPSBWYWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5UZWxlcG9ydEFjaWVudENsb2NrKQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICB3YWl0KDAuNSkKICAgICAgICBpZiBnZXRnZW52KCkuVGVsZXBvcnRBY2llbnRDbG9jayB0aGVuCiAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoMjk1NDksIDE1MDY5LCAtODgpKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKVG9nZ2xlID0gUmFjZTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIEJ1eSBHZWFyIiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvQnV5R2VhciA9IFZhbHVlICAgIAplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0J1eUdlYXIgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJVcGdyYWRlUmFjZSIsICJCdXkifQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiQ29tbUZfIik6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgxKSB1bnRpbCBnZXRnZW52KCkuQXV0b0J1eUdlYXIKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKbG9jYWwgVG9nZ2xlID0gUmFjZTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIEZpbmlzaCBUcmFpbiBRdWVzdCIsIERlZmF1bHQgPSBmYWxzZX0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuUmFjZV8xID0gVmFsdWUKICAgIGdldGdlbnYoKS5RdWVzdFRyYWluXzIgPSBWYWx1ZQogICAgaWYgbm90IFZhbHVlIHRoZW4KICAgICAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLlF1ZXN0VHJhaW5fMikKICAgIGVuZAplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuNSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5SYWNlXzEgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGlmIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJhY2VUcmFuc2Zvcm1lZCIpIGFuZCBjaGFyLlJhY2VUcmFuc2Zvcm1lZC5WYWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlF1ZXN0VHJhaW5fMiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtOTUwNy4wMzEyNSwgNzEzLjY1NDk2OCwgNjE4Ni4zOTQ1MykpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC41KSBkbyAKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5RdWVzdFRyYWluXzIgYW5kIFdvcmxkMyBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBlbmVtaWVzID0gd29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJFbmVtaWVzIikKICAgICAgICAgICAgICAgIGlmIGVuZW1pZXMgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIk1vZGVsIikgYW5kICh2Lk5hbWUgPT0gIlJlYm9ybiBTa2VsZXRvbiIgb3Igdi5OYW1lID09ICJMaXZpbmcgWm9tYmllIiBvciB2Lk5hbWUgPT0gIkRlbW9uaWMgU291bCIgb3Igdi5OYW1lID09ICJQb3Nlc3NlZCBNdW1teSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgdi5IdW1hbm9pZC5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhlYWQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5Cb25lc0JyaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuUXVlc3RUcmFpbl8yIG9yIHYuUGFyZW50ID09IG5pbCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIEJ5cGFzc1RQIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3MgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChwbGF5ZXJQb3MgLSBCb25lUG9zLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA+IDE1MDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBCVFAoQm9uZVBvcykKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKEJvbmVQb3MpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdG9wb3MoQm9uZVBvcykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgVW5FcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLkJvbmVzQnJpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtOTUwNy4wMzEyNSwgNzEzLjY1NDk2OCwgNjE4Ni4zOTQ1MykpCiAgICAgICAgICAgICAgICBsb2NhbCByZXBsaWNhdGVkID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhyZXBsaWNhdGVkOkdldENoaWxkcmVuKCkpIGRvIAogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJNb2RlbCIpIGFuZCAodi5OYW1lID09ICJSZWJvcm4gU2tlbGV0b24iIG9yIHYuTmFtZSA9PSAiTGl2aW5nIFpvbWJpZSIgb3Igdi5OYW1lID09ICJEZW1vbmljIFNvdWwiIG9yIHYuTmFtZSA9PSAiUG9zZXNzZWQgTXVtbXkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyh2Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygyLCAyMCwgMikpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuNSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5SYWNlXzEgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGlmIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJhY2VUcmFuc2Zvcm1lZCIpIGFuZCBub3QgY2hhci5SYWNlVHJhbnNmb3JtZWQuVmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5RdWVzdFRyYWluXzIgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC41KSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlJhY2VfMSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgY2hhcjpGaW5kRmlyc3RDaGlsZCgiUmFjZUVuZXJneSIpIGFuZCBjaGFyLlJhY2VFbmVyZ3kuVmFsdWUgPj0gMSBhbmQgbm90IGNoYXIuUmFjZVRyYW5zZm9ybWVkLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBiZSA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpCiAgICAgICAgICAgICAgICAgICAgYmU6U2VuZEtleUV2ZW50KHRydWUsICJZIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBiZTpTZW5kS2V5RXZlbnQoZmFsc2UsICJZIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKUHVsbGV2ZXIgPSBSYWNlOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJQdWxsIExldmVyIERvbmUiLAogICAgQ29udGVudCA9ICJTdGF0dXM6ICIKfSkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgcHJldmlvdXNTdGF0dXMgPSAiIgogICAgd2hpbGUgdGFzay53YWl0KDEpIGRvCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoInRlbXBsZWRvb3JjaGVjayIpCiAgICAgICAgZW5kKQogICAgICAgIGlmIHN1Y2Nlc3MgdGhlbgogICAgICAgICAgICBsb2NhbCBjdXJyZW50U3RhdHVzID0gcmVzdWx0IGFuZCAi4pyFIiBvciAi4p2MIgogICAgICAgICAgICBpZiBjdXJyZW50U3RhdHVzIH49IHByZXZpb3VzU3RhdHVzIHRoZW4KICAgICAgICAgICAgICAgIFB1bGxldmVyOlNldERlc2MoIlN0YXR1czogIiAuLiBjdXJyZW50U3RhdHVzKQogICAgICAgICAgICAgICAgcHJldmlvdXNTdGF0dXMgPSBjdXJyZW50U3RhdHVzCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKVG9nZ2xlID0gUmFjZTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsgVGl0bGUgPSAiVGVsZXBvcnQgVG8gTWlnYXJlIElzbGFuZCIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlRlbGVwb3J0TWlnYXJlID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuVGVsZXBvcnRNaWdhcmUpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHdhaXQoMC41KSBkbwogICAgICAgICAgICBpZiBnZXRnZW52KCkuVGVsZXBvcnRNaWdhcmUgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBpc2xhbmQgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcDpGaW5kRmlyc3RDaGlsZCgiTXlzdGljSXNsYW5kIikKICAgICAgICAgICAgICAgIGlmIGlzbGFuZCBhbmQgaXNsYW5kOkZpbmRGaXJzdENoaWxkKCJDZW50ZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zID0gaXNsYW5kLkNlbnRlci5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRQb3MgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIGlmIGN1cnJlbnRQb3MgYW5kIChWZWN0b3IzLm5ldyh0YXJnZXRQb3MuWCwgNTAwLCB0YXJnZXRQb3MuWikgLSBjdXJyZW50UG9zKS5tYWduaXR1ZGUgPiA1IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldyh0YXJnZXRQb3MuWCwgNTAwLCB0YXJnZXRQb3MuWikpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKVG9nZ2xlID0gUmFjZTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsgVGl0bGUgPSAiVGVsZXBvcnQgVG8gSGlnaGVzdCBQb2ludCIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlR3ZWVudG9oaWdoZXN0cG9pbnQgPSBWYWx1ZQogICAgaWYgbm90IFZhbHVlIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAogICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5Ud2VlbnRvaGlnaGVzdHBvaW50IGRvCiAgICAgICAgICAgIGxvY2FsIEhpZ2hlc3RQb2ludCA9IHR3ZWVudG9faGlnaGVzdHBvaW50KCkKICAgICAgICAgICAgaWYgSGlnaGVzdFBvaW50IGFuZCBIaWdoZXN0UG9pbnQ6RmluZEZpcnN0Q2hpbGQoIkNGcmFtZSIpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldFBvcyA9IEhpZ2hlc3RQb2ludC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDIxMS44OCwgMCkKICAgICAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRQb3MgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgaWYgY3VycmVudFBvcyBhbmQgKHRhcmdldFBvcy5Qb3NpdGlvbiAtIGN1cnJlbnRQb3MpLm1hZ25pdHVkZSA+IDUgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvcG9zKHRhcmdldFBvcykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKVG9nZ2xlID0gUmFjZTpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsgVGl0bGUgPSAiVGVsZXBvcnQgVG8gQWR2YW5jZWQgRnJ1aXQgRGVhbGVyIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuVGVsZXBvcnRBZHZhbmNlZEZydWl0RGVhbGVyID0gVmFsdWUKICAgIGlmIG5vdCBWYWx1ZSB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuVGVsZXBvcnRBZHZhbmNlZEZydWl0RGVhbGVyIGFuZCB3YWl0KDAuNSkgZG8KICAgICAgICAgICAgbG9jYWwgTXlzdGljSXNsYW5kID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXA6RmluZEZpcnN0Q2hpbGQoIk15c3RpY0lzbGFuZCIpCiAgICAgICAgICAgIGlmIE15c3RpY0lzbGFuZCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBBbGxOUENzID0ge30KICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTlBDczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChBbGxOUENzLCB2KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyhBbGxOUENzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiQWR2YW5jZWQgRnJ1aXQgRGVhbGVyIiBhbmQgdjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zID0gdi5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjdXJyZW50UG9zID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgaWYgY3VycmVudFBvcyBhbmQgKHRhcmdldFBvcy5Qb3NpdGlvbiAtIGN1cnJlbnRQb3MpLm1hZ25pdHVkZSA+IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3ModGFyZ2V0UG9zKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQpUb2dnbGUgPSBSYWNlOkFkZFRvZ2dsZSgiVG9nZ2xlIiwgeyBUaXRsZSA9ICJMb2NrIE1vb24gQW5kIE9uIFJhY2UgVjMiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5Mb2NrTW9vbkFuZE9uUmFjZVYzID0gVmFsdWUKICAgIGlmIG5vdCBWYWx1ZSB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuTG9ja01vb25BbmRPblJhY2VWMyBhbmQgd2FpdCgwLjUpIGRvCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIFdvcmxkMyB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbW9vbkRpciA9IGdhbWUuTGlnaHRpbmc6R2V0TW9vbkRpcmVjdGlvbigpCiAgICAgICAgICAgICAgICAgICAgaWYgbW9vbkRpciBhbmQgbW9vbkRpci5NYWduaXR1ZGUgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbG9va0F0UG9zID0gZ2FtZS5Xb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUucCArIG1vb25EaXIgKiAxMDAKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5Xb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUgPSBDRnJhbWUubG9va0F0KGdhbWUuV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lLnAsIGxvb2tBdFBvcykKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkxvY2tNb29uQW5kT25SYWNlVjMgYW5kIHdhaXQoMykgZG8KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgV29ybGQzIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwgIlQiLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQoZmFsc2UsICJUIiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpClRvZ2dsZSA9IFJhY2U6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7IFRpdGxlID0gIlRlbGVwb3J0IFRvIEJsdWUgR2VhciIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlRlbGVwb3J0VG9HZWFyID0gVmFsdWUKICAgIFN0b3BUd2VlbihnZXRnZW52KCkuVGVsZXBvcnRUb0dlYXIpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMSkgZG8KICAgICAgICBpZiBub3QgZ2V0Z2VudigpLlRlbGVwb3J0VG9HZWFyIG9yIG5vdCBXb3JsZDMgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICBsb2NhbCBNeXN0aWNJc2xhbmQgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcDpGaW5kRmlyc3RDaGlsZCgiTXlzdGljSXNsYW5kIikKICAgICAgICBpZiBub3QgTXlzdGljSXNsYW5kIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgZm9yIF8sIHYgaW4gaXBhaXJzKE15c3RpY0lzbGFuZDpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiB2OklzQSgiTWVzaFBhcnQiKSBhbmQgdi5NYXRlcmlhbCA9PSBFbnVtLk1hdGVyaWFsLk5lb24gdGhlbgogICAgICAgICAgICAgICAgdG9wb3Modi5DRnJhbWUpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClJhY2U6QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIlRlbGVwb3J0IFRvIFRyaWFsIERvb3IiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKICAgICAgICBpZiBub3QgcGxheWVyIG9yIG5vdCBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkRhdGEiKSBvciBub3QgcGxheWVyLkRhdGE6RmluZEZpcnN0Q2hpbGQoIlJhY2UiKSB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIGxvY2FsIHJhY2UgPSBwbGF5ZXIuRGF0YS5SYWNlLlZhbHVlCiAgICAgICAgbG9jYWwgcG9zaXRpb25zID0gewogICAgICAgICAgICBIdW1hbiAgPSBDRnJhbWUubmV3KDI5MjIxLjgyMiwgMTQ4OTAuOTc1LCAtMjA1Ljk5MSksCiAgICAgICAgICAgIFNreXBpZWEgPSBDRnJhbWUubmV3KDI4OTYwLjE1OCwgMTQ5MTkuNjI0LCAyMzUuMDM5KSwKICAgICAgICAgICAgRmlzaG1hbiA9IENGcmFtZS5uZXcoMjgyMzEuMTc1LCAxNDg5MC45NzUsIC0yMTEuNjQxKSwKICAgICAgICAgICAgQ3lib3JnICA9IENGcmFtZS5uZXcoMjg1MDIuNjgxLCAxNDg5NS45NzUsIC00MjMuNzI3KSwKICAgICAgICAgICAgR2hvdWwgICA9IENGcmFtZS5uZXcoMjg2NzQuMjQ0LCAxNDg5MC42NzYsIDQ0NS40MzEpLAogICAgICAgICAgICBNaW5rICAgID0gQ0ZyYW1lLm5ldygyOTAxMi4zNDEsIDE0ODkwLjk3NSwgLTM4MC4xNDkpCiAgICAgICAgfQogICAgICAgIGlmIHBvc2l0aW9uc1tyYWNlXSBhbmQgdHlwZW9mKHRvcG9zKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgdG9wb3MocG9zaXRpb25zW3JhY2VdKQogICAgICAgIGVuZAogICAgZW5kCn0pClRvZ2dsZSA9IFJhY2U6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBUcmlhbCBSYWNlIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b1RyaWFsUmFjZSA9IFZhbHVlCiAgICBTdG9wVHdlZW4oZ2V0Z2VudigpLkF1dG9UcmlhbFJhY2UpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIHJhY2UgPSBwbGF5ZXIuRGF0YS5SYWNlCiAgICBsb2NhbCB2aXJ0dWFsSW5wdXQgPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKQogICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9UcmlhbFJhY2UgZG8KICAgICAgICB3YWl0KDAuNSkKICAgICAgICBpZiByYWNlLlZhbHVlID09ICJIdW1hbiIgdGhlbgogICAgICAgICAgICBmb3IgXywgZW5lbXkgaW4gcGFpcnMoZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShwbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9UcmlhbFJhY2Ugb3Igbm90IGVuZW15LlBhcmVudCBvciBlbmVteS5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgcmFjZS5WYWx1ZSA9PSAiU2t5cGllYSIgdGhlbgogICAgICAgICAgICBsb2NhbCBza3lUcmlhbCA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLlNreVRyaWFsLk1vZGVsCiAgICAgICAgICAgIGlmIHNreVRyaWFsIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCBvYmogaW4gcGFpcnMoc2t5VHJpYWw6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBvYmouTmFtZSA9PSAic25vd2lzbGFuZF9DeWxpbmRlci4wODEiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgQlRQWihvYmouQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiByYWNlLlZhbHVlID09ICJGaXNobWFuIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIHNlYUJlYXN0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5TZWFCZWFzdHM6RmluZEZpcnN0Q2hpbGQoIlNlYUJlYXN0MSIpCiAgICAgICAgICAgIGlmIHNlYUJlYXN0IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHJvb3QgPSBzZWFCZWFzdDpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBpZiByb290IHRoZW4KICAgICAgICAgICAgICAgICAgICB0b3Bvcyhyb290LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBiYWNrcGFjayA9IHBsYXllci5CYWNrcGFjawogICAgICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIGVxdWlwVG9vbCh0b29sVHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHRvb2wgaW4gcGFpcnMoYmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRvb2w6SXNBKCJUb29sIikgYW5kIHRvb2wuVG9vbFRpcCA9PSB0b29sVHlwZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodG9vbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsSW5wdXQ6U2VuZEtleUV2ZW50KHRydWUsIDEyMiwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydHVhbElucHV0OlNlbmRLZXlFdmVudChmYWxzZSwgMTIyLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsSW5wdXQ6U2VuZEtleUV2ZW50KHRydWUsIDEyMCwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydHVhbElucHV0OlNlbmRLZXlFdmVudChmYWxzZSwgMTIwLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDAuMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsSW5wdXQ6U2VuZEtleUV2ZW50KHRydWUsIDk5LCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsSW5wdXQ6U2VuZEtleUV2ZW50KGZhbHNlLCA5OSwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZXF1aXBUb29sKCJNZWxlZSIpCiAgICAgICAgICAgICAgICAgICAgZXF1aXBUb29sKCJCbG94IEZydWl0IikKICAgICAgICAgICAgICAgICAgICBlcXVpcFRvb2woIlN3b3JkIikKICAgICAgICAgICAgICAgICAgICBlcXVpcFRvb2woIkd1biIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIHJhY2UuVmFsdWUgPT0gIkN5Ym9yZyIgdGhlbgogICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KDI4NjU0LCAxNDg5OC43ODMyLCAtMzApKQogICAgICAgIGVsc2VpZiByYWNlLlZhbHVlID09ICJHaG91bCIgdGhlbgogICAgICAgICAgICBmb3IgXywgZW5lbXkgaW4gcGFpcnMoZ2FtZS5Xb3Jrc3BhY2UuRW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgZW5lbXk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShwbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgZ2V0Z2VudigpLkF1dG9UcmlhbFJhY2Ugb3Igbm90IGVuZW15LlBhcmVudCBvciBlbmVteS5IdW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgcmFjZS5WYWx1ZSA9PSAiTWluayIgdGhlbgogICAgICAgICAgICBmb3IgXywgb2JqIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIik6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgIGlmIG9iai5OYW1lID09ICJTdGFydFBvaW50IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9wb3Mob2JqLkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgMTAsIDApKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBSYWNlOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gS2lsbCBQbGF5ZXIgQWZ0ZXIgVHJpYWwgVjQiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvS2lsbFBsYXllckFmdGVyVHJpYWwgPSBWYWx1ZQogICAgU3RvcFR3ZWVuKGdldGdlbnYoKS5BdXRvS2lsbFBsYXllckFmdGVyVHJpYWwpCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMikgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0tpbGxQbGF5ZXJBZnRlclRyaWFsIGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBpZiBub3QgY2hhciBvciBub3QgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gcmV0dXJuIGVuZCAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHRpbWVyR3VpID0gcGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiTWFpbiIpIGFuZCBwbGF5ZXIuUGxheWVyR3VpLk1haW46RmluZEZpcnN0Q2hpbGQoIlRpbWVyIikKICAgICAgICAgICAgICAgIGlmIG5vdCAodGltZXJHdWkgYW5kIHRpbWVyR3VpLlZpc2libGUpIHRoZW4gcmV0dXJuIGVuZCAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIGlwYWlycyhnYW1lLldvcmtzcGFjZS5DaGFyYWN0ZXJzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lIH49IHBsYXllci5OYW1lIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBodW1hbm9pZCA9IHYuSHVtYW5vaWQKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB2Lkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgKGNoYXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIHJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMjMwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMSwgMSwgMikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDYwLCA2MCwgNjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5IZWFkLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShwbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvS2lsbFBsYXllckFmdGVyVHJpYWwgYW5kIGh1bWFub2lkLkhlYWx0aCA+IDAgYW5kIHYuUGFyZW50IGFuZCByb290UGFydCBhbmQgaHVtYW5vaWQgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKR2V0ID0gV2luZG93OkFkZFRhYih7IFRpdGxlID0gIlRhYiBHZXQgSXRlbXMgQW5kIEJ1eSIsIEljb24gPSAiIiB9KQpUb2dnbGUgPSBHZXQ6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBUcmFkZSBCb25lIiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvVHJhZGVCb25lID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBjYW5TZW5kUmVxdWVzdCA9IHRydWUKICAgIGxvY2FsIGRlYm91bmNlVGltZSA9IDEKICAgIHdoaWxlIHRhc2sud2FpdCgwLjUpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9UcmFkZUJvbmUgYW5kIFdvcmxkMyBhbmQgY2FuU2VuZFJlcXVlc3QgdGhlbgogICAgICAgICAgICBjYW5TZW5kUmVxdWVzdCA9IGZhbHNlCiAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICBbMV0gPSAiQm9uZXMiLAogICAgICAgICAgICAgICAgWzJdID0gIkJ1eSIsCiAgICAgICAgICAgICAgICBbM10gPSAxLAogICAgICAgICAgICAgICAgWzRdID0gMQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvY2FsIGNvbW1GID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfCiAgICAgICAgICAgIGlmIGNvbW1GIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBjb21tRjpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB3YWl0KGRlYm91bmNlVGltZSkKICAgICAgICAgICAgY2FuU2VuZFJlcXVlc3QgPSB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBHZXQ6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBCdXkgTGVnZW5kYXJ5IFN3b3JkIiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvQnV5TGVnZW5kYXJ5U3dvcmQgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGxhc3RDYWxsVGltZSA9IDAKICAgIHdoaWxlIHRhc2sud2FpdCgxKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5BdXRvQnV5TGVnZW5kYXJ5U3dvcmQgYW5kIFdvcmxkMiB0aGVuCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRUaW1lID0gdGljaygpICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGN1cnJlbnRUaW1lIC0gbGFzdENhbGxUaW1lID49IDIgdGhlbgogICAgICAgICAgICAgICAgbGFzdENhbGxUaW1lID0gY3VycmVudFRpbWUgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJnczEgPSB7ICJMZWdlbmRhcnlTd29yZERlYWxlciIsICIxIiB9CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJnczIgPSB7ICJMZWdlbmRhcnlTd29yZERlYWxlciIsICIyIiB9CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJnczMgPSB7ICJMZWdlbmRhcnlTd29yZERlYWxlciIsICIzIiB9ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKHVucGFjayhhcmdzMSkpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJnczIpKQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MzKSkgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IEdldDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIkF1dG8gQnV5IEhha2kgQ29sb3IiLAogICAgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQXV0b19CdXlfRW5jaGFuY2VtZW50ID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBsYXN0Q2FsbFRpbWUgPSAwCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9fQnV5X0VuY2hhbmNlbWVudCB0aGVuCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRUaW1lID0gdGljaygpCiAgICAgICAgICAgIGlmIGN1cnJlbnRUaW1lIC0gbGFzdENhbGxUaW1lID49IDIgdGhlbgogICAgICAgICAgICAgICAgbGFzdENhbGxUaW1lID0gY3VycmVudFRpbWUKICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgICAgWzFdID0gIkNvbG9yc0RlYWxlciIsCiAgICAgICAgICAgICAgICAgICAgWzJdID0gIjIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUZfOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHdhaXQoMC4xKQogICAgZW5kCmVuZCkKbG9jYWwgaXNIb3BwaW5nID0gZmFsc2UKVG9nZ2xlID0gR2V0OkFkZFRvZ2dsZSgiVG9nZ2xlIiwgewogICAgVGl0bGUgPSAiSG9wIFNlcnZlciBbIEhha2kgY29sb3Igb3IgTGVnZW5kYXJ5IFN3b3JkXSIsCiAgICBEZWZhdWx0ID0gZmFsc2UKfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihzdGF0ZSkKICAgIGlzSG9wcGluZyA9IHN0YXRlCiAgICBpZiBpc0hvcHBpbmcgdGhlbgogICAgICAgIEhvcCgpCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBHZXQ6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBHZXQgUmFpbmJvdyBIYWtpIiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvUmFpbmJvd0hha2kgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC4yKSBkbwogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1JhaW5ib3dIYWtpIGFuZCBXb3JsZDMgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBsb2NhbCBocnAgPSBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgIGxvY2FsIHF1ZXN0R3VpID0gcGxheWVyLlBsYXllckd1aS5NYWluLlF1ZXN0CiAgICAgICAgICAgICAgICBpZiBub3QgaHJwIHRoZW4gY29udGludWUgZW5kICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHF1ZXN0R3VpLlZpc2libGUgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldFBvcyA9IFZlY3RvcjMubmV3KC0xMTg5Mi4wNzAzMTI1LCA5MzAuNTc2NzIxMTkxNDEsIC04NzYwLjE1OTE3OTY4NzUpCiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldFBvcyAtIGhycC5Qb3NpdGlvbikuTWFnbml0dWRlID4gMzAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KHRhcmdldFBvcykpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xKQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJIb3JuZWRNYW4iLCAiQmV0IikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBsb2NhbCBxdWVzdFRpdGxlID0gcXVlc3RHdWkuQ29udGFpbmVyLlF1ZXN0VGl0bGUuVGl0bGUuVGV4dAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVuZW15TmFtZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFsiU3RvbmUiXSA9IFZlY3RvcjMubmV3KC0xMTc1LCA1MywgNjgxMSksCiAgICAgICAgICAgICAgICAgICAgICAgIFsiSXNsYW5kIEVtcHJlc3MiXSA9IFZlY3RvcjMubmV3KDU4ODcsIDEwMTksIC0xMTQpLAogICAgICAgICAgICAgICAgICAgICAgICBbIktpbG8gQWRtaXJhbCJdID0gVmVjdG9yMy5uZXcoMzAxNCwgNTA5LCAtNzM1NCksCiAgICAgICAgICAgICAgICAgICAgICAgIFsiQ2FwdGFpbiBFbGVwaGFudCJdID0gVmVjdG9yMy5uZXcoLTEzNDg1LjAyODMsIDMzMS43MDkyNTksIC04MDEyLjQ4NzMpLAogICAgICAgICAgICAgICAgICAgICAgICBbIkJlYXV0aWZ1bCBQaXJhdGUiXSA9IFZlY3RvcjMubmV3KDUzNzcsIDIyLCAtNjIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZvciBlbmVteU5hbWUsIHRlbGVwb3J0UG9zIGluIHBhaXJzKGVuZW15TmFtZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHF1ZXN0VGl0bGUsIGVuZW15TmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW5lbXkgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoZW5lbXlOYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZW5lbXkgYW5kIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG9sZENGcmFtZSA9IGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9IYWtpKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1aXBXZWFwb24oZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoZW5lbXkuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBQb3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwLCA1MCwgNTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gb2xkQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b1JhaW5ib3dIYWtpIG9yIGVuZW15Lkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIG5vdCBlbmVteS5QYXJlbnQgb3Igbm90IHF1ZXN0R3VpLlZpc2libGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KHRlbGVwb3J0UG9zKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKVG9nZ2xlID0gR2V0OkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gU2t1bGwgR3VpdGFyIiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvU2t1bGxHdWl0YXIgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9Ta3VsbEd1aXRhciB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBHZXRXZWFwb25JbnZlbnRvcnkoIlNrdWxsIEd1aXRhciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGhycCA9IHBsYXllci5DaGFyYWN0ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgIGlmIGhycCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldFBvcyA9IFZlY3RvcjMubmV3KC05NjgxLjQ1OCwgNi4xMzksIDYzNDEuMzcyKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0UG9zIC0gaHJwLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gNTAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBza2VsZXRvbk1hY2hpbmUgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIlNrZWxldG9uIE1hY2hpbmUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2tlbGV0b25NYWNoaW5lIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRjpJbnZva2VTZXJ2ZXIoInNvdWxHdWl0YXJCdXkiLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGhhdW50ZWRDYXN0bGUgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcDpGaW5kRmlyc3RDaGlsZCgiSGF1bnRlZCBDYXN0bGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhhdW50ZWRDYXN0bGUgYW5kIGhhdW50ZWRDYXN0bGUuQ2FuZGxlMS5UcmFuc3BhcmVuY3kgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBsYWNhcmQxID0gaGF1bnRlZENhc3RsZTpGaW5kRmlyc3RDaGlsZCgiUGxhY2FyZDEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwbGFjYXJkMSBhbmQgcGxhY2FyZDEuTGVmdC5QYXJ0LlRyYW5zcGFyZW5jeSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFF1ZXN0MiA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTg3NjIuNjkxLCAxNzYuODQ3LCA2MTcxLjMwOCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpID0gNywgMSwgLTEgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGFjYXJkID0gaGF1bnRlZENhc3RsZTpGaW5kRmlyc3RDaGlsZCgiUGxhY2FyZCIgLi4gaSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwbGFjYXJkIGFuZCBwbGFjYXJkOkZpbmRGaXJzdENoaWxkKCJMZWZ0IikgYW5kIHBsYWNhcmQuTGVmdDpGaW5kRmlyc3RDaGlsZCgiQ2xpY2tEZXRlY3RvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZWNsaWNrZGV0ZWN0b3IocGxhY2FyZC5MZWZ0LkNsaWNrRGV0ZWN0b3IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGhhdW50ZWRDYXN0bGUgYW5kIGhhdW50ZWRDYXN0bGUuVGFibGV0IGFuZCBoYXVudGVkQ2FzdGxlLlRhYmxldDpGaW5kRmlyc3RDaGlsZCgiU2VnbWVudDEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGxhYlB1enpsZSA9IGhhdW50ZWRDYXN0bGU6RmluZEZpcnN0Q2hpbGQoIkxhYiBQdXp6bGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsYWJQdXp6bGUgYW5kIGxhYlB1enpsZS5Db2xvckZsb29yLk1vZGVsLlBhcnQxOkZpbmRGaXJzdENoaWxkKCJDbGlja0RldGVjdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUXVlc3Q0ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtOTU1My41OTksIDY1LjYyMywgNjA0MS41ODgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwYXJ0c1RvQ2xpY2sgPSB7MywgNCwgNCwgNCwgNiwgNiwgOCwgMTAsIDEwLCAxMH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBudW0gaW4gaXBhaXJzKHBhcnRzVG9DbGljaykgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwYXJ0ID0gbGFiUHV6emxlLkNvbG9yRmxvb3IuTW9kZWw6RmluZEZpcnN0Q2hpbGQoIlBhcnQiIC4uIG51bSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwYXJ0IGFuZCBwYXJ0OkZpbmRGaXJzdENoaWxkKCJDbGlja0RldGVjdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhwYXJ0LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVjbGlja2RldGVjdG9yKHBhcnQuQ2xpY2tEZXRlY3RvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBRdWVzdDMgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZ2hvc3QgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIkdob3N0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2hvc3QgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUY6SW52b2tlU2VydmVyKCJHdWl0YXJQdXp6bGVQcm9ncmVzcyIsICJHaG9zdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBlbmVtaWVzID0gZ2FtZS5Xb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkVuZW1pZXMiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBlbmVtaWVzIGFuZCBlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJMaXZpbmcgWm9tYmllIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGVuZW15IGluIHBhaXJzKGVuZW1pZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIGFuZCBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgZW5lbXkuSHVtYW5vaWQuSGVhbHRoID4gMCBhbmQgZW5lbXkuTmFtZSA9PSAiTGl2aW5nIFpvbWJpZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvSGFraSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDYwLCA2MCwgNjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkUm9vdFBhcnQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBocnAuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAyMCwgMCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTAxNjAuNzg3LCAxMzguNjYyLCA1OTU1LjAzMSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHZpcnR1YWxVc2VyID0gZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpcnR1YWxVc2VyOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydHVhbFVzZXI6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xMDE2MC43ODcsIDEzOC42NjIsIDU5NTUuMDMxKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUY6SW52b2tlU2VydmVyKCJncmF2ZXN0b25lRXZlbnQiLCAyKSwgIkVycm9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTg2NTMuMjA2LCAxNDAuOTg1LCA2MTYwLjAzMykpCiAgICAgICAgICAgICAgICBlbHNlaWYgc3RyaW5nLmZpbmQoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQ29tbUY6SW52b2tlU2VydmVyKCJncmF2ZXN0b25lRXZlbnQiLCAyKSwgIk5vdGhpbmciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9wb3MoIldhaXQgRnVsbCBNb29uIikKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRjpJbnZva2VTZXJ2ZXIoImdyYXZlc3RvbmVFdmVudCIsIDIsIHRydWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKVG9nZ2xlID0gR2V0OkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gR2V0IENESyIsIERlc2NyaXB0aW9uID0gIlRlbGVwb3J0IFRvIENsYWltIENESyIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9HZXRDREsgPSBWYWx1ZQplbmQpCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgcmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIGdldGdlbnYoKS5BdXRvR2V0Q0RLICAgIAogICAgbG9jYWwgaGFzTm90aWZpZWQgPSBmYWxzZQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCByZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgbG9jYWwgd29ya3NwYWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKQogICAgbG9jYWwgZW5lbWllcyA9IHdvcmtzcGFjZS5FbmVtaWVzCiAgICB3aGlsZSBnZXRnZW52KCkuQXV0b0dldENESyBkbwogICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkNES1F1ZXN0IiwgIlByb2dyZXNzIiwgIkdvb2QiKQogICAgICAgICAgICB0YXNrLndhaXQoMC4yKQogICAgICAgICAgICByZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkNES1F1ZXN0IiwgIlByb2dyZXNzIiwgIkV2aWwiKQogICAgICAgICAgICB0YXNrLndhaXQoMC4yKQogICAgICAgICAgICByZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkNES1F1ZXN0IiwgIlN0YXJ0VHJpYWwiLCAiQm9zcyIpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjIpICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGJvc3MgPSBlbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJDdXJzZWQgU2tlbGV0b24gQm9zcyIpCiAgICAgICAgICAgIGlmIGJvc3MgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMoZW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAiQ3Vyc2VkIFNrZWxldG9uIEJvc3MiIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHYuSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJhY2twYWNrID0gcGxheWVyLkJhY2twYWNrCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXI6RmluZEZpcnN0Q2hpbGQoIllhbWEiKSBvciBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiWWFtYSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKCJZYW1hIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlR1c2hpdGEiKSBvciBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiVHVzaGl0YSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKCJUdXNoaXRhIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG5vdCBoYXNOb3RpZmllZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJIaXJ1IEh1YiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJVc2UhIC0gWWFtYSBvciBUdXNoaXRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb24gPSAicmJ4YXNzZXRpZDovLzExOTk1MjEwOTk1IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc05vdGlmaWVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgQnVzbygpCiAgICAgICAgICAgICAgICAgICAgICAgIHYuSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdi5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHYuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsMzAsMCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN5biBhbmQgbm90IGdldGdlbnYoKS5TaW11bGF0aW9uU2V0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldGhpZGRlbnByb3BlcnR5KHBsYXllciwgIlNpbXVsYXRpb25SYWRpdXMiLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuU2ltdWxhdGlvblNldCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IGdldGdlbnYoKS5BdXRvR2V0Q0RLIG9yIG5vdCB2LlBhcmVudCBvciB2Lkh1bWFub2lkLkhlYWx0aCA8PSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygtMTIzMTguMTkzLCA2MDEuOTUxLCAtNjUzOC42NjIpKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgICAgIHRvcG9zKHdvcmtzcGFjZS5NYXAuVHVydGxlLkN1cnNlZC5Cb3NzRG9vci5DRnJhbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpClRvZ2dsZSA9IEdldDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFlhbWEiLCBEZWZhdWx0ID0gZmFsc2V9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkF1dG9ZYW1hID0gVmFsdWUKZW5kKQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvWWFtYSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwcm9ncmVzcyA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXzpJbnZva2VTZXJ2ZXIoIkVsaXRlSHVudGVyIiwgIlByb2dyZXNzIikKICAgICAgICAgICAgICAgIGlmIHByb2dyZXNzIGFuZCBwcm9ncmVzcyA+PSAzMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgICAgICBsb2NhbCB5YW1hSW5CYWNrcGFjayA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiWWFtYSIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2VhbGVkS2F0YW5hID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXA6RmluZEZpcnN0Q2hpbGQoIldhdGVyZmFsbCIpICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3QgeWFtYUluQmFja3BhY2sgYW5kIHNlYWxlZEthdGFuYSBhbmQgc2VhbGVkS2F0YW5hOkZpbmRGaXJzdENoaWxkKCJTZWFsZWRLYXRhbmEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNsaWNrRGV0ZWN0b3IgPSBzZWFsZWRLYXRhbmEuU2VhbGVkS2F0YW5hLkhhbmRsZTpGaW5kRmlyc3RDaGlsZCgiQ2xpY2tEZXRlY3RvciIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNsaWNrRGV0ZWN0b3IgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlY2xpY2tkZXRlY3RvcihjbGlja0RldGVjdG9yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJZYW1hIikgb3Igbm90IGdldGdlbnYoKS5BdXRvWWFtYQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBHZXQ6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiQXV0byBUdXNoaXRhIiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvVHVzaGl0YSA9IFZhbHVlCmVuZCkKc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuNSkgZG8KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1R1c2hpdGEgYW5kIFdvcmxkMyB0aGVuCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIGVuZW1pZXMgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVuZW1pZXMKICAgICAgICAgICAgICAgIGxvY2FsIGxvbmdtYSA9IGVuZW1pZXM6RmluZEZpcnN0Q2hpbGQoIkxvbmdtYSIpCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGhycCA9IGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgIGlmIGxvbmdtYSBhbmQgaHJwIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgZW5lbXkgaW4gcGFpcnMoZW5lbWllczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBlbmVteS5OYW1lID09ICJMb25nbWEiIGFuZCBlbmVteS5QYXJlbnQgYW5kIGVuZW15OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBlbmVteTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gZW5lbXkuSHVtYW5vaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gZW5lbXkuSHVtYW5vaWRSb290UGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFraSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5TZWxlY3RXZWFwb24gYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoZ2V0Z2VudigpLlNlbGVjdFdlYXBvbikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290UGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQuV2Fsa1NwZWVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm9vdFBhcnQuUG9zaXRpb24gLSBocnAuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3Mocm9vdFBhcnQuQ0ZyYW1lICogUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0aGlkZGVucHJvcGVydHkocGxheWVyLCAiU2ltdWxhdGlvblJhZGl1cyIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBnZXRnZW52KCkuQXV0b1R1c2hpdGEgb3Igbm90IGVuZW15LlBhcmVudCBvciBodW1hbm9pZC5IZWFsdGggPD0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRvcG9zKENGcmFtZS5uZXcoLTEwMjM4Ljg3NiwgMzg5Ljc5MSwgLTk1NDkuNzk0KSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBzdG9yZWRMb25nbWEgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIkxvbmdtYSIpCiAgICAgICAgICAgICAgICAgICAgaWYgc3RvcmVkTG9uZ21hIGFuZCBzdG9yZWRMb25nbWE6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFRQKHN0b3JlZExvbmdtYS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMiwgMjAsIDIpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IEdldDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJBdXRvIFNhYmVyIiwgRGVmYXVsdCA9IGZhbHNlfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGdldGdlbnYoKS5BdXRvU2FiZXIgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjUpIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9TYWJlciBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkRhdGEuTGV2ZWwuVmFsdWUgPj0gMjAwIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgbG9jYWwgaHJwID0gY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBpZiBub3QgaHJwIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgbG9jYWwganVuZ2xlID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuSnVuZ2xlCiAgICAgICAgICAgICAgICBsb2NhbCBkZXNlcnQgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5EZXNlcnQKICAgICAgICAgICAgICAgIGxvY2FsIHJlbGljUG9zID0gQ0ZyYW1lLm5ldygtMTQwNC45MSwgMjkuOTcsIDMuODApICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYganVuZ2xlLkZpbmFsLlBhcnQuVHJhbnNwYXJlbmN5ID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGp1bmdsZS5RdWVzdFBsYXRlcy5Eb29yLlRyYW5zcGFyZW5jeSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2FiZXJQb3MgPSBDRnJhbWUubmV3KC0xNjEyLjU1LCAzNi45NywgMTQ4LjcxKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2FiZXJQb3MuUG9zaXRpb24gLSBocnAuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSAxMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLCA1IGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGxhdGUgPSBqdW5nbGUuUXVlc3RQbGF0ZXM6RmluZEZpcnN0Q2hpbGQoIlBsYXRlIiAuLiBpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBsYXRlIGFuZCBwbGF0ZTpGaW5kRmlyc3RDaGlsZCgiQnV0dG9uIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBocnAuQ0ZyYW1lID0gcGxhdGUuQnV0dG9uLkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHNhYmVyUG9zKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRlc2VydC5CdXJuLlBhcnQuVHJhbnNwYXJlbmN5ID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJUb3JjaCIpIG9yIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlRvcmNoIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKCJUb3JjaCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoQ0ZyYW1lLm5ldygxMTE0LjYxLCA1LjA0LCA0MzUwLjIyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BvcyhDRnJhbWUubmV3KC0xNjEwLjAwLCAxMS41MCwgMTY0LjAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjb21tRiA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkNvbW1GXwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29tbUY6SW52b2tlU2VydmVyKCJQcm9RdWVzdFByb2dyZXNzIiwgIlNpY2tNYW4iKSB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tRjpJbnZva2VTZXJ2ZXIoIlByb1F1ZXN0UHJvZ3Jlc3MiLCAiR2V0Q3VwIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKCJDdXAiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbUY6SW52b2tlU2VydmVyKCJQcm9RdWVzdFByb2dyZXNzIiwgIkZpbGxDdXAiLCBjaGFyOkZpbmRGaXJzdENoaWxkKCJDdXAiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1GOkludm9rZVNlcnZlcigiUHJvUXVlc3RQcm9ncmVzcyIsICJTaWNrTWFuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjb21tRjpJbnZva2VTZXJ2ZXIoIlByb1F1ZXN0UHJvZ3Jlc3MiLCAiUmljaFNvbiIpID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1GOkludm9rZVNlcnZlcigiUHJvUXVlc3RQcm9ncmVzcyIsICJSaWNoU29uIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgY29tbUY6SW52b2tlU2VydmVyKCJQcm9RdWVzdFByb2dyZXNzIiwgIlJpY2hTb24iKSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbW9iTGVhZGVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJNb2IgTGVhZGVyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IG1vYkxlYWRlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2JMZWFkZXIgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6RmluZEZpcnN0Q2hpbGQoIk1vYiBMZWFkZXIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbW9iTGVhZGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKG1vYkxlYWRlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0hha2koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKGdldGdlbnYoKS5TZWxlY3RXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9iTGVhZGVyLkh1bWFub2lkUm9vdFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9iTGVhZGVyLkh1bWFub2lkLldhbGtTcGVlZCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3Bvcyhtb2JMZWFkZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIik6QnV0dG9uMURvd24oVmVjdG9yMi5uZXcoMTI4MCwgNjcyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRoaWRkZW5wcm9wZXJ0eShwbGF5ZXIsICJTaW11bGF0aW9uUmFkaXVzIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbW9iTGVhZGVyLkh1bWFub2lkLkhlYWx0aCA8PSAwIG9yIG5vdCBnZXRnZW52KCkuQXV0b1NhYmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBjb21tRjpJbnZva2VTZXJ2ZXIoIlByb1F1ZXN0UHJvZ3Jlc3MiLCAiUmljaFNvbiIpID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tRjpJbnZva2VTZXJ2ZXIoIlByb1F1ZXN0UHJvZ3Jlc3MiLCAiUmljaFNvbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVxdWlwV2VhcG9uKCJSZWxpYyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcG9zKHJlbGljUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHNhYmVyRXhwZXJ0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5FbmVtaWVzOkZpbmRGaXJzdENoaWxkKCJTYWJlciBFeHBlcnQiKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzYWJlckV4cGVydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNhYmVyRXhwZXJ0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKCJTYWJlciBFeHBlcnQiKQogICAgICAgICAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgc2FiZXJFeHBlcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcXVpcFdlYXBvbihnZXRnZW52KCkuU2VsZWN0V2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3Moc2FiZXJFeHBlcnQuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYWJlckV4cGVydC5IdW1hbm9pZFJvb3RQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2MCwgNjAsIDYwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FiZXJFeHBlcnQuSHVtYW5vaWRSb290UGFydC5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYWJlckV4cGVydC5IdW1hbm9pZC5KdW1wUG93ZXIgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYWJlckV4cGVydC5IdW1hbm9pZC5XYWxrU3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYWJlckV4cGVydC5IdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNhcHR1cmVDb250cm9sbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBzYWJlckV4cGVydC5IdW1hbm9pZC5IZWFsdGggPD0gMCBvciBub3QgZ2V0Z2VudigpLkF1dG9TYWJlciAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBzYWJlckV4cGVydC5IdW1hbm9pZC5IZWFsdGggPD0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5Db21tRl86SW52b2tlU2VydmVyKCJQcm9RdWVzdFByb2dyZXNzIiwgIlBsYWNlUmVsaWMiKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpFU1AgPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiVGFiIEVTUCIsIEljb24gPSAiIiB9KQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKbG9jYWwgSXNsYW5kRVNQID0gZmFsc2UKbG9jYWwgdXBkYXRlQ29ubmVjdGlvbgpmdW5jdGlvbiBVcGRhdGVJc2xhbmRFU1AoKQogICAgaWYgbm90IHBsYXllciBvciBub3QgcGxheWVyLkNoYXJhY3RlciBvciBub3QgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgaGVhZFBvc2l0aW9uID0gcGxheWVyLkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uCiAgICBsb2NhbCBsb2NhdGlvbnMgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6R2V0Q2hpbGRyZW4oKQogICAgZm9yIF8sIHYgaW4gaXBhaXJzKGxvY2F0aW9ucykgZG8KICAgICAgICBpZiB2Lk5hbWUgfj0gIlNlYSIgdGhlbgogICAgICAgICAgICBpZiBJc2xhbmRFU1AgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgYmlsbCA9IHY6RmluZEZpcnN0Q2hpbGQoIk5hbWVFc3AiKQogICAgICAgICAgICAgICAgaWYgbm90IGJpbGwgdGhlbgogICAgICAgICAgICAgICAgICAgIGJpbGwgPSBJbnN0YW5jZS5uZXcoIkJpbGxib2FyZEd1aSIpCiAgICAgICAgICAgICAgICAgICAgYmlsbC5OYW1lID0gIk5hbWVFc3AiCiAgICAgICAgICAgICAgICAgICAgYmlsbC5FeHRlbnRzT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwgMSwgMCkKICAgICAgICAgICAgICAgICAgICBiaWxsLlNpemUgPSBVRGltMi5uZXcoMSwgMjAwLCAxLCAzMCkKICAgICAgICAgICAgICAgICAgICBiaWxsLkFkb3JuZWUgPSB2CiAgICAgICAgICAgICAgICAgICAgYmlsbC5BbHdheXNPblRvcCA9IHRydWUKICAgICAgICAgICAgICAgICAgICBiaWxsLlBhcmVudCA9IHYKICAgICAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiLCBiaWxsKQogICAgICAgICAgICAgICAgICAgIG5hbWUuRm9udCA9IEVudW0uRm9udC5Hb3RoYW1Cb2xkCiAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0U2l6ZSA9IDE0CiAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0V3JhcHBlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICBuYW1lLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkKICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRZQWxpZ25tZW50ID0gRW51bS5UZXh0WUFsaWdubWVudC5Ub3AKICAgICAgICAgICAgICAgICAgICBuYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICBuYW1lLlBhcmVudCA9IGJpbGwKICAgICAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRMYWJlbCA9IGJpbGw6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUZXh0TGFiZWwiKQogICAgICAgICAgICAgICAgaWYgdGV4dExhYmVsIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChoZWFkUG9zaXRpb24gLSB2LlBvc2l0aW9uKS5NYWduaXR1ZGUgLyAzCiAgICAgICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHQgPSBzdHJpbmcuZm9ybWF0KCIlc1xuJWQgRGlzdGFuY2UiLCB2Lk5hbWUsIG1hdGguZmxvb3IoZGlzdGFuY2UgKyAwLjUpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvY2FsIGV4aXN0aW5nQmlsbCA9IHY6RmluZEZpcnN0Q2hpbGQoIk5hbWVFc3AiKQogICAgICAgICAgICAgICAgaWYgZXhpc3RpbmdCaWxsIHRoZW4KICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0JpbGw6RGVzdHJveSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kClRvZ2dsZSA9IEVTUDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJFU1AgSXNsYW5kIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBJc2xhbmRFU1AgPSBWYWx1ZQogICAgaWYgSXNsYW5kRVNQIHRoZW4KICAgICAgICBpZiBub3QgdXBkYXRlQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgIHVwZGF0ZUNvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KFVwZGF0ZUlzbGFuZEVTUCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBpZiB1cGRhdGVDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgdXBkYXRlQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgdXBkYXRlQ29ubmVjdGlvbiA9IG5pbAogICAgICAgIGVuZAogICAgICAgIGZvciBfLCB2IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpWyJfV29ybGRPcmlnaW4iXS5Mb2NhdGlvbnM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgbG9jYWwgZXhpc3RpbmdCaWxsID0gdjpGaW5kRmlyc3RDaGlsZCgiTmFtZUVzcCIpCiAgICAgICAgICAgIGlmIGV4aXN0aW5nQmlsbCB0aGVuCiAgICAgICAgICAgICAgICBleGlzdGluZ0JpbGw6RGVzdHJveSgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCmxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCmxvY2FsIERldmlsRnJ1aXRFU1AgPSBmYWxzZQpsb2NhbCB1cGRhdGVDb25uZWN0aW9uCmxvY2FsIE51bWJlciA9IG1hdGgucmFuZG9tKDEsIDEwMDAwMDApCmZ1bmN0aW9uIFVwZGF0ZURldmlsQ2hhbXMoKQogICAgaWYgbm90IHBsYXllciBvciBub3QgcGxheWVyLkNoYXJhY3RlciBvciBub3QgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgaGVhZFBvc2l0aW9uID0gcGxheWVyLkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uCiAgICBmb3IgXywgdiBpbiBpcGFpcnMoZ2FtZS5Xb3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIHY6SXNBKCJNb2RlbCIpIGFuZCBzdHJpbmcuZmluZCh2Lk5hbWUsICJGcnVpdCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIYW5kbGUiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBoYW5kbGUgPSB2LkhhbmRsZQogICAgICAgICAgICAgICAgaWYgRGV2aWxGcnVpdEVTUCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYmlsbCA9IGhhbmRsZTpGaW5kRmlyc3RDaGlsZCgiTmFtZUVzcCIgLi4gTnVtYmVyKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBiaWxsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYmlsbCA9IEluc3RhbmNlLm5ldygiQmlsbGJvYXJkR3VpIikKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbC5OYW1lID0gIk5hbWVFc3AiIC4uIE51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLkV4dGVudHNPZmZzZXQgPSBWZWN0b3IzLm5ldygwLCAxLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLlNpemUgPSBVRGltMi5uZXcoMSwgMjAwLCAxLCAzMCkKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbC5BZG9ybmVlID0gaGFuZGxlCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGwuQWx3YXlzT25Ub3AgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGwuUGFyZW50ID0gaGFuZGxlCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIsIGJpbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuRm9udCA9IEVudW0uRm9udC5Hb3RoYW1TZW1pYm9sZAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRTaXplID0gMTQKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0V3JhcHBlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDEsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dFlBbGlnbm1lbnQgPSBFbnVtLlRleHRZQWxpZ25tZW50LlRvcAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDAuNQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlBhcmVudCA9IGJpbGwKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0TGFiZWwgPSBiaWxsOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiVGV4dExhYmVsIikKICAgICAgICAgICAgICAgICAgICBpZiB0ZXh0TGFiZWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChoZWFkUG9zaXRpb24gLSBoYW5kbGUuUG9zaXRpb24pLk1hZ25pdHVkZSAvIDMKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHQgPSBzdHJpbmcuZm9ybWF0KCIlc1xuJWQgRGlzdGFuY2UiLCB2Lk5hbWUsIG1hdGguZmxvb3IoZGlzdGFuY2UgKyAwLjUpKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGV4aXN0aW5nQmlsbCA9IGhhbmRsZTpGaW5kRmlyc3RDaGlsZCgiTmFtZUVzcCIgLi4gTnVtYmVyKQogICAgICAgICAgICAgICAgICAgIGlmIGV4aXN0aW5nQmlsbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nQmlsbDpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kClRvZ2dsZSA9IEVTUDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJFU1AgRnJ1aXQiLCBEZWZhdWx0ID0gZmFsc2UgfSkKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIERldmlsRnJ1aXRFU1AgPSBWYWx1ZQogICAgaWYgRGV2aWxGcnVpdEVTUCB0aGVuCiAgICAgICAgaWYgbm90IHVwZGF0ZUNvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICB1cGRhdGVDb25uZWN0aW9uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChVcGRhdGVEZXZpbENoYW1zKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGlmIHVwZGF0ZUNvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICB1cGRhdGVDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICB1cGRhdGVDb25uZWN0aW9uID0gbmlsCiAgICAgICAgZW5kCiAgICAgICAgZm9yIF8sIHYgaW4gaXBhaXJzKGdhbWUuV29ya3NwYWNlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIHY6SXNBKCJNb2RlbCIpIGFuZCBzdHJpbmcuZmluZCh2Lk5hbWUsICJGcnVpdCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIYW5kbGUiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBoYW5kbGUgPSB2LkhhbmRsZQogICAgICAgICAgICAgICAgbG9jYWwgZXhpc3RpbmdCaWxsID0gaGFuZGxlOkZpbmRGaXJzdENoaWxkKCJOYW1lRXNwIiAuLiBOdW1iZXIpCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ0JpbGwgdGhlbgogICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nQmlsbDpEZXN0cm95KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQpsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgpsb2NhbCBFU1BQbGF5ZXIgPSBmYWxzZQpsb2NhbCB1cGRhdGVDb25uZWN0aW9uCmxvY2FsIE51bWJlciA9IG1hdGgucmFuZG9tKDEsIDEwMDAwMDApCmZ1bmN0aW9uIFVwZGF0ZVBsYXllckNoYW1zKCkKICAgIGlmIG5vdCBwbGF5ZXIgb3Igbm90IHBsYXllci5DaGFyYWN0ZXIgb3Igbm90IHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuIHJldHVybiBlbmQKICAgIGxvY2FsIGhlYWRQb3NpdGlvbiA9IHBsYXllci5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbgogICAgZm9yIF8sIHYgaW4gaXBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkdldFBsYXllcnMoKSkgZG8KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIHYgfj0gcGxheWVyIGFuZCB2LkNoYXJhY3RlciBhbmQgdi5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSBhbmQgdi5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaGVhZCA9IHYuQ2hhcmFjdGVyLkhlYWQKICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gdi5DaGFyYWN0ZXIuSHVtYW5vaWQKICAgICAgICAgICAgICAgIGxvY2FsIGJpbGwgPSBoZWFkOkZpbmRGaXJzdENoaWxkKCJOYW1lRXNwIiAuLiBOdW1iZXIpCiAgICAgICAgICAgICAgICBpZiBFU1BQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBiaWxsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYmlsbCA9IEluc3RhbmNlLm5ldygiQmlsbGJvYXJkR3VpIikKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbC5OYW1lID0gIk5hbWVFc3AiIC4uIE51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLkV4dGVudHNPZmZzZXQgPSBWZWN0b3IzLm5ldygwLCAxLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLlNpemUgPSBVRGltMi5uZXcoMSwgMjAwLCAxLCAzMCkKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbC5BZG9ybmVlID0gaGVhZAogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLkFsd2F5c09uVG9wID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsLlBhcmVudCA9IGhlYWQKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmFtZSA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIiwgYmlsbCkKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5Gb250ID0gRW51bS5Gb250LkdvdGhhbVNlbWlib2xkCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuVGV4dFNpemUgPSAxNAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlRleHRXcmFwcGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuVG9wCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5UZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuUGFyZW50ID0gYmlsbAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRleHRMYWJlbCA9IGJpbGw6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUZXh0TGFiZWwiKQogICAgICAgICAgICAgICAgICAgIGlmIHRleHRMYWJlbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gbWF0aC5mbG9vcigoaGVhZFBvc2l0aW9uIC0gaGVhZC5Qb3NpdGlvbikuTWFnbml0dWRlIC8gMyArIDAuNSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaGVhbHRoUGVyY2VudCA9IG1hdGguZmxvb3IoKGh1bWFub2lkLkhlYWx0aCAvIGh1bWFub2lkLk1heEhlYWx0aCkgKiAxMDAgKyAwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiJXNcbiVkIERpc3RhbmNlXG5IZWFsdGg6ICVkJSUiLCB2Lk5hbWUsIGRpc3RhbmNlLCBoZWFsdGhQZXJjZW50KQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2LlRlYW0gPT0gcGxheWVyLlRlYW0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAyNTUsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAwLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZiBiaWxsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYmlsbDpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kClRvZ2dsZSA9IEVTUDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJFU1AgUGxheWVyIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBFU1BQbGF5ZXIgPSBWYWx1ZQogICAgaWYgRVNQUGxheWVyIHRoZW4KICAgICAgICBpZiBub3QgdXBkYXRlQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgIHVwZGF0ZUNvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KFVwZGF0ZVBsYXllckNoYW1zKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGlmIHVwZGF0ZUNvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICB1cGRhdGVDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICB1cGRhdGVDb25uZWN0aW9uID0gbmlsCiAgICAgICAgZW5kCiAgICAgICAgZm9yIF8sIHYgaW4gaXBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgdiB+PSBwbGF5ZXIgYW5kIHYuQ2hhcmFjdGVyIGFuZCB2LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGhlYWQgPSB2LkNoYXJhY3Rlci5IZWFkCiAgICAgICAgICAgICAgICBsb2NhbCBleGlzdGluZ0JpbGwgPSBoZWFkOkZpbmRGaXJzdENoaWxkKCJOYW1lRXNwIiAuLiBOdW1iZXIpCiAgICAgICAgICAgICAgICBpZiBleGlzdGluZ0JpbGwgdGhlbgogICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nQmlsbDpEZXN0cm95KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClBWUCA9IFdpbmRvdzpBZGRUYWIoeyBUaXRsZSA9ICJUYWIgUFZQIiwgSWNvbiA9ICIiIH0pCmxvY2FsIFBsYXllcnNsaXN0ID0ge30KZm9yIGksIHBsYXllciBpbiBpcGFpcnMoZ2FtZS5QbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIFBsYXllcnNsaXN0W2ldID0gcGxheWVyLk5hbWUKZW5kICAgIApEcm9wZG93biA9IFBWUDpBZGREcm9wZG93bigiRHJvcGRvd24iLCB7CiAgICAgVGl0bGUgPSAiU2VsZWN0IFBsYXllciBQVlAiLAogICAgIFZhbHVlcyA9IFBsYXllcnNsaXN0LAogICAgIE11bHRpID0gZmFsc2UsCiAgICAgRGVmYXVsdCA9IGZhbHNlLAp9KQpEcm9wZG93bjpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgIGdldGdlbnYoKS5TZWxlY3RQbGF5ZXIgPSBWYWx1ZQplbmQpClRvZ2dsZSA9IFBWUDpBZGRUb2dnbGUoIk15VG9nZ2xlIiwgewogICAgVGl0bGUgPSAiVGVsZXBvcnQgUGxheWVyIiwKICAgIERlZmF1bHQgPSBmYWxzZQp9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLlRlbGVwb3J0UGxheWVyID0gVmFsdWUKICAgIGlmIGdldGdlbnYoKS5UZWxlcG9ydFBsYXllciB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIGdldGdlbnYoKS5UZWxlcG9ydFBsYXllciBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIik6RmluZEZpcnN0Q2hpbGQoZ2V0Z2VudigpLlNlbGVjdFBsYXllcikKICAgICAgICAgICAgICAgIGlmIHBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHJwID0gcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgaWYgaHJwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG9wb3MoaHJwLkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKVG9nZ2xlID0gUFZQOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gQWltYm90IiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuQWltYm90ID0gVmFsdWUKZW5kKSAgICAgICAgCnNwYXduKGZ1bmN0aW9uKCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgICAgICBpZiBnZXRnZW52KCkuQWltYm90IGFuZCBnZXRnZW52KCkuU2VsZWN0UGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChnZXRnZW52KCkuU2VsZWN0UGxheWVyKQogICAgICAgICAgICAgICAgbG9jYWwgbG9jYWxQbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgbG9jYWwgdG9vbCA9IGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiVG9vbCIpCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXIgYW5kIHRvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHJlbW90ZUV2ZW50ID0gdG9vbDpGaW5kRmlyc3RDaGlsZCgiUmVtb3RlRXZlbnQiKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIG1vdXNlUG9zID0gdG9vbDpGaW5kRmlyc3RDaGlsZCgiTW91c2VQb3MiKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgIGlmIHJlbW90ZUV2ZW50IGFuZCBtb3VzZVBvcyBhbmQgdGFyZ2V0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3RlRXZlbnQ6RmlyZVNlcnZlcih0YXJnZXQuUG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKVG9nZ2xlID0gUFZQOkFkZFRvZ2dsZSgiVG9nZ2xlIiwge1RpdGxlID0gIkF1dG8gQWltYm90IEd1biIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQogICAgZ2V0Z2VudigpLkFpbWJvdEd1biA9IFZhbHVlCmVuZCkgICAgICAgIApzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5BaW1ib3RHdW4gYW5kIFNlbGVjdFdlYXBvbkd1biB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICBsb2NhbCB3ZWFwb24gPSBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChTZWxlY3RXZWFwb25HdW4pCiAgICAgICAgICAgIGxvY2FsIHRhcmdldFBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkZpbmRGaXJzdENoaWxkKGdldGdlbnYoKS5TZWxlY3RQbGF5ZXIpCiAgICAgICAgICAgIGxvY2FsIHRhcmdldENoYXJhY3RlciA9IHRhcmdldFBsYXllciBhbmQgdGFyZ2V0UGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICBsb2NhbCB0YXJnZXRIdW1hbm9pZFJvb3RQYXJ0ID0gdGFyZ2V0Q2hhcmFjdGVyIGFuZCB0YXJnZXRDaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICBpZiB3ZWFwb24gYW5kIHRhcmdldEh1bWFub2lkUm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHdlYXBvbi5Db29sZG93bi5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSB0YXJnZXRIdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBbMl0gPSB0YXJnZXRIdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdlYXBvbi5SZW1vdGVGdW5jdGlvblNob290Okludm9rZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmlydHVhbFVzZXIgPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIikKICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsVXNlcjpCdXR0b24xRG93bihWZWN0b3IyLm5ldygxMjgwLCA2NzIpKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpClRvZ2dsZSA9IFBWUDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHtUaXRsZSA9ICJTYWZlIE1vZGVzIiwgRGVmYXVsdCA9IGZhbHNlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuU2FmZU1vZGUgPSBWYWx1ZQplbmQpCnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuU2FmZU1vZGUgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgQ2hhcmFjdGVyUGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgQ2hhcmFjdGVyUGxheWVyIGFuZCBDaGFyYWN0ZXJQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIENoYXJhY3RlclBsYXllcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBIZWFsdGhNaW5QbGF5ZXIgPSBDaGFyYWN0ZXJQbGF5ZXIuSHVtYW5vaWQuTWF4SGVhbHRoICogKGdldGdlbnYoKS5TYWZlIC8gMTAwKQogICAgICAgICAgICAgICAgICAgIGlmIENoYXJhY3RlclBsYXllci5IdW1hbm9pZC5IZWFsdGggPD0gSGVhbHRoTWluUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgZ2V0Z2VudigpLlNhZmVNb2RlIGFuZCBDaGFyYWN0ZXJQbGF5ZXIuSHVtYW5vaWQuSGVhbHRoIDw9IEhlYWx0aE1pblBsYXllciBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXJhY3RlclBsYXllci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENoYXJhY3RlclBsYXllci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSArIFZlY3RvcjMubmV3KDAsIDUwLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQpTbGlkZXIgPSBQVlA6QWRkU2xpZGVyKCJTbGlkZXIiLCB7CiAgICBUaXRsZSA9ICJTYWZlIE1vZGUgQXQiLAogICAgRGVmYXVsdCA9IDMwLAogICAgTWluID0gMCwKICAgIE1heCA9IDEwMCwKICAgIFJvdW5kaW5nID0gNSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgZ2V0Z2VudigpLlNhZmUgPSBWYWx1ZQogICAgZW5kCn0pClRvZ2dsZSA9IFBWUDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsgVGl0bGUgPSAiV2FsayBPbiBXYXRlciIsIERlZmF1bHQgPSB0cnVlIH0pClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpCiAgICBnZXRnZW52KCkuV2Fsa1dhdGVyID0gVmFsdWUgICAgCiAgICBsb2NhbCB3YXRlclBsYW5lID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXBbIldhdGVyQmFzZS1QbGFuZSJdCiAgICBpZiBnZXRnZW52KCkuV2Fsa1dhdGVyIHRoZW4KICAgICAgICB3YXRlclBsYW5lLlNpemUgPSBWZWN0b3IzLm5ldygxMDAwLCAxMTIsIDEwMDApCiAgICBlbHNlCiAgICAgICAgd2F0ZXJQbGFuZS5TaXplID0gVmVjdG9yMy5uZXcoMTAwMCwgODAsIDEwMDApCiAgICBlbmQKZW5kKQpUb2dnbGUgPSBQVlA6QWRkVG9nZ2xlKCJUb2dnbGUiLCB7VGl0bGUgPSAiTm8gQ2xpcCIsIERlZmF1bHQgPSBmYWxzZSB9KQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKHYpCiAgICBnZXRnZW52KCkuTm9DbGlwID0gdgogICAgaWYgZ2V0Z2VudigpLk5vQ2xpcENvbm5lY3Rpb24gdGhlbiBnZXRnZW52KCkuTm9DbGlwQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkgZW5kCiAgICBpZiB2IHRoZW4KICAgICAgICBnZXRnZW52KCkuTm9DbGlwQ29ubmVjdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGZvciBfLCBwIGluIGlwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiBwOklzQSgiQmFzZVBhcnQiKSB0aGVuIHAuQ2FuQ29sbGlkZSA9IGZhbHNlIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgZm9yIF8sIHAgaW4gaXBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgaWYgcDpJc0EoIkJhc2VQYXJ0IikgdGhlbiBwLkNhbkNvbGxpZGUgPSB0cnVlIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKZ2V0Z2VudigpLldhbGtTcGVlZCA9IDE2ClRvZ2dsZSA9IFBWUDpBZGRUb2dnbGUoIlRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIkNoYW5nZSBXYWxrU3BlZWQiLAogICAgRGVmYXVsdCA9IGZhbHNlCn0pCmxvY2FsIFNwZWVkQ29ubmVjdGlvbgpsb2NhbCBmdW5jdGlvbiBBcHBseVNwZWVkKCkKICAgIGlmIG5vdCBUb2dnbGUuVmFsdWUgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBDaGFyYWN0ZXIgPSBQbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBDaGFyYWN0ZXIgdGhlbgogICAgICAgIGxvY2FsIEh1bWFub2lkID0gQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgICAgIGlmIEh1bWFub2lkIHRoZW4KICAgICAgICAgICAgSHVtYW5vaWQuV2Fsa1NwZWVkID0gZ2V0Z2VudigpLldhbGtTcGVlZAogICAgICAgICAgICBpZiBTcGVlZENvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICAgICAgU3BlZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgU3BlZWRDb25uZWN0aW9uID0gSHVtYW5vaWQ6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCJXYWxrU3BlZWQiKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIFRvZ2dsZS5WYWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgSHVtYW5vaWQuV2Fsa1NwZWVkID0gZ2V0Z2VudigpLldhbGtTcGVlZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBBcHBseVNwZWVkKCkKICAgICAgICBQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChBcHBseVNwZWVkKQogICAgZWxzZQogICAgICAgIGlmIFNwZWVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgIFNwZWVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgU3BlZWRDb25uZWN0aW9uID0gbmlsCiAgICAgICAgZW5kCiAgICAgICAgbG9jYWwgQ2hhcmFjdGVyID0gUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIENoYXJhY3RlciB0aGVuCiAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkID0gQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgICAgICAgICBpZiBIdW1hbm9pZCB0aGVuCiAgICAgICAgICAgICAgICBIdW1hbm9pZC5XYWxrU3BlZWQgPSAxNgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCklucHV0ID0gUFZQOkFkZElucHV0KCJJbnB1dCIsIHsKICAgICBUaXRsZSA9ICJJbnB1dCBXYWxrU3BlZWQiLAogICAgIERlZmF1bHQgPSAxMDAsCiAgICAgUGxhY2Vob2xkZXIgPSAiSW5wdXQiLAogICAgIE51bWVyaWMgPSB0cnVlLAogICAgIEZpbmlzaGVkID0gdHJ1ZSwKICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICBnZXRnZW52KCkuV2Fsa1NwZWVkID0gVmFsdWUKICAgICBlbmQKfSkKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpwcmludCgiLS1bW0ltYWdlQnV0dG9uXV0tLSIpCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBDb250ZW50UHJvdmlkZXIgPSBnYW1lOkdldFNlcnZpY2UoIkNvbnRlbnRQcm92aWRlciIpCmxvY2FsIHBsYXllckd1aSA9IFBsYXllcnMuTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJQbGF5ZXJHdWkiKQpsb2NhbCBleGlzdGluZ0d1aSA9IHBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiQ3VzdG9tU2NyZWVuR3VpIikKaWYgZXhpc3RpbmdHdWkgdGhlbgogICAgZXhpc3RpbmdHdWk6RGVzdHJveSgpCmVuZApsb2NhbCBTY3JlZW5HdWkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpClNjcmVlbkd1aS5OYW1lID0gIkN1c3RvbVNjcmVlbkd1aSIKU2NyZWVuR3VpLlBhcmVudCA9IHBsYXllckd1aQpsb2NhbCBCdXR0b24gPSBJbnN0YW5jZS5uZXcoIkltYWdlQnV0dG9uIikKQnV0dG9uLk5hbWUgPSAiQ3VzdG9tQnV0dG9uIgpCdXR0b24uUGFyZW50ID0gU2NyZWVuR3VpCkJ1dHRvbi5TaXplID0gVURpbTIubmV3KDAsIDUwLCAwLCA1MCkKQnV0dG9uLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDE1LCAwLCAwLjAyLCAyMCkKQnV0dG9uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCkJ1dHRvbi5JbWFnZSA9ICJyYnhhc3NldGlkOi8vMTAwMzEwODI3NzE0NzE5Igpsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQpVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKQpVSUNvcm5lci5QYXJlbnQgPSBCdXR0b24KbG9jYWwgaW1hZ2VMb2FkZWQgPSBmYWxzZQpDb250ZW50UHJvdmlkZXI6UHJlbG9hZEFzeW5jKHtCdXR0b24uSW1hZ2V9LCBmdW5jdGlvbigpCiAgICBpbWFnZUxvYWRlZCA9IHRydWUKZW5kKQpCdXR0b24uTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCiAgICBpZiBub3QgaW1hZ2VMb2FkZWQgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCiAgICBsb2NhbCBWaXJ0dWFsSW5wdXRNYW5hZ2VyID0gZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIikKICAgIGlmIFZpcnR1YWxJbnB1dE1hbmFnZXIgdGhlbgogICAgICAgIHRhc2suZGVmZXIoZnVuY3Rpb24oKQogICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCBFbnVtLktleUNvZGUuTGVmdENvbnRyb2wsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwgRW51bS5LZXlDb2RlLkxlZnRDb250cm9sLCBmYWxzZSwgZ2FtZSkKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQotLVxcIOKZoVZJUOKZoQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCnByaW50KCItLVtbSG9wIFNlcnZlciBJZiBZb3UgTWVldCBHYW1lIEFkbWluXV0tLSIpCmxvY2FsIHRhcmdldFBsYXllcnMgPSB7CiAgICBbInJlZF9nYW1lNDMiXSA9IHRydWUsCiAgICBbInJpcF9pbmRyYSJdID0gdHJ1ZSwKICAgIFsiQXhpb3JlIl0gPSB0cnVlLAogICAgWyJQb2xrc3RlciJdID0gdHJ1ZSwKICAgIFsid2VubG9ja3RvYWQiXSA9IHRydWUsCiAgICBbIkRhaWdyb2NrIl0gPSB0cnVlLAogICAgWyJ0b2lsYW12aWRhbW1lIl0gPSB0cnVlLAogICAgWyJvb2ZmaWNpYWxub29iaWUiXSA9IHRydWUsCiAgICBbIlV6b3RoIl0gPSB0cnVlLAogICAgWyJBemFydGgiXSA9IHRydWUsCiAgICBbImFybHRobWV0aWMiXSA9IHRydWUsCiAgICBbIkRlYXRoX0tpbmciXSA9IHRydWUsCiAgICBbIkx1bm92ZW4iXSA9IHRydWUsCiAgICBbIlRoZUdyZWF0ZUFjZWQiXSA9IHRydWUsCiAgICBbInJpcF9mdWQiXSA9IHRydWUsCiAgICBbImRyaXBfbWFtYSJdID0gdHJ1ZSwKICAgIFsibGF5YW5kaWtpdDEyIl0gPSB0cnVlLAogICAgWyJIaW5nb2kiXSA9IHRydWUKfQpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgd2FpdCgxKQogICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWUuUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgIGlmIHRhcmdldFBsYXllcnNbdi5OYW1lXSB0aGVuCiAgICAgICAgICAgICAgICBIb3AoKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQpsb2NhbCBsYXN0Tm90aWZpY2F0aW9uVGltZSA9IDAKbG9jYWwgbm90aWZpY2F0aW9uQ29vbGRvd24gPSAxMApsb2NhbCBjdXJyZW50VGltZSA9IHRpY2soKQppZiBjdXJyZW50VGltZSAtIGxhc3ROb3RpZmljYXRpb25UaW1lID49IG5vdGlmaWNhdGlvbkNvb2xkb3duIHRoZW4KICAgIGdhbWUuU3RhcnRlckd1aTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIkhpcnUgSHViIiwKICAgICAgICBUZXh0ID0gIlN1Y2Nlc3NmdWxseSIsCiAgICAgICAgRHVyYXRpb24gPSAxCiAgICB9KQogICAgbGFzdE5vdGlmaWNhdGlvblRpbWUgPSBjdXJyZW50VGltZQplbmQK'
local function decode(str)
    local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    str = string.gsub(str, '[^'..b..'=]', '')
    return (str:gsub('.', function(x)
        if x == '=' then return '' end
        local r,f='',(b:find(x)-1)
        for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and '1' or '0') end
        return r
    end):gsub('%d%d%d?%d?%d?%d?', function(x)
        if #x < 6 then return '' end
        local c=0
        for i=1,6 do c=c+(x:sub(i,i)=='1' and 2^(6-i) or 0) end
        return string.char(c)
    end))
end

-- Chống debug và dump
local function anti_debug()
    local dbg = require("debug")
    if dbg then
        pcall(function() debug.sethook(function() os.exit() end, "", 1) end)
        pcall(function() debug.getinfo(2, "S") end)
        pcall(function() debug.setupvalue(function() end, 1, nil) end)
        pcall(function() debug.getupvalue(function() end, 1) end)
    end
end

anti_debug()

-- Chạy mã Lua đã được giải mã
local success, err = pcall(load(decode(b64)))
if not success then
    print("Error running script:", err)
end
